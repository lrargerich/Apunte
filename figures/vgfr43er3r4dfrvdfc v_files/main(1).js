define("shared/adlibrary/helpers/filter-placements-mixin",["underscore/nyt"],function(e){"use strict";var t={map:{forcexxl:{placement:"lede-ad",size:[468,648]},force970x250:{placement:"TopAd",size:[970,250]},force970x90:{placement:"TopAd",size:[970,90]},forcemega:{placement:"MegaAd",size:[1600,512]},force300x600:{placement:["lede-ad","MiddleRight"],size:[300,600]},force300x250:{placement:"lede-ad",size:[300,250]},force970x418:{placement:"MegaAd",size:[970,418]},forcexxl2:{placement:"lede-ad",size:[450,623]}},run:function(t,i){var n;!e.isUndefined(t)&&this.map[t]&&(n=this.map[t],e.isArray(n.placement)?e.each(n.placement,function(e){i[e]&&(i[e]=n.size)}):i[n.placement]&&(i[n.placement]=n.size))}};return t}),define("shared/adlibrary/views/base-ad",["underscore/nyt","foundation/views/base-view","shared/adlibrary/helpers/filter-placements-mixin"],function(e,t,i){"use strict";var n=t.extend({isReady:!1,constructor:function(e){this.isDisabled()||(this.setUpOptions(e),i.run(this.pageManager.getUrlParam("ad-keywords"),this.placements),t.apply(this,arguments),this.sitewide.initialize(this),this.sitewide.async||(this.sitewide.isReady=!0,this.signalReady()),this.requirements.initialize(this),this.requirements.async||(this.requirements.isReady=!0,this.signalReady()))},requirements:{async:!1,initialize:function(e){this[e.viewName]=e}},sitewide:{async:!1,initialize:function(e){this[e.viewName]=e}},placements:{TopAd:[[728,90],[970,90],[970,66],[970,250]]},broadcastAdEvent:function(){var e,t,i=Array.prototype.slice.call(arguments);if(0===i.length)throw"Please provide event name as the first argument to notify()";e=i.slice(0,1)[0],i=i.slice(1),t=-1===e.indexOf("nyt:")?"nyt:ad-library:"+this.viewName+":"+e:e,this.broadcast.apply(this,[t].concat(i))},listenToAdEvent:function(e,t){var i=Array.prototype.slice.call(arguments,2),n="boolean"==typeof i[0]?i[0]:!1,s="object"==typeof i[0]?i[0]:i[1],a=n?"listenToOnce":"listenTo",o=-1===e.indexOf("nyt:")?"nyt:ad-library:"+this.viewName+":"+e:e;if(arguments.length<2)throw"Please provide event name and callback to watch()";this[a].call(s||this,this.pageManager,o,t)},ignoreAdEvent:function(e,t){var i=-1===e.indexOf("nyt:")?"nyt:ad-library:"+this.viewName+":"+e:e;this.stopSubscribing(i,t)},signalReady:function(){this.sitewide.isReady&&this.requirements.isReady&&this.broadcastAdEvent("ready")},triggerTagX:function(){var e=this.$html,t={module:"Page",viewportWidth:this.$window.width(),ledeMediaSize:e.attr("data-lede-media-size"),pageLayout:e.attr("data-page-layout")};this.trackingTriggerRaw("ad-tracking",t,"interaction")},setUpOptions:function(t){t&&(this.placements=t.placements?e.extend({},this.placements,t.placements):this.placements,this.requirements=t.requirements||this.requirements)},getAdPlacements:function(){return this.placements},getAdKeywords:function(){return this.pageManager.getUrlParam("ad-keywords")},getAdSensitivity:function(){return this.pageManager.getMeta("ad_sensitivity")},isDisabled:function(){return"undefined"!=typeof this.pageManager.getUrlParam("nojoy")||"noads"===this.pageManager.getUrlParam("adx_campaign")||"pay"===this.pageManager.getUrlParam("gwt")},isAmazonDisabled:function(){return"false"===this.pageManager.getMeta("dfp-amazon-enabled")||this.pageManager.getMeta("dfp-amazon-enabled")===!1}});return n}),define("shared/adlibrary/helpers/dfp-ordered-custom-criteria-mixin",["underscore/nyt","foundation/views/page-manager"],function(e,t){"use strict";function i(t){var i="";return e.isArray(t)?(t=e.each(t,function(e,t){i+=t>0?",":"",i+=e.toLowerCase().replace(/[^a-z]+/gi,"").substring(0,30)}),i):e.isString(t)?t.toLowerCase().replace(/[^a-z]+/gi,"").substring(0,30):""}function n(){return"rec"===t.getUrlParam("src")?"recpg":"Recommendation"===t.getUrlParam("module")?"recmod":t.getUrlParam("pgtype")?t.getUrlParam("pgtype"):""}function s(){if(t.getUrlParam("smid")){if("fb-nytimes"===t.getUrlParam("smid")||"fb-share"===t.getUrlParam("smid"))return"facebook";if("tw-nytimes"===t.getUrlParam("smid")||"tw-share"===t.getUrlParam("smid"))return"twitter"}return""}var a;return a=[{key:"adv",value:t.getUrlParam("ad-keywords")},{key:"plat",value:"web"},{key:"prop",value:"nyt"},{key:"ver",value:"nyt5"},{key:"sub",value:""},{key:"typ",value:""},{key:"pos",value:""},{key:"spon",value:i(t.getMeta("ad-sponsor"))},{key:"des",value:i(t.getMeta("des"))},{key:"per",value:i(t.getMeta("per"))},{key:"org",value:i(t.getMeta("org"))},{key:"geo",value:i(t.getMeta("geo"))},{key:"ttl",value:i(t.getMeta("ttl"))},{key:"col",value:i(t.getMeta("col"))},{key:"ser",value:i(t.getMeta("ser"))},{key:"id",value:t.getMeta("articleid")},{key:"auth",value:i(t.getMeta("author"))},{key:"amznslots",value:""},{key:"ref",value:n()},{key:"srch",value:""},{key:"edn",value:t.isInternationalEdition()?"intl":"us"},{key:"lan",value:""},{key:"etua",value:""},{key:"subsrc",value:""},{key:"env",value:""},{key:"cs",value:""},{key:"jt",value:""},{key:"ind",value:""},{key:"g",value:""},{key:"em",value:""},{key:"inc",value:""},{key:"wat",value:""},{key:"refdom",value:s()},{key:"sov",value:(Math.floor(4*Math.random())+1).toString()}]}),define("shared/adlibrary/helpers/dfp-placements-mixin",[],function(){"use strict";var e={TopAd:[[728,90],[970,90],[970,66],[970,250]],TopAd1:[728,90],TopAd2:[728,90],TopAd3:[728,90],TopAd4:[728,90],TopAd5:[728,90],"lede-ad":[[468,648],[300,600],[300,250]],"marketing-ad":[301,250],MiddleRight1:[300,250],MiddleRight2:[300,250],MiddleRight3:[300,250],MiddleRight4:[300,250],MiddleRight5:[300,250],MiddleRight6:[300,250],MiddleRight7:[300,250],MiddleRight8:[300,250],MiddleRight9:[300,250],MiddleRight10:[300,250],MiddleRight11:[300,250],MiddleRight12:[300,250],MiddleRight13:[300,250],MiddleRight14:[300,250],MiddleRight15:[300,250],Middle1C:[88,31],MostEm:[88,31],TopNavAd:[88,31],MegaAd:[1600,512],Moses:[[970,418],[970,40]],Frame4A:[96,60],Frame6A:[336,90],Position1:[96,60],Spon2:[88,31],MiddleRightN:[300,250],TopAdN:[728,90],BigAd3:[300,250],MobileBanner:[320,50],MobileBanner2:[[320,50],[300,250]],Ribbon:[240,75],RibbonInterstitial:[900,500],Interstitial:[[1,1],[640,480]],WelcomeBack:[300,250],sponsortile:[150,50]};return e}),define("shared/adlibrary/templates",["underscore/nyt"],function(_){var templates={};return templates.iFrameStyleSheet=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<style type="text/css">\nbody {\nmargin: 0;\noverflow: hidden;\n}a img {\nborder: none;\n}\n</style>';return __p},templates.interstitialModal=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div id="Interstitial" class="ad interstitial-ad"></div><p class="user-action dismiss-button">Continue &raquo;</p>';return __p},templates.ribbonInterstitial=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="ribbon-interstitial-ad-overlay hidden">\n<h4 class="ad-heading"> Advertisement </h4>\n<div id="RibbonInterstitial" class="ad ribbon-interstitial-ad"> </div>\n</div>';return __p},templates}),define("shared/modal/templates",["underscore/nyt"],function(_){var templates={};return templates.modal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="overlay"></div>\n<div class="modal '+(null==(__t=id)?"":__t)+" "+(null==(__t=addlClasses)?"":__t)+'" style="'+(null==(__t=modalStyles)?"":__t)+'" role="dialog" aria-labelledby="'+(null==(__t=id)?"":__t)+'-modal-heading" tabindex="-1">\n<div class="modal-header">\n<h3 class="modal-heading" id="'+(null==(__t=id)?"":__t)+'-modal-heading">'+(null==(__t=modalTitle)?"":__t)+"</h3>\n"+(null==(__t=headerContent)?"":__t)+'\n</div>\n<div class="modal-content">\n'+(null==(__t=modalContent)?"":__t)+'\n</div>\n<div class="modal-footer">\n'+(null==(__t=modalFooter)?"":__t)+'\n</div>\n<button type="button" class="modal-close '+(null==(__t=closeClass)?"":__t)+'" aria-disabled="false"><i class="icon"></i><span class="visually-hidden">Close this modal window</span></button>\n<div class="modal-pointer '+(null==(__t="modal-pointer-"+tailDirection)?"":__t)+'"><div class="modal-pointer-conceal"></div></div>\n</div>';return __p},templates}),define("shared/modal/views/modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/templates"],function(e,t,i,n){"use strict";var s=i.registerView("modal").extend({template:n.modal,className:"modal-container",events:{"click .modal-close, .modal-pointer, .dismiss-button":"close","mouseenter .modal":"handleMouseOutClose"},defaultSettings:{id:"default-modal",modalTitle:"",headerContent:"",modalContent:"",modalFooter:"",addlClasses:"",binding:"",disableBindings:!1,tailDirection:"down",tailTopOffset:0,tailLeftOffset:0,fixedOverride:!1,hasOverlay:!1,hasCloseButton:!1,canOpenOnHover:!1,closeOnMouseOut:!1,mouseOutDelay:0,mouseEnterDelay:0,closeOnClick:!0,autoPosition:!1,positionTailSide:!1,toggleSpeed:300,focusOnShow:!0,closeOnEsc:!0},initialize:function(e){t.bindAll(this,"close","open","mouseEnterOpen","mouseOutClose","handleClickClose","removeFromPage"),this.settings=t.extend({},this.defaultSettings,e),this.settings.modalStyles="width: "+e.width+";",this.render()},render:function(){var e=this.settings.id+"-container";return this.settings.closeClass=this.settings.hasCloseButton?"":"hidden",this.$el.hide().addClass(e).html(this.template(this.settings)),this.$modal=this.$el.find(".modal"),this.$el.find(".overlay").toggle(this.settings.hasOverlay),this},addToPage:function(e,t){var i="string"==typeof e?this.$body.find(e):this.$body;return t="function"==typeof i[t]?t:"append",i[t](this.$el),""===this.settings.binding||this.settings.disableBindings||(this.$body.on("click",this.settings.binding,this.open),this.settings.canOpenOnHover&&(this.$body.on("mouseenter",this.settings.binding,this.mouseEnterOpen),this.$body.on("mouseleave",this.settings.binding,this.mouseOutClose))),this},removeFromPage:function(){return this.close(),this.$el.remove(),""===this.settings.binding||this.settings.disableBindings||(this.$body.off("click",this.settings.binding,this.open),this.settings.canOpenOnHover&&(this.$body.off("mouseenter",this.settings.binding,this.mouseEnterOpen),this.$body.off("mouseleave",this.settings.binding,this.mouseOutClose))),this.remove()},updateTemplate:function(e){return this.$modal.find(".modal-content").html(e),this.positionDialog(!1),this},updateModalTitle:function(e){this.$modal.find(".modal-heading").html(e)},open:function(t){var i=this;return t?(t.returnValue=!1,t.preventDefault(),this.$target=e(t.currentTarget)):this.$target=e(this.settings.binding).eq(0),this.$el.fadeIn(this.settings.toggleSpeed,function(){i.broadcast("nyt:modal-show"),i.broadcast("nyt:modal-show-"+i.settings.id)}),this.settings.autoPosition?this.autoPosition():this.positionDialog(!0),(this.settings.openCallback||e.noop).call(this),this.subscribe("nyt:page-resize",this.positionDialog),this.settings.closeOnEsc&&this.subscribeOnce("nyt:page-key-esc",this.close),this.$body.on("click",this.handleClickClose),this.pageManager.isMobile()&&this.$body.css("cursor","pointer"),this.settings.focusOnShow&&this.$modal.focus(),this},mouseEnterOpen:function(e){window.clearTimeout(this.mouseLeaveTimeout),this.mouseEnterTimeout=t.delay(this.open,this.settings.mouseEnterDelay,e)},close:function(t){var i=this;return t&&t.currentTarget&&this.settings.disableBindings&&e(t.currentTarget).hasClass("modal-pointer")?this:(this.$el.fadeOut(this.settings.toggleSpeed,function(){(i.settings.closeCallback||e.noop).call(i),i.broadcast("nyt:modal-hide"),i.broadcast("nyt:modal-hide-"+i.settings.id)}),this.stopSubscribing("nyt:page-resize",this.positionDialog),this.$body.off("click",this.handleClickClose),window.clearTimeout(this.mouseEnterTimeout),this.pageManager.isMobile()&&this.$body.css("cursor",""),this)},mouseOutClose:function(t){var i=e(t.relatedTarget);i.is(this.$.target)||this.$modal.has(i).length>0||(window.clearTimeout(this.mouseEnterTimeout),this.$modal.is(":visible")&&(this.mouseLeaveTimeout=window.setTimeout(this.close,this.settings.mouseOutDelay)))},handleMouseOutClose:function(){this.settings.closeOnMouseOut&&this.$modal.on("mouseleave",this.close)},handleClickClose:function(e){this.settings.closeOnClick&&0===this.$modal.has(e.target).length&&this.$modal[0]!==e.target&&this.close()},positionDialog:function(t){var i,n,s,a,o,r=this.pageManager.getViewport(),l=this.$target,d=this.$modal,c="absolute",h=d.outerHeight(),u=d.outerWidth(),m={marginLeft:"0",marginTop:"0",top:"",left:""};switch(l&&l.length>0&&(a=l.outerHeight(),o=l.outerWidth(),n=l.offset().top+this.settings.tailTopOffset,s=l.offset().left+this.settings.tailLeftOffset),this.settings.tailDirection){case"up":m.top=n+a+14,m.left=s+Math.floor(.5*o)-Math.floor(.5*u)-9;break;case"up-right":m.top=n+a+14,m.left=s+Math.floor(.5*o)-(u-25);break;case"up-left":m.top=n+a+14,m.left=s+Math.floor(.5*o)-25;break;case"down":m.top=n-h-15,m.left=s+Math.floor(.5*o)-Math.floor(.5*u)-8;break;case"down-right":m.top=n-h-15,m.left=s+Math.floor(.5*o)-(u-25);break;case"down-left":m.top=n-h-15,m.left=s+Math.floor(.5*o)-25;break;case"left":m.top=n+Math.floor(.5*a)-Math.floor(.5*h)+5,this.pageManager.isMobile()&&this.$html.hasClass("navigation-active")?m.left=s+o:m.left=s+o+15;break;case"left-bottom":m.top=n+Math.floor(.5*a)-(h-25),m.left=s+o+15;break;case"left-top":m.top=n+Math.floor(.5*a)-25,m.left=s+o+15;break;case"right":m.top=n+Math.floor(.5*a)-Math.floor(.5*h)+5,m.left=s-u-16;break;case"right-bottom":m.top=n+Math.floor(.5*a)-(h-25),m.left=s-u-16;break;case"right-top":m.top=n+Math.floor(.5*a)-25,m.left=s-u-16;break;case"centered":i=r.height,m.top=h>i?r.top+5:Math.floor(.5*(i-h))+r.top,m.left=Math.floor(.5*r.width-.5*u);break;case"fixed":default:c="fixed",u=this.settings.width||d.width(),h=this.settings.height||d.height(),m.top="50%",m.left="50%",m.marginLeft=-Math.floor(.5*u)+this.settings.tailLeftOffset+"px",m.marginTop=-Math.floor(.5*h)+this.settings.tailTopOffset+"px"}return l&&"fixed"===l.css("position")||this.settings.fixedOverride?(c="fixed",m.top-=r.top,this.$el.css("position","fixed")):this.$el.css("position",""),m.top+=e.isNumeric(m.top)?"px":"",m.left+=e.isNumeric(m.left)?"px":"",d.css("position",c),t===!0?d.css(m):d.stop().animate(m,"fast"),this},autoPosition:function(){var e,t,i,n=this.pageManager.getViewport(),s=this.$modal.outerHeight(),a=this.$modal.outerWidth();return this.settings.positionTailSide&&(i=this.$target.offset().left>n.width/2,this.settings.tailDirection=i?"right":"left"),this.positionDialog(!0),e=this.$target.offset(),this.settings.positionTailSide?(t=this.settings.tailDirection,e.top-n.top-.5*s<0?t+="-top":e.top-n.top+.5*s>n.height&&s-42<e.top-n.top&&(t+="-bottom")):(t=e.top-s<0?"up":"down",e.left+a>n.width?t+="-right":e.left<0&&(t+="-left")),this.$modal.find(".modal-pointer").attr("class","modal-pointer modal-pointer-"+t),this.settings.tailDirection=t,this.positionDialog(!0),this}});return s}),define("shared/adlibrary/helpers/dfp-sitewide-requirements-mixin",["jquery/nyt","underscore/nyt","foundation/models/user-data","shared/adlibrary/templates","shared/modal/views/modal"],function(e,t,i,n,s){"use strict";var a={aax:"3030",async:!0,dfp:null,isReady:!1,amazonKeywords:[],tabletPortraitSize:1020,hasSentComscore:!1,pageViewId:"",hasTrackedPageView:!1,initialize:function(e){var t=this;this.dfp=e,this.dfp.isAmazonDisabled()?this.async=!1:this.setUpAmazonGlobal(),this.setPageViewId(),this.dfp.setCustomCriteria({page_view_id:this.getPageViewId()}),this.addCookieData(),this.integrateKrux(),this.determineAdSizes(),this.modifyChamber(),this.handleSupportedBy(),this.dfp.pageManager.flag("trendingPageLinks")&&this.addTrendingKeywords(),e.listenToAdEvent("ad-rendered",t.handleAdRendered,t),e.listenToAdEvent("ad-rendered",t.handlePageViewId,t),e.listenToAdEvent("ad-slot-defined",this.handleSlotDefined,t),e.listenToAdEvent("nyt:masthead-search-toggle",t.handleSearchSponsor,t),e.listenToAdEvent("nyt:page-breakpoint",t.handleBreakpoint,t),e.listenToAdEvent("refresh",t.handleRefresh,t)},handlePageViewId:function(){this.hasTrackedPageView||(this.dfp.trackingTriggerRaw("page_view_id",{module:"page",priority:!0,page_view_id:this.getPageViewId()},"interaction"),this.hasTrackedPageView=!0)},setPageViewId:function(){this.pageViewId=this.generatePageViewId()},generatePageViewId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})},getPageViewId:function(){return this.pageViewId},modifyChamber:function(){var e=this.dfp;e.clearChamber()},signalReady:function(){this.isReady=!0,this.dfp.signalReady()},handleAdRendered:function(e,t,i,n,s){var a=this,o=this.dfp.getAdElement(e);switch(this.determineVisibility(o,i),t=t||[0,0],t[0]){case 728:a.checkPoliticalStatus(o,i);break;case 300:a.checkPoliticalStatus(o,i),a.triggerComScore(e,n,s);break;case 301:a.checkPoliticalStatus(o,i),a.triggerComScore(e,n,s);break;case 468:a.triggerComScore(e,n,s)}switch(e){case"TopAd":a.handleTopAd(o,t,i);break;case"lede-ad":a.handleBigAdRendered(o,t,i);break;case"SupportedBy":a.handleSupportedByAd(o,i);break;case"Interstitial":a.handleInterstitial(o,i,t)}},handleTopAd:function(e,t,i){var n=e.find("iframe"),s=n.prev("div"),a=this.dfp.$adsOnPage.TopAd;return i?(this.dfp.$html.removeClass("has-top-ad"),void this.dfp.$html.removeClass("has-top-flex-frame-ad")):(1605==n.width()?(this.dfp.$html.addClass("has-top-flex-frame-ad"),e.addClass("flex-frame-ad")):(this.dfp.$html.addClass("has-top-ad"),e.removeClass("flex-frame-ad")),e.attr("display","block"),this.has970TopAd=this.dfp.$html.hasClass("has-top-ad")&&(n.width()>728||s.width()>728),void(this.has970TopAd&&a.css("min-height","26px")))},handleBigAdRendered:function(e,t,i){i?this.dfp.$html.removeClass("has-big-ad"):(t[0]>=468||450===t[0]&&623===t[1])&&(this.dfp.$html.addClass("has-xxl"),this.hasXXLAd=!0)},handleSupportedBy:function(){var t=e("html").hasClass("viewport-medium-10");this.dfp.pageManager.flag("supportedBy")&&(t?this.dfp.addPlacementSize("SupportedBy",[150,50]):this.dfp.addPlacementSize("SupportedBy",[320,25]))},handleSupportedByAd:function(t,i){i||(e(".supported-by").removeClass("hidden"),this.dfp.$html.addClass("has-supported-by-ad"))},handleTileAds:function(t,i){i||e(".tile-ads").removeClass("hidden")},checkPoliticalStatus:function(t,i){var n;if(!i)try{t.find("iframe").contents().find("html #politicalAd").length>0&&(n=e("<div>").addClass("ad-header").attr("aria-hidden","true").append(e("<p>")).find("p").text("Advertisement").end(),t.prepend(n))}catch(s){e.noop()}},integrateKrux:function(){this.setUpKruxGlobal(),this.addKruxKeywords()},setUpKruxGlobal:function(){window.Krux=window.Krux||((window.Krux=function(){window.Krux.q.push(arguments)}).q=[])},addKruxKeywords:function(){var e={},t=this.retrieveKruxData("segs"),i=this.retrieveKruxData("user");t&&(e.ksg=t,window.Krux.segments=t.split(",")||[]),i&&(e.kuid=i,window.Krux.user=i),this.dfp.setCustomCriteria(e)},retrieveKruxData:function(e){var t,i="kx"+e;return window.localStorage?window.localStorage[i]||"":navigator.cookieEnabled?(t=document.cookie.match(i+"=([^;]*)"),t&&window.unescape(t[1])||""):""},setUpAmazonGlobal:function(){var t=this;window.amznads={updateAds:e.noop,renderAd:e.noop},e.ajax({url:"//c.amazon-adsystem.com/aax2/amzn_ads.js",dataType:"script",timeout:1e3}).always(function(){t.getAmazonKeywords()})},getAmazonKeywords:function(){var t=this,i=encodeURIComponent(document.location.toString().split("?")[0]);try{i=encodeURIComponent(""+window.top.location.toString().split("?")[0])}catch(n){e.noop()}e.ajax({url:"//aax.amazon-adsystem.com/e/dtb/bid?src="+t.aax+"&u="+i+"&cb="+Math.round(1e7*Math.random()),dataType:"script",timeout:1e3}).done(function(){t.addAmazonKeywords()}).always(function(){t.signalReady()})},handleRefresh:function(){var e=this.dfp,i=t.toArray(arguments),n=function(){e.refreshSlots.apply(e,i)};this.dfp.isAmazonDisabled()?n():this.refreshAmazonKeywords(n)},refreshAmazonKeywords:function(e){var i=this;window.amznads.getAdsCallback&&(window.amznads.getAdsCallback(this.aax,function(){i.addAmazonKeywords(),t.isFunction(e)&&e()}),this.dfp.googletag.cmd.push(function(){i.dfp.googletag.pubads().clearTargeting("amznslots")}))},addAmazonKeywords:function(){window.amznads.ads&&this.dfp.setCustomCriteria({amznslots:t.keys(window.amznads.ads)})},addTrendingKeywords:function(){var t,i,n=e("#trending-link-json").get(0).innerHTML;try{i=JSON.parse(n)}catch(s){i={}}if(null!==i){switch(i.trending_type){case"trending_page":i.dfpTrendingType="trending";break;case"most_emailed_1":i.dfpTrendingType="email";break;case"most_viewed_7":i.dfpTrendingType="icymi";break;case"most_shared_facebook_1":i.dfpTrendingType="fb"}t={trend:i.dfpTrendingType},this.dfp.setCustomCriteria(t)}},addCookieData:function(){var e=i.attributes;this.addEventTrackerId(e),this.parseSubscriberStatus(e),this.parseDemographicData(e.demographics)},addEventTrackerId:function(e){var t={};"0"!==e.id&&(t.etua=e.id,this.dfp.setCustomCriteria(t))},parseSubscriberStatus:function(e){var t,i={};t="0"===e.id?"anon":e.subscription.length<=4?"reg":"sub",i.sub=t,this.dfp.setCustomCriteria(i)},parseDemographicData:function(e){var n,s={};t.isObject(e)&&(s.cs=i.getCompanySize(),s.jt=i.getJobTitle(),s.ind=i.getJobIndustry(),s.g=i.getGender(),s.em=i.getEmailSubscriptions(),s.inc=i.getIncomeRange(),s.wat=i.getWat(),i.getBundleSubscriptions()&&i.getBundleSubscriptions().length>0&&(n=i.getBundleSubscriptions()[0],s.subprm=n.promotion,s.grace=n.in_grace?"t":"f",t.isString(n.bundle)&&(s.sub=n.bundle.toLowerCase()),t.isString(n.source)&&(s.subsrc=n.source)),this.dfp.setCustomCriteria(s))},determineAdSizes:function(){var e,t=this.dfp.pageManager.getViewport().width;975>t&&(this.dfp.removePlacementSize("TopAd",[970,90]),this.dfp.removePlacementSize("TopAd",[970,66]),this.dfp.removePlacementSize("TopAd",[970,250]),this.dfp.removePlacementSize("lede-ad",[468,648])),765>t&&(this.dfp.editPlacementSize("TopAd",[320,50]),this.dfp.editPlacementSize("TopAd1",[320,50]),this.dfp.editPlacementSize("TopAd2",[320,50]),this.dfp.editPlacementSize("TopAd3",[320,50]),this.dfp.editPlacementSize("TopAd4",[320,50]),this.dfp.editPlacementSize("TopAd5",[320,50]),this.dfp.removePlacement("SponLink"),e={plat:"mweb",prop:"mnyt"},this.dfp.setCustomCriteria(e))},handleSlotDefined:function(e,t){var i;switch(t){case"lede-ad":i="mid1";break;case"MiddleRight2":i="mid2";break;case"Frame6A":i="artexp";break;case"MostEm":i="emmod";break;case"TopAd":i="top";break;case"TopAd1":i="bottom";break;case"TopNavAd":case"SponsorAd":i="ssearch";break;case"Middle1C":case"Spon2":i=t;break;case"FlexAd":i="flex"}i&&e.setTargeting("pos",i)},determineVisibility:function(e,t){if(t)e.addClass("hidden").removeClass("request-pending");else try{e.find("iframe").contents().find("html #exclusivity").length>0?e.addClass("hidden ad-exclusivity"):e.removeClass("hidden request-pending")}catch(i){e.removeClass("hidden request-pending")}},handleSearchSponsor:function(){var e=this.dfp.$shell.find("#SponsorAd");e.find("iframe").length>0||this.dfp.requestDynamicAd("SponsorAd",[88,31])},handleBreakpoint:function(e){this.has970TopAd&&this.hideTopAdForSmallViewport(e),this.hasXXLAd&&this.hideXxlForSmallViewport(e)},hideTopAdForSmallViewport:function(e){var t=this.dfp.getAdElement("TopAd");e<=this.tabletPortraitSize?(t.addClass("hidden"),this.dfp.$html.removeClass("has-top-ad")):(t.removeClass("hidden"),this.dfp.$html.addClass("has-top-ad"))},hideXxlForSmallViewport:function(e){var t=this.dfp.getAdElement("lede-ad");e<=this.tabletPortraitSize?(t.addClass("hidden"),this.dfp.$html.removeClass("has-xxl")):(t.removeClass("hidden"),this.dfp.$html.addClass("has-xxl"))},triggerComScore:function(e,t,i){this.dfp.getAdElement(e).data("isInitial")||this.hasSentComscore||(this.dfp.trackingComscorePVC({module:"Ad",version:e,action:"Impression",contentCollection:i,contentID:t,region:this.dfp.adPath,eventName:"AdImpression"}),this.hasSentComscore=!0)},setupInterstitial:function(){var e=this;this.interstitialModal=new s({id:"interstitial-ad-modal",modalTitle:"advertisement",tailDirection:"fixed",hasOverlay:!0,hasCloseButton:!0,width:640,height:480,modalContent:n.interstitialModal(),closeCallback:function(){e.closeInterstitial()}}).addToPage(),e.requestInterstitial(),this.closeTimeout=window.setTimeout(this.interstitialModal.close,15e3)},requestInterstitial:function(){this.dfp.broadcastAdEvent("request-placement","Interstitial")},closeInterstitial:function(){window.clearTimeout(this.closeTimeout)},handleInterstitial:function(e,t,i){t||1===i[0]||this.interstitialModal.open()}};return a}),define("shared/adlibrary/views/dfp",["jquery/nyt","underscore/nyt","shared/adlibrary/views/base-ad","foundation/hosts","shared/adlibrary/helpers/dfp-ordered-custom-criteria-mixin","shared/adlibrary/helpers/dfp-placements-mixin","shared/adlibrary/helpers/dfp-sitewide-requirements-mixin"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend({alreadyRequested:{},notYetRequested:{},readyForDisplay:{},adPath:"",viewName:"dfp",chamber:[],adsOnPage:{},$adsOnPage:{},slots:{},googletag:null,customCriteria:[],placements:a,isScanning:!1,hasTragedy:!1,initialize:function(e){e=e||{},this.listenToAdEvent("ready",this.handleReady),this.adPath=this.getAdUnitPath(),this.sitewide=o,this.customCriteria=t.each(s,function(e){return t.clone(e)}),this.setCustomCriteria(e.customCriteria),this.discoverAdsOnPage(),this.addToChamber(this.adsOnPage),this.listenToAdEvent("ad-slot-defined",this.handleSlotDefined),this.listenToAdEvent("ad-rendered",this.triggerTagX,!0),this.listenToAdEvent("request-placement",this.requestDynamicAd),this.listenToAdEvent("queue-placement",this.queueDynamicAd),this.listenToAdEvent("scan",this.scan),this.listenToAdEvent("discover",this.discoverAdsOnPage),this.broadcastAdEvent("waiting",this)},getAdUnitPath:function(){var e,i,s=this.getAdSensitivity(),a="tragedy"!==s&&"noads"!==s?this.pageManager.getMeta("dfp-ad-unit-path"):s;return this.flag("requestTragedyAd")&&(a=this.pageManager.getMeta("dfp-ad-unit-path")),t.isUndefined(a)&&(e=this.pageManager.getMeta("CG"),i=this.pageManager.getMeta("SCG")?"/"+this.pageManager.getMeta("SCG"):"",a=e+i),n.dfpHost+a},handleReady:function(){var e=this;if(this.googletag=window.googletag,!this.googletag)return setTimeout(function(){e.handleReady()},500);if(this.isReady)throw new Error("DFP already in ready state.  Do not signal ready more than once.");this.isReady=!0,this.addPageLevelParameters(),this.initialAdRequest(),this.enableServices(),this.scan(),this.listenToAdEvent("placement-added",this.scan)},handleSlotDefined:function(e,t){this.trackRequested(e,t)},requestAdsInViewport:function(){this.requestMultipleAds(this.getAdsInViewport())},trackRequested:function(e,i){this.readyForDisplay[i]=this.notYetRequested[i],delete this.notYetRequested[i],0===t.keys(this.notYetRequested).length&&(this.isScanning=!1,this.stopSubscribing("nyt:page-scroll",this.requestAdsInViewport))},getAdsInViewport:function(){var e=this,i={};return t.each(this.$adsOnPage,function(t,n){!e.alreadyRequested[n]&&e.isElementInViewport(t)&&(i[n]={$el:t,size:e.adsOnPage[n]})}),i},enableServices:function(){var e=this.googletag,t=this;e.cmd.push(function(){e.pubads().addEventListener&&e.pubads().addEventListener("slotRenderEnded",function(e){t.broadcastAdEvent("ad-rendered",e.slot.getSlotId().getDomId(),e.size,e.isEmpty,e.lineItemId,e.serviceName)}),t.broadcastAdEvent("enable-services"),e.pubads().enableSingleRequest(),e.enableServices()})},addPageLevelParameters:function(){var e=this.googletag;t.each(this.customCriteria,function(i){t.isEmpty(i.value)||e.cmd.push(function(){e.pubads().setTargeting(i.key,i.value)})})},setCustomCriteria:function(e){t.isObject(e)&&t.each(e,function(e,i){var n=t.findWhere(this.customCriteria,{key:i});"undefined"!=typeof e&&(t.isString(e)||t.isArray(e)||(e=e.toString()),n?n.value=e:this.customCriteria.push({key:i,value:e}))},this)},defineAdSlots:function(e){var i=this,n=e.isInitial,s=i.googletag;e=t.omit(e,t.keys(i.slots)),t.isEmpty(e)||s.cmd.push(function(){t.each(e,function(e,a){var o,r,l;"fluid"===e?o=e:t.isArray(e)&&t.isArray(e[0])&&t.isArray(e[0][0])?(o=[],r=e):o=e,l=s.defineSlot(i.adPath,o,a),r&&l.defineSizeMapping(r),l.addService(s.pubads()).setCollapseEmptyDiv(!0),i.slots[a]=l,i.$adsOnPage[a].data("isInitial",n),i.broadcastAdEvent("ad-slot-defined",l,a,e)})})},requestMultipleAds:function(e){t.each(e,function(e,t){"undefined"==typeof this.slots[t]?this.requestDynamicAd(t,e.size):this.requestSingleAd(t)},this)},requestSingleAd:function(e){var i=this.googletag,n=this;if(!this.hasTragedy){if(!n.isReady)return n.listenToAdEvent("ready",function(){n.requestSingleAd(e)},!0);i.cmd.push(function(){i.display(e),t.extend(n.alreadyRequested,n.readyForDisplay),delete n.readyForDisplay[e]})}},discoverAdsOnPage:function(){var t=this,i=e(".ad, .text-ad, .sponsor-ad");i.each(function(e,i){i.id in t.placements&&!t.$adsOnPage[i.id]&&t.addPlacement(i.id)})},addToChamber:function(){this.chamber.push.apply(this.chamber,t.toArray(arguments))},clearChamber:function(){var e=this.chamber;return this.chamber=[],e},initialAdRequest:function(){t.each(this.chamber,function(e){e.isInitial=!0,this.defineAdSlots(e)},this)},requestDynamicAd:function(t,i){var n=this;return n.isReady?this.alreadyRequested[t]?(this.$adsOnPage[t]=e("#"+t),!1):(this.addPlacement(t,i),this.defineAdSlots(this.getPlacement(t)),void this.requestSingleAd(t)):n.listenToAdEvent("ready",function(){n.requestDynamicAd(t,i)},!0)},queueDynamicAd:function(e,t){this.addPlacement(e,t),this.scan()},getAdElement:function(t){return this.$adsOnPage[t]||e()},addPlacement:function(i,n){var s;return t.isObject(i)?t.each(i,function(e,t){this.addPlacement(t,e)},this):(s=e("#"+i),0===s.length?!1:(this.placements[i]=n||this.placements[i],this.adsOnPage[i]=this.placements[i],this.$adsOnPage[i]=e("#"+i),this.notYetRequested[i]=this.$adsOnPage[i],void this.broadcastAdEvent("placement-added",i,n)))},getPlacement:function(){var e={};return t.each(t.toArray(arguments),function(t){this.adsOnPage[t]&&(e[t]=this.adsOnPage[t])},this),e},removePlacement:function(e){delete this.placements[e],delete this.adsOnPage[e],delete this.$adsOnPage[e],delete this.notYetRequested[e]},deleteAllPlacements:function(){this.placements={},this.adsOnPage={},this.$adsOnPage={},this.notYetRequested={}},removePlacementSize:function(e,i){var n,s,a;if(this.adsOnPage&&this.adsOnPage[e]&&(n=this.adsOnPage[e]),this.adsOnPage&&this.adsOnPage[e]&&t.isArray(this.adsOnPage[e][0]))for(a=0;a<n.length;a+=1)s=n[a],s[0]===i[0]&&s[1]===i[1]&&n.splice(a,1);else n&&n[0]===i[0]&&n[1]===i[1]&&this.removePlacement(e)},editPlacementSize:function(e,t){this.adsOnPage&&this.adsOnPage[e]&&(this.adsOnPage[e].length=0,this.adsOnPage[e].push.apply(this.adsOnPage[e],t))},addPlacementSize:function(e,i){var n,s,a=!1,o=0;if(t.isUndefined(this.adsOnPage[e]))return this.addPlacement(e,i);if(t.isArray(this.adsOnPage[e][0])){for(o;o<this.adsOnPage[e].length;o+=1)if(n=this.adsOnPage[e][o][0],s=this.adsOnPage[e][o][1],n===i[0]&&s===i[1]){a=!0;break}a||this.adsOnPage[e].push(i)}else n=this.adsOnPage[e][0],s=this.adsOnPage[e][1],(n!==i[0]||s!==i[1])&&(this.adsOnPage[e].length=0,this.adsOnPage[e].push([n,s]),this.adsOnPage[e].push(i))},refreshSlots:function(i,n){var s,a=this;n=n||!1,i&&(s=[],i=t.isArray(i)?i:[i],t.each(i,function(e){this.slots[e]&&s.push(this.slots[e])},this)),t.each(this.$adsOnPage,function(t,i){a.$adsOnPage[i]=e("#"+i)}),this.googletag.cmd.push(function(){a.googletag.pubads().refresh(s,{changeCorrelator:n})})},scan:function(){this.isScanning||(this.isScanning=!0,this.requestAdsInViewport(),this.subscribe("nyt:page-scroll",this.requestAdsInViewport))}});return r}),define("shared/ad/models/ad",["backbone/nyt"],function(e){"use strict";var t=e.Model.extend({});return t}),define("shared/adlibrary/collections/adx-collection",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","foundation/hosts","shared/ad/models/ad"],function(e,t,i,n,s){"use strict";var a=i.extend({url:n.ADXHost+"/adx/bin/adxrun.html",model:s,initialize:function(e){
if(this.options=e||{},this.placements=this.options.placements,!this.options.placements)throw new Error("No ad placements found in ADX collection");t.isUndefined(this.pageManager.getMeta("adxPage"))?this.host=this.pageManager.getUrlParam("adx_campaign")||this.options.adx_campaign||"www.nytimes.com":(this.host="",this.options.page=this.pageManager.getMeta("adxPage")),this.interstitial=this.options.interstitial?1:0,this.setPageParameter()},setPageParameter:function(){var e;this.options.page||(e=location.pathname,e=e.replace(/\d{4}/,"yr").replace(/\d{2}/,"mo").replace(/\d{2}/,"day"),this.options.page=this.host+e)},sync:function(i,n,s){var a=this;return s.dataType="jsonp",s.jsonp="jsonp",s.jsonpCallback="processAdx",s.data={page:a.options.page,positions:t.keys(this.placements).join(","),autoconfirm:0,v:3,cpp:0,attributes:"nyt5",keywords:this.getAdxKeywords(),secureClientside:1},e.sync(i,n,s)},getAdxKeywords:function(){var e=this.pageManager.getMeta("keywords")||"",t=this.pageManager.getUrlParam("ad-keywords");return t&&(e=e+","+t),e},parse:function(e){var t,i=[];for(t in e.ads)e.ads.hasOwnProperty(t)&&this.placements.hasOwnProperty(t)&&(e.ads[t].adId=t,i.push(e.ads[t]));return i}});return a}),define("shared/adlibrary/helpers/adx-placements-mixin",[],function(){"use strict";var e={Inv1:[],Inv2:[],Inv3:[],ab1:[],ab2:[],ab3:[],prop1:[],prop2:[],Anchor:[],Bar1:[],ADX_CLIENTSIDE:[]};return e}),define("shared/adlibrary/views/adx",["jquery/nyt","underscore/nyt","shared/adlibrary/views/base-ad","shared/adlibrary/templates","shared/adlibrary/collections/adx-collection","shared/adlibrary/helpers/adx-placements-mixin"],function(e,t,i,n,s,a){"use strict";var o=i.extend({viewName:"adx",placements:a,iframeClass:"ad-frame",initialize:function(){this.ads=new s({placements:this.placements}),this.subscribe(this.ads,"sync",this.receiveAds),this.requestAds(),this.listenToAdEvent("request-placement",function(e){this.renderAdFromData({id:e})})},requestAds:function(){this.ads.fetch()},renderAdFromData:function(t){var i,s;(t.model||t.id)&&(i=t.model||this.ads.findWhere({adId:t.id}),s=t.id||(i?i.get("adId"):null),i&&s&&this.renderInIframe({el:e("#"+s),model:i,frameStyle:n.iFrameStyleSheet(),secondaryIframeClass:"frame-for-article"}))},receiveAds:function(e){var t=this;e.each(function(e){t.renderAdFromData({model:e,id:e.get("adId")})})},renderInIframe:function(i){var n,s,a,o,r,l,d,c=document.createElement("iframe");i=i||{},s=i.model,s&&"undefined"!=typeof s.get&&i.el&&!s.get("hasPainted")&&(i.el=e(i.el),o=s.get("confirmation-url"),r=s.get("creative"),d=s.get("isInlineSafe"),"string"==typeof d&&"n"===d.toLowerCase()&&(d=!1),d?i.el.append(i.el.html()+r):0===i.el.find("iframe").length&&"ADX_CLIENTSIDE"!==s.get("name")&&(a=i.frameStyle?i.frameStyle+r:r,e(c).attr("frameBorder",0).addClass(this.iframeClass).css(this.calculateIFrameCss(s.get("width"),s.get("height"))),i.secondaryIframeClass&&(c.className+=" "+i.secondaryIframeClass),i.el.append(c),c.contentDocument?n=c.contentDocument:c.contentWindow&&(n=c.contentWindow.document),n&&(n.open(),n.write(a),t.defer(function(){n.close()}))),e(i.el.selector+"-alternate-content").addClass("hidden"),o&&""!==o&&(l=new Image,l.src=o),this.trackingTriggerImpression("ad-render",{module:"Ad",version:s.get("name"),action:"Impression",contentCollection:s.get("campaign"),contentID:s.get("classification"),region:i.page||"",eventName:"AdImpression"}),this.broadcastAdEvent("ad-rendered",s.get("adId")),i.callback&&i.callback())},calculateIFrameCss:function(e,t){var i={};return i.width=e||0,i.height=t||0,i}});return o}),define("homepage/views/adlibrary/placements/adx-placements-mixin",[],function(){"use strict";var e={Inv1:[],Inv2:[],Inv3:[],ab1:[],ab2:[],ab3:[],prop1:[],prop2:[],Anchor:[],Bottom8:[],Bottom9:[],"HPmodule-RE2":[],Top5:[],Bar1:[],Header1:[]};return e}),define("homepage/views/adlibrary/placements/dfp-placements-mixin",["foundation/views/page-manager"],function(e){"use strict";var t={HPMiddle:[300,602],HPMiddle3:[336,91],TopLeft:[184,90],TopRight:[184,91],Top:[[970,251],[970,67],[970,91],[970,301],[970,401]],HPMidLeader:[[970,252],[970,68],[970,92],[970,302],[970,402],[728,92],[970,250],[970,66],[970,90],[970,300],[970,400],[728,90]],Middle4:[163,90],Box1:[301,250],HPWeather:[163,90],HPSponLink:[[970,253],[970,69],[970,93],[970,303],[970,403],[728,93],[970,250],[970,66],[970,90],[970,300],[970,400],[728,90]],HPPromo:[336,138],HPBottom1:[302,250],mostpop:[96,60],Middle:[300,601],"tile-ad-1":[120,60],"tile-ad-2":[120,60]};return e.flag("enableFlexFrameAds")&&(t.Top=[[1605,300],[970,251],[970,67],[970,91],[970,301],[970,401]]),t}),define("homepage/views/adlibrary/requirements/dfp-homepage-requirements-mixin",["jquery/nyt"],function(e){"use strict";var t={dfp:null,paidPostFivePackCounter:0,fivepackImpressionSent:!1,initialize:function(e){var t=this;this.dfp=e,this.dfp.listenToAdEvent("ad-slot-defined",t.handleSlotDefined,t),this.dfp.listenToAdEvent("weatherModalRendered",t.requestWeatherAd,t),this.dfp.listenToAdEvent("marketsModalRendered",t.requestMarketsAd,t),this.dfp.listenToAdEvent("ad-rendered",t.handleAdRendered,t),this.dfp.removePlacement("TopAd"),this.setHomepageCustomCriteria(),this.addPaidPostFivePackAds(),this.prepareInitialRequest()},prepareInitialRequest:function(){this.dfp.clearChamber(),this.dfp.addToChamber(this.dfp.getPlacement("Top","TopLeft","TopRight","Middle","PaidPostFivePack1","PaidPostFivePack2","PaidPostFivePack3","PaidPostFivePack4","PaidPostFivePack5"))},setHomepageCustomCriteria:function(){var e={typ:"hp"};this.dfp.setCustomCriteria(e)},handleSlotDefined:function(e,t){var i;switch(t){case"Middle4":i="marketstile";break;case"HPWeather":i="weathertile";break;case"Middle1C":i="ssearch";break;case"mostpop":i=t;break;case"HPBottom1":case"Box1":i="mktg"}i&&e.setTargeting("pos",i)},requestWeatherAd:function(){this.dfp.broadcastAdEvent("request-placement","HPWeather")},addPaidPostFivePackAds:function(){this.dfp.pageManager.isMobile()||this.dfp.addPlacement({PaidPostFivePack1:[177,197],PaidPostFivePack2:[177,197],PaidPostFivePack3:[177,197],PaidPostFivePack4:[177,197],PaidPostFivePack5:[177,197]})},handleAdRendered:function(e,t,i){var n=this,s=n.dfp,a=s.$adsOnPage[e];switch(t=t||[0,0],t[1]>=600&&n.dfp.broadcastAdEvent("nyt:ads-rendered",s),e){case"Box1":n.handleBoxOneRendered(a);break;case"HPPromo":n.handleHPPromoRendered(a,i);break;case"TopLeft":case"TopRight":n.handleEarRendered(a);break;case"PaidPostFivePack1":case"PaidPostFivePack2":case"PaidPostFivePack3":case"PaidPostFivePack4":case"PaidPostFivePack5":n.handlePaidPostFivePackRendered(a,i)}},handleHPPromoRendered:function(e,t){t||e.css({"text-align":"center"})},handleEarRendered:function(e){this.dfp.broadcastAdEvent("ear-ad-visible"),e.removeClass("hidden").css({display:"block"})},handleBoxOneRendered:function(e){e.find(">div").css({display:"inline-block"})},handlePaidPostFivePackRendered:function(t,i){var n;i||(t.parent().removeClass("hidden"),this.paidPostFivePackCounter++),5===this.paidPostFivePackCounter&&(e("#paid-post-five-pack").removeClass("hidden"),n={module:"PaidPostDriver",region:"PaidPostMOTH",pgType:"Homepage",eventName:"Impression",action:"Impression"},this.handleTriggerPaidPostImpression(e("#paid-post-five-pack"),n))},requestMarketsAd:function(){this.dfp.broadcastAdEvent("request-placement","Middle4")},handleTriggerPaidPostImpression:function(e,t){var i=this;this.handlePaidPostVisibility(e,t)||this.dfp.listenToAdEvent("nyt:page-scroll",function(){i.handlePaidPostVisibility(e,t)})},handlePaidPostVisibility:function(e,t){return e.is(":visible")&&this.dfp.isElementInViewport(e)?(this.handlePaidPostImpression(e,t),!0):!1},handlePaidPostImpression:function(e,t){var i=!1;"paid-post-five-pack"===e.attr("id")&&this.fivepackImpressionSent===!1&&(this.fivepackImpressionSent=!0,i=!0),i===!0&&this.dfp.trackingTrigger("paid-post-driver",t)}};return t}),define("homepage/instances/ad-manager",["foundation/views/page-manager","shared/adlibrary/views/dfp","shared/adlibrary/views/adx","homepage/views/adlibrary/placements/adx-placements-mixin","homepage/views/adlibrary/placements/dfp-placements-mixin","homepage/views/adlibrary/requirements/dfp-homepage-requirements-mixin"],function(e,t,i,n,s,a){"use strict";var o=new t({placements:s,requirements:a});return new i({placements:n,page:e.isInternationalEdition()?"international-home.nytimes.com/index.html":"homepage.nytimes.com/index.html"}),o}),define("shared/account/templates",["underscore/nyt"],function(_){var templates={};return templates.accountModalHeader=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<h4 class="modal-subheading">To save articles or get newsletters, alerts or recommendations &ndash; all free.</h4>';return __p},templates.logInModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="buttons">\n'+(null==(__t=oauthButtons)?"":__t)+'\n</div><!-- close buttons -->\n<div class="separator">\n<span class="separator-text">OR</span>\n</div>\n<div class="login-form-control form-control">\n<form id="login-form" class="login-form" role="form" method="post" action="'+(null==(__t=loginUrl)?"":__t)+'">\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="login-email" id="login-email-label">Email address</label>\n</div>\n<div class="field-container">\n<input type="text" id="login-email" name="userid" class="text login-email" placeholder="Email address" aria-labelledby="login-email-label" aria-required="true">\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-email-description"><i class="icon"></i><span class="visually-hidden" id="clear-email-description">Clear this text input</span></button>\n</div>\n</div>\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="login-password" id="login-password-label">Password</label>\n</div>\n<div class="field-container">\n<input type="password" id="login-password" name="password" class="text login-password" placeholder="Password" data-type="password" aria-labelledby="login-password-label" aria-required="true">\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-password-description">Clear this text input</span></button>\n</div>\n</div>\n<div class="control user-action-control layout-horizontal">\n<div class="control checkbox-control">\n<div class="field-container">\n<input type="checkbox" id="login-remember-checkbox" name="login-remember" class="checkbox login-remember" checked="checked" aria-labelledby="login-remember-label" aria-checked="true" value="">\n</div>\n<div class="label-container">\n<label for="login-remember" class="checkbox-label" id="login-remember-label">Remember me</label>\n</div>\n</div>\n<p class="form-hint password-hint"><a href="//www.nytimes.com/forgot">Forgot password?</a></p>\n</div>\n<div class="control">\n<p class="disclaimer"><a href="http://www.nytimes.com/content/help/rights/terms/terms-of-service.html">Terms of Service</a> <a href="http://www.nytimes.com/content/help/rights/privacy/policy/privacy-policy.html">Privacy Policy</a></p>\n</div>\n<div class="control button-control">\n<button id="login-send-button" class="button login-button">Log in</button>\n</div>\n<input name="is_continue" value="1" type="hidden">\n<input id="account-form-token" name="token" value="" type="hidden">\n<input id="account-form-expiration" name="expires" value="" type="hidden">\n<input id="login-remember" name="remember" value="1" type="hidden">\n</form>\n</div><!-- close login-form-control -->';return __p},templates.loginModalFooter=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<p class="user-action registration-modal-trigger">Don&#8217;t have an account? <a href="javascript:;">Sign Up</a></p>';return __p},templates.oauthButtons=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button id="'+(null==(__t=facebookId)?"":__t)+'" data-provider-name="facebook" class="button oauth-button facebook-oauth-button">\n<i class="icon sprite-icon"></i>\n<span class="button-text">'+(null==(__t=prefix)?"":__t)+' with Facebook</span>\n</button>\n<button id="'+(null==(__t=googleId)?"":__t)+'" data-provider-name="google" class="button oauth-button google-oauth-button">\n<i class="icon sprite-icon"></i>\n<span class="button-text">'+(null==(__t=prefix)?"":__t)+" with Google</span>\n</button>";return __p},templates.registrationModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="buttons">\n'+(null==(__t=oauthButtons)?"":__t)+'\n</div><!-- close buttons -->\n<div class="separator">\n<span class="separator-text">OR</span>\n</div>\n<div class="registration-form-control form-control">\n<form id="registration-form" class="registration-form" role="form" method="post" action="'+(null==(__t=regiUrl)?"":__t)+'">\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="register-email" id="register-email-label">Email address</label>\n</div>\n<div class="field-container">\n<input type="email" id="register-email" name="email_address" class="text register-email" placeholder="Email address" aria-labelledby="register-email-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-email-description"><i class="icon"></i><span class="visually-hidden" id="clear-email-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="register-password" id="register-password-label">Password</label>\n</div>\n<div class="field-container">\n<input type="password" id="register-password" name="password1" class="text register-password" placeholder="Password" data-type="password" aria-labelledby="register-password-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-password-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="retype-password" id="retype-password-label">Retype password</label>\n</div>\n<div class="field-container">\n<input type="password" id="retype-password" name="password2" class="text retype-password" placeholder="Retype password" data-type="password" aria-labelledby="retype-password-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-retyped-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-retyped-password-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control layout-horizontal">\n<p class="form-hint">\nBy signing up, you agree to receive updates and special offers for The New York Timesâ€™s products and services. You may unsubscribe at any time.\n</p>\n</div>\n<div class="control">\n<p class="disclaimer"><a href="http://www.nytimes.com/content/help/rights/terms/terms-of-service.html">Terms of Service</a> <a href="http://www.nytimes.com/content/help/rights/privacy/policy/privacy-policy.html">Privacy Policy</a></p>\n</div>\n<div class="control button-control">\n<button id="register-send-button" class="button register-button">Create Account</button>\n</div>\n<input name="is_continue" value="1" type="hidden">\n<input id="account-form-token" name="token" value="" type="hidden">\n<input id="account-form-expiration" name="expires" value="" type="hidden">\n<input id="account-form-subscribe" name="subscribe[]" type="hidden" value="MM">\n</form>\n</div><!-- close registration-form-control -->';return __p},templates.registrationModalFooter=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<p class="user-action login-modal-trigger">Already have an account? <a href="javascript:;">Log In</a></p>';return __p},templates.userProfileModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="user-profile-form-control form-control '+(null==(__t=user?"":"user-profile-form-control-loading")?"":__t)+'">\n',user&&(__p+='\n<form id="user-profile-form" class="user-profile-form" role="form" method="post">\n<div class="controls">\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="user-profile-name" id="user-profile-name-label">Name</label>\n</div>\n<div class="field-container">\n<input type="text" id="user-profile-name" name="name" class="text user-profile-name" placeholder="Name" aria-labelledby="user-profile-name-label" aria-required="true" value="'+(null==(__t=user.getName())?"":__t)+'">\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-name-description"><i class="icon"></i><span class="visually-hidden" id="clear-name-description">Clear this text input</span></button>\n</div>\n</div>\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="user-profile-location" id="user-profile-location-label">Location</label>\n</div>\n<div class="field-container">\n<input type="text" id="user-profile-location" name="location" class="text user-profile-location" placeholder="Location" aria-labelledby="user-profile-location-label" aria-required="true" value="'+(null==(__t=user.getLocation())?"":__t)+'">\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-location-description"><i class="icon"></i><span class="visually-hidden" id="clear-location-description">Clear this text input</span></button>\n</div>\n</div>\n<div class="control button-control">\n<button class="button save-button">Save</button>\n<button class="button cancel-button">Cancel</button>\n</div>\n</div>\n<div class="avatar" role="presentation">\n<span class="avatar-image"><img width="80" height="80" src="'+(null==(__t=user.getAvatar())?"":__t)+'"/></span>\n<label class="user-profile-avatar-button" for="user-profile-avatar-input">\nEdit photo\n<input type="file" name="avatar" id="user-profile-avatar-input" class="user-profile-avatar-input"/>\n</label>\n<div class="avatar-editor">\n<div class="avatar-crop"></div>\n<button class="button crop-button">Crop</button>\n</div>\n</div>\n</form>\n'),__p+="\n</div><!-- close user-profile-form-control -->";return __p},templates.userProfileModalHeader=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<h4 class="modal-subheading">Your profile is public. It will appear with any comments you leave on NYTimes.com</h4>';return __p},templates}),define("shared/account/helpers/account-modal-mixin",["jquery/nyt","underscore/nyt","foundation/lib/polyfills/placeholder","shared/account/templates","foundation/models/token","foundation/hosts"],function(e,t,i,n,s,a){"use strict";var o={oauthProviders:["google","facebook"],handleFormSubmit:function(e){s.getToken()?(this.$el.find("#account-form-token").val(s.getToken()),this.$el.find("#account-form-expiration").val(s.getTokenExpiration()),this.$el.find("#login-remember").val(this.$el.find("#login-remember-checkbox").is(":checked")?1:0)):e.preventDefault()},handleFormButton:function(){s.getToken()?this.$el.find("form").submit():(this.subscribeOnce("nyt:myaccount-token",this.handleFormButton),s.loadData())},handleKeyUp:function(t){var i=e(t.target);i.parent().find(".clear-button").toggle(""!==i.val())},handleClearButton:function(t){var n=e(t.currentTarget),s=n.parent().find("input");n.toggle(!1),s.val(""),i()},executeOauthLogin:function(t){t.preventDefault(),this.oauthPopup(e(t.currentTarget).data("providerName"))},addEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)},getPageUrlParams:function(){var t,i=window.location,n={URI:i.protocol+"//"+i.hostname+"/"+i.pathname.replace(/^\//,"")};return i.search.length>1&&(t=i.search.substr(1),t=t.replace(/(\?|&)?gwh=([^&]+)/g,""),t=t.replace(/(\?|&)?gwt=([^&]+)/g,""),t=t.replace(/%/g,"Q"),n.OQ=t),e.param(n)},getSocialLinkUrl:function(e,t,i){return a.myaccount+"/oauth/"+t+"-link?type=login&URI="+e+(i?"&view=popup":"")+"&flow=HPLI"},oauthPopup:function(e){var i,n,s="oauthPopup",a=450,o=600;-1!==t.indexOf(this.oauthProviders,e)&&(n=["height="+o,"width="+a,"left="+(window.screen.availLeft+window.screen.width/2-a/2),"top="+Math.max(window.screen.height/2-o/2-20,0),"scrollbars=1"],i=window.open("about:blank",s,n.join(",")),i?(i=window.open(this.getSocialLinkUrl(document.URL,e,!0),s,n.join(",")),i.focus()):window.location.href=this.getSocialLinkUrl(document.URL,e))},renderOauthButtons:function(){return n.oauthButtons({facebookId:this.getFacebookButtonId(this.modalSettings.id),googleId:this.getGoogleButtonId(this.modalSettings.id),prefix:this.modalSettings.oauthButtonText})},addOauthEvents:function(e){this.$el.find("#"+this.getGoogleButtonId(e)+", #"+this.getFacebookButtonId(e)).on("click",t.bind(this.executeOauthLogin,this))},getFacebookButtonId:function(e){return"facebook-oauth-button-"+e},getGoogleButtonId:function(e){return"google-oauth-button-"+e}};return o}),define("shared/account/views/login-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/modal/views/modal","shared/account/templates","foundation/hosts","shared/account/helpers/account-modal-mixin","foundation/lib/polyfills/placeholder"],function(e,t,i,n,s,a,o,r,l){"use strict";var d=i.extend(t.extend({},r,{state:n.isLoggedIn()?"logged in":"logged out",events:{"click .registration-modal-trigger":"handleRegisterClick","click #login-send-button":"handleFormButton","submit #login-form":"handleFormSubmit","click .clear-button":"handleClearButton","keyup .text":"handleKeyUp","click .oauth-button":"handleLoginModalClick","click .login-form":"handleLoginModalClick"},nytEvents:{"nyt:loginmodal-open":"handleOpen"},defaultSettings:{id:"login-modal",addlClasses:"account-modal",headerContent:a.accountModalHeader(),modalContent:"",modalFooter:a.loginModalFooter(),modalTitle:"Log in",moduleName:"LogIn",oauthButtonText:"Log in",binding:".login-modal-trigger",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0,tailLeftOffset:-40,tailTopOffset:-40},initialize:function(e){var i=this;this.modalSettings=t.extend({},this.defaultSettings,e),this.registrationPlatform=!1,this.modalSettings.modalContent=a.logInModalContent({oauthButtons:this.renderOauthButtons(),loginUrl:o.myaccount+"/auth/login?"+this.getPageUrlParams()}),this.modalSettings.openCallback=function(){var e=i.modalTitle||this.$target.data("modal-title")||"Log in",t=i.moduleName||"LogIn";i.hasPlaceholderSupport&&this.$modal.find(".login-email").focus(),this.$modal.find("#login-modal-modal-heading").text(e),this.$modal.find(".modal-subheading").toggleClass("hidden","Log in"!==e),this.$modal.find(".field-container input").val(""),i.modalTitle=null,this.trackingTrigger("tagx-auth-interaction",{module:t,state:i.state,eventName:"modal popup | "+t})},this.subscribe("nyt:modal-show-login-modal",l)},handleDomReady:function(){this.render()},render:function(){this.logInModal=new s(this.modalSettings).addToPage(),this.setElement(this.logInModal.$modal),this.local(this,"nyt:modal-login-modal-rendered"),this.addOauthEvents(this.modalSettings.id)},handleOpen:function(e){e&&e.modalTitle&&(this.modalTitle=e.modalTitle),e&&e.moduleName&&(this.moduleName=e.moduleName),e&&e.registrationPlatform&&(this.registrationPlatform=e.registrationPlatform),this.logInModal&&this.logInModal.open()},handleUserReady:function(){n.isLoggedIn()&&(this.logInModal?(this.logInModal.removeFromPage(),this.remove()):this.subscribeOnce(this,"nyt:modal-login-modal-rendered",this.handleUserReady))},handleRegisterClick:function(e){var t={};e.stopPropagation(),this.registrationPlatform&&(t.platformTracking=this.registrationPlatform,this.registrationPlatform=!1),this.logInModal.close(),this.broadcast("nyt:registrationmodal-open",t),this.trackingTrigger("loginmodal-register-click",{module:"Registration",action:"Click","WT.z_ract":"Regnow"}),this.trackingTrigger("tagx-auth-interaction",{module:"Registration",state:this.state,eventName:"modal click | Registration"})},handleLoginModalClick:function(){this.trackingTrigger("tagx-auth-interaction",{module:"LogIn",state:this.state,eventName:"modal click | LogIn"})}}));return d}),define("shared/account/views/registration-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/account/templates","foundation/hosts","shared/account/helpers/account-modal-mixin","foundation/lib/polyfills/placeholder"],function(e,t,i,n,s,a,o,r){"use strict";var l=i.extend(t.extend({},o,{events:{"click .login-modal-trigger":"handleLoginClick","click #register-send-button":"handleFormButton","submit #registration-form":"handleFormSubmit","click .clear-button":"handleClearButton","keyup .text":"handleKeyUp"},nytEvents:{"nyt:registrationmodal-open":"handleOpen"},defaultSettings:{id:"registration-modal",addlClasses:"account-modal",headerContent:s.accountModalHeader(),modalContent:"",modalFooter:s.registrationModalFooter(),modalTitle:"Sign up",oauthButtonText:"Sign up",binding:".registration-modal-trigger",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0,tailLeftOffset:-40,tailTopOffset:-40},initialize:function(i){var n=this;this.modalSettings=t.extend({},this.defaultSettings,i),this.platformTracking=!1,this.modalSettings.modalContent=s.registrationModalContent({oauthButtons:this.renderOauthButtons(),regiUrl:a.myaccount+"/register?"+this.getPageUrlParams()}),this.modalSettings.openCallback=function(){n.hasPlaceholderSupport&&this.$modal.find(".register-email").focus(),this.$modal.find(".field-container input").val(""),e("#account-form-platform").remove(),n.platformTracking&&(e("#registration-form").append('<input id="account-form-platform" name="regi_info_platform" type="hidden" value="'+n.platformTracking+'">'),n.platformTracking=!1)},this.subscribe("nyt:modal-show-registration-modal",r)},handleDomReady:function(){this.render()},render:function(){this.registrationModal=new n(this.modalSettings).addToPage(),this.setElement(this.registrationModal.$modal),this.addOauthEvents(this.modalSettings.id)},handleLoginClick:function(){this.registrationModal.close()},handleOpen:function(e){e&&e.platformTracking&&(this.platformTracking=e.platformTracking),this.registrationModal&&this.registrationModal.open()}}));return l}),define("shared/account/instances/account",["shared/account/views/login-modal","shared/account/views/registration-modal","foundation/models/user-data"],function(e,t,i){"use strict";i.isLoggedIn()||(new e,new t)}),define("shared/recommendations/templates",["underscore/nyt"],function(_){var templates={};return templates.mostPopular=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",collection.length?(__p+="<ol>",_.each(collection.slice(0,10),function(e,t){__p+='<li>\n<a class="story-link" href="'+(null==(__t=e.get("link"))?"":__t)+'">\n<article class="story">\n',_.isEmpty(e.getCrop("thumbStandard"))||(__p+='\n<div class="small-thumb">\n<img src="'+(null==(__t=e.getCrop("thumbStandard").url)?"":__t)+'" />\n</div>\n'),__p+='\n<div class="story-body">\n',e.get("kicker")&&(__p+='\n<h3 class="kicker">'+(null==(__t=e.get("kicker"))?"":__t)+"</h3>\n"),__p+='\n<h2 class="headline">\n'+(null==(__t=e.get("headline"))?"":__t)+"\n</h2>\n</div>\n</article>\n</a>\n</li>"}),__p+="</ol>"):__p+='<p class="error-message">This article list is not currently available. Please try again later.</p>',__p+='<footer class="recommendations-footer">\n<p class="user-action"><a href="http://www.nytimes.com/gst/mostpopular.html">Go to Complete List &raquo;</a></p>\n<p class="user-toggle"><a class="show-recommended">Show My Recommendations</a></p>\n</footer>';return __p},templates.recommended=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",collection.length?(__p+="",isLoggedIn&&(__p+='<header class="recommendations-header">\n<div class="article-count"><span class="counter">'+(null==(__t=collection.getCount())?"":__t)+'</span> articles viewed recently</div>\n<div class="user-meta">\n',__p+=collection.getUserPictureUrl()?'\n<img class="avatar" src="'+(null==(__t=collection.getUserPictureUrl())?"":__t)+'" />\n':'\n<img class="avatar" src="'+(null==(__t=staticHost)?"":__t)+'/images/apps/timespeople/none.png" />\n',__p+='\n<span class="user-name">'+(null==(__t=collection.getUserDisplayName())?"":__t)+'</span><br />\n<a href="http://www.nytimes.com/recommendations">All Recommendations</a>\n</div>\n</header>'),__p+="<ol>",_.each(collection.slice(0,10),function(e,t){__p+='<li>\n<a class="story-link" href="'+(null==(__t=e.get("link"))?"":__t)+'">\n<article class="story">\n',_.isEmpty(e.getCrop("thumbStandard"))||(__p+='\n<div class="small-thumb">\n<img src="'+(null==(__t=e.getCrop("thumbStandard").url)?"":__t)+'" />\n</div>\n'),__p+='\n<div class="story-body">\n',e.get("kicker")&&(__p+='\n<h3 class="kicker">'+(null==(__t=e.get("kicker"))?"":__t)+"</h3>\n"),__p+='\n<h2 class="headline">\n'+(null==(__t=e.get("headline"))?"":__t)+"\n</h2>\n</div>\n</article>\n</a>\n</li>"}),__p+="</ol>"):__p+='<p class="error-message">We don&rsquo;t have any personalized recommendations for you at this time. Please try again later.</p>',__p+='<footer class="recommendations-footer">',__p+=isLoggedIn?'<div class="user-actions">\n<p class="user-action"><a href="http://www.nytimes.com/recommendations">Go to Your Recommendations &raquo;</a></p>\n<ul class="menu layout-horizontal theme-links with-pipes">\n<li><a href="http://www.nytimes.com/content/help/extras/recommendations/recommendations.html">What&rsquo;s This?</a></li>\n<li><a class="hide-recommended">Donâ€™t Show</a></li>\n</ul>\n</div><div id="recommendedAd" class="recommended-ad ad">\n<iframe scrolling="no" frameborder="0" src="http://www.nytimes.com/packages/html/recommendations/ad.html" width="168" height="40"></iframe>\n</div>':'<p class="user-message">Log in to discover more articles<br>based on what you&rsquo;ve read.</p><div id="recommendedAd" class="recommended-ad ad">\n<iframe scrolling="no" frameborder="0" src="http://www.nytimes.com/packages/html/recommendations/ad.html" width="168" height="40"></iframe>\n</div><div class="user-actions logged-out">\n<div class="user-tools-button-group">\n<button class="button login-button login-modal-trigger">Log In</button>\n<button class="button registration-button registration-modal-trigger">Register Now</button>\n</div>\n<ul class="menu layout-horizontal theme-links with-pipes">\n<li><a href="http://www.nytimes.com/content/help/extras/recommendations/recommendations.html">What&rsquo;s This?</a></li>\n<li><a class="hide-recommended">Donâ€™t Show</a></li>\n</ul></div><!-- close user-actions -->',__p+="</footer>";return __p},templates}),define("shared/tabs/views/legacy/tabs",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/views/base-view"],function(e,t,i,n){"use strict";var s=n.extend({activeTabClass:"selected",events:{"click .tabs li":"handleTabClick"},initialize:function(){var e,i;t.bindAll(this,"handleTabClick"),this.$tabs=this.$el.find(".tabs li"),e=this.$tabs.filter(".selected"),this.$tabContent=this.$el.siblings(".tab-content"),this.resetState(),e.length>0?(i=e.eq(0).index(),this.activateTab(i)):this.activateTab(0)},handleTabClick:function(t){var i=e(t.currentTarget).closest("li"),n=i.index();i.hasClass(this.activeTabClass)||t.preventDefault(),this.local(this,"nyt:tab-click",t,n),this.resetState(),this.activateTab(n)},activateTab:function(e){this.$tabs.eq(e).addClass(this.activeTabClass),this.$tabContent.eq(e).show()},resetState:function(){this.$tabs.removeClass(this.activeTabClass),this.$tabContent.hide()}});return s}),define("shared/data/models/article",["underscore/nyt","backbone/nyt"],function(e,t){"use strict";var i=t.Model.extend({defaults:{title:"",kicker:"",pubdate:"",link:"",media:[{
caption:"","media-metadata":[{url:""}]}],promotional_media:[{image:{image_crops:{}}}],processed:!1},initialize:function(){this.adjustKicker()},adjustKicker:function(){this.isOpinion()&&this.get("authors")&&this.set("kicker",this.get("authors")[0])},isOpinion:function(){return"Op-Ed Columnist"===this.get("kicker")||"Opinionator"===this.get("kicker")},getCrop:function(e){var t=this.get("promotional_media"),i="",n="image";try{if(t.type&&"image"!==t.type){switch(n=t.type){case"video":i="Play Video";break;case"slideshow":i="View Slideshow";break;case"interactive":i="View Interactive";break;default:i="View Media"}t=t.promotional_media}return t.image.image_crops[e].type=n,t.image.image_crops[e].typeName=i,t.image.image_crops[e]}catch(s){return{}}},getLink:function(){return this.get("link")},getType:function(){var e="";return this.get("type")?e=this.get("type"):this.get("item_type")&&(e=this.get("item_type")),e.toLowerCase()},isVideo:function(){return"video"===this.getType()},isSlideshow:function(){var e=this.getType();return"imageslideshow"===e||"slideshow"===e},isPromoMediaTypeSlideshow:function(){var e=this.get("promotional_media");return"slideshow"===e.type},isPromoMediaTypeVideo:function(){var e=this.get("promotional_media");return"video"===e.type},getVideoKicker:function(){return this.get("kicker")?this.get("kicker"):this.get("section")},createDateObject:function(e){var t,i,n=new Date(e);return n.getDate()||e.search(/\d+T\d+/)>=0&&(t=e.split("T")[0],i=t.split("-"),n=new Date(i[0],i[1]-1,i[2])),n},getFormattedDate:function(e){var t,i=["Jan.","Feb.","March","April","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."];return e=e||this.get("pubDate"),t=this.createDateObject(e),i[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()},getDatetime:function(e){var t;return e=e||this.get("pubDate"),t=this.createDateObject(e),t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}});return i}),define("shared/data/models/most-popular",["underscore/nyt","backbone/nyt","shared/data/models/article"],function(e,t,i){"use strict";var n=i.extend({getVideoKicker:function(){return this.get("section")}});return n}),define("shared/data/helpers/collection-mixin",[],function(){"use strict";var e={hasFetched:!1,getNext:function(e,t){var i=e.indexOf(t),n=i===e.length?0:i+1;return e.at(n)},loadData:function(){var e=this;return 0!==this.length||this.hasFetched||(this.hasFetched=!0,this.fetch({success:function(){e.trigger("fetchSuccess")},error:function(){e.trigger("fetchError")}})),this},getIdentifier:function(){return"rref="+this.sectionId},getName:function(){return this.sectionName},getUrl:function(){return this.sectionUrl}};return e}),define("shared/data/collections/most-popular",["backbone/nyt","foundation/collections/base-collection","shared/data/models/most-popular","foundation/hosts","underscore/nyt","shared/data/helpers/collection-mixin","foundation/views/page-manager"],function(e,t,i,n,s,a,o){"use strict";var r=t.extend(s.extend({},a,{model:i,apis:{mostviewed:{url:n.s1Host+"/du/mostpopular/viewed/all_1.jsonp?v1",callback:"jsonCallbackViewed"},mostemailed:{url:n.s1Host+"/du/mostpopular/emailed/all_1.jsonp?v1",callback:"jsonCallbackEmailed"},mostviewed7days:{url:n.DUHost+"/svc/mostpopular/v2/viewed/7.jsonp",callback:"jsonCallbackMostEmailed7"},mosttweeted:{url:n.DUHost+"/svc/mostpopular/v2/shared/1/twitter.jsonp",callback:"jsonCallbackTweeted"},mostsharedonfacebook:{url:n.DUHost+"/svc/mostpopular/v2/shared/1/facebook.jsonp",callback:"jsonCallbackFacebook"}},initialize:function(e,t){var i;this.url=this.apis[t.type].url,this.callback=this.apis[t.type].callback,o.flag("styledMostEmailed")&&(i=this.pageManager.getUrlParam("testUrlMostEmailed"),i&&(this.url=i))},sync:function(t,i,n){return n.dataType="jsonp",n.jsonpCallback=this.callback,n.jsonp="callback",n.cache=!0,e.sync(t,i,n)},parse:function(e){var t=this,i=s.map(e.results,function(e){var i=[];return e.id&&(e.data_id=e.id,delete e.id),e.asset_id&&delete e.asset_id,""===e.media?delete e.media:i=e.media[0]["media-metadata"]||[],e.promotional_media={image:{image_crops:{thumbStandard:t.getCrop(i,"Standard Thumbnail"),mediumThreeByTwo210:t.getCrop(i,"mediumThreeByTwo210"),mediumThreeByTwo440:t.getCrop(i,"mediumThreeByTwo440")}}},e.description=e["abstract"],e.link=e.url,e.kicker=e.column,e.headline=e.title,e.authors=[e.byline.replace("By ","").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})],e.pubDate=e.published_date,e});return i},getCrop:function(e,t){var i,n;for(i=0,n=e.length;n>i;i+=1)if(e[i].format===t)return e[i]},getIdentifier:function(){return"src=me"}}));return r}),define("shared/data/instances/most-emailed",["foundation/views/page-manager","shared/data/collections/most-popular"],function(e,t){"use strict";return new t([],{type:"mostemailed"})}),define("shared/data/instances/most-viewed",["jquery/nyt","foundation/views/page-manager","shared/data/collections/most-popular"],function(e,t,i){"use strict";return new i([],{type:"mostviewed"})}),define("shared/data/collections/trending-pages",["underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/hosts","shared/data/models/article","shared/data/helpers/collection-mixin"],function(e,t,i,n,s,a){"use strict";var o=i.extend(e.extend({},a,{model:s,url:n.s1Host+"/du/trending/top_pages.jsonp",sync:function(e,i,n){return n.dataType="jsonp",n.jsonpCallback="top_pages_callback",n.jsonp="callback",n.cache=!0,t.sync(e,i,n)},parse:function(t){var i=t.top_pages;return this.last_updated=t.updated_ts,e.map(i,function(e){e.link=e.url}),i},getIdentifier:function(){return"src=trending"}}));return o}),define("shared/data/instances/trending-pages",["shared/data/collections/trending-pages"],function(e){"use strict";return new e}),define("shared/data/collections/recommendations",["backbone/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","underscore/nyt","shared/data/helpers/collection-mixin"],function(e,t,i,n,s,a){"use strict";var o=t.extend(s.extend({},a,{model:i,url:n.personalizationHost+"/svc/recommendations/v3/personalized.json",sync:function(t,i,n){return n.cache=!0,n.data={access_key:"776ACB1E-6C7F-4702-9E18-CF329376F5A3",location:this.pageManager.getApplicationName()},n.xhrFields={withCredentials:!0},e.sync(t,i,n)},parse:function(e){var t=this,i=s.map(e.suggestions,function(e){var i=e.thumbs||{};return e.promotional_media={image:{image_crops:{thumbStandard:e.thumbnail,mediumThreeByTwo210:t.getCrop(i,"mediumThreeByTwo210")}}},e.kicker&&"Video"===e.item_type&&(e.kicker="Video | "+e.kicker),e.byline?e.authors=[e.byline.replace("By ","").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})]:e.authors="",e.description=e["abstract"],e.link=e.url,e.headline=e.title,e.pubDate=e.published_date,e});return this.num_articles=e.num_articles,this.uid=e.uid,this.user_displayname=e.user_displayname,this.user_pic_url=e.user_pic_url,i},getCount:function(){return this.num_articles||0},getUserId:function(){return this.uid||0},getUserDisplayName:function(){return this.user_displayname||null},getUserPictureUrl:function(){return this.user_pic_url||null},getCrop:function(e,t){var i,n;for(i=0,n=e.length;n>i;i+=1)if(e[i].type===t)return e[i].url=e[i].content,e[i]},getIdentifier:function(){return"src=recg"}}));return o}),define("shared/data/instances/recommendations",["jquery/nyt","foundation/views/page-manager","shared/data/collections/recommendations"],function(e,t,i){"use strict";return new i}),define("shared/recommendations/views/recommendations",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/hosts","foundation/views/base-view","foundation/models/user-data","foundation/cookies","shared/recommendations/templates","shared/tabs/views/legacy/tabs","shared/data/instances/most-emailed","shared/data/instances/most-viewed","shared/data/instances/trending-pages","shared/data/instances/recommendations"],function(e,t,i,n,s,a,o,r,l,d,c,h,u){"use strict";var m=s.extend({el:"#recommendations",events:{"click .hide-recommended":"handleHideClick","click .show-recommended":"handleShowClick"},collectionList:{"most-emailed":{name:"mostEmailedCollection",render:"renderMostEmailed",instance:d},"most-viewed":{name:"mostViewedCollection",render:"renderMostViewed",instance:c},recommended:{name:"recommendedCollection",render:"renderRecommended",instance:u},trending:{name:"trendingCollection",render:"renderTrending",instance:h}},initialize:function(){var t,i=o.readCookie("nyt-recommend");this.$tabsContainer=this.$el.find(".tabs-container"),t=new l({el:this.$tabsContainer}),this.subscribe(t,"nyt:tab-click",function(t){var i=t.isTrigger,n=e(t.currentTarget).data("type");this.handleTabClick(n,i)}),this.pageManager.flag("homepageTrending")&&"1"===this.isUserVariant("homepageTrending")?this.activateRecommended():this.pageManager.flag("homepageTrending")&&"2"===this.isUserVariant("homepageTrending")?(this.deactivateRecommended(),this.activateTrending()):"0"===i?this.deactivateRecommended():i&&"1"!==i||this.activateRecommended()},handleTabClick:function(e,t){var i=this.collectionList[e];this[i.name]=i.instance.loadData(),this[i.name].length>0?this[i.render]():this.subscribeOnce(this[i.name],"sync error",this[i.render]),this.broadcast("nyt:recommended-tab-click",e,t)},renderMostEmailed:function(){this.$el.find(".tab-content.most-emailed").html(r.mostPopular({collection:this.mostEmailedCollection}))},renderMostViewed:function(){this.$el.find(".tab-content.most-viewed").html(r.mostPopular({collection:this.mostViewedCollection}))},renderTrending:function(){this.$el.find(".tab-content.trending").html(r.mostPopular({collection:this.trendingCollection}))},renderRecommended:function(){this.recommendedCollection.length>0?(this.$el.find(".tab-content.recommended").html(r.recommended({staticHost:n.staticHost,collection:this.recommendedCollection,isLoggedIn:a.isLoggedIn()})),this.broadcast("nyt:ads-new-placement","recommendedAd")):(this.deactivateRecommended(),this.$el.addClass("recommended-no-results"))},handleHideClick:function(e){e.preventDefault(),this.deactivateRecommended(),o.writeCookie("nyt-recommend","0"),this.broadcast("nyt:recommended-click-switch",!1)},handleShowClick:function(e){e.preventDefault(),this.activateRecommended(),o.writeCookie("nyt-recommend","1"),this.broadcast("nyt:recommended-click-switch",!0)},deactivateRecommended:function(){this.$tabsContainer.find("li[data-type=most-emailed]").trigger("click"),this.$tabsContainer.find("li[data-type=recommended]").hide(),this.$el.removeClass("recommended-active")},activateRecommended:function(){this.$tabsContainer.find("li[data-type=recommended]").show().trigger("click"),this.$el.addClass("recommended-active")},activateTrending:function(){this.$tabsContainer.find("li[data-type=trending]").show().trigger("click")}});return m}),define("homepage/instances/recommendations",["jquery/nyt","underscore/nyt","foundation/views/page-manager","shared/recommendations/views/recommendations"],function(e,t,i,n){"use strict";var s,a;s=function(){var t,n,s;return t=e("#recommendations"),s=i.isComponentVisible(t),n=t.length>0&&window.pageYOffset+window.innerHeight>t.position().top-200,s||n?(a(),t.find("#recommendations-module-loader").hide(),!0):!1},a=function(){i.stopListening(i,"nyt:page-scroll",s),new n},s()||i.listenTo(i,"nyt:page-scroll",s)}),define("shared/searchform/models/search-suggest",["foundation/models/base-model"],function(e){"use strict";var t=e.extend({defaults:{query:"",results:[]}});return t}),define("shared/searchform/collections/search-suggest",["backbone/nyt","foundation/collections/base-collection","foundation/views/page-manager","shared/searchform/models/search-suggest","foundation/hosts"],function(e,t,i,n,s){"use strict";var a=t.extend({model:n,mobileBaseUrl:s.mobileWeb,desktopBaseUrl:s.www,settings:{numOfSuggestions:7},query:"",sync:function(t,i,n){var s="/svc/suggest/v1/homepage?query="+this.query;return this.pageManager.getCurrentBreakpoint()<120?n.url=this.mobileBaseUrl+s:n.url=this.desktopBaseUrl+s,e.sync(t,i,n)},parse:function(e){return{query:e[0],results:e[1].slice(0,this.settings.numOfSuggestions)}},newQuery:function(e){this.query=e,this.fetch()}});return a}),define("shared/searchform/templates",["underscore/nyt"],function(_){var templates={};return templates.autoSuggest=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li><a href="'+(null==(__t=queryUrl)?"":__t)+'">\n'+(null==(__t=suggest.replace(queryRegExp,"<strong>"+query+"</strong>"))?"":__t)+"\n</a></li>";return __p},templates}),define("shared/searchform/helpers/search-form-mixin",["jquery/nyt","underscore/nyt","foundation/lib/polyfills/placeholder","shared/searchform/collections/search-suggest","shared/searchform/templates","foundation/hosts"],function(e,t,i,n,s,a){"use strict";var o=t.extend({},{collection:new n,searchBaseUrl:a.search+"/search/sitesearch/#/",searchMobileUrl:a.mobileWeb+"/search?query=",KEYS:{ENTER:13,ESC:27,UP_ARROW:38,DOWN_ARROW:40,LEFT_ARROW:37,RIGHT_ARROW:39},initialize:function(){var e=this.pageManager.getMeta("article:section")||"";t.bindAll(this,"handlePageClicks"),this.trackingBaseData={action:"click",contentCollection:e,region:"TopBar"}},handleDomReady:function(){this.$list=this.$el.find(".auto-suggest"),this.$clearButton=this.$el.find(".clear-button"),this.$overlay=this.$shell.find(".search-overlay"),this.$input=this.$el.find(".search-input"),this.$submitButton=this.$el.find(".submit-button"),this.disableSubmitButton(),this.listenTo(this.collection,"sync change",this.render),this.throttledSuggestions=t.debounce(this.getAutoSuggestions,250),this.afterInitialize()},afterInitialize:e.noop,render:function(){var e,t="",i=this.collection.toJSON()[0],n=new RegExp(i.query,"ig"),a=s.autoSuggest,o=i.results.length;if(o>0&&this.getSearchValue().length>0){for(e=0;o>e;e+=1)t+=a({query:i.query,queryUrl:this.getSearchUrl(i.results[e]),suggest:i.results[e],queryRegExp:n});this.$list.show().find("ol").html(t)}else this.$list.hide()},handleKeyDown:function(e){var t=e.which;t===this.KEYS.ENTER&&e.preventDefault()},handleKeyUp:function(e){var t=e.which;e.preventDefault(),t===this.KEYS.UP_ARROW||t===this.KEYS.DOWN_ARROW?this.navigateAutoSuggestions(t):t===this.KEYS.ENTER?this.handleEnterKey(e):t===this.KEYS.RIGHT_ARROW||t===this.KEYS.LEFT_ARROW?this.handleRightLeftKey(e):(this.$clearButton[this.getSearchValue().length>0?"fadeIn":"fadeOut"](200),this.getSearchValue().length?this.$submitButton.hasClass("disabled")&&this.$submitButton.removeClass("disabled"):this.disableSubmitButton(),this.throttledSuggestions())},handleEnterKey:function(){this.submitSearch()},handleRightLeftKey:e.noop,handleClearButton:function(e){e.preventDefault(),this.setSearchValue(""),this.$clearButton.fadeOut(200),this.disableSubmitButton(),this.$input.focus(),i()},setSearchValue:function(e){this.$input.val(e)},getSearchValue:function(){return e.trim(this.$input.val())},hideAutoSuggest:function(){this.$list.hide()},getAutoSuggestions:function(){var e=this.getSearchValue();e.length>1?this.collection.newQuery(e):this.hideAutoSuggest()},getSearchUrl:function(e){return this.pageManager.getCurrentBreakpoint()<120?this.searchMobileUrl+e+"&sort=rel":this.searchBaseUrl+e},navigateAutoSuggestions:function(e){var t,i;i=this.$list.find(".active"),t=i.parent().index()||0,t+=e===this.KEYS.UP_ARROW?-1:1,this.$list.find("a").removeClass("active").eq(t).addClass("active"),this.setSearchValue(this.$list.find("a").eq(t).text())},submitSearch:function(e){var t,i=this.getSearchValue();e&&e.preventDefault(),i&&(t=this.trackingAppendParams(this.getSearchUrl(i),{module:"SearchSubmit"}),this.$el.is(":visible")&&(window.location=t))},handlePageClicks:function(){this.hideAutoSuggest()},disableSubmitButton:function(){this.$submitButton.addClass("disabled")}});return o}),define("shared/masthead/views/search",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/searchform/helpers/search-form-mixin"],function(e,t,i,n){"use strict";var s=i.extend(t.extend({},n,{el:e("#masthead").find(".search-flyout-panel"),events:{"click .close-button":"close","keyup .search-input":"handleKeyUp","keydown .search-input":"handleKeyDown","click .submit-button":"submitSearch","click .clear-button":"handleClearButton"},nytEvents:{"nyt:masthead-search-click":"toggle","nyt:masthead-search-toggle":"handleSearchToggle","nyt:navigation-search-click":"toggle","nyt:search-close-ready":"close"},slideTiming:100,afterInitialize:function(){this.trackingBaseData["WT.nav"]="searchWidget",this.$input.removeAttr("placeholder")},open:function(){var e=this;this.$el.slideDown(this.slideTiming,function(){e.$el.find(".control").fadeIn(e.slideTiming).end().find(".search-input").val("").focus()}),this.broadcast("nyt:masthead-search-toggle",!0),this.$shell.on("click",this.handlePageClicks),this.subscribeOnce("nyt:page-key-esc",this.close),this.$overlay.fadeIn(200),this.$html.addClass("search-active")},close:function(){var e=this;this.$html.hasClass("search-active")&&(this.$el.find(".control").fadeOut(this.slideTiming,function(){e.$el.slideUp(e.slideTiming,function(){e.$html.removeClass("search-active")})}),this.broadcast("nyt:masthead-search-toggle",!1),this.$shell.off("click",this.handlePageClicks),this.setSearchValue(""),this.$overlay.fadeOut(200))},toggle:function(){this[this.$el.is(":visible")?"close":"open"]()},isSearchButton:function(t){var i=e(t).hasClass("search-button"),n=1===e(t).parents(".search-button").length;return i||n},isSearchFlyout:function(t){var i=e(t).hasClass("search-flyout-panel"),n=1===e(t).parents(".search-flyout-panel").length;return i||n},handlePageClicks:function(e){this.isSearchButton(e.target)||this.isSearchFlyout(e.target)||this.close(),this.hideAutoSuggest()},handleSearchToggle:function(e){e===!1&&(this.$el.find(".submit-button").addClass("disabled"),this.$el.find(".clear-button").hide())}}));return s}),define("shared/masthead/templates",["underscore/nyt"],function(_){var templates={};return templates.profileIcon=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<span class="avatar" role="presentation">\n<a href="javascript:;" href="user-profile-button"><img src="'+(null==(__t=userData.getImageUrl())?"":__t)+'" alt="" /></a>\n</span>';return __p},templates.userName=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button class="button user-name-button">\n<span class="button-text">'+(null==(__t=getTruncatedUserName(15))?"":__t)+'</span>\n<i class="icon sprite-icon user-icon"></i>\n<i class="icon caret-icon"></i>\n</button>';return __p},templates.userNameModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<ul>\n<li><a href="javascript:;" class="user-profile-button">Edit Profile</a></li>\n<li><a href="'+(null==(__t=hosts.myaccount)?"":__t)+'/membercenter/myaccount.html">My Account</a></li>\n<li><a href="'+(null==(__t=hosts.myaccount)?"":__t)+'/mem/manage_billing.html">My Billing Information</a></li>\n<li><a href="'+(null==(__t="http:"+hosts.www)?"":__t)+'/saved">My Saved Items</a></li>\n<li><button class="button log-out-button">Log Out</button></li>\n</ul>';return __p},templates.userNameModalTitle=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",""!=userData.getImageUrl()&&(__p+='<span class="avatar">\n<a href="javascript:;" class="user-profile-button"><img src="'+(null==(__t=userData.getImageUrl())?"":__t)+'" /></a>\n</span>'),__p+='\n<span class="user-name-subscription">\n<span class="user-name">'+(null==(__t=userData.getUserName())?"":__t)+'</span>\n<span class="user-subscription"><a href="https://myaccount.nytimes.com/membercenter/myaccount.html">'+(null==(__t=subscription.label)?"":__t)+"</a></span>\n</span>";return __p},templates.userSettingsModal=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="menu edition-menu">\n<h5 class="modal-heading">Edition</h5>\n<ul>\n<li><a href="http://www.nytimes.com" data-edition="us">U.S.</a></li>\n<li><a href="http://global.nytimes.com" data-edition="global">International</a></li>\n<li><a href="http://cn.nytimes.com" data-edition="chinese">ä¸­æ–‡ (Chinese)</a></li>\n<li><a href="http://www.nytimes.com/es/" data-edition="spanish">EspaÃ±ol</a></li>\n</ul>\n</div>\n<div class="menu help-menu">\n<h5 class="modal-heading">Help</h5>\n<ul>\n<li><a href="http://www.nytimes.com/content/help/front.html">FAQ</a></li>\n<li><a href="http://www.nytimes.com/content/help/contact/directory.html">Contact Us</a></li>\n</ul>\n</div>\n',showTypeSizer&&(__p+='\n<div class="menu type-sizer-menu">\n<h5 class="modal-heading">Type Size</h5>\n<ul>\n<li data-size="small" class="type-sizer-small"><a href="javascript:;">A <span class="visually-hidden">Type size small</span></a></li>\n<li data-size="medium" class="type-sizer-medium"><a href="javascript:;">A <span class="visually-hidden">Type size medium</span></a></li>\n<li data-size="large" class="type-sizer-large"><a href="javascript:;">A <span class="visually-hidden">Type size large</span></a></li>\n</ul>\n</div>\n'),__p+="";return __p},templates}),define("shared/masthead/views/user-settings-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/masthead/templates"],function(e,t,i,n,s){"use strict";var a=i.extend({events:{"click .edition-menu a":"handleEditionClick","click .type-sizer-menu li":"handleFontSizeClick","click .help-menu a":"handleHelpMenuClick"},nytEvents:{"nyt:fontsizer-initialize":"handleFontSizeChange","nyt:fontsizer-change":"handleFontSizeChange"},defaultSettings:{id:"user-settings-modal",binding:".user-settings-button",tailDirection:"up-right",tailTopOffset:-8,tailLeftOffset:-1,width:"260px",toggleSpeed:1,showTypeSizer:!0,openCallback:function(){this.$target.addClass("active"),this.subscribeOnce("nyt:page-scroll",this.close)},closeCallback:function(){this.$target.removeClass("active")}},webTrendsNav:"user-settings-modalContainer",initialize:function(e){var i=this.pageManager.getMeta("article:section")||"";this.settings=t.extend({},this.defaultSettings,e),this.settings.modalContent=s.userSettingsModal({showTypeSizer:this.settings.showTypeSizer}),this.trackingBaseData={action:"click",region:"TopBar","WT.nav":this.webTrendsNav,contentCollection:i}},handleDomReady:function(){this.render()},render:function(){var e=new n(this.settings);this.setElement(e.$modal),e.$modal.find("a[data-edition="+this.pageManager.getEdition()+"]").addClass("selected"),e.addToPage(),this.handleFontSizeChange()},handleEditionClick:function(e){this.broadcast("nyt:masthead-edition-change",e,{"WT.nav":this.webTrendsNav})},handleHelpMenuClick:function(t){var i=e(t.target),n=i.attr("href");n&&(n=this.trackingAppendParams(n,{}),i.attr("href",n))},handleFontSizeClick:function(t){var i=e(t.currentTarget).data("size");this.broadcast("nyt:fontsizer-change",i)},handleFontSizeChange:function(e){var t="type-size-selected";e=e||this.pageManager.getMeta("fontsizer_typeSize"),this.$el.find(".type-sizer-menu li").removeClass(t),this.$el.find(".type-sizer-"+e).addClass(t)}});return a}),define("shared/account/views/user-profile-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/account/templates"],function(e,t,i,n,s){"use strict";var a=i.extend({events:{"change #user-profile-avatar-input":"handleAvatarUpload","click .cancel-button":"handleCancelClick","click .save-button":"handleSaveClick","click .crop-button":"handleCropClick","submit #profile-form":"handleFormSubmit"},defaultSettings:{id:"user-profile-modal",addlClasses:"",headerContent:s.userProfileModalHeader(),modalTitle:"Edit Profile",modalContent:"",binding:".user-profile-button",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0,cropBoundaries:{x1:0,y1:0,x2:0,y2:0},tailLeftOffset:-40,tailTopOffset:-40,cropperWidth:80,cropperHeight:80},initialize:function(e){var i=this;this.settings=t.extend({},this.defaultSettings,e),this.settings.openCallback=function(){i.model||require(["shared/community/instances/community-user"],function(e){i.model=e,i.model.isNew()?i.model.on("change",i.render,i):i.render(),i.model.on("avatarFailed",i.render,i)}),this.subscribeOnce(i,"nyt:profile-modal-close",this.close)},this.settings.modalContent=this.renderModalContent()},renderModalContent:function(){return s.userProfileModalContent({user:this.model?this.model:null})},handleUserReady:function(){var e=new n(this.settings);this.setElement(e.$modal),e.addToPage(),this.modal=e},render:function(){this.modal&&this.model&&this.modal.updateTemplate(this.renderModalContent())},handleCancelClick:function(e){e.preventDefault(),this.local(this,"nyt:profile-modal-close")},handleSaveClick:function(e){e.preventDefault(),this.model&&(this.model.setName(this.$el.find("#user-profile-name").val()),this.model.setLocation(this.$el.find("#user-profile-location").val()),this.model.once("request",function(){this.local(this,"nyt:profile-modal-close")},this).save())},handleFormSubmit:function(e){e.preventDefault()},handleAvatarUpload:function(e){this.$(".user-profile-avatar-button").addClass("loading"),this.model&&e.target.files&&this.model.once("avatarUploaded",this.createCropper.bind(this)).addRawAvatar(e.target.files[0])},handleCropClick:function(t){var i=this;t.preventDefault(),e(t.target).addClass("disabled").attr("disabled","disabled"),this.model.once("avatarCropped",function(){i.render()}).cropRawAvatar(this.settings.cropBoundaries)},getCropBoundingBox:function(e,t){var i=Math.abs(parseInt(e.css("left"),10)),n=Math.abs(parseInt(e.css("top"),10)),s={};return s.x1=Math.ceil(i*t),s.y1=Math.ceil(n*t),s.x2=Math.ceil((i+this.settings.cropperWidth)*t),s.y2=Math.ceil((n+this.settings.cropperHeight)*t),s},createCropper:function(t){var i,n=this.$(".avatar-crop"),s=this;return e.fn.draggable?(this.$("#user-profile-form").addClass("avatar-editing"),void(i=e('<img src="'+t+'"/>').on("load",function(){var t,a=this.width>this.height?"avatar-horizontal":"avatar-vertical",o=this.width>this.height?"x":"y",r=this.naturalHeight/n.height();i.removeClass("avatar-horizontal avatar-vertical").addClass(a).css({left:"0px",top:"0px"}),n.empty().append(i),s.settings.cropBoundaries=s.getCropBoundingBox(i,r),t=e('<div class="avatar-crop-container"></div>').prependTo(n).css({height:s.settings.cropperHeight+2*(this.height-s.settings.cropperHeight)+"px",width:s.settings.cropperWidth+2*(this.width-s.settings.cropperWidth)+"px",top:-1*(this.height-s.settings.cropperHeight)+"px",left:-1*(this.width-s.settings.cropperWidth)+"px"}),i.draggable({axis:o,containment:t,stop:function(){s.settings.cropBoundaries=s.getCropBoundingBox(i,r)},cursor:"move"})}))):void require(["foundation/lib/jquery/jquery.draggable/1.11.4"],function(){this.createCropper(t)}.bind(this))}});return a}),define("shared/masthead/views/user-name-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/masthead/templates","foundation/models/user-data","foundation/hosts","shared/account/views/user-profile-modal"],function(e,t,i,n,s,a,o,r){"use strict";var l=i.extend({events:{"click .premier-subscriber a":"handleUserSubscriptionClick","click li a":"handleUserOptionClick"},defaultSettings:{id:"user-name-modal",modalTitle:"",modalContent:"",binding:".user-name-button",tailDirection:"up-right",tailTopOffset:-8,tailLeftOffset:-1,width:"260px",toggleSpeed:1,openCallback:function(){this.$target.addClass("active"),this.listenToOnce(this.pageManager,"nyt:page-scroll",this.close)},closeCallback:function(){this.$target.removeClass("active")}},initialize:function(e){t.bindAll(this,"handleLogOut"),this.settings=t.extend({},this.defaultSettings,e),this.trackingBaseData={module:"ProfileDropdown",action:"click",region:"Masthead","WT.nav":"shell"}},handleUserReady:function(){var e,t=this.getSubscriptionLabel(a);this.settings.modalTitle=s.userNameModalTitle({userData:a,subscription:t}),this.settings.modalContent=s.userNameModalContent({userData:a,hosts:o}),new r,this.render(),e=this.$el.find(".user-subscription"),""===t.label&&e.remove(),""!==t.className&&e.addClass(t.className),""!==t.link&&e.find("a").attr("href",t.link),this.listenToOnce(a,"nyt:user-image-loaded",this.handleProfileImage),this.$el.on("click",".log-out-button",this.handleLogOut)},getSubscriptionLabel:function(e){var t={label:"",className:"",link:""};return e.isPremierSubscriber()?(t.label="Times Insider Subscriber",t.className="premier-subscriber",t.link="http://www.nytimes.com/section/insider"):e.isWebSubscriber()&&e.isMobileSubscriber()?t.label="All Digital Access Subscriber":e.isTabletSubscriber()&&e.isWebSubscriber()?t.label="Tablet and Web Subscriber":e.isSmartphoneSubscriber()&&e.isWebSubscriber()?t.label="Smartphone and Web Subscriber":e.isWebSubscriber()?t.label="Web Subscriber":e.isOpinionSubscriber()&&e.isCookingSubscriber()?t.label="NYT Opinion & Cooking Subscriber":e.isCookingSubscriber()?t.label="Cooking Subscriber":e.isOpinionSubscriber()?(t.label="NYT Opinion Subscriber",t.link="http://www.nytimes.com/content/help/mobile/nyt-opinion/nyt-opinion.html"):e.isCrosswordsSubscriber()&&(t.label="Crosswords Subscriber"),t},render:function(){var e=new n(this.settings);this.setElement(e.$modal),e.addToPage()},handleProfileImage:function(){var e=s.profileIcon({userData:a});this.$el.find(".modal-heading").prepend(e)},handleUserSubscriptionClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{contentCollection:"TimesPremier-InsideStory"});i.attr("href",n)},handleUserOptionClick:function(t){var i=e(t.target),n=i.text(),s=i.attr("href"),a={action:"Click",region:"TopBar","WT.nav":"shell"};s&&(n&&(a.module=n.replace(/\s/g,"")),s=this.trackingAppendParams(s,a),i.attr("href",s))},handleLogOut:function(){var e="http:"+o.www+"/logout";e=this.trackingAppendParams(e,{module:"LogOut",action:"Click",region:"TopBar","WT.nav":"shell"}),this.trackingTrigger("tagx-auth-interaction",{module:"LogOut",state:a.isLoggedIn()?"logged in":"logged out",eventName:"logout click | LogOut"}),window.location=e}});return l}),define("homepage/views/masthead/masthead",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/hosts","foundation/models/user-data","shared/masthead/templates"],function(e,t,i,n,s,a){"use strict";var o=i.registerView("masthead").extend({el:"#masthead",events:{"click .search-button":"handleSearchClick","click .sections-button":"handleSectionsClick","click .editions-menu a":"handleEditionClick","click .login-button":"handleLogInClick","click .masthead-menu a":"handleMenuClick","click .subscribe-button":"handleSubscribeClick"},nytEvents:{"nyt:messaging-critical-alerts-move-furniture":"handlePageAlerts","nyt:messaging-suggestions-move-furniture":"handlePageAlerts","nyt:masthead-search-toggle":"handleSearchToggle","nyt:masthead-edition-change":"handleEditionClick","nyt:messaging-notification-count-update":"handleMessagingCountChange"},trackingRegion:"TopBar",handleDomReady:function(){var e=this.$el.find(".user-tools-button-group"),t=this;s.ready(function(){s.isLoggedIn()?e.prepend(a.userName(s)):(t.pageManager.hasAdBlock().done(function(){e.find(".subscribe-button").removeClass("hidden")}),e.find(".login-button").removeClass("hidden"))})},handlePageAlerts:function(t){t(this.$el),t(e("#announcements-container")),t(e("#masthead-placeholder"))},handleSearchToggle:function(e){this.$el.find(".search-button")[e?"addClass":"removeClass"]("active")},handleMenuClick:function(t){var i=e(t.currentTarget),n=i.data("collection"),s={action:"Click",module:"HPMiniNav",region:this.trackingRegion,"WT.nav":"page"};switch(n){case"todays-paper":s.contentCollection="TodaysPaper";break;case"weather":s.contentCollection="Weather";break;case"video":s.contentCollection="Video"}i.attr("href",this.trackingAppendParams(i.attr("href"),s))},handleEditionClick:function(i,n){var s=e(i.target),a=s.attr("href"),o=s.data("edition"),r={action:"Click",region:this.trackingRegion};switch(this.pageManager.setEdition(o),o){case"us":r.module="EditionToggleToUS";
break;case"global":r.module="EditionToggleToGlobal";break;case"chinese":r.module="EditionToggleToCHNS";break;case"spanish":r.module="EditionToggleToSpanish"}a&&(r=t.extend(r,n),a=this.trackingAppendParams(s.attr("href"),r),s.attr("href",a))},handleSectionsClick:function(e){this.broadcast("nyt:masthead-section-click",e)},handleSearchClick:function(e){this.broadcast("nyt:masthead-search-click",e),this.trackingTrigger("masthead-search-click",{action:"Click",module:"SearchOpen",eventName:"OpenSearchBar",region:this.trackingRegion})},handleLogInClick:function(){var e="masthead-login";this.trackingTrigger("masthead-login-click",{action:"Click",module:"LogIn","WT.nav":"shell",region:this.trackingRegion}),this.trackingTrigger("tagx-auth-interaction",{module:e,state:s.isLoggedIn()?"logged in":"logged out",eventName:"login click | "+e})},handleSubscribeClick:function(t){var i,n;i=e(t.currentTarget).closest(".subscribe-button"),n=this.trackingAppendParams(i.data("href"),{module:"Subscribe-Now"}),window.location=n},handleMessagingCountChange:function(e){var t=this.$el.find(".notifications-button"),i=e.count>99?"99+":e.count;t.find(".button-text").html(i),e.delta>0?(t.addClass("has-notifications animate-notifications"),setTimeout(function(){t.removeClass("animate-notifications")},2e3)):0===e.count&&t.removeClass("has-notifications")}});return o}),define("homepage/views/masthead/in-content-theme",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({el:"#masthead",events:{"click .user-name-button, .user-settings-button":"handleUserButtonClick"},nytEvents:{"nyt:page-scroll":"handlePageScrolled","nyt:ad-library:dfp:ear-ad-visible":"handleEarAdVisible","nyt:in-content-theme-deactivate-pinned-masthead":"deactivatePinnedMasthead","nyt:masthead-update-offset":"handleMastheadUpdateOffset"},defaultSettings:{themeClass:"theme-in-content",pinnedClass:"theme-pinned-masthead",themeEventName:"nyt:masthead-contenttheme",pinnedMastheadEventName:"nyt:pinned-masthead",viewabilityTimerMs:3e3,backupTimerMs:1e4,closabilityThreshold:10},mastheadOffset:null,countEarAds:0,initialize:function(e){var i=this,n=this.$el.find("#masthead-cap");t.bindAll(this,"determineCloseAbility"),this.settings=t.extend({},this.defaultSettings,e),this.mastheadCapHidden=!1,this.mastheadOffset=this.$el.height(),this.pinnedMasthead=!0,this.closePinnedMastheadFlag=!1,this.mastheadCapOffset=n.offset().top+n.height(),this.backupTimeout=setTimeout(function(){i.closePinnedMastheadFlag=!0},this.settings.backupTimerMs)},handleDomReady:function(){this.toggleTheme()},handlePageScrolled:function(){this.toggleTheme(),this.checkMastheadCapHidden()},handleMastheadUpdateOffset:function(){this.mastheadOffset=this.$el.offset().top+this.$el.height()},deactivatePinnedMasthead:function(){var t=this;this.$el.hasClass(this.settings.themeClass)&&!e("#account-alerts").is(":visible")?this.$el.animate({top:-172},400,function(){t.$el.removeClass(t.settings.pinnedClass),t.$el.removeAttr("style"),t.pinnedMasthead=!1,t.toggleTheme(),t.broadcast(t.settings.pinnedMastheadEventName,!1)}):(t.$el.removeClass(t.settings.pinnedClass),t.pinnedMasthead=!1,t.toggleTheme(),t.broadcast(t.settings.pinnedMastheadEventName,!1))},toggleTheme:function(){var e,t=this.pageManager.getViewport().top,i=this.$el.hasClass(this.settings.themeClass);e=t>this.mastheadOffset,e&&!i?(this.addTheme(),this.broadcast(this.settings.themeEventName,!0),this.pinnedMasthead===!0&&this.broadcast(this.settings.pinnedMastheadEventName,!0)):!e&&i&&(this.removeTheme(),this.broadcast(this.settings.themeEventName,!1)),this.closePinnedMastheadFlag===!0&&this.pinnedMasthead===!0&&(this.pinnedMasthead=!1,this.deactivatePinnedMasthead())},addTheme:function(){this.signalSearchCloseReady(),this.$el.addClass(this.settings.themeClass)},removeTheme:function(){this.signalSearchCloseReady(),this.$el.removeClass(this.settings.themeClass)},signalSearchCloseReady:function(){this.broadcast("nyt:search-close-ready")},handleUserButtonClick:function(){this.$html.hasClass("search-active")&&!this.$el.hasClass(this.settings.themeClass)&&(window.scrollTo(0,0),this.signalSearchCloseReady())},determineCloseAbility:function(e,i){var n=i-this.$body.scrollTop();Math.abs(n)<=this.settings.closabilityThreshold||this.$html.hasClass("search-active")?e.subscribeOnce("nyt:page-scroll",t.partial(this.determineCloseAbility,e,i)):e.close()},checkMastheadCapHidden:function(){var e=this.$body.scrollTop()-this.settings.closabilityThreshold;e>=this.mastheadCapOffset&&!this.mastheadCapHidden?(this.mastheadCapHidden=!0,this.broadcast("nyt:masthead-hidden")):e<this.mastheadCapOffset&&this.mastheadCapHidden&&(this.mastheadCapHidden=!1)},handleEarAdVisible:function(){var e=this;this.countEarAds+=1,2===this.countEarAds&&(clearTimeout(this.backupTimeout),setTimeout(function(){e.closePinnedMastheadFlag=!0},this.settings.viewabilityTimerMs))}});return n}),define("homepage/templates",["underscore/nyt"],function(_){var templates={};return templates.embeddedSlideshowHP=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="content-container">\n<div class="image"></div>\n<nav class="arrow-navigation">\n<span class="counter"></span>\n',isMobile===!1&&(__p+='\n<button class="arrow-navigation-previous" >\n<span class="visually-hidden">Go to previous slide</span>\n<div class="arrow arrow-left">\n<div class="arrow-conceal"></div>\n</div>\n</button>\n<button class="arrow-navigation-next">\n<span class="visually-hidden">Go to next slide</span>\n<div class="arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n</button>\n'),__p+='\n</nav><figcaption class="caption" itemprop="description"></figcaption>\n</div>';return __p},templates.image=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<nav class="image-navigation previous">\n<span class="visually-hidden">Go to previous slide</span>\n</nav>\n<nav class="image-navigation next">\n<span class="visually-hidden">Go to next slide</span>\n</nav>\n<img src="'+(null==(__t=src)?"":__t)+'" data-caption="" style="display:none;" />';return __p},templates.imageInfo=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<span class="caption-control" style="display:none;">\n<span class="caption-text">\n'+(null==(__t=caption)?"":__t)+'\n</span>\n<span class="credit" itemprop="copyrightHolder">\n<span class="visually-hidden">Credit</span>\n'+(null==(__t=credit)?"":__t)+"\n</span>\n</span>";return __p},templates.marketsModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<section class="market-indexes">\n<h2 class="section-heading visually-hidden">Markets Indexes</h2>\n<div class="column">\n<table class="markets-table">\n<tr class="visually-hidden">\n<th scope="col">Label</th>\n<th scope="col">Last</th>\n<th scope="col">Change</th>\n<th scope="col">Percentage Change</th>\n</tr>\n',_.each(market.get("Items"),function(e,t){__p+='\n<tr class="'+(null==(__t=0===t?"active":"")?"":__t)+'" data-image-coords="'+(null==(__t=e.getSpriteCoordinate())?"":__t)+'" data-last-updated="'+(null==(__t=e.getIndexStatus())?"":__t)+" "+(null==(__t=e.getLastUpdated()>0?prettyDate(e.getLastUpdated()).toLowerCase():"")?"":__t)+'" data-index="'+(null==(__t=e.getLabel())?"":__t)+'">\n<th scope="row">'+(null==(__t=e.getLabel())?"":__t)+'</th>\n<td class="market-value">'+(null==(__t=e.getLast())?"":__t)+'</td>\n<td class="market-changed is-'+(null==(__t=e.getChangedText())?"":__t)+'">'+(null==(__t=e.getFormattedPrice())?"":__t)+'</td>\n<td class="market-changed-percentage is-'+(null==(__t=e.getChangedText())?"":__t)+'">'+(null==(__t=e.getFormattedPercentage())?"":__t)+"%</td>\n</tr>\n"}),__p+='\n</table>\n</div>\n<div class="column">\n<div id="markets-graph" class="markets-graph">\n<p>'+(null==(__t=market.get("Items")[0].getLabel())?"":__t)+'</p>\n<i class="icon markets-graph-icon" style="background: url('+(null==(__t=market.get("ChartUrl"))?"":__t)+") no-repeat "+(null==(__t=market.get("Items")[0].getSpriteCoordinate())?"":__t)+'px 0;"></i>\n</div>\n</div>\n</section><section class="markets-quotes">\n<div class="column">\n<h2 class="section-heading">Get Quotes</h2>\n<form class="markets-search-form" role="search" method="get" action="http://query.nytimes.com/gst/getquotes.html">\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="markets-search-input">Stock, ETFs, Funds</label>\n</div>\n<div class="field-container">\n<input id="markets-search-input" name="symb" type="text" class="markets-search-input text" autocomplete="off" placeholder="Stock, ETFs, Funds" />\n<button id="markets-submit" class="button submit-button" type="submit">Go</button>\n</div>\n</div><!-- close control -->\n</form>\n<p class="user-action">\n<a href="http://markets.on.nytimes.com/research/portfolio/view/view.asp">My Portfolio &raquo;</a>\n</p>\n</div>\n<div class="column">\n<div id="Middle4" class="ad middle4-ad"></div>\n</div>\n</section>';return __p},templates.marketsModalHeader=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<a href="http://markets.on.nytimes.com/research/markets/overview/overview.asp">Markets &raquo;</a>';return __p},templates.marketsModalHeaderContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<p id="markets-last-update" class="markets-last-update">'+(null==(__t=date)?"":__t)+"</p>";return __p},templates.marketsTicker=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button data-collection="markets" class="button markets-button is-'+(null==(__t=getChangedText())?"":__t)+'">'+(null==(__t=getLabel())?"":__t)+" <span>"+(null==(__t=getFormattedPercentage())?"":__t)+'%</span><i class="icon sprite-icon ticker-icon"></i></button>';return __p},templates.miniNavigationPlaceholder=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="mini-navigation-placeholder"></div>';return __p},templates.playlistItem=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li>\n<article class="story">\n<div class="wide-thumb">\n<img src="'+(null==(__t=thumbnailSrc)?"":__t)+'"></img>\n<div class="media-action-overlay">\n<div class="icon-container"><i class="icon"></i></div>\n<p class="media-meta">Now Playing</p>\n</div>\n</div>\n<h3 class="kicker">\n<span class="kicker-label">'+(null==(__t=kicker)?"":__t)+'</span>\n<span class="duration">'+(null==(__t=duration)?"":__t)+'</span>\n</h3>\n<h2 class="headline">'+(null==(__t=headline)?"":__t)+"</h2>\n</article>\n</li>";return __p},templates.videoMetadata=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<p class="byline">'+(null==(__t=byline)?"":__t)+'</p><a class="user-action watch-link" href="'+(null==(__t=permalink)?"":__t)+'">Watch in Times Video &raquo;</a>';return __p},templates.videoPoster=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="media-meta-container">\n<div class="icon-container">\n<i class="icon"></i>\n</div>\n<div class="media-meta">\n<h3 class="kicker">\n<span class="duration">'+(null==(__t=duration)?"":__t)+'</span>\n</h3>\n<h2 class="headline">'+(null==(__t=headline)?"":__t)+'</h2>\n<p class="summary">'+(null==(__t=summary)?"":__t)+"</p>\n</div>\n</div>";return __p},templates.weather=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<i class="icon sprite-icon weather-icon '+(null==(__t="icon-weather-"+currentWeather.getIcon())?"":__t)+' w24"></i>'+(null==(__t=currentWeather.getTemp())?"":__t)+"&deg;"+(null==(__t=currentWeather.getTempUnit())?"":__t);return __p},templates.weatherModalAutoSuggest=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",collection.each(function(e){__p+='\n<li data-location-identifier="'+(null==(__t=e.getLocation())?"":__t)+'">'+(null==(__t=e.getCity())?"":__t)+", "+(null==(__t="United States"===e.getCountry()?e.getState():"")?"":__t)+(null==(__t="United States"===e.getCountry()?"":e.getCountry())?"":__t)+'<span class="auto-suggest-zipcode">, '+(null==(__t=e.getZipCode())?"":__t)+" </span></li>\n"}),__p+="";return __p},templates.weatherModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="section today">\n<h5 class="section-heading">Today</h5>\n<i class="icon sprite-icon weather-icon '+(null==(__t="icon-weather-"+currentWeather.getIcon())?"":__t)+' w50"></i>\n<div class="weather-detail">\n<h4 class="weather-heading">\n<span>'+(null==(__t=currentWeather.getTemp())?"":__t)+"&deg;"+(null==(__t=currentWeather.getTempUnit())?"":__t)+'</span>\n<span class="phrase">'+(null==(__t=currentWeather.getDescription())?"":__t)+'</span>\n</h4>\n<span class="temperature high-temperature"><span class="visually-hidden">High Temperature</span>'+(null==(__t=currentWeather.getHighTemp())?"":__t)+'&deg;</span>\n<span class="temperature low-temperature"><span class="visually-hidden">Low Temperature</span>'+(null==(__t=currentWeather.getLowTemp())?"":__t)+'&deg;</span>\n<p class="summary">'+(null==(__t=currentWeather.getPhrase())?"":__t)+'</p>\n</div>\n<div id="HPWeather" class="ad hp-weather-ad"></div>\n</div><!-- close section -->\n<div class="section this-week">\n<h5 class="section-heading">This week</h5>\n<ul>\n',_.each(weatherCollection.getFiveDayForecast(),function(e){__p+='\n<li>\n<i class="icon sprite-icon weather-icon '+(null==(__t="icon-weather-"+e.getIcon())?"":__t)+' w50">\n<span class="visually-hidden">'+(null==(__t=e.getDescription())?"":__t)+'</span>\n</i>\n<span class="day">'+(null==(__t=e.getDisplayDay())?"":__t)+'</span>\n<span class="temperature high-temperature"><span class="visually-hidden">High Temperature</span>'+(null==(__t=e.getHighTemp())?"":__t)+'&deg;</span>\n<span class="temperature low-temperature"><span class="visually-hidden">Low Temperature</span>'+(null==(__t=e.getLowTemp())?"":__t)+"&deg;</span>\n</li>\n"}),__p+='\n</ul>\n</div><!-- close section -->\n<div class="section location hidden">\n<div class="control location-control">\n<div class="label-container visually-hidden">\n<label for="location-text">City, State or ZIP Code</label>\n</div>\n<div class="field-container">\n<input id="location-text" type="text" class="text location-text" placeholder="City, State or ZIP Code" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-location-text"><i class="icon"></i><span id="clear-location-text" class="visually-hidden">Clear this text input</span></button>\n</div>\n<div id="error-container" class="error-container hidden">\n<p class="error">We could not find the weather for <strong>Evatown</strong>. Try entering a ZIP code.</p>\n</div>\n<div id="auto-suggest" class="auto-suggest">\n<ol class="auto-suggest-menu"></ol>\n</div>\n<div id="current-location-container" class="current-location-container auto-suggest-has-items">\n<p class="current-location"><span id="current-location-text" class="current-location-text">'+(null==(__t=currentWeather.getDisplayLocation())?"":__t)+'</span><span class="current-location-label">Current Location</span></p>\n</div>\n</div><!-- close control -->\n</div><!-- close section -->';return __p},templates.weatherModalFooter=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<p id="cancel-location-edit" class="user-action cancel-location-edit">Cancel</p>';return __p},templates.weatherModalHeader=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",__p+=weatherFeatureFlag?'\n<p class="user-action"><a id="edit-location" class="edit-location" href="javascript:;">Edit Your Location</a></p>\n':'\n<p class="user-action"><a href="'+(null==(__t=editWeatherUrl)?"":__t)+'">Edit Your Location</a></p>\n',__p+="";return __p},templates}),define("shared/data/models/weather",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/models/base-model","foundation/models/page-storage"],function(e,t,i,n,s){"use strict";var a=n.extend({defaults:{city:"",state:"",country:"",temp:"",high:"",low:"",temp_unit:"",image:"",icon:"",phrase:"",description:""},dayAbbreviations:{Monday:"MON",Tuesday:"TUES",Wednesday:"WED",Thursday:"THURS",Friday:"FRI",Saturday:"SAT",Sunday:"SUN"},getCity:function(){return this.get("city")},getState:function(){return this.get("state")},getCountry:function(){return this.get("country")},getDisplayLocation:function(){var e=this.getCity(),t=this.getState(),i=this.getCountry(),n=s.get("nyt:weather-locationName");return n?n:"United States"===i?e+", "+t:e+", "+i},getTemp:function(){return this.get("temp")},getHighTemp:function(){return this.get("high")},getLowTemp:function(){return this.get("low")},getTempUnit:function(){return this.get("temp_unit")},getDay:function(){return this.get("day")},getDisplayDay:function(){return this.dayAbbreviations[this.getDay()]},getIconURL:function(){return this.get("image")},getIcon:function(){return this.get("icon")},getPhrase:function(){return this.get("phrase")},getDescription:function(){var e=this.getIcon();return this.get("description")||this.getWeatherDescriptionFromIcon(e)},getWeatherDescriptionFromIcon:function(e){var t={"01":"Sunny","02":"Mostly Sunny","03":"Partly Sunny","04":"Partly Cloudy","05":"Hazy","06":"Mostly Cloudy","07":"Cloudy","08":"Overcast",11:"Foggy",12:"Showers",13:"Scattered Showers",14:"Isolated Showers",15:"Thunderstorms",16:"Scattered Thunderstorms",17:"Isolated Thunderstorms",18:"Rain",19:"Flurries",20:"Scattered Flurries",21:"Isolated Flurries",22:"Snow",23:"Scattered Snow",24:"Ice",25:"Sleet",26:"Freezing Rain",29:"Mixed Rain and Snow",30:"Hot",31:"Cold",32:"Windy",33:"Clear",34:"Mostly Clear",35:"Partly Cloudy",36:"Partly Cloudy",37:"Hazy",38:"Mostly Cloudy",39:"Isolated Showers",40:"Scattered Showers",41:"Isolated Thunderstorms",42:"Scattered Thunderstorms",43:"Scattered Flurries",44:"Scattered Snow"};return t[e]||""}});return a}),define("shared/data/collections/weather",["backbone/nyt","foundation/collections/base-collection","underscore/nyt","shared/data/helpers/collection-mixin","foundation/hosts","shared/data/models/weather","foundation/cookies","foundation/models/page-storage"],function(e,t,i,n,s,a,o,r){"use strict";var l=t.extend(i.extend({},n,{model:a,initialize:function(){r.isReady()?this.fetch():this.subscribeOnce("nyt:storage-ready",this.fetch)},sync:function(t,i,n){var a=r.get("nyt:weather-locationId")||"";return a&&(a="/"+a),n.url=s.weatherApiHost+"/svc/weather/v2/current-and-seven-day-forecast"+a+".json",n.cache=!0,e.sync(t,i,n)},parse:function(e){var t,i,n,s=["description","temp","temp_unit","icon"];if(e&&e.results){t=e.results.seven_day_forecast,i=e.results.current[0];for(n in s)s.hasOwnProperty(n)&&(t[0][s[n]]=i[s[n]]);return t}return[]},getFourDayForecast:function(){return this.models.slice(1,5)},getFiveDayForecast:function(){return this.models.slice(1,6)},getCurrentWeather:function(){return this.models[0]}}));return l}),define("shared/data/instances/weather-collection",["shared/data/collections/weather"],function(e){"use strict";return new e}),define("homepage/views/helpers/masthead-modals",["jquery/nyt","underscore/nyt"],function(e,t){"use strict";var i={autoCloseDuration:1e3,initialize:function(){t.bindAll(this,"handleModalOpen","handleModalClose"),this.render()},handleModalOpen:function(){var e;this.broadcast(this.eventPrefix+"open"),this.broadcast("nyt:ads-new-placement",this.adPosition),e=this.eventPrefix.split("-")[1]+"Rendered",this.broadcast("nyt:ad-library:dfp:"+e)},handleModalClose:function(){this.broadcast(this.eventPrefix+"close")},handleOpen:function(){this.isModalAppened!==!0&&(this.modal.addToPage(),this.isModalAppened=!0,this.setElement(this.modal.$modal)),this.modal.open()},handleClose:function(){this.modal.close()},disableAutoClose:function(){window.clearTimeout(this.autoCloseTimer),delete this.autoCloseTimer},enableAutoClose:function(){this.disableAutoClose(),this.autoCloseTimer=window.setTimeout(this.modal.close,this.autoCloseDuration)},handleMouseOver:function(){this.broadcast(this.eventPrefix+"mouseover"),this.disableAutoClose()},handleMouseOut:function(){this.enableAutoClose()}};return i}),define("homepage/models/weather-location",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/models/base-model"],function(e,t,i,n){"use strict";var s=n.extend({defaults:{location:"",zipcode:"",city:"",state:"",country:""},getLocation:function(){return this.get("location")},getZipCode:function(){return this.get("zipcode")},getCity:function(){return this.get("city")},getState:function(){return this.get("state")},getCountry:function(){return this.get("country")}});return s}),define("homepage/collections/weather-location",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","homepage/models/weather-location","foundation/hosts"],function(e,t,i,n,s){"use strict";var a=i.extend({model:n,sync:function(i,n,a){return t.isNaN(parseInt(this.getQuery(),10))?a.url="http://www.nytimes.com/svc/suggest/v1/weather_cities?query="+this.getQuery():a.url=s.DUHost+"/svc/weather/v2/location/"+this.getQuery()+".json",a.cache=!0,e.sync(i,n,a)},parse:function(e){var t=e.results||e[1];return t.length>=5?t.slice(0,5):t},getQuery:function(){return window.encodeURIComponent(this.query)},setQuery:function(e){this.query=e.replace(/,/g,""),this.fetch()}});return a}),define("homepage/views/masthead/weather-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","homepage/templates","foundation/hosts","shared/data/instances/weather-collection","homepage/views/helpers/masthead-modals","homepage/collections/weather-location","foundation/cookies","foundation/models/page-storage"],function(e,t,i,n,s,a,o,r,l,d,c){"use strict";var h=i.extend(r).extend({modalSettings:{id:"weather-modal",binding:"#weather .weather-button",tailDirection:"up",tailTopOffset:-4},events:{mouseenter:"handleMouseOver","click #edit-location":"handleEditLocationClick","click #cancel-location-edit":"handleCancelLocationEditClick","click .clear-button":"handleClearButtonClick","click .auto-suggest-menu li":"handleAutoSuggestClick","keyup .location-text":"handleKeyUp","mouseenter .auto-suggest-menu li":"handleAutoSuggestMouseEnter","mouseleave .auto-suggest-menu li":"handleAutoSuggestMouseLeave"},locationCollection:new l,eventPrefix:"nyt:homepage-weatherModal-",adPosition:"HPWeather",handleDomReady:function(){t.bindAll(this,"handleKeyUp"),this.listenTo(this.locationCollection,"sync",this.handleLocationSync)},render:function(){var e=o.getCurrentWeather(),i=t.extend({},this.modalSettings);i.modalTitle=e.getDisplayLocation(),i.headerContent=s.weatherModalHeader({weatherFeatureFlag:this.pageManager.flag("weatherLocation"),editWeatherUrl:a.www+"/gst/weather.html?saction=updatePrimary"}),i.modalContent=s.weatherModalContent({weatherCollection:o,currentWeather:e,mainWeatherPageUrl:a.www+"/weather"}),i.modalFooter=s.weatherModalFooter(),i.openCallback=this.handleModalOpen,i.closeCallback=this.handleModalClose,this.modal=new n(i),this.modal.$modal.find(".modal-header").addClass("weather-modal-header"),this.modal.$modal.find(".modal-footer").addClass("weather-modal-footer hidden"),this.subscribe("nyt:homepage-weatherPreview-on",this.handleOpen),this.subscribe("nyt:homepage-weatherPreview-off",this.handleClose),this.subscribe("nyt:homepage-marketsModal-open",this.handleClose)},handleEditLocationClick:function(){this.$list=this.$el.find(".auto-suggest-menu"),this.modal.$modal.addClass("weather-modal-location-edit"),e(".weather-modal-header").addClass("hidden"),e(".section.today").addClass("hidden"),e(".section.this-week").addClass("hidden"),e(".section.location").removeClass("hidden"),e(".weather-modal-footer").removeClass("hidden"),e(".location-text").val("").focus()},handleCancelLocationEditClick:function(){this.toggleForecast()},toggleForecast:function(){this.modal.$modal.removeClass("weather-modal-location-edit"),e(".weather-modal-header").removeClass("hidden"),e(".section.today").removeClass("hidden"),e(".section.this-week").removeClass("hidden"),e(".section.location").addClass("hidden"),e(".weather-modal-footer").addClass("hidden")},toggleAutoSuggestions:function(){this.$el.find("#auto-suggest ol").empty()},handleKeyUp:function(e){var t=this.pageManager.KEYS,i=e.which;i===t.ENTER?this.selectLocationByEnterKey():i===t.UP||i===t.DOWN?this.navigateAutoSuggestions(i):i!==t.LEFT&&i!==t.RIGHT&&this.autoSuggestResults()},navigateAutoSuggestions:function(e){var t,i,n=this.pageManager.KEYS;i=this.$list.find(".active"),t=i.index()||0,t+=e===n.UP?-1:1,this.$list.find("li").removeClass("active").eq(t).addClass("active")},selectLocationByEnterKey:function(){var e=this.$list.find(".active").data("location-identifier"),t=this.$list.find(".active").text();e&&this.changeLocation(e,t)},autoSuggestResults:t.debounce(function(){var e=this.$el.find("#location-text"),t=/^\d/.test(e.val());return e.parent().find(".clear-button").toggle(""!==e.val()),t&&e.val().length<5?void 0:(this.$el.find("#auto-suggest ol").toggleClass("query-type-zipcode",t&&5===e.val().length),0===e.val().length?void this.toggleAutoSuggestions():void this.locationCollection.setQuery(e.val()))},400),handleClearButtonClick:function(t){var i=e(t.currentTarget),n=i.parent().find("input");i.toggle(!1),n.val("")},handleLocationSync:function(){var e=s.weatherModalAutoSuggest({collection:this.locationCollection});this.modal.$modal.find("#auto-suggest ol").html(e)},handleWeatherSync:function(){var e,t=o.getCurrentWeather();this.broadcast("nyt:homepage-weatherModal-update"),e=s.weatherModalContent({weatherCollection:o,currentWeather:t,mainWeatherPageUrl:a.www+"/weather"}),this.modal.updateTemplate(e),this.modal.updateModalTitle(t.getDisplayLocation()),this.toggleForecast(),this.modal.$modal.focus()},changeLocation:function(e,t){var i=t.trim().replace(/,\s?(\d+)?$/,"");c.set("nyt:weather-locationId",e),c.set("nyt:weather-locationName",i),this.listenToOnce(o,"sync",this.handleWeatherSync),o.fetch()},handleAutoSuggestClick:function(t){var i=e(t.target),n=i.data("location-identifier"),s=i.text();this.changeLocation(n,s)},handleAutoSuggestMouseEnter:function(t){var i=e(t.target);i.addClass("active")},handleAutoSuggestMouseLeave:function(){this.$el.find("#auto-suggest li.active").removeClass("active")}});return h}),define("homepage/views/helpers/masthead-hover-intent",["jquery/nyt","underscore/nyt"],function(e,t){"use strict";var i={events:{mouseenter:"handleButtonOver",mouseleave:"handleButtonOut"},hoverThreshold:300,mouseOutClose:1e3,initialize:function(){this.bindAllList.unshift(this),t.bindAll.apply(void 0,this.bindAllList),this.collection.length>0?this.render():this.subscribeOnce(this.collection,"sync",this.render)},enableModalCloseTimer:function(){this.modalCloseTimer=window.setTimeout(this.closeModal,this.mouseOutClose)},disableModalCloseTimer:function(){window.clearTimeout(this.modalCloseTimer),delete this.modalCloseTimer},enableModalOpenTimer:function(){this.modalOpenTimer=window.setTimeout(this.openModal,this.hoverThreshold)},disableModalOpenTimer:function(){window.clearTimeout(this.modalOpenTimer),delete this.modalOpenTimer},closeModal:function(){this.broadcast(this.eventPrefix+"off")},openModal:function(){this.broadcast(this.eventPrefix+"on")},handleModalMouseover:function(){this.disableModalCloseTimer()},handleButtonOver:function(){this.enableModalOpenTimer(),this.disableModalCloseTimer()},handleButtonOut:function(){this.disableModalOpenTimer(),this.enableModalCloseTimer()},handleModalOpen:function(){this.$el.find(".button").addClass("active")},handleModalClose:function(){this.$el.find(".button").removeClass("active")}};return i}),define("homepage/views/masthead/weather-preview",["jquery/nyt","underscore/nyt","foundation/views/base-view","homepage/templates","shared/data/instances/weather-collection","foundation/hosts","homepage/views/masthead/weather-modal","homepage/views/helpers/masthead-hover-intent"],function(e,t,i,n,s,a,o,r){"use strict";var l=i.extend(r).extend({el:"#weather .weather-button",nytEvents:{"nyt:homepage-weatherModal-mouseover":"handleModalMouseover","nyt:homepage-weatherModal-open":"handleModalOpen","nyt:homepage-weatherModal-close":"handleModalClose","nyt:homepage-weatherModal-update":"handleWeatherUpdate"},collection:s,eventPrefix:"nyt:homepage-weatherPreview-",bindAllList:["openModal","closeModal"],render:function(){this.updatePreview(),new o},handleWeatherUpdate:function(){this.updatePreview()},updatePreview:function(){var e=this.collection.getCurrentWeather(),t=n.weather({currentWeather:e});this.$el.html(t).parent().removeClass("hidden")}});return l}),define("shared/data/models/markets",["underscore/nyt","foundation/models/base-model"],function(e,t){"use strict";var i=t.extend({getPercentage:function(){var e=(Math.round(100*this.get("PercentChange"))/100).toFixed(2);return e},getFormattedPercentage:function(){var e=this.getPercentage();return e>0?"+"+e:e},getPriceChange:function(){return(Math.round(100*this.get("PriceChange"))/100).toFixed(2)},getFormattedPrice:function(){var e=this.getPriceChange();return e>0?"+"+e:e},getLast:function(){return(Math.round(100*this.get("Last"))/100).toFixed(2)},getLabel:function(){return this.get("Label")},getChangedText:function(){var e=this.get("PriceChange");return 0>e?"negative":e>0?"positive":"unchanged"},getIndexStatus:function(){return"True"===this.get("IsOpen")?"Updated ":"Closed "},getLastUpdated:function(){return 1e3*this.get("LastQuoteDateTime")},getSpriteCoordinate:function(){return this.get("XCoordinate")}});return i}),define("shared/data/collections/markets",["backbone/nyt","foundation/collections/base-collection","foundation/hosts","shared/data/models/markets"],function(e,t,i,n){"use strict";var s=t.extend({initialize:function(){this.fetch()},sync:function(t,n,s){return s.url=i.marketsApiHost+"/research/Net/SectionFrontAPI/MarketModuleData/jsonp",s.dataType="jsonp",s.jsonpCallback="jsonMarkets",s.jsonp="callback",s.cache=!0,e.sync(t,n,s)},parse:function(e){var t,i,s,a,o=e.Tabs;for(i=0,s=o.length;s>i;i+=1)for(o[i].Items.length>3&&(o[i].Items=o[i].Items.slice(0,3)),t=0,a=o[i].Items.length;a>t;t+=1)o[i].Items[t]=new n(o[i].Items[t]);return o||[]},determineOpenIndex:function(){var e,t,i,n,s,a=["U.S.","Europe","Asia"];for(e=0;3>e&&!this.openRegion;e+=1)for(n=this.findWhere({Label:a[e]}),t=0,i=n.get("Items").length;i>t;t+=1)if(s=n.get("Items")[t],"True"===s.get("IsOpen")){this.openRegion=n;break}return this.openRegion=this.openRegion||this.findWhere({Label:"U.S."}),this.openRegion},getOpenIndex:function(){return this.openRegion||this.determineOpenIndex()},getIndex:function(e){return this.findWhere({Label:e})}});return s}),define("shared/data/instances/markets",["shared/data/collections/markets"],function(e){"use strict";return new e}),define("homepage/views/masthead/markets-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","homepage/templates","foundation/cookies","foundation/hosts","shared/data/instances/markets","homepage/views/helpers/masthead-modals"],function(e,t,i,n,s,a,o,r,l){"use strict";var d=i.extend(l).extend({modalSettings:{id:"markets-modal",binding:".markets-button",tailDirection:"up",tailTopOffset:-4,modalTitle:s.marketsModalHeader()},events:{"mouseover tr":"handleRowHover",mouseenter:"handleMouseOver",mouseleave:"handleMouseOut"},eventPrefix:"nyt:homepage-marketsModal-",adPosition:"Middle4",autoCloseDuration:1e3,render:function(){var e=t.extend({},this.modalSettings),i=r.getOpenIndex().get("Items")[0],a="";i.getLastUpdated()>0&&(a=this.prettyDate(i.getLastUpdated()).toLowerCase()),e.disableBindings=!this.pageManager.isMobile(),e.headerContent=s.marketsModalHeaderContent({date:i.getIndexStatus()+a}),e.modalContent=s.marketsModalContent({market:r.getOpenIndex(),prettyDate:this.prettyDate}),e.openCallback=this.handleModalOpen,e.closeCallback=this.handleModalClose,this.modal=new n(e),this.setElement(this.modal.$modal),this.subscribe("nyt:homepage-marketsTicker-on",this.handleOpen),this.subscribe("nyt:homepage-marketsTicker-off",this.handleClose),this.subscribe("nyt:homepage-weatherModal-open",this.handleClose);
},handleRowHover:function(t){var i=e(t.currentTarget),n=i.data("image-coords"),s=i.data("last-updated"),a=i.data("index");this.$el.find("tr").removeClass("active"),i.addClass("active"),this.$el.find("#markets-graph .icon").css("background-position","-"+n+"px 0"),this.$el.find("#markets-graph p").html(a),this.$el.find("#markets-last-update").html(s)}});return d}),define("homepage/views/masthead/markets-ticker",["jquery/nyt","underscore/nyt","foundation/views/base-view","homepage/templates","shared/data/instances/markets","homepage/views/masthead/markets-modal","homepage/views/helpers/masthead-hover-intent"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend(o).extend({el:"#markets",nytEvents:{"nyt:homepage-marketsModal-mouseover":"handleModalMouseover","nyt:homepage-marketsModal-open":"handleModalOpen","nyt:homepage-marketsModal-close":"handleModalClose"},collection:s,rotateFrequency:5e3,currentIndex:0,eventPrefix:"nyt:homepage-marketsTicker-",bindAllList:["rotateTicker","disableTicker","enableTicker","openModal","closeModal"],render:function(){this.indexes=this.collection.getOpenIndex().get("Items"),this.$el.html(n.marketsTicker(this.indexes[this.currentIndex])),this.$el.removeClass("hidden"),new a,this.enableTicker()},rotateTicker:function(){var e=this;this.currentIndex<this.indexes.length-1?this.currentIndex+=1:this.currentIndex=0,this.$el.fadeOut(function(){e.$el.html(n.marketsTicker(e.indexes[e.currentIndex])),e.$el.fadeIn(function(){e.disableTicker(),e.enableTicker()})})},enableTicker:function(){this.timer||(this.timer=window.setTimeout(this.rotateTicker,this.rotateFrequency))},disableTicker:function(){window.clearTimeout(this.timer),delete this.timer},handleModalMouseover:function(){this.disableTicker(),this.disableModalCloseTimer()},handleButtonOver:function(){this.enableModalOpenTimer(),this.disableModalCloseTimer(),this.disableTicker()},handleModalOpen:function(){this.disableTicker(),this.$el.find("button").addClass("active")},handleModalClose:function(){this.enableTicker(),this.$el.find("button").removeClass("active")}});return r}),define("shared/freetrial/tracking/tracking",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({el:"#free-trial",events:{"mouseup .free-trial-intro .next-button":"handleIntroPanelChange","mouseup .free-trial-intro .prev-button":"handleIntroPanelChange","mouseup .free-trial-intro .dot":"handleIntroPanelChange","mouseup .free-trial-intro .skip-button":"handleIntroPanelChange","mouseup .free-trial-intro .subscribe-newsletter .button":"handleIntroNewsletter","mousedown .free-trial-intro .follow-button":"handleIntroFollow","mouseup .free-trial-tasks .toggle-tasks":"handleToggleTasks","mousedown .free-trial-tasks .task-item a":"handleTasksGo","mousedown .free-trial-tasks .scroll-right":"handleTasksScroll","mousedown .free-trial-tasks .scroll-left":"handleTasksScroll","mouseup .free-trial-post .toggle-tasks":"handleTogglePostTrial","mouseup .free-trial-post .outer-link":"handleLPLink"},initialize:function(){this.trackingBaseData={action:"click",module:"FreeTrial",region:"FixedTop",mediaId:this.$el.data("variation")}},fourPanelSteps:{0:"WelcomeIntro",1:"Newsletter",2:"Follow",3:"Tour"},handleLPLink:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{contentCollection:"FreeTrialPost",contentId:"FTPostTrialToDSLP"});i.attr("href",n)},handleTogglePostTrial:function(t){var i=e(t.currentTarget),n=i.hasClass("collapsed"),s={contentCollection:"TogglePostTrial",version:"PostTrial",eventName:n?"ShowAll":"HideAll",priority:!0};this.trackingTrigger("free-trial-post-trial",s,"interaction")},handleToggleTasks:function(t){var i=e(t.currentTarget),n=i.hasClass("collapsed"),s={contentCollection:"ToggleTasks",version:"Tasks",eventName:n?"ShowAll":"HideAll",priority:!0};this.trackingTrigger("free-trial-tasks",s,"interaction")},handleTasksScroll:function(t){var i=e(t.currentTarget),n=i.hasClass("scroll-right"),s={contentCollection:"ScrollTasks",version:"Tasks",eventName:n?"ScrollRight":"ScrollLeft",priority:!0};i.hasClass("disabled")||this.trackingTrigger("free-trial-tasks",s,"interaction")},handleTasksGo:function(t){var i=e(t.currentTarget),n=i.data("trackAction"),s=i.data("trackId"),a=this.trackingAppendParams(i.attr("href"),{contentCollection:"GoToComplete",contentId:s,version:"Tasks",eventName:n});i.attr("href",a)},handleIntroNewsletter:function(t){var i=e(t.currentTarget),n=i.data("trackAction"),s=i.data("trackId"),a={contentCollection:"newsletter",contentId:s,version:"4panel",eventName:n,priority:!0};this.trackingTrigger("free-trial-intro",a,"interaction")},handleIntroFollow:function(t){var i=e(t.currentTarget),n=i.attr("data-track-action"),s=i.data("trackId"),a={contentCollection:"follow",contentId:s,version:"4panel",eventName:n,priority:!0};this.trackingTrigger("free-trial-intro",a,"interaction")},handleIntroPanelChange:function(t){var i=this.fourPanelSteps,n=e(t.target),s=n.data("trackAction"),a={next:function(){return i[parseInt(n.data("trackStep"),10)-1]},previous:function(){return i[parseInt(n.data("trackStep"),10)+1]},skip:function(){return i[parseInt(n.data("trackStep"),10)-1]},"go-step":function(){return i[n.data("trackStep")]}},o={contentCollection:a[s](),version:"4panel",eventName:s,priority:!0};this.trackingTrigger("free-trial-intro",o,"interaction")}});return n}),define("shared/freetrial/templates",["underscore/nyt"],function(_){var templates={};return templates.freeTrial=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div id="free-trial" class="free-trial" data-variation="'+(null==(__t=freeTrial.variation)?"":__t)+'"></div>';return __p},templates.freeTrialBand=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="free-trial-container">\n<div class="logo"></div>\n<div class="discoveries">\n',showRemainingTasks&&(__p+='\n<span>\n<span class="remaining-tasks"></span> of <span class="total-tasks"></span>  discoveries remaining\n</span>\n'),__p+="",showDaysLeft&&(__p+="\n<span>\n",0==daysLeft?(__p+="\nlast day\n",showDiscoveries&&(__p+='\n<span class="additional-info"> to finish your discoveries</span>\n'),__p+="\n"):(__p+="\n<span>"+(null==(__t=daysLeft)?"":__t)+"</span> day",daysLeft>1&&(__p+="s"),__p+=" left\n",showDiscoveries&&(__p+='\n<span class="additional-info">&nbsp;&mdash;&nbsp;last chance to finish your discoveries</span>\n'),__p+="\n"),__p+="\n</span>\n"),__p+="",showLimitedOffer&&(__p+="\n<span>\nlimited time offer\n</span>\n"),__p+="\n</div>",showToggleLink&&!showLimitedOffer&&(__p+='\n<a href="#" class="toggle-tasks"><span class="text hide-all">hide all</span><span class="text show-all">show discoveries</span><i class="toggle-icon"></i></a>\n'),__p+="",showToggleLink&&showLimitedOffer&&(__p+='\n<a href="#" class="toggle-tasks"><span class="text hide-all">hide</span><span class="text show-all">show</span><i class="toggle-icon"></i></a>\n'),__p+="\n</div>";return __p},templates.freeTrialIntro=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<div class="modal-panel">\n<div class="free-trial-container">\n<div class="step-container"></div><footer class="footer">\n<button class="button next-button" type="button" data-track-action="next" data-track-step="'+(null==(__t=currentStep+1)?"":__t)+'">Next</button><nav class="nav">\n';for(var i=0;i<steps.length;i++)__p+='\n<span class="dot '+(null==(__t=i==currentStep?"is-active":"")?"":__t)+'" data-track-action="go-step" data-track-step="'+(null==(__t=i)?"":__t)+'" data-step="'+(null==(__t=i)?"":__t)+'"></span>\n';__p+="\n</nav>\n</footer>\n</div>\n</div>"}return __p},templates.freeTrialIntroFollows=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<header class="header">\n<div class="heading">Follow our journalists and columns</div>\n<p class="summary">Get updates onsite when new articles are published in your favorite columns.</p>\n</header>\n<div class="tiles"></div>';return __p},templates.freeTrialIntroNewsletters=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<header class="header">\n<div class="heading">Sign up for our free email newsletters</div>\n<p class="summary">Choose newsletters on your favorite topics, from parenting to sports to real estate and more.</p>\n</header>\n<div class="tiles"></div>';return __p},templates.freeTrialIntroTour=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="heading">Take the tour</div>\n<p class="summary">\nTake new sections, must-have apps and the latest\nfeatures with our Times Tour Guide â€“ always\naccessible at the top of each web page.\n</p>';return __p},templates.freeTrialIntroWelcome=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<header class="header">\n<div class="logo"></div>\n</header>\n<div class="heading">Welcome to your free trial</div>\n<p class="summary">\nYour sign up is now complete. Here\'s how you can<br>\nmake the most of your time with The Times.\n</p>';return __p},templates.freeTrialPost=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="free-trial-container post-container">\n<a class="outer-link" title="" href="'+(null==(__t=takeUpsellUrl)?"":__t)+'">\n<span class="free-trial-container">\n<span class="inner">\n<span class="image"></span><span class="content">\n<span class="heading">We hope you enjoyed your free trial.</span>\n<span class="summary">Get '+(null==(__t=weeks)?"":__t)+' more weeks of unlimited access for just <span class="free-trial-upsell-price">'+(null==(__t=price)?"":__t)+'</span>.</span>\n<span class="button">Get '+(null==(__t=weeks)?"":__t)+' More Weeks</span>\n</span><span class="button">Get '+(null==(__t=weeks)?"":__t)+" More Weeks</span>\n</span>\n</span>\n</a>\n</div>";return __p},templates.freeTrialStaticPanel=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="tasks-list">\n<a href="#" class="scroll scroll-left disabled">\n<i class="arrow arrow-left"></i>\n<span class="scroll-label">prev</span>\n</a>\n<a href="" class="scroll scroll-right">\n<i class="arrow arrow-right"></i>\n<span class="scroll-label">next</span>\n</a>\n<div class="scroll-container">\n<ul></ul>\n</div>\n</div>';return __p},templates.freeTrialTask=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="thumb '+(null==(__t=id)?"":__t)+'"> </div>\n<div class="content">\n<div class="heading">'+(null==(__t=title)?"":__t)+'</div>\n<div class="summary">'+(null==(__t=description)?"":__t)+'</div>\n<a href="'+(null==(__t=link)?"":__t)+'" class="button" data-track-action="complete" data-track-id="'+(null==(__t=id)?"":__t)+'">'+(null==(__t=button)?"":__t)+"</a>\n</div>";return __p},templates.freeTrialUpsell=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="modal-panel">\n<div class="close-button-wrapper">\n<button type="button" class="close" aria-disabled="false">\n<i class="icon"></i>\n<span class="visually-hidden">Close this modal window</span>\n</button>\n</div><div>\n<div class="image"></div><div class="heading">\nWe hope youâ€™re enjoying your free trial.\n</div>\n<div class="summary">\nAdd '+(null==(__t=weeks)?"":__t)+' more weeks to your trial for just <span class="free-trial-upsell-price">'+(null==(__t=price)?"":__t)+'</span>.\n</div><div>\n<a class="button button-primary" href="'+(null==(__t=takeUpsellUrl)?"":__t)+'">\nAdd '+(null==(__t=weeks)?"":__t)+' More Weeks\n</a>\n<a class="button button-secondary button-cancel" href="">\nNo Thanks\n</a>\n</div>\n</div></div>';return __p},templates}),define("shared/freetrial/data/free-trial-config",[],function(){"use strict";return{offerChainIDs:{inTrialUpsell:"20000561421",postTrialUpsell:"20000037600"},campaignIDs:{inTrialUpsell:{v1:"4Y8KJ",v2:"4Y8KL"},postTrialUpsell:{v1:"4Y8KR",v2:"4Y8KW"}},inTrialOffer:{weeks:4,price:"99&cent;",localizedPrice:{UKP:"&pound;1",EUR:"&euro;1",AUD:"AUD &#36;1",CAN:"CAD &#36;1"}},postTrialOffer:{weeks:8,price:"99&cent;",localizedPrice:{UKP:"&pound;1",EUR:"&euro;1",AUD:"AUD &#36;1",CAN:"CAD &#36;1"}},inTrialUpsellPeriod:{startDay:7,endDay:27},postTrialUpsellPeriod:{startDay:28,endDay:34}}}),define("shared/freetrial/models/free-trial",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/models/base-model","foundation/hosts","shared/freetrial/data/free-trial-config"],function(e,t,i,n,s,a){"use strict";var o=function(e){return/sbx|dev|stg/.test(window.location.host)?void 0===e?!1:parseInt(e,10):!1},r=function(e){return/sbx|dev|stg/.test(window.location.host)?void 0===e?!1:e:!1},l=n.extend({freeTrialTotalDays:28,initialize:function(){t.bindAll(this,"freeTrialChanged"),this.isSynced=!1,this.listenToOnce(this,"sync",this.markSynced),this.listenToOnce(this,"sync",this.setAdxGlobals),this.listenTo(this,"change:freeTrial",this.freeTrialChanged),this.subscribe("nyt:free-trial-complete-step",this.completeStep)},sync:function(e,t,n){return n.url=s.myaccountHost+"/svc/account/free-trial/v1/status",n.cache=!1,n.xhrFields={withCredentials:!0},i.sync(e,t,n)},parse:function(e){var t=o(this.pageManager.getUrlParam("ftPassedDays")),i=o(this.pageManager.getUrlParam("ftRemainingDays")),n=r(this.pageManager.getUrlParam("ftVariation"));return e.data&&e.data.freeTrialUser?(i!==!1&&(e.data.freeTrial.remainingDays=i),t!==!1&&(e.data.freeTrial.passedDays=t),n!==!1&&(e.data.freeTrial.variation=n),e.data):e.data},markSynced:function(){this.isSynced=!0,this.broadcast("nyt:free-trial-status-updated")},setAdxGlobals:function(){window.NYTD||(window.NYTD={}),window.NYTD.showBar1Upsell=this.isFreeTrialUser()&&!this.isUpsellTaken()&&this.getPassedDays()<a.postTrialUpsellPeriod.startDay},getRemainingDays:function(){return this.freeTrialTotalDays-this.getPassedDays()},getPassedDays:function(){return this.get("freeTrial").passedDays},getVariation:function(){return this.get("freeTrial").variation},isVariation1:function(){return"v1"===this.get("freeTrial").variation},isVariation2:function(){return"v2"===this.get("freeTrial").variation},freeTrialChanged:function(){var e,i,n=this.get("freeTrial").steps,s=this.previous("freeTrial");if(s)for(e=0;e<n.length;e+=1)t.indexOf(s.steps,n[e])>-1||(i=n[e].replace("step-",""),this.broadcast("nyt:free-trial-step-completed",i),this.broadcast("nyt:free-trial-step-completed-"+i))},completeStep:function(t){var i=this;if(!this.isStepCompleted(t)){try{localStorage.setItem("free-trial-step-"+t+"-completed-at",(new Date).getTime())}catch(n){}e.ajax({url:s.myaccountHost+"/svc/account/free-trial/v1/update",method:"POST",xhrFields:{withCredentials:!0},data:{step:t}}).done(function(e){return e?void i.set(e.data):!1})}},isStepCompleted:function(e){var i,n;try{if(i=parseInt(localStorage.getItem("free-trial-step-"+e+"-completed-at"),10),n=new Date,n.setHours(4),n.setMinutes(0),n.setSeconds(0),"crosswords"===e&&i&&i<n.getTime())return!1}catch(s){}return this.get("freeTrial")?t.indexOf(this.get("freeTrial").steps,"step-"+e)>-1:!1},isIntroStepCompleted:function(){return this.isStepCompleted("intro")},isInTrialUpsellStepCompleted:function(){return this.isStepCompleted("in-trial-upsell")},isFreeTrialUser:function(){return this.get("freeTrialUser")?!0:!1},isUpsellTaken:function(){var e=this.get("freeTrial");return"upsell"===e.participantStatus?!0:!1},ensureCountryCode:function(t){return window.NYTD&&window.NYTD.countryCode?void t(window.NYTD.countryCode):void e.ajax({url:"http://www.nytimes.com/adx/bin/adxrun.html?jsonp=?",dataType:"jsonp",data:{v:3,page:"www.nytimes.com/growl",positions:"data_country"},success:function(i){e("body").append(i.ads&&i.ads&&i.ads.data_country&&i.ads.data_country.creative),t(window.NYTD&&window.NYTD.countryCode)},error:function(){t()},timeout:1e3})}});return new l}),define("shared/freetrial/models/free-trial-storage",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/models/base-model"],function(e,t,i,n){"use strict";var s=n.extend({initialize:function(){this.loadFromStorage(),this.on({change:this.dataChanged},this)},getSessionStorage:function(e){var t;try{if(t=window.sessionStorage.getItem(e))return JSON.parse(t)}catch(i){}return{}},setSessionStorage:function(e,t){try{window.sessionStorage.setItem(e,JSON.stringify(t))}catch(i){}},loadFromStorage:function(){var e=this.getSessionStorage("free-trial-storage");this.set(e)},dataChanged:function(){this.setSessionStorage("free-trial-storage",this.toJSON())}});return new s}),define("shared/freetrial/views/free-trial-intro-welcome",["foundation/views/base-view","shared/freetrial/templates"],function(e,t){"use strict";var i=e.extend({className:"free-trial-intro-welcome",template:t.freeTrialIntroWelcome,render:function(){return this.$el.html(this.template()),this}});return i}),define("shared/subscribenewsletter/api/newsletter",["jquery/nyt","foundation/hosts"],function(e,t){"use strict";var i=function(i,n,s,a){var o=t.myaccountHost+"/svc/account/newsletter/v1/"+n;e.ajax({type:i,url:o,data:s,xhrFields:{withCredentials:!0}}).error(function(e,t,i){a&&a(new Error("Error making request to "+o+"\n"+i+"\n"+t))}).success(function(e){a&&a(null,e.data)})};return{subscribe:function(e,t){i("POST","subscribe",{product:e},t)},unsubscribe:function(e,t){i("POST","unsubscribe",{product:e},t)},list:function(e){i("GET","list",{},function(t,i){t?e(t):e(null,i.subscriptions)})},available:function(e){i("GET","available",{},e)}}}),define("shared/subscribenewsletter/models/subscribe-newsletter",["backbone/nyt","jquery/nyt","underscore/nyt","foundation/models/base-model","shared/subscribenewsletter/api/newsletter"],function(e,t,i,n,s){"use strict";var a=n.extend({defaults:{code:!1,suggested:!1,thumb:!1,thumbClass:!1,title:"default title",description:!1,subscribed:!1,buttonText:["Subscribe","Subscribed","Unsubscribe"],saveImmediately:!0},initialize:function(){this.wasInitiallySubscribed=this.get("subscribed")},toggleSubscription:function(){this.get("subscribed")?this.unsubscribe():this.subscribe()},subscribe:function(){this.set("subscribed",!0),this.get("saveImmediately")&&this.save()},unsubscribe:function(){this.set("subscribed",!1),this.get("saveImmediately")&&this.save()},save:function(){this.get("subscribed")!==this.wasInitiallySubscribed&&(this.get("subscribed")?s.subscribe(this.get("code"),function(e){e?this.set("subscribed",this.wasInitiallySubscribed):this.wasInitiallySubscribed=!0}.bind(this)):s.unsubscribe(this.get("code"),function(e){e?this.set("subscribed",this.wasInitiallySubscribed):this.wasInitiallySubscribed=!1}.bind(this)))}});return a}),define("shared/freetrial/collections/free-trial-intro-newsletters",["underscore/nyt","foundation/collections/base-collection","shared/subscribenewsletter/models/subscribe-newsletter","shared/subscribenewsletter/api/newsletter"],function(e,t,i,n){"use strict";var s=t.extend({model:i,refreshSubscriptionStatuses:function(e){n.list(function(t,i){return t&&"function"==typeof e?e(t):(i.forEach(function(e){var t=this.findWhere({code:e.code});t&&(t.set("subscribed",e.subscribed),t.wasInitiallySubscribed=e.subscribed)}.bind(this)),void("function"==typeof e&&e()))}.bind(this))},handleSuggestedSubscriptions:function(){e(this.where({suggested:!0,subscribed:!1})).each(function(e){e.subscribe()})}});return s}),define("shared/subscribenewsletter/templates",["underscore/nyt"],function(_){var templates={};return templates.subscribeNewsletter=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",(thumb||thumbClass)&&(__p+='\n<div class="thumb" role="presentation">\n',__p+=thumb?'\n<img src="'+(null==(__t=thumb)?"":__t)+'" alt="'+(null==(__t=title)?"":__t)+'"/>\n':'\n<i class="'+(null==(__t=thumbClass)?"":__t)+'"></i>\n',__p+="\n</div>\n"),__p+='<div class="heading">'+(null==(__t=title)?"":__t)+"</div>",description&&(__p+='\n<div class="summary">'+(null==(__t=description)?"":__t)+"</div>\n"),__p+='<button class="button '+(null==(__t=subscribed?"is-subscribed":"")?"":__t)+'"\ntype="button"\ndata-track-id="'+(null==(__t=code)?"":__t)+'"\ndata-track-action="'+(null==(__t=subscribed?"unsubscribe":"subscribe")?"":__t)+'">\n<i class="icon sprite-icon"></i>\n<span class="button-text">'+(null==(__t=buttonText[subscribed?1:0])?"":__t)+"</span>\n</button>";return __p},templates}),define("shared/subscribenewsletter/views/subscribe-newsletter",["jquery/nyt","foundation/views/base-view","shared/subscribenewsletter/templates","shared/subscribenewsletter/models/subscribe-newsletter"],function(e,t,i,n){"use strict";var s=t.extend({className:"subscribe-newsletter",template:i.subscribeNewsletter,model:new n,events:{"click .button":"onClickButton","mouseenter .button":"onHoverButton","mouseleave .button":"onUnhoverButton"},initialize:function(){this.listenTo(this.model,"sync change",this.render)},onHoverButton:function(t){this.model.get("subscribed")&&e(t.currentTarget).addClass("active").find(".button-text").text(this.model.get("buttonText")[2])},onUnhoverButton:function(t){this.model.get("subscribed")&&e(t.currentTarget).removeClass("active").find(".button-text").text(this.model.get("buttonText")[1])},onClickButton:function(){this.model.toggleSubscription()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}});return s}),define("shared/freetrial/views/free-trial-intro-newsletters",["foundation/views/base-view","shared/freetrial/templates","shared/freetrial/collections/free-trial-intro-newsletters","shared/subscribenewsletter/views/subscribe-newsletter"],function(e,t,i,n){"use strict";var s=e.extend({className:"free-trial-intro-newsletters",template:t.freeTrialIntroNewsletters,collection:new i,initialize:function(){this.collection.refreshSubscriptionStatuses(function(e){var t="nyt:free-trial-intro-newsletters:handledSuggestedSubscriptions";e||sessionStorage.getItem(t)||(this.collection.handleSuggestedSubscriptions(),sessionStorage.setItem(t,!0))}.bind(this))},render:function(){return this.$el.html(this.template()),this.$el.find(".tiles").append(this.collection.map(function(e){return new n({model:e}).render().$el.addClass("tile")})),this}});return s}),define("shared/messaging/models/follow",["underscore/nyt","foundation/models/base-model"],function(e,t){"use strict";var i=t.extend({defaults:{tag:"",type:"",following:"",thumb:"",thumbClass:!1,description:"",isFollowing:!1},follow:function(){this.set("isFollowing",!0),this.broadcast("nyt:messaging-following-"+this.id)},unfollow:function(){this.set("isFollowing",!1),this.broadcast("nyt:messaging-unfollowing-"+this.id)},isFollowing:function(){return this.get("isFollowing")},getButtonText:function(){return e.pick(this.toJSON(),["followText","followingText","unfollowText"])}});return i}),define("shared/freetrial/collections/free-trial-intro-follows",["foundation/collections/base-collection","shared/messaging/models/follow"],function(e,t){"use strict";var i=e.extend({model:t});return i}),define("shared/messaging/templates",["underscore/nyt"],function(_){var templates={};return templates.followButton=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button class="button follow-button '+(null==(__t=classes)?"":__t)+'">\n<i class="icon sprite-icon"></i>\n<span class="button-text">'+(null==(__t=buttonText)?"":__t)+"</span>\n</button>";return __p},templates.followConfirmation=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="message message-unfollow-confirmation" data-timestamp="'+(null==(__t=timestamp)?"":__t)+'">\n',thumb&&(__p+='\n<div class="thumb">\n<img src="'+(null==(__t=thumb)?"":__t)+'" />\n</div>\n'),__p+='\n<div class="message-content">\n<p class="message-title">'+(null==(__t=unfollowText)?"":__t)+' <span class="collection-name">'+(null==(__t=following)?"":__t)+'</span>?</p>\n<div class="button-container">\n<button class="button unfollow-button"><i class="icon sprite-icon"></i>'+(null==(__t=confirmText)?"":__t)+'</button>\n<button class="button keep-following-button">'+(null==(__t=abortText)?"":__t)+"</button>\n</div>\n</div>\n</div>";return __p},templates.followInfo=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="follow-info '+(null==(__t=followClass)?"":__t)+'">\n',thumb?__p+='\n<div class="thumb '+(null==(__t=type)?"":__t)+'">\n<img src="'+(null==(__t=thumb)?"":__t)+'" alt="" role="presentation"/>\n</div>\n':thumbClass&&(__p+='\n<div class="thumb">\n<i class="'+(null==(__t=thumbClass)?"":__t)+'"></i>\n</div>\n'),__p+='\n<h4 class="collection-name">'+(null==(__t=following)?"":__t)+'</h4>\n<p class="description">'+(null==(__t=description)?"":__t)+"</p>\n</div>";return __p},templates.followUnfollowed=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",__p+=message_type?'\n<div class="message message-unfollow-confirmed message-comment-'+(null==(__t=message_type)?"":__t)+'" data-timestamp="'+(null==(__t=timestamp)?"":__t)+'">\n':'\n<div class="message message-unfollow-confirmed" data-timestamp="'+(null==(__t=timestamp)?"":__t)+'">\n',__p+="\n<div class=\"message-content\">\n<p class='message-title'>"+(null==(__t=confirmedText)?"":__t)+" <span class='collection-name'>"+(null==(__t=following)?"":__t)+"</span>. <button class='button undo-action-button'>Undo</button></p>\n</div>\n</div>";return __p},templates.message=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){if(__p+="",closeButton&&(__p+='\n<button class="button close-message">\n<i class="icon"></i>\n<span class="visually-hidden">Close alert</span>\n</button>\n'),__p+="",sub_type&&(sub_type=sub_type.replace(/([A-Z])/g,"-$1").toLowerCase(),"-"===sub_type.charAt(0)&&(sub_type=sub_type.substr(1))),__p+='<div class="message '+(null==(__t=sub_type)?"":__t)+'" data-messageId="'+(null==(__t=id)?"":__t)+'"><i class="icon sprite-icon"></i>',label&&(__p+='\n<span class="label">'+(null==(__t=label)?"":__t)+"</span>\n"),__p+='<span class="message-content">\n<span class="message-title">'+(null==(__t=formattedTitle)?"":__t)+"</span>\n",buttons.length>0){__p+="\n";for(var i=0;i<buttons.length;i++)buttons[i].url&&(__p+='\n<a href="'+(null==(__t=buttons[i].url)?"":__t)+'" class="button message-button action-button">'+(null==(__t=buttons[i].text)?"":__t)+"</a>\n");__p+="\n"}if(__p+="\n",1===display_type_id&&start_time){var minutes,hours,formatted,date=new Date(1e3*start_time);hours=date.getHours(),minutes=date.getMinutes(),minutes=9>=minutes?"0"+minutes:minutes,ampm=hours>=12?"PM":"AM",hours=hours>12?hours-12:hours,formatted=""+hours+":"+minutes+" "+ampm,__p+='\n<span class="timestamp">\n'+(null==(__t=formatted)?"":__t)+"\n</span>\n"}__p+="\n",4===display_type_id&&(__p+="\n<a href='#' class=\"close-message\">"+(null==(__t=payload.dsm_cpy)?"":__t)+"</a>\n"),__p+="\n",__p+="\n","undefined"!=typeof customMarkup&&customMarkup&&(__p+='\n<span class="message-extra">\n'+(null==(__t=customMarkup)?"":__t)+"\n</span>\n"),__p+="\n",__p+="\n</span></div>"}return __p},templates.messenger=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="message-bed"></div>';return __p},templates.notificationModals=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",__p+=message_type?'\n<div class="message comment-'+(null==(__t=message_type)?"":__t)+'-message">\n':'\n<div class="message">\n',__p+="\n",__p+=link?'\n<a href="'+(null==(__t=link)?"":__t)+'">\n':"\n<a class='link-to-panel' href=\"#\">\n",__p+="\n"+(null==(__t=emphasize(title,emphasis))?"":__t)+'\n</a>\n<span class="message-metadata">\n',timestamp&&(__p+='\n<time class="timestamp" datetime="'+(null==(__t=timestamp)?"":__t)+'">'+(null==(__t=this.prettyDate(1e3*timestamp)||"Just now")?"":__t)+"</time>\n"),__p+="\n</span>\n</div>";return __p},templates.notificationsModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="","default"===show?__p+='\n<div class="message-container">\n<div class="message message-default">\n<div class="message-content">\n<p class="message-title">You have no new notifications.</p>\n<p>Follow columns and be notified when new articles are published.</p>\n</div>\n<div class="follow-suggestions"></div>\n</div>\n</div>\n':(__p+="\n",__p+=message_type?'\n<div class="message message-comment-'+(null==(__t=message_type)?"":__t)+'" data-timestamp="'+(null==(__t=timestamp)?"":__t)+'">\n':'\n<div class="message" data-timestamp="'+(null==(__t=timestamp)?"":__t)+'">\n',__p+="\n",display_type_id>=unfollowThreshold&&(__p+='\n<button class="button unsubscribe-button" title="'+(null==(__t=unfollowText)?"":__t)+" "+(null==(__t=following)?"":__t)+'"><i class="icon sprite-icon"></i></button>\n'),__p+="\n",link&&(__p+='\n<a class="message-link" href="'+(null==(__t=link)?"":__t)+'">\n'),__p+="\n",thumb&&5!==display_type_id&&(__p+='\n<div class="thumb"><img src="'+(null==(__t=thumb)?"":__t)+'" /></div>\n'),__p+='<div class="message-content">\n<p class="message-title">'+(null==(__t=formattedTitle)?"":__t)+"</p>\n",5===display_type_id&&comment_body&&(__p+='\n<div class="comment-excerpt">\n',display_name&&"replied"===message_type&&(__p+='\n<div class="commenter">\n<p class="commenter-name">'+(null==(__t=display_name)?"":__t)+"</p>\n",location&&(__p+='\n<p class="commenter-location">'+(null==(__t=location)?"":__t)+"</p>\n"),__p+="\n</div>\n"),__p+='\n<p class="comment-text" data-truncate="true">'+(null==(__t=comment_body)?"":__t)+"</p>\n</div>\n"),__p+="\n",5===display_type_id&&(__p+='\n<i class="icon sprite-icon"></i>\n'),__p+="\n",timestamp&&(__p+='\n<time class="timestamp" datetime="'+(null==(__t=timestamp)?"":__t)+'">'+(null==(__t=this.prettyDate(1e3*timestamp)||"Just now")?"":__t)+"</time>\n"),__p+="\n</div>\n",link&&(__p+="</a>"),__p+="\n</div>\n"),__p+="";return __p},templates.onboardingFirstFollow=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<p class="prompt"><strong>You are following '+(null==(__t=collectionName)?"":__t)+".</strong> Every time a new "+(null==(__t=collectionName)?"":__t)+" article is published, you will receive an alert in your notifications panel in the top right corner of your screen.</p>";return __p},templates.onboardingIntroducingNotifications=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<p class="prompt"><strong>Introducing the notifications panel.</strong> Follow columns and receive an alert when new articles are published.</p>';return __p},templates.onboardingSuggestFollow=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<p class="prompt"><strong>Follow '+(null==(__t=collectionName)?"":__t)+"</strong> and receive an alert when a new article is published.</p>";return __p},templates}),define("shared/messaging/views/follow-onboarding",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal"],function(e,t,i,n){"use strict";var s=i.registerView("messaging").extend({defaults:{featureName:"",extractTemplateData:function(e){return e},animationDuration:1e3,modalDefaults:{className:"",superclass:"",template:function(){},modalOptions:{tailDirection:"up-right",disableBindings:!0,toggleSpeed:200},onShow:function(){},onHide:function(){}},allows:{}},initialize:function(e){var i,n,s,a=this;if(!e.types)return!1;this.modals={},this.settings=t.extend({},this.defaults,e),this.modalSettings={},this.settings.modalOptions=t.extend({},this.defaults.modalOptions,e.modalOptions),this.extractTemplateData=this.settings.extractTemplateData,this.allows=t.extend({},this.defaults.allows,e.allows);for(i in e.types)this.modals[i]={},this.modalSettings[i]=t.extend({},this.settings.modalDefaults,e.types[i]),this.modalSettings[i].modalOptions=t.extend({},this.settings.modalDefaults.modalOptions,e.types[i].modalOptions),n=this.modalSettings[i].modalOptions.addlClasses,s=this.modalSettings[i].className+" "+this.modalSettings[i].superclass,n=n?n+" "+s:s,n.replace(/\s/g,"").length>0&&(this.modalSettings[i].modalOptions.addlClasses=n);return this.subscribe("nyt:"+this.settings.featureName+"-onboarding-show",function(e){a.handleModalOpen(e.type,e)}),this.subscribe("nyt:"+this.settings.featureName+"-onboarding-hide",function(e){a.handleModalClose(e.type,e)}),this},createNewModal:function(i,s){
var a=this,o=s?s.binding:void 0,r=s&&s.modalOptions?s.modalOptions:{},l=this.modalSettings[i];return new n(t.extend({},this.settings.modalOptions,l.modalOptions,r,{id:this.settings.featureName+"-tooltip-"+i,modalContent:l.template(a.extractTemplateData(s)),binding:o,openCallback:function(){a.trackOnboardingEvent("impression",i,o),l.onShow(a),e("#notifications-tooltip-"+i).find(".dismiss-button").on("click",function(){a.trackOnboardingEvent("click",i,o)})},closeCallback:function(){l.onHide(a)},instanceData:s}))},showModal:function(e){e&&(this.modals[e].addToPage().open(),this.broadcast("nyt:"+this.settings.featureName+"-onboarding-shown",e))},hideModal:function(e){e&&(this.modals[e].close().removeFromPage(),this.broadcast("nyt:"+this.settings.featureName+"-onboarding-hidden",this),this.modals[e]=!1)},handleModalOpen:function(e,t){(t.force||e&&this.allows[e])&&(this.modals[e]=this.createNewModal(e,t),this.showModal(e),this.allows[e]=!1)},handleModalClose:function(e){e&&!t.isEmpty(this.modals[e])&&this.hideModal(e)},trackOnboardingEvent:function(i,n,s){var a,o,r,l,d,c,h="impression"===i;n&&(r={version:"Follow"+n.toUpperCase().slice(0,1)+n.slice(1),module:"follow",eventName:h?"tooltip-shown":"tooltip-CTA",priority:h},l=["marginalia","next-in","notifications-modal","extended-byline","collection-heading","masthead"],o=t.isString(s)?e(s):s,o&&o.length&&(d=t.find(l,function(e){return o.parents("."+e).length>0})),d&&(r.region=d),a=h?"trackingTriggerImpression":"trackingTrigger",c=h?void 0:"interaction",this[a]("follow-events",r,c))}});return s}),define("shared/messaging/collections/follows",["jquery/nyt","underscore/nyt","foundation/collections/base-collection","shared/messaging/models/follow","shared/messaging/views/follow-onboarding","shared/messaging/templates","foundation/hosts"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend({model:n,defaultSettings:{},initialize:function(e){this.settings=t.extend({},this.defaultSettings,e),this.followSorts=!1,this.followQueue=[],this.followsInitialized=!1,this.knowsSubscriptionData=!1,this.followLater={},this.followedAlready=!1,this.onboarding=null,this.stateKeys={onboardWelcome:"follow.onboard-welcome",onboardSuggest:"follow.onboard-suggest",onboardConfirm:"follow.onboard-confirm",betaWhitelist:"follow.whitelist"},t.bindAll(this,"createOnboardingInstance","handleOnboardingComplete"),this.pageManager.isDomReady()?this.getFollowables():this.subscribe(this.pageManager,"nyt:page-ready",this.getFollowables),this.subscribe("nyt:messaging-follow-data-received",this.handleFollowingDataReceived),this.subscribe("nyt:messaging-unfollow-tag",this.unsubscribeFromFollowable),this.subscribe("nyt:messaging-follow-tag",this.subscribeToFollowable),this.subscribe("nyt:notifications-onboarding-complete",this.handleOnboardingComplete),this.subscribe("nyt:notifications-instantiate-onboarding",this.createOnboardingInstance)},changeSubscription:function(t,i,n){var s=o.followApiHost+"/svc/pushmobile/follow/v0/"+i+".json";e.ajax({url:s,type:t,xhrFields:{withCredentials:!0}}).done(n)},unsubscribeFromFollowable:function(e){var t=this.get(e);t&&t.unfollow(),this.changeSubscription("DELETE",e,function(){})},subscribeToFollowable:function(e){var t=this.get(e);t&&(t.follow(),this.followedAlready||"follow"===e.slice(0,6)||(this.broadcast("nyt:notifications-onboarding-show",{type:"confirm",model:t}),this.followedAlready=!0)),this.changeSubscription("POST",e,function(){})},getFollowables:function(){var i=this;e.ajax({url:o.s1Host+"/messaging/available_follows.jsonp",dataType:"jsonp",jsonpCallback:"followablesCallback"}).done(function(e){var n,s;if(!e)return!1;if(e.followables)for(n in e.followables)s=e.followables[n],s.id=n,i.add(s);i.followSorts=t.omit(e,"followables"),i.followsInitialized=!0,i.local(i,"nyt:messaging-followables-received")})},handleFollowingDataReceived:function(e){var t=this;this.knowsSubscriptionData||!this.pageManager.flag("followingRelease")&&!e[this.stateKeys.betaWhitelist]||(this.knowsSubscriptionData=!0,this.pageManager.setMeta("nyt:messaging-user-has-ability-to-follow","true"),this.broadcast("nyt:messaging-user-has-ability-to-follow"),this.followsInitialized?this.followFollowables(e):(this.followQueue=e,this.subscribe(this,"nyt:messaging-followables-received",this.followFollowables)),this.pageManager.getMeta("nyt:messaging-notifications-panel-active")?this.handleOnboardingReady(e):this.subscribe("nyt:messaing-notifications-panel-active",function(){t.handleOnboardingReady(e)}))},handleOnboardingReady:function(e){e&&!e[this.stateKeys.onboardConfirm]&&"homepage"!==this.pageManager.getApplicationName()&&(this.createOnboardingInstance({following:e}),e[this.stateKeys.onboardWelcome]||this.broadcast("nyt:notifications-onboarding-show",{type:"welcome",binding:".notifications-button"}))},createOnboardingInstance:function(e){!this.onboarding&&e.following&&(this.onboarding=new s({featureName:"notifications",extractTemplateData:function(e){return e&&e.model&&e.model.get?{collectionName:e.model.get("following")}:{}},types:{welcome:{template:a.onboardingIntroducingNotifications,className:"notifications-tooltip",superclass:"tooltip",modalOptions:{tailTopOffset:-8,tailLeftOffset:-1,fixedOverride:!0},onShow:function(t){var i=function(){t.broadcast("nyt:notifications-onboarding-hide",{type:"welcome"})};t.broadcast("nyt:notifications-onboarding-complete","welcome"),"homepage"===t.pageManager.getApplicationName()?t.subscribeOnce("nyt:masthead-hidden",i):t.subscribeOnce("nyt:masthead-storytheme",i),e.cbExtension&&e.cbExtension(t.modals.welcome)}},suggest:{template:a.onboardingSuggestFollow,className:"notifications-tooltip",superclass:"tooltip",modalOptions:{tailDirection:"down-right"},onShow:function(t){t.broadcast("nyt:notifications-onboarding-complete","suggest"),t.modals.suggest.settings.fixedOverride&&t.subscribeOnce("nyt:masthead-storytheme",function(){t.broadcast("nyt:notifications-onboarding-hide",{type:"suggest"})}),e.cbExtension&&e.cbExtension(t.modals.suggest)}},confirm:{template:a.onboardingFirstFollow,className:"notifications-confirmation",modalOptions:{modalTitle:'<i class="icon"></i>Success!',hasOverlay:!0,hasCloseButton:!0,tailDirection:"centered"},onShow:function(e){e.broadcast("nyt:notifications-onboarding-complete","confirm")}}},modalOptions:{modalFooter:e.footerOverride||'<button class="button dismiss-button">Ok, got it</button>'},allows:{welcome:!e.following[this.stateKeys.onboardWelcome],suggest:!e.following[this.stateKeys.onboardSuggest],confirm:!e.following[this.stateKeys.onboardConfirm]}}),this.broadcast("nyt:messaging-user-onboarding-start"))},followFollowables:function(e){var i,n,s=e||this.followQueue;for(s=t.isArray(s)?s:t.keys(s);s.length>0;)i=s.shift(),n=this.get(i),n?n.follow():this.followLater[i]=!0;this.handleFollowDataReady()},handleFollowDataReady:function(){var e,t=this.createOrderedFullList();e=this.pageManager.flag("moreFollowSuggestions")?t:this.generateFollowSuggestions(),this.broadcast("nyt:messaging-follow-suggestions-received",e),this.broadcast("nyt:messaging-followable-list-received",t)},generateFollowSuggestions:function(e){var i,n,s=[],a=[],o=this.followSorts.weighted||this.followSorts.alpha||t.pluck(this.models,"id"),r=t.clone(o);for(e=e||3;s.length<e;)if(r.length>0){if(i=r.shift(),n=this.get(i),!n)continue;n.isFollowing()?a.push(n):s.push(n)}else{if(0===a.length)break;s.push(a.shift())}return s},createOrderedFullList:function(e){var i,n,s,a,o=[];for(a=t.pluck(this.models,"id"),e=e||this.followSorts.alpha||a,i=0;i<e.length;i+=1)s=this.followSorts.alpha[i],n=this.get(s),n&&o.push(n);return o},getModelFromMeta:function(e){var t,i,n=this.pageManager.getMeta("applicationName");return"article"!==n&&"collection"!==n||(t=this.pageManager.getMeta("CT")+"."+this.pageManager.getMeta("CN"),t!==e)?void 0:(i=this.add({following:this.pageManager.getMeta("nyt-collection:display-name"),id:t,tag:t,thumb:"collection"===n?this.pageManager.getMeta("og:image"):void 0,description:this.pageManager.getMeta("nyt-collection:tagline")}),this.followLater[t]&&i.follow(),i)},handleOnboardingComplete:function(e){var t;this.pageManager.flag("followingRelease")&&this.isUserLoggedIn===!1||(t={welcome:this.stateKeys.onboardWelcome,suggest:this.stateKeys.onboardSuggest,confirm:this.stateKeys.onboardConfirm},t[e]&&this.subscribeToFollowable(t[e]))}});return r}),define("shared/messaging/instances/follows",["foundation/views/page-manager","shared/messaging/collections/follows"],function(e,t){"use strict";return e.flag("followFeature")?new t:{}}),define("shared/messaging/views/follow-button",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/messaging/templates","shared/messaging/instances/follows"],function(e,t,i,n,s,a){"use strict";var o=i.registerView("messaging").extend({className:"follow-button-container",defaults:{template:s.followButton,followingText:"Following",followText:"Follow",unfollowText:"Unfollow"},initialize:function(e){this.settings=t.extend({},this.defaults,e),this.template=this.settings.template,e.$el&&(this.model=a.get(e.$el.data("collection-id")),this.model||(this.model=a.getModelFromMeta(e.$el.data("collection-id")))),this.model&&(this.settings=t.extend(this.settings,this.model.getButtonText()),this.subscribe("nyt:messaging-following-"+this.model.id,this.updateFollowView),this.subscribe("nyt:messaging-unfollowing-"+this.model.id,this.updateFollowView),e.$el&&e.$el.replaceWith(this.render().$el))},render:function(){var i=this,n=t.extend(i.model.toJSON(),i.getRenderVars()),s=i.template(n);return i.$el.html(s),i.$el.on("click",".follow-button",function(){var t,n;return i.trackFollowButtonClick(e(this)),void 0===i.isUserLoggedIn?!1:i.isUserLoggedIn?(n=i.model.get("tag"),i.model.isFollowing()?i.broadcast("nyt:messaging-unfollow-tag",n):i.broadcast("nyt:messaging-follow-tag",n),!1):(t="Log in to follow "+i.model.get("following"),i.broadcast("nyt:loginmodal-open",{modalTitle:t,registrationPlatform:"follow_button"}),!1)}),i.$el.on("focusin mouseenter",".follow-button",function(){var t=e(this),n=t.parent().parent(),s={tailDirection:"down-right",fixedOverride:!1};t.hasClass("is-following")?t.addClass("active").find(".button-text").html(i.settings.unfollowText):n.hasClass("follow-option")||(n.hasClass("collection-heading")?s.tailTopOffset=3:n.hasClass("collection-meta")?s.tailTopOffset=-2:n.hasClass("collection-header")?(s.tailDirection="up-left",s.tailTopOffset=-2,s.tailLeftOffset=-44):n.hasClass("user-tools-button-group")?(s.tailDirection="up-right",s.tailTopOffset=-2,s.fixedOverride=!0):n.hasClass("extended-byline")&&(s.tailDirection="up-left"),i.broadcast("nyt:notifications-onboarding-show",{type:"suggest",binding:i.$el,model:i.model,modalOptions:s}))}),i.$el.on("mouseleave focusout",".follow-button.is-following",function(){e(this).removeClass("active").find(".button-text").html(i.settings.followingText)}),this},getRenderVars:function(){var e={};return this.model.isFollowing()?(e.buttonText=this.settings.followingText,e.classes="is-following"):(e.buttonText=this.settings.followText,e.classes=""),e},updateFollowView:function(){var e=this.getRenderVars(),t=this.$el.find(".follow-button"),i=t.find(".button-text");t.removeClass("is-following active").addClass(e.classes),i.html(e.buttonText)},trackFollowButtonClick:function(i){var n,s,a=this.model.get("id").split("."),o={module:"follow",state:this.model.isFollowing()?"following":"not-following",action:"click",contentId:a[1]||"",version:a[0]||"",eventName:this.model.isFollowing()?"unfollow":"follow",mData:{textLabel:!0}},r=["marginalia","next-in","notifications-modal","extended-byline","collection-heading","masthead"],l=["notifications","follow-options"];n=t.find(r,function(e){return i.parents("."+e).length>0}),n&&(o.region=n),"notifications-modal"===n&&(s=t.find(l,function(e){return i.parents("."+e).length>0}),s&&(o.state="follow-options"===s?"customize":"notification",o.contentPlacement=e(".notifications-modal ."+s+" .follow-button").index(i)+1)),this.trackingTrigger("follow-events",o,"interaction")},handleUserReady:function(){this.isUserLoggedIn=n.isLoggedIn()}});return o}),define("shared/messaging/views/follow",["underscore/nyt","foundation/views/base-view","shared/messaging/views/follow-button","shared/messaging/templates"],function(e,t,i,n){"use strict";var s=t.registerView("messaging").extend({className:"follow-option",defaults:{template:n.followInfo},initialize:function(t){this.settings=e.extend({},this.defaults,t),this.template=this.settings.template,this.followButton=new i({model:this.model}),this.subscribe("nyt:messaging-following-"+this.model.id,this.updateFollowView),this.subscribe("nyt:messaging-unfollowing-"+this.model.id,this.updateFollowView)},render:function(){var t=e.extend(this.model.toJSON(),{followClass:this.getFollowClass()}),i=this.template(t);return this.$el.html(i).append(this.followButton.render().$el),this},getFollowClass:function(){return this.model.isFollowing()?"following":""},updateFollowView:function(){var e=this.getFollowClass(),t=this.$el.find(".follow-info");t.removeClass("following").addClass(e)}});return s}),define("shared/freetrial/views/free-trial-intro-follows",["foundation/views/base-view","shared/freetrial/templates","shared/freetrial/collections/free-trial-intro-follows","shared/messaging/views/follow","shared/messaging/instances/follows"],function(e,t,i,n,s){"use strict";var a=e.extend({className:"free-trial-intro-follows",template:t.freeTrialIntroFollows,collection:new i,getCorrectModel:function(e){var t=s.get(e.get("id"));return t||(t=s.add(e.toJSON())),t.set("thumb",e.get("thumb")),t.set("description",e.get("description")),t.set("thumbClass",e.get("thumbClass")),t},render:function(){var e=this;return this.$el.html(this.template()),this.$el.find(".tiles").append(this.collection.map(function(t,i){var s,a,o=e.getCorrectModel(t);return a=new n({model:o}),a.render(),a.$el.addClass("tile"),s=a.$el.find(".follow-button"),s.attr("data-track-id",t.id),s.attr("data-track-action",a.model.get("isFollowing")?"unfollow":"follow"),e.listenTo(a.model,"sync change",function(){s.attr("data-track-action",a.model.get("isFollowing")?"unfollow":"follow")}),2>i&&!o.isFollowing()&&e.broadcast("nyt:messaging-follow-tag",o.get("id")),a.el})),this}});return a}),define("shared/freetrial/views/free-trial-intro-tour",["foundation/views/base-view","shared/freetrial/templates"],function(e,t){"use strict";var i=e.extend({className:"free-trial-intro-tour",template:t.freeTrialIntroTour,render:function(){return this.$el.html(this.template()),this}});return i}),define("shared/freetrial/data/free-trial-newsletters",["foundation/hosts","underscore/nyt"],function(e,t){"use strict";var i=[{SUGGESTED_FOR_FREE_TRIAL:!0,SUBSCRIBED:0,PRODUCT_CODE:"NN",PRODUCT_NAME:"The NYT Now Morning Briefing",PRODUCT_STATUS:1,REGI_BLURB:"What you need to know to start your day, delivered to your inbox.",SAMPLE_LINK:"http://www.nytimes.com/pages/nytnow/nytnow-email/index.html",FREQUENCY_SCHEDULE:"(MONDAY - FRIDAY)",LARGE_IMAGE:"/ads/emailads/misc/subscriptionspage/NYT_Now_75.png"},{SUGGESTED_FOR_FREE_TRIAL:!0,SUBSCRIBED:0,PRODUCT_CODE:"UP",PRODUCT_NAME:"The Upshot",PRODUCT_STATUS:1,REGI_BLURB:"The best of The Upshotâ€™s news on politics, policy and everyday life.",SAMPLE_LINK:"http://www.nytimes.com/pages/upshot/upshot-email/index.html",FREQUENCY_SCHEDULE:"(WEEKLY)",LARGE_IMAGE:"/images/membercenter/icon_upshot.png"},{SUBSCRIBED:0,PRODUCT_CODE:"TY",PRODUCT_NAME:"Opinion Today",PRODUCT_STATUS:1,REGI_BLURB:"Thought-provoking commentary from our Op-Ed columnists and more.",SAMPLE_LINK:"http://www.nytimes.com/pages/opinion/opiniontodayemail/index.html",FREQUENCY_SCHEDULE:"(Monday - Friday)",LARGE_IMAGE:"/ads/emailads/misc/subscriptionspage/Opinion_Today_75.jpg"},{SUBSCRIBED:0,PRODUCT_CODE:"MA",PRODUCT_NAME:"The New York Times Magazine",PRODUCT_STATUS:1,REGI_BLURB:"The best of The New York Times Magazine.",SAMPLE_LINK:"http://www.nytimes.com/pages/magazine/magazine-email/index.html",FREQUENCY_SCHEDULE:"(WEEKLY)",LARGE_IMAGE:"/images/misc/nytmagazine/nytmag.jpg"},{SUBSCRIBED:0,PRODUCT_CODE:"LI",PRODUCT_NAME:"NYT Living",PRODUCT_STATUS:1,REGI_BLURB:"The latest lifestyle news and trends from the Style, Travel and Food sections.",SAMPLE_LINK:"http://www.nytimes.com/pages/nytliving/nytliving-email/index.html",FREQUENCY_SCHEDULE:"(TWICE A WEEK)",LARGE_IMAGE:"/ads/emailads/misc/subscriptionspage/NYT_Living_75.png"},{SUBSCRIBED:0,PRODUCT_CODE:"CK",PRODUCT_NAME:"Cooking",PRODUCT_STATUS:1,REGI_BLURB:"Recipe suggestions, cooking tips and shopping advice from NYT Cooking.",SAMPLE_LINK:"http://www.nytimes.com/pages/cooking/cooking-email/index.html",FREQUENCY_SCHEDULE:"(FIVE TIMES A WEEK)",LARGE_IMAGE:"/images/membercenter/200808/Cooking.png"}],n=e.staticHost;return t(i).map(function(e){return{code:e.PRODUCT_CODE,title:e.PRODUCT_NAME,description:e.REGI_BLURB,thumb:n+e.LARGE_IMAGE,subscribed:!!e.SUBSCRIBED,suggested:!!e.SUGGESTED_FOR_FREE_TRIAL,buttonText:["SIGN UP","SUBSCRIBED","UNSUBSCRIBE"],saveImmediately:!1}})}),define("shared/freetrial/data/free-trial-follows",["underscore/nyt","foundation/hosts"],function(e,t){"use strict";var i=[{following:"State of the Art",type:"column",tag:"column.state-of-the-art",description:"Farhad Manjoo on how technology is changing business and society.",thumb:t.staticHost+"/images/2014/02/11/technology/personaltech/farhad-manjoo-headshot/farhad-manjoo-headshot-thumbStandard-v2.jpg"},{following:"A Good Appetite",type:"column",tag:"column.a-good-appetite",description:"Melissa Clarkâ€™s weekly cooking column.",thumb:t.staticHost+"/images/2014/04/24/dining/clarkCP/clarkCP-thumbStandard-v2.jpg"},{following:"Frank Bruni",type:"columnist",tag:"column.frank-bruni",thumb:t.staticHost+"/images/2014/11/01/opinion/bruni-circular/bruni-circular-thumbStandard-v2.png",description:"Politics, social issues, education and culture."},{following:"Nicholas Kristof",type:"columnist",tag:"column.nicholas-kristof",thumb:t.staticHost+"/images/2014/11/01/opinion/kristof-circular/kristof-circular-thumbStandard-v2.png",description:"Human rights, womenâ€™s rights, health, global affairs."},{following:"Modern Love",type:"column",tag:"column.modern-love",description:"Reader-submitted essays that explore the joys and tribulations of love.",thumbClass:"icon-free-trial-modern-love-75x75-fullcolor"},{following:"36 Hours",type:"column",tag:"column.36-hours",description:"What to do when you've got 36 hours to get to know a city.",thumbClass:"icon-free-trial-36-hours-75x75-fullcolor"}];return e(i).map(function(e){return e.id=e.tag,e})}),define("shared/freetrial/models/free-trial-intro",["backbone/nyt","underscore/nyt","foundation/models/base-model","shared/freetrial/views/free-trial-intro-welcome","shared/freetrial/views/free-trial-intro-newsletters","shared/freetrial/views/free-trial-intro-follows","shared/freetrial/views/free-trial-intro-tour","shared/freetrial/collections/free-trial-intro-newsletters","shared/freetrial/collections/free-trial-intro-follows","shared/freetrial/data/free-trial-newsletters","shared/freetrial/data/free-trial-follows"],function(e,t,i,n,s,a,o,r,l,d,c){"use strict";var h=e.Model.extend({defaults:{currentStep:0,steps:[{viewClass:n},{viewClass:s,collection:new r(d),beforeLeaveStep:function(e){e.collection.forEach(function(e){e.save()})}},{viewClass:a,collection:new l(c)},{viewClass:o,buttonText:"Get Started"}]}});return h}),define("shared/freetrial/models/free-trial-task",["foundation/models/base-model","shared/freetrial/models/free-trial"],function(e,t){"use strict";var i=e.extend({isStepCompleted:function(){return t.isStepCompleted(this.get("id"))}});return i}),define("shared/freetrial/data/free-trial-tasks",[],function(){"use strict";return{"get-our-apps":{title:"Get Our Apps",description:"Your go-to apps for news on the go.",link:"http://www.nytimes.com/services/mobile/index.html?ft2pu=app-download"},crosswords:{title:"Crosswords",description:"How quickly can you solve our mini puzzle today?",link:"http://www.nytimes.com/crosswords/game/mini?ft2pu=mini-crossword",button:"Play"},"riveting-reads":{title:"Riveting Reads",description:"100 stories that captivated our readers last year.",link:"http://www.nytimes.com/interactive/2015/12/09/upshot/top-stories.html?ft2pu=riveting-reads"},"whats-cooking":{title:"Whatâ€™s Cooking",description:"Inspire your next meal with the latest recipes.",link:"http://cooking.nytimes.com/?ft2pu=cooking"},"where-to-go":{title:"Where to Go",description:"52 stunning places to visit in 2016.",link:"http://www.nytimes.com/interactive/2016/01/07/travel/places-to-visit.html?ft2pu=where-to-go"},timesmachine:{title:"TimesMachine",description:"Explore historic moments as they appeared in print, from 1851.",link:"http://timesmachine.nytimes.com/browser?ft2pu=timesmachine"}}}),define("shared/freetrial/collections/free-trial-tasks",["underscore/nyt","foundation/collections/base-collection","shared/freetrial/models/free-trial-task","shared/freetrial/models/free-trial","shared/freetrial/data/free-trial-tasks"],function(e,t,i,n,s){"use strict";var a=t.extend({model:i,initialize:function(e){this.options=e,this.fillTasks()},comparator:function(e){return e.isStepCompleted()},fillTasks:function(){var e,t,i=this;for(t in s)s.hasOwnProperty(t)&&(e=s[t],e.id=t,i.add(e));this.sort(),this.subscribe("nyt:free-trial-status-updated",this.sort),this.broadcast("nyt:free-trial-tasks-received",i.models)},getCompletedTasks:function(){var t=[];return e.each(this.models,function(e){n.isStepCompleted(e.get("id"))&&t.push(e)}),t},getRemainingTasks:function(){return this.length-this.getCompletedTasks().length}});return new a}),define("shared/freetrial/views/free-trial-band",["underscore/nyt","foundation/views/base-view","foundation/hosts","shared/freetrial/templates","shared/freetrial/collections/free-trial-tasks","shared/freetrial/models/free-trial","shared/freetrial/models/free-trial-storage"],function(e,t,i,n,s,a,o){"use strict";var r=t.extend({className:"free-trial-band",events:{"click .toggle-tasks":"handleTogglePanel"},initialize:function(t){e.bindAll(this,"updateRemainingTasks"),this.options={showDiscoveries:!0,showRemainingTasks:!1,showToggleLink:!1,isPanelCollapsed:!1,imageHost:i.staticHost,showDaysLeft:!1,daysLeft:0,showLimitedOffer:!1,remainingTasks:0,totalTasks:0},this.options=e.extend({},this.options,t),this.options.showRemainingTasks&&this.subscribe("nyt:free-trial-step-completed",this.updateRemainingTasks)},render:function(){return this.$el.html(n.freeTrialBand(this.options)),this.options.daysLeft<=5&&this.$el.addClass("alert"),(this.options.showDaysLeft||this.options.showRemainingTasks||this.options.showLimitedOffer)&&this.$el.addClass("logo-separator"),this.options.showToggleLink&&this.options.isPanelCollapsed&&this.toggleLink(),this.updateRemainingTasks(),this},updateRemainingTasks:function(){var e=this.$el.find(".remaining-tasks"),t=this.$el.find(".total-tasks");e.length&&this.options.showRemainingTasks&&(e.text(this.options.remainingTasks),t.text(this.options.totalTasks))},toggleLink:function(){var e=this.$el.find(".toggle-tasks"),t=this.options.showLimitedOffer?"postCollapsed":"tasksCollapsed";e.toggleClass("collapsed"),e.hasClass("collapsed")?o.set(t,!0):o.set(t,!1)},handleTogglePanel:function(e){this.toggleLink(),this.broadcast("nyt:free-trial-toggle-click"),e.preventDefault()}});return r}),define("shared/freetrial/views/free-trial-intro",["jquery/nyt","underscore/nyt","foundation/hosts","foundation/views/base-view","shared/freetrial/templates","shared/freetrial/models/free-trial-intro","shared/freetrial/models/free-trial","shared/freetrial/views/free-trial-band"],function(e,t,i,n,s,a,o,r){"use strict";var l=n.extend({className:"free-trial-intro",template:s.freeTrialIntro,model:new a,events:{"click .next-button":"onClickNext","click .skip-button":"onClickSkip","click .dot":"onClickDot"},initialize:function(){this.listenTo(this.model,"sync change",this.render),this.band=new r,this.band.render(),this.broadcast("nyt:free-trial-complete-step","intro"),this.addUserToWhitelist()},addUserToWhitelist:function(){e.ajax({url:i.followApiHost+"/svc/pushmobile/follow/v0/follow.whitelist.json",method:"POST"})},onClickNext:function(){this.setStep(this.model.get("currentStep")+1)},onClickSkip:function(){this.finishLastStep()},onClickDot:function(t){this.setStep(e(t.currentTarget).data("step"))},setStep:function(e){e>=this.model.get("steps").length?(this.beforeLeaveStep(),this.finishLastStep()):(e=Math.max(0,Math.min(this.model.get("steps").length-1,e)),this.model.get("currentStep")!==e&&(this.beforeLeaveStep(),this.model.set("currentStep",e),this.afterEnterStep()))},finishLastStep:function(){this.broadcast("nyt:free-trial-intro-finished")},beforeLeaveStep:function(){var e=this.model.get("steps")[this.model.get("currentStep")];"function"==typeof e.beforeLeaveStep&&e.beforeLeaveStep(this.currentSubview)},afterEnterStep:function(){var e=this.model.get("steps")[this.model.get("currentStep")];"function"==typeof e.afterEnterStep&&e.afterEnterStep(this.currentSubview)},render:function(){var e,t,i,n;return this.$el.html(this.template(this.model.toJSON())),this.$el.find(".modal-panel").prepend(this.band.el),e=this.model.get("steps")[this.model.get("currentStep")],t={},e.model&&(t.model=e.model),e.collection&&(t.collection=e.collection),e.buttonText&&this.$el.find(".next-button").text(e.buttonText),n=e.viewClass,i=new n(t),i.render().$el.addClass("step"),this.$el.find(".step-container").append(i.render().el),this.currentSubview=i,this}});return l}),define("shared/freetrial/views/free-trial-task",["underscore/nyt","foundation/views/base-view","shared/freetrial/templates"],function(e,t,i){"use strict";var n=t.extend({tagName:"li",className:"task-item",events:{"click .button":"startTaskAction"},initialize:function(){e.bindAll(this,"startTaskAction","handleStepCompleted"),this.subscribe("nyt:free-trial-step-completed-"+this.model.get("id"),this.handleStepCompleted)},render:function(){var t=e.extend({},{button:"Go"},this.model.toJSON());return this.$el.append(i.freeTrialTask(t)),this.setCompleted(),this},setCompleted:function(){this.model.isStepCompleted()&&this.$el.find(".button").addClass("completed").text("Completed")},handleStepCompleted:function(){this.setCompleted(),this.performAction()},performAction:function(){window.location=this.$el.find("a.button").attr("href")},startTaskAction:function(e){this.model.isStepCompleted()?this.performAction():this.broadcast("nyt:free-trial-complete-step",this.model.get("id")),e.preventDefault()}});return n}),define("shared/freetrial/views/free-trial-tasks",["foundation/views/base-view","shared/freetrial/templates","shared/freetrial/views/free-trial-task","shared/freetrial/models/free-trial","shared/freetrial/models/free-trial-storage","shared/freetrial/collections/free-trial-tasks","shared/freetrial/views/free-trial-band"],function(e,t,i,n,s,a,o){"use strict";var r=e.extend({className:"free-trial-tasks",nytEvents:{"nyt:free-trial-toggle-click":"togglePanel","nyt:free-trial-tasks-received":"addLoadedTasks"},events:{"click .scroll-left":"scrollLeft","click .scroll-right":"scrollRight"},initialize:function(){var e=!n.isVariation1();this.position=0,this.collection=a,this.remainingTasks=a.getRemainingTasks(),this.totalTasks=a.length,this.isTasksCollapsed=!e||n.getPassedDays()>7||s.get("tasksCollapsed")||this.remainingTasks<=0,this.daysLeft=n.getRemainingDays(),this.band=new o({showDiscoveries:e,isPanelCollapsed:this.isTasksCollapsed,showRemainingTasks:e&&this.daysLeft>5&&this.remainingTasks>0,showToggleLink:e,showDaysLeft:this.daysLeft<=5,daysLeft:this.daysLeft,remainingTasks:this.remainingTasks,totalTasks:this.totalTasks})},render:function(){return this.$el.html(t.freeTrialStaticPanel()),this.$el.prepend(this.band.render().$el),this.collection.length&&this.addLoadedTasks(this.collection.models),this.isTasksCollapsed&&this.$el.find(".tasks-list").hide(),this},setPosition:function(e){this.position=e},getScrollContainer:function(){return this.scrollContainer||(this.scrollContainer=this.$el.find(".scroll-container")),this.scrollContainer},getScrollElement:function(){return this.scrollElement||(this.scrollElement=this.$el.find(".scroll-container ul")),this.scrollElement},detectScrollStep:function(){return this.$el.find(".scroll-container ul li:nth-child(1)").outerWidth()},getAmountOfElements:function(){return this.collection.length},getDisplayAmountOfElements:function(){return Math.round(this.getScrollContainer().outerWidth()/this.detectScrollStep())},scrollLeft:function(e){this.scroll(1,1),e.preventDefault()},scrollRight:function(e){this.scroll(-1,1),e.preventDefault()},scroll:function(e,t){var i=this.getScrollElement(),n=this.detectScrollStep(),s=this.getAmountOfElements(),a=this.getDisplayAmountOfElements(),o=this.$el.find(".scroll-left"),r=this.$el.find(".scroll-right"),l=this.position-e*t;return 0>l||l>s-a?!1:(this.setPosition(l),i.animate({left:"+="+e*t*n},500),o.toggleClass("disabled",0===this.position),r.toggleClass("disabled",this.position===s-a),!0)},togglePanel:function(){this.broadcast("nyt:masthead-update-offset"),this.$el.find(".tasks-list").animate({height:"toggle"},500)},addLoadedTasks:function(e){var t,n,s,a=this.$el.find(".scroll-container ul");for(n=0;n<e.length;n+=1)t=e[n],s=new i({model:t}),a.append(s.render().$el)}});return r}),define("shared/freetrial/views/free-trial-post",["foundation/views/base-view","foundation/hosts","shared/freetrial/templates","shared/freetrial/data/free-trial-config","shared/freetrial/models/free-trial-storage","shared/freetrial/models/free-trial","shared/freetrial/views/free-trial-band"],function(e,t,i,n,s,a,o){"use strict";var r=e.extend({className:"free-trial-post",template:i.freeTrialPost,nytEvents:{"nyt:free-trial-toggle-click":"togglePanel"},initialize:function(){this.isPanelCollapsed=s.get("postCollapsed"),this.band=new o({showLimitedOffer:!0,showToggleLink:!0,isPanelCollapsed:this.isPanelCollapsed})},makeTakeUpsellUrl:function(){var e=t.myaccount+"/get-started?OC="+encodeURIComponent(n.offerChainIDs.postTrialUpsell)+"&return_url="+encodeURIComponent(window.location.href)+"&ftv="+encodeURIComponent(a.getVariation());return a.isVariation1()&&(e+="&campaignId="+encodeURIComponent(n.campaignIDs.postTrialUpsell.v1)),a.isVariation2()&&(e+="&campaignId="+encodeURIComponent(n.campaignIDs.postTrialUpsell.v2)),e},render:function(){var e=n.postTrialOffer;return this.$el.append(this.band.render().$el),this.$el.append(this.template({takeUpsellUrl:this.makeTakeUpsellUrl(),weeks:e.weeks,price:e.price})),a.ensureCountryCode(function(t){t&&e.localizedPrice&&e.localizedPrice[t]&&this.$el.find(".free-trial-upsell-price").html(e.localizedPrice[t])}.bind(this)),this.isPanelCollapsed&&this.$el.find(".post-container").hide(),this},togglePanel:function(){this.broadcast("nyt:masthead-update-offset"),this.$el.find(".post-container").animate({height:"toggle"},500)}});return r}),define("shared/freetrial/views/free-trial-upsell",["foundation/views/base-view","foundation/hosts","shared/freetrial/templates","shared/freetrial/data/free-trial-config","shared/freetrial/models/free-trial"],function(e,t,i,n,s){"use strict";var a=e.extend({className:"free-trial-upsell",template:i.freeTrialUpsell,events:{"click .close":"close","click .button-cancel":"close"},initialize:function(){this.broadcast("nyt:free-trial-complete-step","in-trial-upsell")},close:function(e){e.preventDefault(),this.broadcast("nyt:free-trial-refresh")},makeTakeUpsellUrl:function(){var e=t.myaccount+"/get-started?OC="+encodeURIComponent(n.offerChainIDs.inTrialUpsell)+"&return_url="+encodeURIComponent(window.location.href)+"&ftv="+encodeURIComponent(s.getVariation());return s.isVariation1()&&(e+="&campaignId="+encodeURIComponent(n.campaignIDs.inTrialUpsell.v1)),s.isVariation2()&&(e+="&campaignId="+encodeURIComponent(n.campaignIDs.inTrialUpsell.v2)),e},render:function(){var e=n.inTrialOffer;return this.$el.html(this.template({takeUpsellUrl:this.makeTakeUpsellUrl(),weeks:e.weeks,
price:e.price})),s.ensureCountryCode(function(t){t&&e.localizedPrice&&e.localizedPrice[t]&&this.$el.find(".free-trial-upsell-price").html(e.localizedPrice[t])}.bind(this)),this}});return a}),define("shared/freetrial/views/free-trial",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/freetrial/tracking/tracking","shared/freetrial/templates","shared/freetrial/data/free-trial-config","shared/freetrial/models/free-trial","shared/freetrial/models/free-trial-storage","shared/freetrial/views/free-trial-intro","shared/freetrial/views/free-trial-tasks","shared/freetrial/views/free-trial-post","shared/freetrial/views/free-trial-upsell"],function(e,t,i,n,s,a,o,r,l,d,c,h,u){"use strict";var m=i.extend({el:"body",nytEvents:{"nyt:free-trial-refresh":"refreshPanel","nyt:free-trial-intro-finished":"refreshPanel"},initialize:function(){t.bindAll(this,"refreshPanel")},handleUserReady:function(){this.flag("freeTrial")&&n.hasEntitlement("FTEX")&&(this.removeRibbonIfExists(),this.unpinMasthead(),this.model=r,this.model.fetch(),this.model.isSynced?this.render():this.listenTo(this.model,"sync",this.render))},render:function(){return r.isFreeTrialUser()?(this.$el.prepend(this.getRenderedStep()),this.setTracking(),this.broadcast("nyt:masthead-update-offset"),this):this},setTracking:function(){this.trackingObj&&(this.trackingObj.undelegateEvents(),this.trackingObj.remove()),this.trackingObj=new s},refreshPanel:function(){this.$el.find("#free-trial").replaceWith(this.getRenderedStep()),this.setTracking(),this.broadcast("nyt:masthead-update-offset")},getRenderedStep:function(){var t=this.model.toJSON(),i=e(a.freeTrial(t)),n=this.getCurrentStep();return null!==n?(this.pageManager.$html.addClass("has-free-trial"),i.append(n.render().$el),this.handleImpression(i)):this.pageManager.$html.removeClass("has-free-trial"),i},getCurrentStep:function(){var e=this.model.getPassedDays(),t=this.model.isUpsellTaken(),i=this.model.isInTrialUpsellStepCompleted(),n=this.model.isIntroStepCompleted(),s=this.pageManager.getCurrentBreakpoint()>=1031,a=!!l.get("postClose");return e>o.postTrialUpsellPeriod.endDay?null:e>=o.postTrialUpsellPeriod.startDay?a||t?null:new h:e>=o.inTrialUpsellPeriod.startDay&&e<=o.inTrialUpsellPeriod.endDay&&!i&&!t?new u:!n&&s?new d:new c},removeRibbonIfExists:function(){e("#ribbon").remove()},handleImpression:function(e){this.trackingTriggerImpression("free-trial-intro-load",{module:"FreeTrial",region:"FixedTop",action:"Impression",eventName:"Impression",contentCollection:e.find(">:first-child").attr("class"),mediaId:e.data("variation"),priority:!0})},unpinMasthead:function(){this.broadcast("nyt:in-content-theme-deactivate-pinned-masthead")}});return m}),define("homepage/instances/masthead",["jquery/nyt","underscore/nyt","shared/masthead/views/search","shared/masthead/views/user-settings-modal","shared/masthead/views/user-name-modal","homepage/views/masthead/masthead","homepage/views/masthead/in-content-theme","homepage/views/masthead/weather-preview","homepage/views/masthead/markets-ticker","shared/freetrial/views/free-trial"],function(e,t,i,n,s,a,o,r,l,d){"use strict";new a,new i,new o,new n({showTypeSizer:!1,fixedOverride:!1,tailLeftOffset:-5,openCallback:function(){this.$target.addClass("active"),this.subscribeOnce("nyt:masthead-hidden",this.close)}}),new s({fixedOverride:!1,openCallback:function(){this.$target.addClass("active"),this.subscribeOnce("nyt:masthead-hidden",this.close)}}),new r,new l,new d}),define("shared/messaging/views/messenger-format-mixin",["underscore/nyt"],function(e){"use strict";var t={emphasizeTitle:function(t,i){var n,s,a,o,r,l,d,c=[],h=[],u=0,m=t.length;if(!i||0===i.length)return t;for(s=e.sortBy(i,function(e){return e.offset});s.length>0;){if(o=s.shift(),r=o.offset+o.count,l=o.offset,u>l||r>m)return t;l===u&&c.length>0?(a=c.pop(),a+=t.slice(l,r),c.push(a),u=r):(l>u&&c.push(t.slice(u,l)),c.push(t.slice(l,r)),d={index:c.length-1,treatment:o.treatment,url:o.url},h.push(d),u=r),0===s.length&&u!==m&&c.push(t.slice(r))}return e.each(h,function(e){var t=e.index,i=e.treatment;e.url?c[t]='<a class="link action-link" href="'+e.url+'""><span class="'+i+'">'+c[t]+"</span></a>":c[t]='<span class="'+i+'">'+c[t]+"</span>"}),n=c.join("")}};return t}),define("shared/messaging/views/message",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/templates","shared/messaging/views/messenger-format-mixin"],function(e,t,i,n,s){"use strict";var a=i.registerView("messaging").extend({className:"message-container hidden",events:{"click .close-message":"dismissed","click .action-button":"acknowledged","click .action-link":"acknowledged"},defaults:{closeButton:!0,dismissAcknowledged:!0,hiddenClass:"hidden",revealClass:"",show:function(){this.$el.removeClass(this.settings.hiddenClass).addClass(this.settings.revealClass)},hide:function(){this.$el.removeClass(this.settings.revealClass).addClass(this.settings.hiddenClass)}},initialize:function(e){this.settings=t.extend({},this.defaults,e),this.template=n[this.settings.template],this.subscribe("nyt:messaging-modal-"+this.model.id+"-dismissed",this.popupDismissed),this.subscribe("nyt:messaging-modal-"+this.model.id+"-acknowledged",this.popupAcknowledged),this.subscribe(this,"nyt:messaging-message-expired",this.expired)},render:function(){var e=this;return this.$el.html(e.template(t.extend(e.model.toJSON(),e.settings,{formattedTitle:this.getFormattedTitle(),unfollowThreshold:this.pageManager.flag("unfollowComments")?5:6}))).addClass(this.settings.hiddenClass).data("id",e.model.get("id")),!e.model.get("links")||e.model.isNotificationsPanelMessage()||e.pageManager.flag("allTheEmphases")||this.insertLinks(),e.model.get("unread")?e.$el.find(".message").addClass("is-unread"):e.$el.find(".message").addClass("is-read no-transition"),this},replaceBetween:function(e,t,i,n){return n.substring(0,e)+i+n.substring(t)},insertLinks:function(){var e,t,i,n,s,a,o,r=this.$el.find(".message-title"),l=r.html(),d=this.model.get("links");for(d.length>1&&d.sort(function(e,t){return t.start-e.start}),o=0;o<d.length;o++)if(e=d[o].offset,i=d[o].count,n=decodeURI(d[o].url),e+i&&(t=e+i),n&&"null"!==n)if("undefined"!=typeof e&&"undefined"!=typeof t){if(d[o-1]&&t>d[o-1].start)break;s=l.substring(e,t),a='<a class="action-link" href="'+n+'">'+s+"</a>",l=this.replaceBetween(e,t,a,l)}else l='<a class="action-link" href="'+n+'">'+l+"</a>";r.html(l)},getFormattedTitle:function(){var e=this.model.getCombinedEmphasis(),t=this.model.get("title"),i=s.emphasizeTitle(t,e),n=this.model.get("links")[0];return this.pageManager.flag("allTheEmphases")?this.model.isNotificationsPanelMessage()||!n||n.count?i:'<a class="action-link" href="'+n.url+'" >'+i+"</a>":this.model.isNotificationsPanelMessage()?i:t},reveal:function(e){e?this.settings.show.call(this):this.settings.hide.call(this)},dimensions:function(){return{width:this.$el.outerWidth(),height:this.$el.outerHeight()}},displayed:function(e){e=e||0,this.markRead(e),this.model.displayed()},markRead:function(e){var t=this.$el.find(".message"),i=this;e=void 0!==e?e:1500,t.hasClass("is-unread")&&window.setTimeout(function(){i.model.isNotificationsPanelMessage()&&i.broadcast("nyt:messaging-count-received",-1),t.removeClass("is-unread").addClass("is-read")},e)},showOnce:function(){this.model.showOnce()},acknowledged:function(t){var i=e(t.currentTarget).attr("href");t.preventDefault(),this.settings.dismissAcknowledged&&this.model.acknowledged(),this.local(this,"nyt:messaging-message-view-acknowledged",this),i=this.trackingAppendParams(i,{action:"Click",contentCollection:this.model.get("sub_type")||"",contentID:this.model.get("id")}),i!==window.location.href?window.location.href=i:window.location.reload()},expired:function(){this.model.expired(),this.local(this,"nyt:messaging-message-view-expired",this)},dismissed:function(e){this.model.dismissed(),this.local(this,"nyt:messaging-message-view-dismissed",this),e.preventDefault()},popupDismissed:function(){this.model.setRead(),this.markRead(0)},popupAcknowledged:function(){this.model.setRead(),this.markRead()}});return a}),define("shared/messaging/models/message",["backbone/nyt","underscore/nyt","foundation/models/base-model","foundation/models/page-storage"],function(e,t,i,n){"use strict";var s=i.extend({defaults:{display_type_id:1,id:"",title:"",status:"new",sub_type:"",label:"",pub_date:"",start_time:"",end_time:"",links:[],buttons:[],payload:{},message_type:"",thumb:!1,comment_body:!1,timestamp:!1,location:"",unread:!0,version:1,customMarkup:null,isDummy:!1},initialize:function(){var e,t=this.get("display_type_id"),i=this.get("start_time"),n=this.get("version"),s=5===t,a=this.getPrimaryLink();s&&n>1?(e=this.get("last_modified"),this.set("timestamp",e)):this.set("timestamp",i),this.isNotificationsPanelMessage()&&this.set({unfollowText:s?"Stop receiving":"Unfollow",confirmText:s?"Turn off":"Unfollow",abortText:s?"Cancel":"Keep following",confirmedText:s?"You will no longer receive":"You are no longer following"}),s&&this.set({following:"comment notifications",tag:"follow.comment-notifications"}),this.isNotificationsPanelMessage()&&void 0===this.get("popup_unread")&&this.set("popup_unread",!0),a&&this.set("link",a)},showOnce:function(){this.setRead(),this.saveToLocalStorage()},setStatus:function(e){this.set("status",e)},displayed:function(){this.set("unread",!1),this.set("status","displayed")},acknowledged:function(){this.set("unread",!1),this.set("status","acknowledged"),this.saveToLocalStorage()},expired:function(){this.set("unread",!1),this.set("status","expired"),this.saveToLocalStorage()},dismissed:function(){this.set("unread",!1),this.set("status","dismissed"),this.saveToLocalStorage()},getPrimaryLink:function(){var e=this.get("links");return e&&e[0]&&e[0].url?e[0].url:null},applyMetadata:function(e){var t,i,n;e&&(i=e[0],n=e[2],this.set("version",i),this.set("unread",n),e.length>3&&(t=e[3],this.set("popup_unread",t)))},updateProperties:function(e){var t,i,n,s,a=["byline","comment_body","display_name","display_location","emphasis","end_time","following","headline","last_modified","links","sub_type","tag","thumb","timestamp","title","link"];if(e)for(t=0;t<a.length;t+=1)s=a[t],i=this.get(s),n=e.get(s),i!==n&&this.set(s,n)},getCombinedEmphasis:function(){var e,i,n,s,a,o=[],r={},l=this.get("emphasis"),d=this.get("links");if(l&&l.length>0&&void 0!==l[0].offset&&l[0].count&&(r.emphasize=l),d&&d.length>0&&void 0!==d[0].offset&&d[0].count&&(r["link-text"]=d),t.isEmpty(r))return!1;for(e in r)if(n=r[e],n&&n.length>0)for(i=0;i<n.length;i+=1)a=this.isNotificationsPanelMessage()?t.omit(n[i],"url"):n[i],s=t.extend({treatment:e},a),o.push(s);return o},setRead:function(){this.set("unread",!1),this.broadcast("nyt:messaging-message-state-update",this)},setPopupRead:function(){this.set("popup_unread",!1),this.broadcast("nyt:messaging-message-state-update",this)},saveToLocalStorage:function(){var e,t,i,s,a;this.isNotificationsPanelMessage()||this.get("isDummy")||(e=this.get("id"),t=this.get("version"),i=(new Date).getTime(),s=n.get("messaging"),a=s?s+","+e:e,t&&(a=a+"-"+t+"-"+i),n.set("messaging",a))},isNotificationsPanelMessage:function(){return this.get("display_type_id")>=5}});return s}),define("shared/messaging/collections/messages",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/websockets-transport","shared/messaging/models/message","foundation/hosts","foundation/cookies","foundation/models/page-storage"],function(e,t,i,n,s,a,o,r,l){"use strict";var d=n.extend({model:a,url:o.messagingHost+"/svc/message/v1/list/global.json",pageStorageKey:"messaging",defaultSettings:{webSockets:!0,longPoll:!1,fauxLongPoll:!1,interval:10,cachePullDelay:5},initialize:function(e){this.cleanLocalStorage(),this.settings=t.extend({},this.defaultSettings,e),t.bindAll(this,"fetch","fetchSuccess","handleSave","stopSaving"),this.received={},this.serverSaveQueue=[],this.statusFragments={},this.beingProcessed=!1,this.followStarts={},this.lastReceived=!1,this.cachePullOver=!1,this.pageManager.isDomReady()?this.prepareToConnect():this.subscribe(this.pageManager,"nyt:page-ready",this.prepareToConnect),this.subscribe(this,"change:status",this.saveMessageEverywhere),this.subscribe("nyt:messaging-message-state-update",this.saveMessageEverywhere),this.storageKey="nyt:ab-tests",this.testName="velcroSocialFollow",this.shouldPromptForFacebookLike()&&this.addFacebookSdk(function(e){var t=this;this.subscribe(this,"change:status",this.handleVelcroDismissed),setTimeout(function(){t.addSocialFollowSuggest(e)},1e3)})},prepareToConnect:function(){this.initWebSockets()},initWebSockets:function(){var t=r.readCookie("NYT-S")||"";s.registerClient({name:"messaging",collection:this,fabrikApp:"hermes.push",cookies:{"nyt-s":t},handleMessage:this.handleMessage,notifyOnError:e.noop,handleFailover:this.switchToHTTP})},makeHTTPRequest:function(){var e=this;this.url=o.messagingHost+"/svc/message/v1/list/global.json",this.fetch({success:function(t,i){e.fetchSuccess(t,i)},error:function(){}})},switchToHTTP:function(e){e.settings.fauxLongPoll=!0,e.settings.webSockets=!1,e.stopSaving(),e.makeHTTPRequest()},sync:function(e,t,n){return this.settings.longPoll?(n.timeout=2e3,i.sync(e,t,n)):(n.cache=!1,i.sync(e,t,n))},parse:function(e){return e&&e.results?e.results.messages:void 0},handleMessage:function(e,t){var i;t.websocketConnected||t.handleSave(),e.body&&(i=JSON.parse(e.body),t.fetchSuccess(t,i))},fetchSuccess:function(e,i){var n,s,a,o,r,l,d={},c=e||this;if(i&&!t.isArray(i)&&(i=[i]),i)for(n=0,s=i.length;s>n;n+=1)l=this.preprocessMessage(i[n]),l&&(a=l.get("id"),o=l.get("title"),c.add(l),r=this.categorizeMessage(l),d[r]=d[r]||[],this.received[a]=o,d[r].push(l));if(t.isEmpty(d))return!1;for(r in d)c.trigger(r,d[r]);this.settings.fauxLongPoll&&window.setTimeout(function(){c.makeHTTPRequest()},1e3*c.settings.interval)},preprocessMessage:function(e){var t;return this.cachePullOver||this.checkCachePullEnd(),this.interceptFollows(e)&&this.ensureMessageID(e)&&this.interceptFragments(e)&&this.ensureUniqueTitles(e)&&(t=this.handleUpdateableData(e))?this.ensureActive(t):!1},interceptFollows:function(e){return e.follows?(t.isEmpty(this.followStarts)&&(this.followStarts=e.follows),this.broadcast("nyt:messaging-follow-data-received",e.follows),!1):e},ensureMessageID:function(e){return e.id||e.messageId?e:!1},interceptFragments:function(e){return e.title?e:(this.isExpired(e)||this.updateMessageData(e.messageId,this.extractMessageMetadata(e)),!1)},ensureUniqueTitles:function(e){return 5!==e.display_type_id&&this.titleExists(e.title)?!1:e},handleUpdateableData:function(e){var t,i,n;if(this.statusFragments[e.id]?(t=this.statusFragments[e.id],delete this.statusFragments[e.id]):this.get(e.id)&&(t=this.extractMessageMetadata(this.get(e.id))),t){if(i=this.extractMessageMetadata(e),n=this.unionOfState(t,i),n.toString()===t.toString()&&this.get(e.id))return!1;if(e=new a(e),this.get(e.id))return this.updateMessageData(e.id,n,e),!1;e.applyMetadata(n)}return e=e.get?e:new a(e)},ensureActive:function(e){return this.isExpired(e)||this.isInactive(e)||this.isInLocalStorage(e)||this.isBeforeSubscribed(e)?!1:e},categorizeMessage:function(e){var t,i=e.get("display_type_id");switch(i){case 1:e.get("label")||e.set("label","Breaking News"),t="nyt:messaging-breaking-news-received";break;case 2:e.get("label")||e.set("label","Account Alert"),t="nyt:messaging-account-alert-received";break;case 3:e.get("label")||e.set("label","Live Video"),t="nyt:messaging-video-received";break;case 4:t="nyt:messaging-velcro-received";break;case 5:t="nyt:messaging-notification-received";break;case 6:t="nyt:messaging-follow-notice-received";break;default:t="nyt:messaging-message-received"}return t},isExpired:function(e){var t,i=e.get?e.get("end_time"):e.end_time,n=(new Date).getTime();return i?(t=new Date(1e3*i).getTime(),n>t):void 0},titleExists:function(i){var n=t.values(this.received);return e.inArray(i,n)>-1},isInactive:function(e){return e&&e.get?!e.get("unread")&&!e.isNotificationsPanelMessage():!0},isBeforeSubscribed:function(e){var t,i=e.get("tag");return(this.pageManager.flag("unfollowComments")||5!==e.get("display_type_id"))&&e.isNotificationsPanelMessage()?(i&&(t=this.followStarts[i]),t&&t.start?t.start>e.get("start_time"):!0):!1},handleSave:function(){var e;for(this.websocketConnected=!0;this.serverSaveQueue.length>0;)e=this.serverSaveQueue.shift(),this.saveMessageToFabrik(e)},stopSaving:function(){this.websocketConnected=!1},unionOfState:function(e,t){var i,n,s=e[1],a=e[0]>t[0]?e[0]:t[0],o=e[2]&&t[2];return e.length>3&&(n=e[3]&&t[3]),e[0]!==t[0]&&5===s&&(o=!0),i=[a,s,o],void 0!==n&&i.push(n),i},updateMessageData:function(e,t,i){var n,s,a=this.get(e)?this.extractMessageMetadata(this.get(e)):this.statusFragments[e];return a?(s=this.unionOfState(t,a),void(s.toString()!==a.toString()&&(this.get(e)?(n={id:e,update:s,message:i},this.broadcast("nyt:messaging-existing-message-update",n)):this.statusFragments[e]=s))):void(this.statusFragments[e]=t)},isInLocalStorage:function(i){var n=[],s=[],a=l.get(this.pageStorageKey),o=i.get("id").toString();return a?(n=a.split(","),s=t.map(n,function(e){return e.split("-")[0]}),e.inArray(o,s)>-1):!1},cleanLocalStorage:function(){var e,t,i,n,s,a,o,r=l.get(this.pageStorageKey);if(r)for(e=r.split(","),i=0;i<e.length;i++)t=e[i],n=t.split("-")[2],s=(new Date).getTime(),n&&(a=(s-n)/1e3,o=Math.floor(a/86400),o>7&&this.deleteInLocalStorage(t))},deleteInLocalStorage:function(e){var t=l.get(this.pageStorageKey),i=new RegExp(e+",?"),n=t.replace(i,"");l.set(this.pageStorageKey,n)},saveMessageEverywhere:function(e){e&&(this.websocketConnected?this.saveMessageToFabrik(e):this.serverSaveQueue.push(e))},saveMessageToFabrik:function(e){var t,i=e.get("popup_unread"),n=e.get("display_type_id"),a=6===n;(this.allowedToSend(e)||!this.pageManager.flag("limitFabrikSave"))&&(t={status:e.get("status"),messageId:e.get("id"),version:e.get("version")||1,date:(new Date).getTime(),start_time:e.get("start_time"),end_time:e.get("end_time"),display_type_id:n,unread:e.get("unread")},a&&(t.tag=e.get("tag")),void 0!==i&&(t.popup_unread=i),this.settings.webSockets&&s.publish({action:"send",client_app:"hermes.push",message:t}))},extractMessageMetadata:function(e){var t,i=e.version||e.get("version")||1,n=e.display_type_id||e.get("display_type_id"),s=e.get?e.get("unread"):e.unread,a=e.get?e.get("popup_unread"):e.popup_unread;return void 0===s&&(s=!0),t=[i,n,s],void 0!==a&&t.push(a),t},allowedToSend:function(e){var t=e.get("display_type_id");return e.get("isDummy")?!1:4===t||5===t||6===t?!0:!1},checkCachePullEnd:function(){var e=(new Date).getTime();this.lastReceived||(this.lastReceived=e),e-this.lastReceived>1e3*this.settings.cachePullDelay?(this.cachePullOver=!0,this.broadcast("nyt:messaging-cache-pull-over",e)):this.lastReceived=e},shouldPromptForFacebookLike:function(){var e,t;return this.pageManager.flag(this.testName)&&"1"===this.isUserVariant(this.testName)?"global"===this.pageManager.getEdition()&&"homepage"===this.pageManager.getApplicationName()?!1:(t=l.get(this.storageKey)||{},t[this.testName]&&t[this.testName].dismissed?!1:(e=this.getSessionStorage(this.storageKey),e[this.testName]&&e[this.testName].displayCount>=3?!1:!0)):!1},getSessionStorage:function(e){var t=window.sessionStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(i){}return{}},setSessionStorage:function(e,t){window.sessionStorage.setItem(e,JSON.stringify(t))},addFacebookSdk:function(e){var t,i=this,n="facebook-jssdk",s=document.getElementsByTagName("script")[0];document.getElementById(n)||(t=document.createElement("script"),t.id=n,t.src="//connect.facebook.net/en_US/sdk.js",s.parentNode.insertBefore(t,s),window.fbAsyncInit=function(){window.FB.init({appId:"9869919170",xfbml:!0,version:"v2.3"}),window.FB.getLoginStatus(function(t){var n="connected"===t.status||"not_authorized"===t.status;e&&e.call(i,n)}),window.FB.Event.subscribe("edge.create",function(){i.handleLikeButtonClicked(!0)}),window.FB.Event.subscribe("edge.remove",function(){i.handleLikeButtonClicked(!1)})})},addSocialFollowSuggest:function(e){var i=this,n=e?410:245,s=Math.floor((new Date).getTime()/1e3);t.bind(this.handleVelcroRendered,this),this.subscribe("nyt:messaging-velcro-rendered",this.handleVelcroRendered),this.fetchSuccess(this,{isDummy:!0,display_type_id:4,customMarkup:"<span class='fb-like' data-href='https://www.facebook.com/nytimes' data-layout='standard' data-width='"+n+"' data-action='like' data-show-faces='false' data-share='false'></span>",title:"The New York Times on Facebook â€” a hub for conversation about news and ideas.",emphasis:[{offset:0,count:18,text:"The New York Times"}],sub_type:"FacebookSuggestion",status:"new",version:1,id:this.testName,start_time:s,end_time:s+3600,closeButtonPreference:!0}),this.subscribeOnce("nyt:messaging-message-suggestions-hidden",function(){i.adjustSessionDisplayCount(!1)})},handleVelcroRendered:function(e){var t=e.model.get("id"),i=e.$el.find(".message-extra");if(t===this.testName&&i.length){try{window.FB.XFBML.parse(i[0])}catch(n){}this.adjustSessionDisplayCount(!0)}},adjustSessionDisplayCount:function(e){var t,i;t=this.getSessionStorage(this.storageKey),i=t[this.testName]||{},i.displayCount=i.displayCount||0,e?i.displayCount+=1:i.displayCount=Math.max(0,i.displayCount-=1),t[this.testName]=i,this.setSessionStorage(this.storageKey,t)},handleLikeButtonClicked:function(e){var t=this.get(this.testName);t&&(this.setTestComplete(),this.broadcast("nyt:messaging-velcroSocialFollow-like-button-clicked",{model:t,wasLiked:e}))},handleVelcroDismissed:function(e){e.get("id")===this.testName&&"dismissed"===e.get("status")&&this.setTestComplete()},setTestComplete:function(){var e=l.get(this.storageKey)||{};e[this.testName]={dismissed:!0,date:Math.floor((new Date).getTime()/1e3)},l.set(this.storageKey,t.clone(e))}});return d}),define("shared/messaging/instances/messages",["shared/messaging/collections/messages"],function(e){"use strict";return new e}),define("shared/messaging/views/messenger-mixin",["jquery/nyt","underscore/nyt","shared/messaging/views/message","shared/messaging/instances/messages","shared/messaging/templates"],function(e,t,i,n,s){"use strict";var a={template:s.messenger,mixinSettings:{id:null,notifyWhen:null,messageType:null,parent:null,template:"message",newestFirst:!0,closeButton:!0,expiration:!1,animationSpeed:200,expirationAfterPause:null,fadeOutDelay:1500,dismissAcknowledged:!0,trackingVersion:""},events:{"click .action-link":"trackLinkClicks","click .action-button":"trackLinkClicks"},initialize:function(e){this.options=t.extend({},this.mixinSettings,this.defaultSettings,e),this.subscribe(this,"nyt:messaging-message-rendered",this.afterMessageReceived),this.subscribe(this,"nyt:messaging-message-removed",this.afterMessageRemoved),this.subscribe(this,"nyt:messaging-message-"+this.options.id+"-displayed nyt:messaging-message-cleared",this.addLastMessageClass),this.subscribe(this,"nyt:messaging-message-"+this.options.id+"-displayed",this.trackImpressions),this.delegateEvents(),this.collection=n,this.active={messages:{}},this.notActive={messages:{}},this.received={messages:{}},this.newestTime=0,this.oldestTime=1/0,this.pageManager.isDomReady()?this.render():this.subscribe(this.pageManager,"nyt:page-ready",this.render),this.trackingBaseData={module:"Notification",version:this.options.trackingVersion,region:"FixedTop"},this.local(this,"nyt:messaging-messenger-initialized")},render:function(){return this.$parent=this.options.parent?this.options.parent():this.$body,this.rendered||(this.$el.hide().addClass(this.options.id).append(this.template(this.options)),this.$parent.prepend(this.$el),this.rendered=!0,this.local(this,"nyt:messaging-messenger-rendered"),this.prepareView(),this.subscribe(this.collection,this.options.notifyWhen,this.notify)),this},notify:function(i){var n,s,a=this,o=[];t.each(i||[],function(e){s=e.get("id"),s&&o.push(e)}),n=o.length>0?function(){a.createMessageViews(o)}:e.noop,this.pageManager.isDomReady()?n():this.subscribe(this.pageManager,"nyt:page-ready",t.debounce(n,0))},createMessageViews:function(e){return e&&t.each(e||[],function(e){var t,n=e.get("closeButtonPreference");t=new i({model:e,template:this.options.template,closeButton:void 0!==n?n:this.options.closeButton,dismissAcknowledged:this.options.dismissAcknowledged}),this.subscribe(t,"nyt:messaging-message-view-expired",this.removeMessage),this.subscribe(t,"nyt:messaging-message-view-dismissed",this.removeMessage),this.subscribe(t,"nyt:messaging-message-view-dismissed",this.trackDismissal),this.addMessage(t)},this),this},addMessage:function(t){var i,n,s,a,o,r,l,d,c,h,u,m;if(t){if(i=t.model.get("id"),n=!0,s=this.options.newestFirst?"prepend":"append",u=t.render().$el,m=this.$(".message-bed"),this.received.messages[i]=t,this.active.messages[i]=t,a=this.countMessages(),this.options.newestFirst&&(o=t.model.get("timestamp"),o>this.newestTime&&(this.newestTime=o),o<this.oldestTime&&(this.oldestTime=o),o<=this.oldestTime?s="append":o<this.newestTime&&(n=!1)),n)m[s](u);else for(r=this.$(".message-bed").find(".message-container"),d=r.length-1,l=d;-1!==l;l-=1)if(h=e(r[l]),c=h.find(".message").data("timestamp"),c>o){h.after(u);break}t.$el.data("messageId",i),this.local(this,"nyt:messaging-message-rendered",t,a)}},removeMessage:function(e){var t,i;e&&(t=e.model.get("id"),this.notActive.messages[t]=e,this.active.messages[t]&&delete this.active.messages[t],i=this.countMessages(),this.local(this,"nyt:messaging-message-removed",e,i))},addLastMessageClass:function(){this.$(".message-container").removeClass("last-message-container").last().addClass("last-message-container")},dimensions:function(){return{width:this.$el.find(".message-bed").outerWidth(!0),height:this.$el.find(".message-bed").outerHeight(!0)}},countMessages:function(){return t.size(this.active.messages)},trackImpressions:function(e){var t,i;e=e||"",t=this.received.messages[e],i=this.getcontentCollection(t)||"",this.trackingTriggerImpression("messaging-impression",{action:"Impression",contentCollection:i,eventName:"Impression",contentID:e,priority:t.model.get("isDummy")})},trackDismissal:function(e){var t=e.model.get("id"),i=this.getcontentCollection(e);this.trackingTrigger("messaging-dismissal",{action:"Click",contentCollection:i,eventName:"DismissNotification",contentID:t,priority:e.model.get("isDummy")})},trackLinkClicks:function(t){var i=e(t.currentTarget),n=i.parents(".message-container").data("messageId"),s=this.received.messages[n],a=this.getcontentCollection(s),o=this.trackingAppendParams(i.attr("href"),{action:"Click",contentCollection:a,contentID:n});i.attr("href",o)},getcontentCollection:function(e){return e.model.get("sub_type")?e.model.get("sub_type"):""}};return a}),define("shared/messaging/views/move-furniture-mixin",["jquery/nyt"],function(e){"use strict";var t={moveFurniture:function(t,i,n){var s,a,o,r=this,l=this.options.animationSpeed||200;"add"===i?s="+="+t:"subtract"===i&&(s="-="+t),a=function(e){e.animate({marginTop:s},l)},o=function(t){t.promise().done(function(){e(this).css({marginTop:s})})},n?(this.$el.promise().done(function(){e(this).css("height",s),r.broadcast("nyt:messaging-"+r.options.messageType+"-after")}),this.messagesHeight=this.dimensions().height,this.broadcast("nyt:messaging-"+this.options.messageType+"-move-furniture",o,s,this)):(this.$el.animate({height:s},l,function(){r.messagesHeight=r.dimensions().height,r.broadcast("nyt:messaging-"+r.options.messageType+"-after")}),this.broadcast("nyt:messaging-"+this.options.messageType+"-move-furniture",a,s,this))}};return t}),define("shared/messaging/views/critical-alerts",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/views/move-furniture-mixin"],function(e,t,i,n,s){"use strict";var a=i.registerView("messaging").extend(t.extend({},s,n,{defaultSettings:{messageType:"critical-alerts",parent:function(){return 0===e("#critical-alerts").length&&e("body").prepend('<div id="critical-alerts"></div>'),e("#critical-alerts")}},prepareView:function(){this.messagesHeight=0,this.$el.addClass("alerts"),this.$el.parent("#critical-alerts").addClass("critical-alerts messenger"),this.$el.css("height","0")},afterMessageReceived:function(e,t){var i,n=0;e&&t>0&&(this.broadcast("nyt:messaging-message-"+this.options.id+"-received",e,this),1===t&&(n+=this.openMessenger()),e.reveal(!0),e.displayed(),n+=e.dimensions().height,this.moveFurniture(n,"add"),i=e.model.get("id"),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",i),this.createMessageClone(e),this.alignMessages(),this.options.expiration&&this.startTimer(e))},startTimer:function(e){var t;window.setTimeout(function(){t=e.model.get("status"),t&&"dismissed"!==t&&"expired"!==t&&e.trigger("nyt:messaging-message-expired")},60*this.options.expiration*1e3)},openMessenger:function(){var e;return this.$el.show(),this.$el.find(".message-bed").show(),e=this.dimensions().height,this.subscribe(this.pageManager,"nyt:page-resize",this.handleWindowResize),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this),e},afterMessageRemoved:function(e,t){var i=0;e&&null!==t&&(i+=e.dimensions().height,e.$el.hide(),this.local(this,"nyt:messaging-message-cleared"),0===t&&(i+=this.closeMessenger()),this.broadcast("nyt:messaging-message-"+this.options.id+"-closed",e,this),this.moveFurniture(i,"subtract",!0))},closeMessenger:function(){var t=this.dimensions().height,i=this;return this.$el.hide(),this.$el.find(".message-bed").hide(),this.stopListening(this.pageManager,"nyt:page-resize"),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-closed",this),this.$el.promise().done(function(){e(this).siblings(".alerts").is(":hidden")&&i.broadcast("nyt:messaging-message-"+i.options.messageType+"-closed",i)}),t},createMessageClone:function(e){e.$el.find(".message").clone().addClass("hidden-message").wrapInner('<div class="message-wrap" />').appendTo(e.$el)},handleWindowResize:function(){var e,t,i,n=this;this.$el.promise().done(function(){t=n.dimensions().height,i=n.messagesHeight,t>i?(e=t-i,n.moveFurniture(e,"add",!0),n.messagesHeight=t):i>t&&(e=i-t,n.moveFurniture(e,"subtract",!0),n.messagesHeight=t),n.alignMessages()})},maxMessageWidth:function(){var e=this.$(".message-container").width();this.$(".message:not(.hidden-message)").css({"max-width":e+"px"})},alignMessages:function(){var e=0,i=this.active.messages;t.size(i)>0&&(t.each(i,function(t){var i=t.$el.find(".hidden-message .message-wrap").outerWidth();i>e&&(e=i)}),this.$el.find(".message:not(.hidden-message)").css({width:e+2+"px"}),this.maxMessageWidth())}}));return a}),define("shared/messaging/views/suggestions",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/views/move-furniture-mixin"],function(e,t,i,n,s){"use strict";var a=i.registerView("messaging").extend(t.extend({},s,n,{nytEvents:{"nyt:masthead-storytheme":"toggleTheme","nyt:masthead-contenttheme":"toggleTheme","nyt:messaging-message-breaking-news-alerts-received":"hideMessenger","nyt:messaging-message-account-alerts-received":"hideMessenger"},defaultSettings:{messageType:"suggestions",closeButton:!1,trackingVersion:"Velcro"},prepareView:function(){this.messagePresent=!1,this.stayHidden=!1,this.$el.addClass("messenger"),this.$el.css("height","0"),this.pageManager.flag("velcroSocialFollow")&&"1"===this.isUserVariant("velcroSocialFollow")&&this.subscribe("nyt:messaging-velcroSocialFollow-like-button-clicked",this.handleLikeButtonClicked)},afterMessageReceived:function(t){var i,n,s=e("#account-alerts"),a=e("#breaking-news-alerts"),o=e("#masthead");t&&this.$el.is(":hidden")&&s.is(":hidden")&&a.is(":hidden")&&(this.stayHidden||this.messagePresent||(t.reveal(!0),t.displayed(),t.showOnce(),this.messagePresent=!0,o.hasClass("theme-in-story")||(this.openMessenger(),i=this.dimensions().height,this.moveFurniture(i,"add"),n=t.model.get("id"),this.broadcast("nyt:messaging-velcro-rendered",t),
this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",n))))},openMessenger:function(){this.$el.show(),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this)},afterMessageRemoved:function(e){var t=this.dimensions().height;e&&(e.$el.hide(),this.moveFurniture(t,"subtract",!0),this.broadcast("nyt:messaging-message-"+this.options.id+"-closed",e,this),this.closeMessenger())},closeMessenger:function(){this.$el.hide(),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-closed",this)},hideMessenger:function(){var e=this.dimensions().height;this.$el.is(":visible")&&(this.$el.hide(),this.moveFurniture(e,"subtract",!0)),this.broadcast("nyt:messaging-message-"+this.options.id+"-hidden",this),this.stayHidden=!0},showMessenger:function(){var e=this.dimensions().height;this.moveFurniture(e,"add"),this.broadcast("nyt:messaging-message-"+this.options.id+"-shown",this),this.$el.show()},toggleTheme:function(t){var i,n=e("#account-alerts"),s=e("#breaking-news-alerts"),a=t?"hide":"show";"hide"===a&&this.$el.is(":visible")?(i=this.dimensions().height,this.moveFurniture(i,"subtract",!0),this.$el.addClass("theme-changed"),this.$el.hide()):"show"===a&&this.$el.is(":hidden")&&n.is(":hidden")&&!this.stayHidden&&this.messagePresent&&n.is(":hidden")&&s.is(":hidden")&&(this.$el.show(),i=this.dimensions().height,this.moveFurniture(i,"add",!0),this.$el.removeClass("theme-changed")),this.broadcast("nyt:messaging-message"+this.options.id+a,i,this)},handleLikeButtonClicked:function(e){e.model&&void 0!==e.wasLiked&&this.trackingTrigger("velcro-social-follow-fb-click",{action:"Click",contentCollection:e.model.get("sub_type"),eventName:e.wasLiked?"LikeNYTimes":"UnlikeNYTimes",contentID:e.model.get("id"),priority:e.model.get("isDummy")})}}));return a}),define("shared/messaging/views/announcements",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin"],function(e,t,i,n){"use strict";var s=i.registerView("messaging").extend(t.extend({},n,{nytEvents:{"nyt:page-resize":"adjustWidth"},defaultSettings:{messageType:"announcements",parent:function(){return e("#masthead").find(".container")},animationSpeed:400,expiration:30,expirationAfterPause:3,trackingVersion:"LiveVideo"},prepareView:function(){var e=this,t=1e3*this.options.expirationAfterPause;this.messagePresent=!1,this.timer=null,this.currentMessageId=null,this.widthDiff=45,this.$el.addClass("messenger"),this.adjustWidth(),this.$el.on("mouseenter",function(){e.clearTimer()}),this.$el.on("mouseleave",function(){e.startTimer(t)})},afterMessageReceived:function(e){var t=e.model.get("id"),i=this,n=1e3*this.options.expiration;e&&(this.messagePresent?window.setTimeout(function(){i.afterMessageReceived(e)},n):(e.reveal(!0),e.displayed(),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",t),this.messagePresent=!0,this.openMessenger(),this.currentMessageId=t,this.startTimer(n)))},startTimer:function(e){var t=this.currentMessageId,i=this.active.messages[t],n=function(){i&&i.trigger("nyt:messaging-message-expired")};e=e||5e3,this.timer=window.setTimeout(n,e)},clearTimer:function(){window.clearTimeout(this.timer)},openMessenger:function(){var e=this.options.animationSpeed||500;this.$el.stop(!0).show().animate({top:0},e),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this)},afterMessageRemoved:function(e){e&&this.closeMessenger(e)},closeMessenger:function(t){var i=this.dimensions().height,n=this.options.animationSpeed||500,s=this;t&&this.$el.stop(!0).animate({top:"-"+i},n,function(){e(this).hide(),t.$el.hide(),s.messagePresent=!1,s.broadcast("nyt:messaging-messenger-"+s.options.id+"-closed",s)})},adjustWidth:function(){var t,i=e("#masthead"),n=i.width(),s=this.widthDiff,a=this.pageManager.getCurrentBreakpoint(),o=0;a>1020?(10060>=a&&(o=parseInt(i.css("margin-left"),10)),t=n-(2*s+o),this.$el.css("width",t+"px"),this.$el.css("left",s+"px")):(this.$el.css("left","0px"),this.$el.css("width","100%"))}}));return s}),define("shared/messaging/views/notification-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/templates","shared/messaging/views/messenger-format-mixin","shared/modal/views/modal"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend({defaultSettings:{expiration:7,stackSize:3,modalHeight:91,modalMargin:6,truncateTextHeight:34},template:s.notificationModals,el:"#notification-modals",nytEvents:{"nyt:messaging-notification-archive-opened":"closeModals"},initialize:function(e){this.options=t.extend({},this.defaultSettings,e),this.queue={},this.active={},this.timer={},this.maxHeight=this.options.stackSize*this.options.modalHeight+this.options.modalMargin,this.$el.css({"max-height":this.maxHeight+"px"})},instantiateModal:function(i,n){var s=this,r=new o({id:"notification-modal-"+n,hasCloseButton:!0,modalContent:s.template(t.extend(i.toJSON(),{link:i.getPrimaryLink(),emphasize:a.emphasizeTitle,emphasis:i.getCombinedEmphasis()})),tailDirection:"up",autoPosition:!1,closeOnClick:!1,toggleSpeed:400,openCallback:function(){this.$el.css("left",5)},closeCallback:function(){s.closeModal(n)}});return r.addToPage("#notification-modals"),r.$el.data("messageId",n),r.$el.on("click",function(e){var t;e.preventDefault(),s.local(s,"nyt:messaging-notification-modal-clicked",n),s.closeModal(n),t=s.trackingAppendParams(i.get("link"),{module:"notification",version:"NotificationPopup",action:"click",region:"TopBar",eventName:"click",contentCollection:i.get("tag")}),s.broadcast("nyt:messaging-notifications-navigate",t)}),r.$el.find(".modal-close").on("click",function(e){e.stopPropagation(),s.local(s,"nyt:messaging-notification-modal-closed",n),s.closeModal(n),s.trackNotificationClose(i)}),r.$el.on("mouseenter",function(){e(this).parent().children(".active").each(function(){var t=e(this).data("timerId");s.clearTimer(t)})}),r.$el.on("mouseleave",function(){e(this).parent().children(".active").each(function(){var t=s.startTimer(n,2e3);e(this).data("timerId",t)})}),r},render:function(e){var t,i,n,s,a,o,r=this.options.truncateTextHeight;e&&(t=e.model.get("id"),i=this.instantiateModal(e.model,t),t&&i&&(n=i.$el.find(".message"),s=n.find(".timestamp"),a=s.attr("datetime"),i.open(),i.truncateText(n.find("a"),r),o=this.prettyDate(a),o&&s.text(o),this.showOrWait(t,i)))},showOrWait:function(e,t){var i,n=t.$el.position().top,s=1e3*this.options.expiration;n>=this.maxHeight?this.queue[e]=t:(this.queue[e]&&delete this.queue[e],this.active[e]=t,t.$el.addClass("active"),i=this.startTimer(e,s),t.$el.data("timerId",i))},startTimer:function(e,t){var i,n,s=this,a=function(){n=s.active[e],n&&n.close()};return i=window.setTimeout(a,t)},clearTimer:function(e){e&&window.clearTimeout(e)},closeModal:function(e){var t,i=this.active[e];i&&(t=i.$el.data("timerId"),t&&this.clearTimer(t),i.removeFromPage(),this.active[e]&&delete this.active[e],this.queue[e]&&delete this.queue[e]),this.showNext()},closeModals:function(){var e,t;for(e in this.queue)t=this.queue[e],t.removeFromPage(),delete this.queue[e];for(e in this.active)t=this.active[e],t.removeFromPage(),delete this.active[e]},showNext:function(){var e;for(e in this.queue)this.showOrWait(e,this.queue[e])},trackNotificationClose:function(e){e&&e.get&&this.trackingTrigger("notification-events",{module:"notification",version:"NotificationPopup",action:"close",region:"TopBar",contentId:e.get("link"),contentCollection:e.get("tag")},"interaction")}});return r}),define("shared/messaging/views/notifications",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/messaging/instances/follows","shared/messaging/views/messenger-mixin","shared/messaging/views/notification-modal","shared/messaging/views/follow","shared/messaging/templates","shared/modal/views/modal"],function(e,t,i,n,s,a,o,r,l,d){"use strict";var c=i.registerView("messaging").extend(t.extend({},a,{defaultSettings:{messageType:"notifications",parent:function(){var t=new d({id:"notifications-modal",binding:".notifications-button",modalTitle:"Notifications",headerContent:"<button class='button customize-button hidden' id='toggle-customize-button'>Customize</button>",modalFooter:'<p class="disclaimer">This is a beta version of notifications. <a class="user-action" href="mailto:messaging.feedback@nytimes.com?Subject=Notifications feedback">Send feedback &raquo;</a></p>',tailDirection:"up-right",tailTopOffset:-8,tailLeftOffset:-1,width:"360px",toggleSpeed:1,fixedOverride:this.isFixed,openCallback:function(){this.$target.addClass("active"),this.subscribedAlready||(this.subscribe("nyt:comments-panel-opened",this.close),this.subscribe("nyt:loginmodal-open",this.close),"homepage"===this.pageManager.getApplicationName()?this.subscribe("nyt:masthead-hidden",this.close):this.subscribe("nyt:masthead-storytheme",this.close),this.subscribedAlready=!0),this.broadcast("nyt:messaging-notification-archive-opened",this)},closeCallback:function(){this.$target.removeClass("active"),this.broadcast("nyt:messaging-notification-archive-closed")}});return t.addToPage(),e("#notifications-modal").find(".modal-content")},template:"notificationsModal",fadeOutDelay:3e3,trackingVersion:"ReaderActivity",timestampUpdateFreq:3e4,truncateTextHeight:34,isFixed:!0,scrollCheckHeight:15},nytEvents:{"nyt:messaging-notification-archive-opened":"handleArchivePanelOpened","nyt:messaging-notification-archive-closed":"handleArchivePanelClosed","nyt:messaging-count-received":"updateCounter","nyt:messaging-existing-message-update":"updateMessageView","nyt:messaging-critical-alerts-move-furniture":"movePanelForOtherAlerts","nyt:messaging-suggestions-move-furniture":"movePanelForAlerts","nyt:messaging-follow-suggestions-received":"addSuggestedFollows","nyt:messaging-followable-list-received":"createFollowableList","nyt:messaging-cache-pull-over":"setCachePullOver","nyt:messaging-notifications-navigate":"handleNavigationRequired","nyt:messaging-notifications-panel-active":"setupPanel"},events:{"click .unsubscribe-button":"confirmUnfollowIntent","click .unfollow-button":"confirmUnfollowed","click .keep-following-button":"restoreOriginalFollowable","click .undo-action-button":"undoUnfollowFollowable","click .message-link":"handleMessageClicked"},prepareView:function(){t.bindAll(this,"trackArchiveAction"),this.notificationModal=new o,this.$el.find(".message-bed").append(l.notificationsModal({show:"default"})),this.$archivePanel=e("#notifications-modal"),this.$modalContent=this.$archivePanel.find(".modal-content"),this.$notificationsModal=this.$archivePanel.find(".notifications-modal"),this.$notificationsButton=e(".notifications-button"),this.messageCount=0,this.archiveOpen=!1,this.timestampsUpdating=!1,this.sliding=!1,this.maxHeight=parseInt(this.$modalContent.css("max-height"),10),this.isUnfollowing=!1,this.unfollowing={model:void 0,$el:void 0},this.cachePullOver=!1,this.modalsEnabled=!1,this.lastScrollCheck=0,this.unreadMessages=[],this.subscribe(this.notificationModal,"nyt:messaging-notification-modal-clicked",this.handleMessageAcknowledged),this.subscribe(this.notificationModal,"nyt:messaging-notification-modal-closed",this.handleMessageDismissed),this.pageManager.setMeta("nyt:messaging-notifications-panel-active","true"),this.broadcast("nyt:messaging-notifications-panel-active"),this.$el.show(),this.disablePageScrollOnHover()},afterMessageReceived:function(e){var t,i,n=this.$archivePanel.is(":visible");e&&(t=e.model.get("unread"),i=e.model.get("popup_unread"),t&&(this.broadcast("nyt:messaging-count-received",1),this.unreadMessages.push(e),!n&&i&&this.displayPopup(e)),this.hideDefaultNotification(),e.reveal(!0),n&&(this.truncateCommentBodies(),this.markAppropriateMessagesRead()),this.addBottomBorder())},setCachePullOver:function(){this.cachePullOver=!0},displayPopup:function(e){this.cachePullOver&&this.modalsEnabled&&this.notificationModal.render(e),e.model.setPopupRead()},markRead:function(e){var t=this.active.messages[e];t.displayed()},handleMessageAcknowledged:function(e){this.broadcast("nyt:messaging-modal-"+e+"-acknowledged")},handleMessageDismissed:function(e){this.broadcast("nyt:messaging-modal-"+e+"-dismissed")},handleArchivePanelOpened:function(){var e=this;e.archiveOpen=!0,e.timestampsUpdating||(e.updateTimestamps(e),e.timestampsUpdating=setInterval(function(){e.updateTimestamps(e)},e.timestampUpdateFreq)),e.markAppropriateMessagesRead(),e.truncateCommentBodies(),e.addBottomBorder(),e.trackArchiveAction("open")},handleArchivePanelClosed:function(){this.archiveOpen=!1,this.stopUpdatingTimestamps(),this.trackArchiveAction("close"),this.isUnfollowing&&this.restoreOriginalFollowable()},isMessageVisible:function(e){var t,i,n,s,a;return this.$modalContent.find(".follow-options").is(":visible")?!1:(t=this.$modalContent.offset().top,i=t+this.$modalContent.height(),n=e.$el.find(".message-title"),s=n.offset().top,a=s+n.height(),s>=t&&i>=a)},markAppropriateMessagesRead:function(){var t,i,n,s,a,o=this,r=[];for(i=0;i<this.unreadMessages.length;i++)s=this.unreadMessages[i],t=s.model.get("id"),a=this.isMessageVisible(s),n=s.model.get("unread"),a&&n?(s.displayed(this.options.fadeOutDelay),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",t)):!a&&n&&r.push(s);this.unreadMessages=r,this.watchingWhichMessagesAreSeen||(this.$modalContent.on("scroll",function(){var t=e(this).scrollTop(),i=Math.abs(t-o.lastScrollCheck),n=i/o.options.scrollCheckHeight>1;o.unreadMessages.length>0&&n&&(o.markAppropriateMessagesRead(),o.lastScrollCheck=t)}),this.watchingWhichMessagesAreSeen=!0)},updateCounter:function(e){var t,i;void 0!==e&&(t=this.messageCount+e,this.messageCount=Math.max(t,0),i={count:this.messageCount,delta:e},this.broadcast("nyt:messaging-notification-count-update",i))},showDefaultNotification:function(){this.$el.find(".default-message").show()},hideDefaultNotification:function(){var e=this.$el.find(".message-default").closest(".message-container");"block"===e.css("display")&&e.hide()},disablePageScrollOnHover:function(){this.$modalContent.on("mousewheel DOMMouseScroll",function(t){var i=0;"mousewheel"===t.type?i=-1*t.originalEvent.wheelDelta:"DOMMouseScroll"===t.type&&(i=40*t.originalEvent.detail),i&&(t.preventDefault(),e(this).scrollTop(i+e(this).scrollTop()))})},addBottomBorder:function(){var t=this.dimensions().height,i=parseInt(this.$modalContent.css("max-height"),10);t>i&&(e("#notifications-modal").find(".modal").addClass("scroll-active"),this.$modalContent.find(".comment-text").data("truncate",!0))},handleMessageClicked:function(t){var i,n,s,a,o;t.preventDefault(),i=e(t.currentTarget),n=i.closest(".message-container"),a=n.data("messageId"),o=this.collection.get(a),s=this.trackingAppendParams(i.attr("href"),{module:"notification",version:"NotificationPanel",action:"click",region:"TopBar",eventName:"click",contentCollection:o?o.get("tag"):"",contentPlacement:this.determineMessagePlacement(n)}),this.handleNavigationRequired(s)},handleNavigationRequired:function(e){var t,i,n,s=window.location.href.split("#")[0]===e.split("#")[0];window.location.href=e,t=e.split("#")[1],t&&s&&(n=t.split("="),i=n[1],"permid"===n[0]&&i&&this.broadcast("nyt:community-commentspanel-open",i))},trackArchiveAction:function(e){this.trackingTrigger("notification-events",{module:"notification",version:"NotificationPanel",action:e,region:"TopBar"},"interaction")},confirmUnfollowIntent:function(t){var i,n,s=e(t.currentTarget).closest(".message-container"),a=this.collection.get(s.data("id"));this.trackInlineUnfollow("dismiss",s,a),this.isUnfollowing&&this.restoreOriginalFollowable(),a.set("originalHTML",s.html()),t.preventDefault(),t.stopPropagation(),i=s.height(),s.css({height:i}),s.find(".unsubscribe-button").remove(),n=l.followConfirmation(a.toJSON()),s.find(".message").replaceWith(n),this.isUnfollowing=!0,this.unfollowing={$el:s,model:a}},confirmUnfollowed:function(t){var i,n=e(t.currentTarget).closest(".message-container"),s=this.collection.get(n.data("id")),a=s.get("tag");this.trackInlineUnfollow("unfollowing",n,s),t.preventDefault(),t.stopPropagation(),this.broadcast("nyt:messaging-unfollow-tag",a),i=l.followUnfollowed(s.toJSON()),n.css({height:"auto"}),n.find(".message").replaceWith(i),this.isUnfollowing=!1},restoreOriginalFollowable:function(t){var i=t?e(t.currentTarget).closest(".message-container"):this.unfollowing.$el,n=t?this.collection.get(i.data("id")):this.unfollowing.model;return t&&(t.preventDefault(),t.stopPropagation()),t&&t.currentTarget&&e(t.currentTarget).hasClass("keep-following-button")&&this.trackInlineUnfollow("keepfollowing",i,n),i.find(".message").replaceWith(n.get("originalHTML")),i.css({height:"auto"}),this.isUnfollowing=!1,n},undoUnfollowFollowable:function(t){var i=e(t.currentTarget).closest(".message-container"),n=this.restoreOriginalFollowable(t),s=n.get("tag");this.trackInlineUnfollow("follow",i,n),this.broadcast("nyt:messaging-follow-tag",s)},updateMessageView:function(e){var t,i,n=this.received.messages[e.id],s=n.model;t=s.get("unread"),s.applyMetadata(e.update),i=s.get("unread"),e.message&&s.updateProperties(e.message),!t&&i?this.broadcast("nyt:messaging-count-received",1):t&&!i&&this.broadcast("nyt:messaging-count-received",-1),i?(n.$el.detach(),n.render(),this.$el.find(".message-bed").prepend(n.$el),n.reveal(!0),this.archiveOpen&&this.markAppropriateMessagesRead()):n.render().reveal(!0)},movePanelForOtherAlerts:function(e){var t;this.archiveOpen&&(t=this.$archivePanel.find(".notifications-modal"),e(t))},updateTimestamps:function(t){e(".notifications-modal .timestamp").each(function(){var i=e(this),n=1e3*parseInt(i.attr("datetime"),10),s=t.prettyDate(n);s&&i.html(s)})},stopUpdatingTimestamps:function(){this.updating&&(clearInterval(this.updating),this.updating=!1)},addSuggestedFollows:function(e){var t,i,n,s=this,a=s.$el.find(".follow-suggestions");for(i=0;i<e.length;i+=1)t=e[i],n=new r({model:t}),a.append(n.render().$el)},createFollowableList:function(e){var t,i,n,s=this;for(this.$archivePanel.find("#toggle-customize-button").removeClass("hidden"),this.$modalContent.append("<div class='follow-options'><h4 class='follow-options-heading'>Follow columns and columnists</h4></div>"),n=this.$modalContent.find(".follow-options"),t=0;t<e.length;t+=1)i=new r({model:e[t]}),n.append(i.render().$el);this.$archivePanel.find(".modal-header").on("click",".button",function(e){e.preventDefault(),e.stopPropagation(),s.sliding||(s.sliding=!0,s.toggleFollowableView(e,function(){s.sliding=!1}))})},toggleFollowableView:function(e,t,i){var n,s=this,a=this.$archivePanel.find(".modal-header");n=this.prepareToAnimateFollows(),i=i||250,this.trackPanelCustomizeToggle(e,n.$showing),a.find("#toggle-customize-button").toggleClass("active"),n.wrapButton?a.find(".modal-heading").wrap("<button class='button back-button'></button>"):a.find(".modal-heading").unwrap(),s.$modalContent.removeClass("scroll-active").css({height:n.destinationHeight}).addClass("is-animating"),n.$showing.addClass("is-animating").css({width:n.width,"max-height":s.maxHeight,left:n.moveShowingTo}),n.$toShow.addClass("is-animating").css({width:n.width,left:0}),setTimeout(function(){n.scrollActive&&s.$notificationsModal.addClass("scroll-active"),n.$showing.removeClass("is-animating scroll-active").css({display:"none"}),n.$toShow.removeClass("is-animating scroll-active").css({width:"auto"}),s.$modalContent.removeClass("is-animating").css({height:"auto"}),t&&t()},i)},prepareToAnimateFollows:function(){var e,t,i,n,s,a=this.$modalContent.find(".follow-options"),o=this.$modalContent.width(),r=this.$modalContent.height(),l=this.maxHeight;return n=!1,s=a.is(":hidden"),e=s?this.$el:a,t=s?a:this.$el,this.$modalContent.css({height:r}),l=t.css({display:"inherit",width:o}).height(),l>=this.maxHeight?(t.addClass("scroll-active"),n=!0):this.$notificationsModal.removeClass("scroll-active"),r===this.maxHeight&&e.addClass("scroll-active"),l=l>this.maxHeight?this.maxHeight:l,i=s?-o:o,{$showing:e,$toShow:t,wrapButton:s,destinationHeight:l,moveShowingTo:i,width:o,scrollActive:n}},truncateCommentBodies:function(){var t=this;this.$modalContent.find(".comment-text").each(function(){var i=e(this);i.data("truncate")&&(t.truncateText(i,t.options.truncateTextHeight),i.data("truncate",!1))})},determineMessagePlacement:function(t){return e(".notifications-modal .notifications .message-container:visible").index(t)+1},trackPanelCustomizeToggle:function(t,i){i&&this.trackingTrigger("notification-events",{module:"follow",state:i.hasClass("follow-options")?"customize":"notification",action:"click",version:"NotificationPanel",region:"TopBar",contentId:e(t.currentTarget).hasClass("back-button")?"back-button":"customize-button",eventName:"click"},"interaction")},trackInlineUnfollow:function(e,t,i){var n;e&&(n=i.get("tag").split("."),this.trackingTrigger("notification-events",{module:"follow",state:"notification-unfollow",action:"click",contentId:n[1],version:n[0],eventName:e,region:"TopBar",contentPlacement:this.determineMessagePlacement(t)},"interaction"))},handleUserReady:function(){this.pageManager.flag("followingRelease")&&(this.isUserLoggedIn=n.isLoggedIn(),s.isUserLoggedIn=n.isLoggedIn(),this.setupPanel())},revealBell:function(){this.$notificationsButton.removeClass("hidden")},setupPanel:function(){var e=this;if(this.pageManager.getMeta("nyt:messaging-notifications-panel-active")){if(!this.pageManager.flag("followingRelease"))return this.revealBell(),void(this.modalsEnabled=!0);if(void 0!==this.isUserLoggedIn)return this.isUserLoggedIn?(this.modalsEnabled=!0,this.pageManager.getMeta("nyt:messaging-user-has-ability-to-follow")?void this.revealBell():void this.subscribe("nyt:messaging-user-has-ability-to-follow",function(){e.revealBell()})):(this.revealBell(),void this.handleAnonInteractions())}},handleAnonInteractions:function(){var e=this,t=(new Date).getTime()-6e4;this.broadcast("nyt:notifications-instantiate-onboarding",{following:{"follow.whitelist":{start:t},"follow.onboard-welcome":{start:t}},footerOverride:'<button class="button login-button">Log in</button>',cbExtension:function(t){var i,n,s,a=t.settings.instanceData?t.settings.instanceData.type:null,o="Notification";a&&(i=t.settings.instanceData?t.settings.instanceData.model:null,n="Log in to follow",i&&(n=n+" "+i.get("following"),s="follow_button",o="Follow"),t.$el.find(".login-button").on("click",function(t){t.stopPropagation(),e.broadcast("nyt:notifications-onboarding-hide",{type:a}),e.trackingTrigger("tagx-auth-interaction",{module:o,state:e.isUserLoggedIn?"logged in":"logged out",eventName:"login click | "+o}),e.broadcast("nyt:loginmodal-open",{modalTitle:n,registrationPlatform:s||"follow_bell",moduleName:o})}))}}),this.$notificationsButton.hover(function(){e.anonOnboardingShown||(e.anonOnboardingShown=!0,e.broadcast("nyt:notifications-onboarding-show",{type:"welcome",binding:".notifications-button",force:!0}))}),this.$notificationsButton.click(function(t){t.stopPropagation(),e.broadcast("nyt:loginmodal-open",{modalTitle:"Log in to follow",registrationPlatform:"follow_bell",moduleName:"Notification"})})}}));return c}),define("homepage/instances/messaging",["jquery/nyt","foundation/views/page-manager","shared/messaging/views/critical-alerts","shared/messaging/views/suggestions","shared/messaging/views/announcements","shared/messaging/views/notifications"],function(e,t,i,n,s,a){"use strict";var o=t.getMeta("nyt:messaging-user-has-ability-to-follow"),r=function(){t.flag("followFeature")&&new a({id:"notifications",notifyWhen:"nyt:messaging-notification-received nyt:messaging-follow-notice-received",isFixed:!1})};t.$html.hasClass("lt-ie9")||(new n({id:"suggestions",notifyWhen:"nyt:messaging-velcro-received"}),new i({id:"breaking-news-alerts",notifyWhen:"nyt:messaging-breaking-news-received",expiration:20,dismissAcknowledged:!1,trackingVersion:"BreakingNews"}),new i({id:"account-alerts",notifyWhen:"nyt:messaging-account-alert-received",expiration:10,trackingVersion:"UserAccounts"}),new s({id:"announcements",notifyWhen:"nyt:messaging-video-received",parent:function(){return e("#announcements-container")}}),o||t.flag("followingRelease")?r():t.listenToOnce(t,"nyt:messaging-user-has-ability-to-follow",r))}),define("shared/navigation/templates",["underscore/nyt"],function(_){var templates={};return templates.mainPanel=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<div class="sections">\n';var count=1;__p+="\n",_.each(level1,function(e){__p+='\n<div class="section '+(null==(__t=isVisible(e[0],count)===!1?"hidden":"")?"":__t)+'">\n<ul class="menu" role="menubar">\n',_.each(e,function(e){__p+="\n"+(null==(__t=liTemplate({model:e,isVisible:isVisible(e,count)}))?"":__t)+"\n",count+=iterateTemplateCount(e),__p+="\n"}),__p+="\n",count+=1,__p+="\n</ul>\n</div>\n"}),__p+="\n</div>"}return __p},templates.menuItem=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li role="presentation" class="'+(null==(__t=isVisible===!1?"hidden":"menuitem-visible")?"":__t)+'">\n<a id="navId-'+(null==(__t=model.getTaxonomyId())?"":__t)+'"\nclass="'+(null==(__t=model.getEdition())?"":__t)+" "+(null==(__t=model.hasChildren()?"expandable":"")?"":__t)+'"\nrole="menuitem" '+(null==(__t=model.getPath()?' href="'+model.getPath()+'"':' tabindex="0"')?"":__t)+"\n"+(null==(__t=model.hasChildren()?' aria-haspopup="true" aria-expanded="false"':"")?"":__t)+">\n"+(null==(__t=model.get("name"))?"":__t)+"\n",model.hasChildren()&&(__p+='\n<div class="arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n',model.getLevel()>1&&(__p+='\n<div class="arrow arrow-left">\n<div class="arrow-conceal"></div>\n</div>\n'),__p+="\n"),__p+="\n</a>\n</li>";return __p},templates.mobileNav=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<section class="edition-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li class="'+(null==(__t=isGlobalEdition?"":"active")?"":__t)+'"><a href="http://mobile.nytimes.com/"><span>U.S. Edition</span></a></li>\n</ul>\n<ul class="menu">\n<li class="'+(null==(__t=isGlobalEdition?"active":"")?"":__t)+'"><a href="http://mobile.nytimes.com/international/"><span>International Edition</span></a></li>\n</ul>\n</section>\n<section class="primary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'"><span>Home</span></a></li>\n<li><a href="http://mobile.nytimes.com/world/"><span>World</span></a></li>\n<li><a href="http://mobile.nytimes.com/national/"><span>U.S. '+(null==(__t=isGlobalEdition?"News":"")?"":__t)+'</span></a></li>\n<li><a href="http://mobile.nytimes.com/politics/"><span>'+(null==(__t=isGlobalEdition?"U.S.":"")?"":__t)+' Politics</span></a></li>\n<li><a href="http://mobile.nytimes.com/upshot/"><span>The Upshot</span></a></li>\n<li><a href="http://mobile.nytimes.com/nyregion/"><span>New York</span></a></li>\n<li><a href="http://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'business/"><span>Business '+(null==(__t=isGlobalEdition?"":"Day")?"":__t)+'</span></a></li>\n<li><a href="http://mobile.nytimes.com/technology/"><span>Technology</span></a></li>\n<li><a href="http://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'sports/"><span>Sports</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'opinion/"><span>Opinion</span></a></li>\n<li><a href="http://mobile.nytimes.com/science/"><span>Science</span></a></li>\n<li><a href="http://mobile.nytimes.com/health/"><span>Health</span></a></li>\n<li><a href="http://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'arts/"><span>Arts</span></a></li>\n<li><a href="http://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'style/"><span>Style</span></a></li>\n<li><a href="http://mobile.nytimes.com/photos/"><span>Photos</span></a></li>\n<li><a href="http://mobile.nytimes.com/video/"><span>Video</span></a></li>\n<li><a href="http://mobile.nytimes.com/most-emailed/"><span>Most Emailed</span></a></li>\n<li><a href="http://mobile.nytimes.com/times-insider/"><span>Times Insider</span></a></li>\n</ul>\n</section>\n<section class="secondary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/automobiles/"><span>Automobiles</span></a></li>\n<li><a href="http://mobile.nytimes.com/blogs/"><span>Blogs</span></a></li>\n<li><a href="http://mobile.nytimes.com/books/"><span>Books</span></a></li>\n<li><a href="http://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'dining/"><span>Food</span></a></li>\n<li><a href="http://mobile.nytimes.com/education/"><span>Education</span></a></li>\n<li><a href="http://mobile.nytimes.com/magazine/"><span>Magazine</span></a></li>\n<li><a href="http://mobile.nytimes.com/mens-style/"><span>Men\'s Style</span></a></li>\n<li><a href="http://mobile.nytimes.com/movies/"><span>Movies</span></a></li>\n<li><a href="http://mobile.nytimes.com/music/"><span>Music</span></a></li>\n<li><a href="http://mobile.nytimes.com/business/media/"><span>Media &amp; Advertising</span></a></li>\n<li><a href="http://mobile.nytimes.com/obituaries/"><span>Obituaries</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/publiceditor/"><span>Public Editor</span></a></li>\n',isGlobalEdition||(__p+='\n<li><a href="http://mobile.nytimes.com/realestate/"><span>Real Estate</span></a></li>\n'),__p+='\n<li><a href="http://mobile.nytimes.com/opinion/sundayreview/"><span>Sunday Review</span></a></li>\n',isGlobalEdition&&(__p+='\n<li><a href="http://mobile.nytimes.com/opinion/international/greathomes/"><span>Great Homes and Destinations</span></a></li>\n'),__p+='\n<li><a href="http://mobile.nytimes.com/tmagazine/"><span>T Magazine</span></a></li>\n<li><a href="http://mobile.nytimes.com/television/"><span>Television</span></a></li>\n<li><a href="http://mobile.nytimes.com/theater/"><span>Theater</span></a></li>\n<li><a href="http://mobile.nytimes.com/timeswire/"><span>Times Wire</span></a></li>\n<li><a href="http://mobile.nytimes.com/travel/"><span>Travel</span></a></li>\n<li><a href="http://mobile.nytimes.com/weddings/"><span>Weddings</span></a></li>\n<li><a href="http://nytlive.nytimes.com/womenintheworld/"><span>Women In The World</span></a></li>\n<li><a href="http://mobile.nytimes.com/corrections/"><span>Corrections</span></a></li>\n</ul>\n</section>\n<section class="tertiary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/recommendations/"><span>Recommendations</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/saved/"><span>Saved</span></a></li>\n</ul>\n</section>\n<section class="settings '+(null==(__t=userData.isLoggedIn()?"":"hidden")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><span class="label">Account:</span> '+(null==(__t=userData.getUserName())?"":__t)+'</li>\n</ul>\n</section>\n<section class="logout '+(null==(__t=userData.isLoggedIn()?"":"hidden")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="https://myaccount.nytimes.com/mobile/logout/smart/index.html?EXIT_URI='+(null==(__t=encodeURIComponent(window.location))?"":__t)+'"><span>Log out</span></a></li>\n</ul>\n</section>\n<section class="account '+(null==(__t=userData.isLoggedIn()?"hidden":"")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://www.nytimes.com/mowweb/ftnotlog"><span>Subscribe</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="https://myaccount.nytimes.com/mobile/login/smart/index.html?EXIT_URI='+(null==(__t=encodeURIComponent(window.location))?"":__t)+'"><span>Log In</span></a></li>\n</ul>\n</section>';
return __p},templates.navigationModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="secondary-container">\n'+(null==(__t=secondary)?"":__t)+'\n</div>\n<div class="tertiary-container">\n'+(null==(__t=tertiary)?"":__t)+"\n</div>";return __p},templates.secondaryPanel=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<div class="secondary-container">\n<div class="header">\n<h5 class="section-heading"><a href="" role="menuitem"></a></h5>\n</div>\n';var count=1;__p+="",_.each(level2,function(e){__p+='\n<div class="section '+(null==(__t="432A1823-3F24-43C0-8004-79088F94E754"===e[0].getParentId()?"video":"")?"":__t)+'" data-parent="navId-'+(null==(__t=e[0].getParentId())?"":__t)+'">\n<ul class="secondary" role="menu">\n',_.each(e,function(e){__p+="\n"+(null==(__t=liTemplate({model:e,isVisible:!0}))?"":__t)+"\n"}),__p+="\n</ul>\n</div><!-- close secondary "+(null==(__t=e[0].getParentId())?"":__t)+" sections -->\n"}),__p+="",_.each(level1,function(e){__p+='\n<div class="section section-more '+(null==(__t=isVisible(e[0],count,!0)===!1?"hidden":"")?"":__t)+'"  data-parent="navId-more-section">\n<ul class="secondary" role="menu">\n',_.each(e,function(e){__p+="\n"+(null==(__t=liTemplate({model:e,isVisible:isVisible(e,count,!0)}))?"":__t)+"\n",count+=iterateTemplateCount(e),__p+="\n"}),__p+="\n",count+=1,__p+="\n</ul>\n</div>\n"}),__p+="</div><!-- close secondary modal -->"}return __p},templates.tertiaryPanel=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="header">\n<h5 class="section-heading"><a href="" role="menuitem"></a></h5>\n</div>\n',_.each(level3,function(e,t){__p+='\n<ul class="tertiary" data-parent="navId-'+(null==(__t=e[0].getParentId())?"":__t)+'" role="menu">\n',_.each(e,function(e,t){__p+="\n"+(null==(__t=liTemplate({model:e,isVisible:!0}))?"":__t)+"\n"}),__p+="\n</ul>\n"}),__p+="";return __p},templates}),define("shared/data/models/section",["backbone/nyt"],function(e){"use strict";var t=e.Model.extend({defaults:{name:"",edition:"",className:"",path:"",show_in_nav:!0,hasSubsections:!1,level:1,taxonomyId:""},getTaxonomyId:function(){return this.get("taxonomyId")},getParentId:function(){return this.get("parent")},getEdition:function(){var e=this.get("edition");return"global"===e?"international":e},hasChildren:function(){return this.get("hasSubsections")},getPath:function(){return this.get("path")},getLevel:function(){return this.get("level")}});return t}),define("shared/data/collections/taxonomy",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","shared/data/models/section","foundation/hosts","foundation/models/user-data"],function(e,t,i,n,s){"use strict";var a=i.extend({url:s.staticHost+"/services/json/taxonomy/v2/flat.jsonp",model:n,sectionMarkers:["C5BFA7D5-359C-427B-90E6-6B7245A6CDD8","5C13EEDD-D905-4D8C-A284-6859EA434563","8FB1308A-FFE4-4BED-ADF6-659A680D0884","6101A43A-8BDE-45FF-AAD5-EF7396F83AC9","FED853D9-D192-46F6-8D18-447803EB4A7B"],initialize:function(){this.editionString="us"===this.pageManager.getEdition()?"domestic":"global",this.level1=[],this.level2=[],this.level3=[],this.fetch()},sync:function(t,i,n){return n.dataType="jsonp",n.jsonpCallback="jsonTaxonomyCallback",n.cache=!0,e.sync(t,i,n)},parse:function(i){var s,a,o,r=0,l=new e.Collection,d=t.map(i.elements,function(e){return e.taxonomyId=e.id,e.id=r++,e});for(l.model=n,l.reset(d),s=l.where({parent:null}),a=0,r=0,o=s.length;o>r;r+=1)t.indexOf(this.sectionMarkers,s[r].get("taxonomyId"))>=0&&(this.levelData(l,s.slice(a,r),0),a=r);return this.levelData(l,s.slice(a,s.length),0),this.level1.push([new n({name:"More",taxonomyId:"more-section",hasSubsections:!0})]),l.toJSON()},levelData:function(e,i,n){var s,a,o,r,l,d,c;if(t.isArray(i))for(this["level"+(n+1)].push(i),s=0,a=i.length;a>s;s+=1)this.levelData(e,i[s],n+1);else 3>n&&(c=e.where({taxonomyId:i.get("taxonomyId")}).length>1,o=e.where({parent:i.get("taxonomyId"),show_in_nav:!0}),c&&(o=t.uniq(o,function(e){return e.get("taxonomyId")}))),r=o&&o.length>0,i.set("className",i.get("name").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()),i.set("hasSubsections",r),i.set("level",n),l=i.get("alternate_editions"),l&&l[this.editionString]&&(d=e.findWhere({taxonomyId:l[this.editionString]}),i.set("editionName",d.get("name")),i.set("editionPath",d.get("path"))),r&&this.levelData(e,o,n)},getPrimarySections:function(){return this.level1},getSecondarySections:function(){return this.level2},getTertiarySections:function(){return this.level3},getSectionByKeyword:function(e){return this.find(function(t){var i=t.get("path")||"";return i.indexOf("/"+e+"/index.html")>0})}});return a}),define("shared/data/instances/taxonomy",["shared/data/collections/taxonomy"],function(e){"use strict";return new e}),define("shared/navigation/views/navigation",["module","jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/views/page-manager","foundation/hosts","foundation/models/user-data","shared/modal/views/modal","shared/navigation/templates","shared/data/instances/taxonomy"],function(e,t,i,n,s,a,o,r,l,d){"use strict";var c=n.registerView("navigation").extend({module:e,el:"#navigation",navTemplate:l.navigation,modalTemplate:l.navigationModalContent,events:{mouseleave:"delayedClose",mouseenter:"cancelDelayedClose","mouseenter li a":"tryPrimaryHover","mouseleave li a.expandable":"delayedModalClose","click li a":"activatePrimaryItem","click .menu a[href]":"handlePrimaryNavigationClick"},nytEvents:{"nyt:masthead-section-click":"toggle","nyt:navigation-toggle-ready":"toggle","nyt:navigation-edge-click":"open","nyt:navigation-edge-mouse-enter":"delayedOpen","nyt:navigation-edge-mouse-leave":"cancelDelayedOpen","nyt:messaging-critical-alerts-move-furniture":"moveNav","nyt:messaging-suggestions-move-furniture":"moveNav","nyt:a11y-enabled":"enableA11Nav","nyt:a11y-disabled":"disableA11yNav"},defaultSettings:{panelwidth:210,navTimeout:500,navAnimation:150,hoverTimeout:500,intentRangeLower:10,intentRangeUpper:170,maxMouseLocs:2,a11yEnabled:!1},modalSettings:{id:"navigation-modal",modalTitle:"",modalContent:"",tailDirection:"left-top",closeOnClick:!1,fixedOverride:!0,autoPosition:!0,positionTailSide:!0,toggleSpeed:1},mouseLocs:[],navIds:{REAL_ESTATE:"navId-92720057-BCB6-4BDB-9351-12F29393259F",OPINION_DOMESTIC:"navId-09736473-CB3F-4B2F-9772-3AF128ABE12D",OPINION_INTERNATIONAL:"navId-AD8090D7-4137-4D71-84C8-70DA3BD89778",VIDEO:"navId-432A1823-3F24-43C0-8004-79088F94E754",CONFERENCES:"navId-0442C365-4B63-4B63-B9DE-3C28319CB622",MORE:"navId-more-section"},navLevels:{PRIMARY:1,SECONDARY:2,TERTIARY:3},initialize:function(e){i.bindAll(this,"tryPrimaryHover","trySecondaryHover","open","close","render","saveMousePosition","delayedOpen","delayedClose","cancelDelayedOpen","cancelDelayedClose","delayedModalOpen","delayedModalClose","cancelDelayedModalOpen","cancelDelayedModalClose","delayedPrimaryHover","cancelDelayedPrimaryHover","delayedSecondaryHover","cancelDelayedSecondaryHover","handleClickClose","handleTapClose","detectFalsePositive","isNavItemVisible","iterateTemplateCount"),this.settings=i.extend({},this.defaultSettings,e),this.singlePanelWidth=this.settings.panelwidth+"px",this.singlePanelPartlyShut=this.settings.panelwidth-20+"px",this.isNavAnimating=!1,this.timer={},d.length>0?this.render():this.subscribeOnce(d,"sync",this.render),this.$document.on("click","#navigation-modal a[href]",i.bind(this.handleModalClick,this)),this.trackingBaseData={module:"SectionsNav",action:"click",version:"BrowseTree",region:"TopBar"}},handleUserReady:function(){this.updateCrosswordSubscriptionLink()},updateCrosswordSubscriptionLink:function(){var e=o.isTabletSubscriber(),i=o.isSmartphoneSubscriber(),n=o.isHomeDeliverySubscriber(),s=o.isPremierSubscriber(),r=o.isOpinionSubscriber(),l=o.isCrosswordsSubscriber(),d=a.www+"/subscriptions/games/lp8J6KQ.html?campaignId=49W96",c=a.www+"/subscriptions/games/lp897H9.html?campaignId=49W8Y";(e||i||n||s||r)&&!l?t("#nyt-crossword").attr("href",d):l||t("#nyt-crossword").attr("href",c)},handlePrimaryNavigationClick:function(e){var i=t(e.currentTarget),n=this.trackingAppendParams(i.attr("href"),{contentCollection:t.trim(i.text())});i.attr("href",n)},handleModalClick:function(e){var i=t(e.currentTarget),n=t.trim(t("#navigation-modal").find(".secondary-container .header").text()),s=this.trackingAppendParams(i.attr("href"),{contentCollection:n+"/"+t.trim(i.text()),contentPlacement:i.closest("ul").hasClass("secondary")?2:3});i.attr("href",s)},moveNav:function(e){e(this.$el)},render:function(){var e,t,n,s=23,a=33,o=this,c=this.$body.find(".navigation-modal");this.navItemsInView=s,this.navItemsInView=Math.floor((this.pageManager.getViewport().height-41)/26),this.pageManager.isMobile()?this.navItemsInView=s:this.navItemsInView>a?this.navItemsInView=a:this.navItemsInView<s&&(this.navItemsInView=s),this.$el.append(l.mainPanel({level1:d.getPrimarySections(),liTemplate:l.menuItem,isVisible:this.isNavItemVisible,iterateTemplateCount:this.iterateTemplateCount})),e=l.secondaryPanel({level1:i.initial(d.getPrimarySections()),level2:d.getSecondarySections(),liTemplate:l.menuItem,isVisible:this.isNavItemVisible,iterateTemplateCount:this.iterateTemplateCount}),t=l.tertiaryPanel({level3:d.getTertiarySections(),liTemplate:l.menuItem}),c.eq(0).remove(),this.modalSettings.modalContent=l.navigationModalContent({secondary:e,tertiary:t}),this.navigationModal=new r(this.modalSettings),this.navigationModal.addToPage(),this.navigationModal.$modal.on("mouseover",".secondary li a",o.trySecondaryHover).on("click",".secondary li a.expandable",o.activateSecondaryItem).on("mouseenter",".tertiary-container",o.cancelDelayedSecondaryHover).on("mouseenter",function(){o.cancelDelayedClose(),o.cancelDelayedModalClose(),o.cancelDelayedPrimaryHover()}).on("mouseleave",function(){o.delayedClose(),o.delayedModalClose()}),this.navigationModal.$modal.find(".secondary-container .hidden .menuitem-visible").eq(0).closest(".section").removeClass("hidden"),n=this.navigationModal.$modal.find(".section-more"),this.moreInModalHeight=25*n.find(".menuitem-visible").length+30*n.not(".hidden").length+45},isNavItemVisible:function(e,t,i){return i?t>this.navItemsInView&&"more-section"!==e.getTaxonomyId():t<=this.navItemsInView||"more-section"===e.getTaxonomyId()},iterateTemplateCount:function(e){var t="global"===this.pageManager.getEdition()?"international":"domestic";return e.getEdition()&&t!==e.getEdition()?0:1},toggle:function(){this.$el.hasClass("active")?this.close():this.open()},open:function(){var e=this,t={width:e.singlePanelPartlyShut,display:"block",opacity:"0"},i={width:e.singlePanelWidth,opacity:"1"};this.isNavAnimating||this.$el.hasClass("active")!==!1||(this.$el.css(t),this.$el.toggleClass("active"),this.$html.toggleClass("navigation-active"),this.isNavAnimating=!0,this.$el.animate(i,this.settings.navAnimation,function(){e.isNavAnimating=!1,e.$body.on("click",e.handleTapClose)}),this.pageManager.isMobile()&&this.$body.css("cursor","pointer"),this.settings.a11yEnabled&&this.toggleFocusEvents(!0),this.broadcast("nyt:navigation-opened",this),this.$document.on("mousemove",this.saveMousePosition))},close:function(){var e,t,i;this.isNavAnimating||this.$el.hasClass("active")!==!0||(e=this,t=this.$el.css("marginTop"),i={width:this.singlePanelPartlyShut,opacity:"0"},this.navigationModal.close(),this.resetNav(this.navLevels.SECONDARY),this.isNavAnimating=!0,this.$el.animate(i,this.settings.navAnimation,function(){e.$el.toggleClass("active"),e.$html.toggleClass("navigation-active"),e.$body.off("click",e.handleClickClose),e.$body.off("click",e.handleTapClose),e.$el.removeAttr("style"),e.$el.css("marginTop",t),e.$el.find("a").removeClass("active"),e.isNavAnimating=!1}),this.pageManager.isMobile()&&this.$body.css("cursor",""),this.settings.a11yEnabled&&this.toggleFocusEvents(!1),this.broadcast("nyt:navigation-closed",this),this.$document.off("mousemove",this.saveMousePosition))},resetNav:function(e){var t=this.navigationModal.$modal;e===this.navLevels.SECONDARY&&t.find(".section").removeClass("active"),t.find(".secondary a").removeClass("active"),t.find(".tertiary").removeClass("active"),t.find(".modal-content").removeClass("expanded"),t.find(".section-heading a").removeClass("active")},activatePrimaryItem:function(e){var i,n,s,a,o,r,l,d=t(e.target).closest("a"),c=d.attr("id");e.stopPropagation(),d.hasClass("active")||this.isNavAnimating!==!1||(d.hasClass("expandable")?(i=this.navigationModal,n=i.$modal.find('[data-parent="'+c+'"]').find("li").length,s=55,a=29*n,o=a+s,l=i.$modal.find(".secondary-container"),c===this.navIds.MORE?o=this.moreInModalHeight||553:c===this.navIds.OPINION_DOMESTIC||c===this.navIds.OPINION_INTERNATIONAL?o=357:c===this.navIds.VIDEO?(o=310,l.css("width","380px")):c===this.navIds.CONFERENCES&&l.css("width","220px"),this.cancelDelayedModalClose(),this.resetNav(this.navLevels.SECONDARY),i.$modal.height(o),e.currentTarget=e.target,i.open(e),this.moveModalArrow(),this.$el.find("a").removeClass("active").attr("aria-expanded","false"),d.addClass("active").attr("aria-expanded","true"),i.$modal.find(".secondary").removeClass("active"),r=i.$modal.find(".secondary-container .section-heading"),this.setHeadingText(d,r),i.$modal.find('[data-parent="'+c+'"]').addClass("active"),c!==this.navIds.VIDEO&&c!==this.navIds.CONFERENCES&&l.css("width","190px"),this.broadcast("nyt:navigation-level-one-open",i.$modal)):this.modalClose())},setHeadingText:function(e,t){e.attr("href")?t.html('<a href="'+e.attr("href")+'" tabinxdex="0" role="menuitem" class="active">'+e.text()+"</a>"):t.html(e.text())},moveModalArrow:function(){var e,i,n,s=this.navigationModal.$modal,a=12,o=18,r=39,l=this.settings.panelwidth-10;t("html").hasClass("viewport-large-70")&&(l+=t("#navigation-edge").width()),s.css("left",l+"px"),e=s.find(".modal-pointer"),e.hasClass("modal-pointer-left")?(i=Math.floor(s.outerHeight()/2)-o,e.css("top",i+"px")):e.hasClass("modal-pointer-left-top")?e.css("top",a,"px"):e.hasClass("modal-pointer-left-bottom")&&(n=s.outerHeight()-r,e.css("top",n+"px"))},activateSecondaryItem:function(e){var i,n,s=t(e.target).closest("a");s.hasClass("active")||this.isNavAnimating!==!1||(e.preventDefault(),i=this.navigationModal.$modal,s.hasClass("expandable")?(this.resetNav(this.navLevels.TERTIARY),i.find(".modal-content").addClass("expanded"),n=i.find(".tertiary-container .section-heading"),this.setHeadingText(s,n),i.find('[data-parent="'+s.attr("id")+'"]').eq(0).addClass("active"),s.addClass("active").attr("aria-expanded","true"),this.broadcast("nyt:navigation-level-two-open",i.find(".tertiary-container"))):(this.resetNav(this.navLevels.TERTIARY),s.addClass("active")))},tryPrimaryHover:function(e){var i,n=t(e.target).closest("a"),s=n.hasClass("expandable");this.cancelDelayedClose(),s&&this.cancelDelayedModalClose(),this.cancelDelayedPrimaryHover(),this.$el.find("li a.active").length>0?(i=this.getAngle(this.mouseLocs[0],this.mouseLocs[1]),i>this.defaultSettings.intentRangeLower&&i<this.defaultSettings.intentRangeUpper?this.delayedPrimaryHover(e):this.activatePrimaryItem(e)):this.activatePrimaryItem(e)},trySecondaryHover:function(e){var t;this.cancelDelayedClose(),this.cancelDelayedModalClose(),this.cancelDelayedSecondaryHover(),this.navigationModal.$modal.find(".modal-content").hasClass("expanded")?(t=this.getAngle(this.mouseLocs[0],this.mouseLocs[1]),t>this.defaultSettings.intentRangeLower&&t<this.defaultSettings.intentRangeUpper?this.delayedSecondaryHover(e):this.activateSecondaryItem(e)):this.activateSecondaryItem(e)},getAngle:function(e,t){var i,n,s,a,o,r,l;return e&&t?(i=e.x,n=e.y,s=t.x,a=t.y,o=s-i,r=a-n,l=Math.round(180*Math.atan2(o,r)/Math.PI*10)/10):null},delayedOpen:function(){this.timer.navOpen=window.setTimeout(this.open,this.defaultSettings.navTimeout)},delayedClose:function(){this.timer.navClose=window.setTimeout(this.close,this.defaultSettings.navTimeout)},cancelDelayedOpen:function(){window.clearTimeout(this.timer.navOpen)},cancelDelayedClose:function(){window.clearTimeout(this.timer.navClose)},delayedModalOpen:function(){this.timer.modalOpen=window.setTimeout(this.navigationModal.open,this.defaultSettings.navTimeout)},delayedModalClose:function(){var e=this;this.cancelDelayedPrimaryHover(),this.cancelDelayedSecondaryHover(),this.timer.modalClose=window.setTimeout(function(){e.modalClose()},this.defaultSettings.navTimeout)},modalClose:function(){this.$el.find("a").removeClass("active"),this.navigationModal.close(),this.broadcast("nyt:navigation-level-one-closed")},cancelDelayedModalOpen:function(){window.clearTimeout(this.timer.modalOpen)},cancelDelayedModalClose:function(){window.clearTimeout(this.timer.modalClose)},delayedPrimaryHover:function(e){var t=this;t.timer.primaryHoverIntent=window.setTimeout(function(){t.activatePrimaryItem(e)},this.defaultSettings.hoverTimeout)},cancelDelayedPrimaryHover:function(){window.clearTimeout(this.timer.primaryHoverIntent)},delayedSecondaryHover:function(e){var t=this;t.timer.secondaryHoverIntent=window.setTimeout(function(){t.activateSecondaryItem(e)},this.defaultSettings.hoverTimeout)},cancelDelayedSecondaryHover:function(){window.clearTimeout(this.timer.secondaryHoverIntent)},handleClickClose:function(e){0===t(e.target).closest("#navigation, #navigation-modal").length&&this.close()},handleTapClose:function(e){0===t(e.target).closest("#navigation, #navigation-modal").length&&this.close()},saveMousePosition:function(e){this.mouseLocs.length>1?(this.mouseLocs[1].x!==e.pageX||this.mouseLocs[1].y!==e.pageY)&&(this.mouseLocs.push({x:e.pageX,y:e.pageY}),this.mouseLocs.length>this.defaultSettings.maxMouseLocs&&this.mouseLocs.shift()):this.mouseLocs.push({x:e.pageX,y:e.pageY})},toggleFocusEvents:function(e){var t=e?"subscribe":"stopSubscribing";this[t]("nyt:page-key-tab nyt:page-key-up-a11y nyt:page-key-down-a11y",this.handleFocusKey),this[t]("nyt:page-key-esc-a11y nyt:page-key-left-a11y",this.handleCollapseKey),this[t]("nyt:page-key-enter nyt:page-key-right-a11y",this.handleExpandKey),this[t]("nyt:navigation-level-one-open nyt:navigation-level-two-open",this.addFocusableElements),e?(this.focusableElements=[],this.addFocusableElements(),this.$document.on("mousemove",this.detectFalsePositive)):delete this.focusableElements},addFocusableElements:function(e){var t,n;this.settings.a11yEnabled&&(e&&e.length>0?n=".active a[role=menuitem]:visible, .section-heading a.active[role=menuitem]:visible":(e=this.$el,n="a[role=menuitem]:visible, .section-heading a.active[role=menuitem]:visible"),t=e.find(n).toArray(),this.focusableElements.push({first:t[0],all:t,last:i.last(t)}),t[0].focus())},handleFocusKey:function(e){var t=i.last(this.focusableElements),n=this.getKeyDirection(e),s=document.activeElement;if(s===t.last&&"forward"===n)t.first.focus();else if(s===t.first&&"backward"===n)t.last.focus();else if("forward"===n)t.all[i.indexOf(t.all,s)+1].focus();else{if("backward"!==n)return;t.all[i.indexOf(t.all,s)-1].focus()}e.preventDefault()},handleCollapseKey:function(){var e;this.focusableElements.pop(),e=i.last(this.focusableElements),this.focusableElements.length>1?(this.resetNav(this.navLevels.TERTIARY),e.active.focus()):this.focusableElements.length>0?(this.modalClose(),e.active.focus()):this.close()},handleExpandKey:function(e){var n=t(document.activeElement),s=i.last(this.focusableElements);s.active=n,n.hasClass("expandable")&&(e.preventDefault(),n.closest(".secondary").length>0?this.activateSecondaryItem(e):this.activatePrimaryItem(e))},detectFalsePositive:i.throttle(function(e){t(e.target).is('a[role="menuitem"], li[role="presentation"')&&this.disableA11yNav()},1e3),getKeyDirection:function(e){var t="",i=this.pageManager.KEYS,n=e&&e.keyCode?e.keyCode:null;switch(n){case i.UP:case i.LEFT:t="backward";break;case i.DOWN:case i.RIGHT:case i.TAB:t="forward"}return t},enableA11Nav:function(){this.settings.a11yEnabled=!0},disableA11yNav:function(){this.settings.a11yEnabled=!1,this.toggleFocusEvents(!1),this.$document.off("mousemove",this.detectFalsePositive)}});return c}),define("homepage/views/navigation/mini",["underscore/nyt","jquery/nyt","foundation/views/base-view","foundation/models/user-data"],function(e,t,i,n){"use strict";var s=i.extend({el:"#mini-navigation",events:{"click .all-sections-button":"handleSectionsClick","click .sections-button":"handleSectionsClick"},shortcuts:{crosswords:"3300eb4c-284f-4484-af31-0d7d1dba4f4c",timespremier:"99c17804-a343-4a76-bf04-f5793ada48d1"},initialize:function(){e.bindAll(this,"distinguishOptions")},handleDomReady:function(){n.ready(this.distinguishOptions)},distinguishOptions:function(){n.isLoggedIn()&&this.handleLoggedInOptions()},handleLoggedInOptions:function(){n.isPremierSubscriber()&&this.$el.find(".mini-navigation-menu .shortcuts-"+this.shortcuts.timespremier).addClass("enabled"),n.isCrosswordsSubscriber()&&!n.isPremierSubscriber()&&this.$el.find(".mini-navigation-menu .shortcuts-"+this.shortcuts.crosswords).addClass("enabled")},handleSectionsClick:function(e){this.broadcast("nyt:navigation-toggle-ready",e)},handleSearchClick:function(e){this.broadcast("nyt:navigation-search-click",e)}});return s}),define("homepage/views/navigation/in-content-theme",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({el:"#mini-navigation",nytEvents:{"nyt:page-scroll":"toggleTheme"},defaultSettings:{themeClass:"theme-in-content",themeEventName:"nyt:mini-navigation-contenttheme"},navOffset:null,initialize:function(e){this.settings=t.extend({},this.defaultSettings,e),this.navOffset=this.$el.offset()?this.$el.offset().top:""},handleDomReady:function(){this.toggleTheme()},toggleTheme:function(){var e=this.pageManager.getViewport().top,t=this.$el.hasClass(this.settings.themeClass),i=e>this.navOffset;i&&!t?(this.addTheme(),this.broadcast(this.settings.themeEventName,!0)):!i&&t&&(this.removeTheme(),this.broadcast(this.settings.themeEventName,!1))},addTheme:function(){this.$el.addClass(this.settings.themeClass)},removeTheme:function(){this.$el.removeClass(this.settings.themeClass)}});return n}),define("homepage/instances/navigation",["shared/navigation/views/navigation","homepage/views/navigation/mini","homepage/views/navigation/in-content-theme"],function(e,t,i){"use strict";new e,new t,new i}),define("homepage/views/inside-nyt/inside-nyt",["underscore/nyt","jquery/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({el:"#inside-nyt-browser",settings:{visibleItems:6},hammerSettings:{drag_block_vertical:!0,swipe_velocity:.7,drag_min_distance:3},events:{"click .navigation-control .next:not(.deactivated)":"handleNextArrowClick","click .navigation-control .previous:not(.deactivated)":"handlePreviousArrowClick","dragstart .carousel":"handleDragStart","drag .carousel":"handleDrag","swipe .carousel":"handleSwipe"},currentPosition:0,initialize:function(){this.trackingBaseData={action:"click",region:"inside-nyt-region",version:"Moth"}},handleDomReady:function(){var e;this.$carousel=this.$el.find(".carousel"),this.$menu=this.$carousel.find(".menu"),this.$items=this.$menu.find("li"),this.totalItems=this.$items.length,this.itemWidth=this.$items.eq(1).width()+parseInt(this.$items.eq(1).css("margin-left"),10),this.totalWidth=this.$items.length*this.itemWidth,this.isAnimating=!1,this.pointer=1,this.$menu.css("width",this.totalWidth+"px"),this.assignCustomEasing(),this.totalItems<=this.settings.visibleItems&&this.$el.find(".navigation-control").hide(),e=Math.max(this.$menu.height(),this.$carousel.height())+3,this.$carousel.height(e),this.$items.height(e)},animateToPointer:function(e){var t=this,i=(e-1)*this.itemWidth;t.isAnimating=!0,t.$menu.animate({left:"-"+i+"px"},function(){t.isAnimating=!1,t.activateArrows(e)})},activateArrows:function(e){var i=t(".navigation-control"),n=this.totalItems-this.settings.visibleItems+1;i.find("button").removeClass("deactivated"),1===e?i.find(".previous").addClass("deactivated"):e===n&&i.find(".next").addClass("deactivated")},getNextRemainingItems:function(){return this.totalItems-this.pointer-this.settings.visibleItems},getPreviousRemainingItems:function(){return this.pointer-1},getNextPointerValue:function(){return this.getNextRemainingItems()<this.settings.visibleItems?this.pointer+this.getNextRemainingItems()+1:this.pointer+this.settings.visibleItems},getPreviousPointerValue:function(){return this.getPreviousRemainingItems()<this.settings.visibleItems?this.pointer-this.getPreviousRemainingItems():this.pointer-this.settings.visibleItems},next:function(){var e=this.getNextPointerValue();this.pointer!==e&&(this.animateToPointer(e),this.pointer=e)},previous:function(){var e=this.getPreviousPointerValue();this.pointer!==e&&(this.animateToPointer(e),this.pointer=e)},handleNextArrowClick:function(){this.isAnimating===!1&&this.next(),this.trackingTrigger("moth-forwardscroll-click",{module:"inside-nyt-region",region:"inside-nyt-region",eventName:"inside-nyt-region-right-arrow-click"})},handlePreviousArrowClick:function(){this.isAnimating===!1&&this.previous(),this.trackingTrigger("moth-backwardscroll-click",{module:"inside-nyt-region",region:"inside-nyt-region",eventName:"inside-nyt-region-left-arrow-click"})},handleDragStart:function(){this.currentPosition=this.$menu.css("left")},handleDrag:function(e){var t,i;e.gesture.preventDefault(),this.stopSwipeAnimation(),t=parseInt(this.currentPosition,10),i=this.checkLeftValue(t+e.gesture.deltaX),this.$menu.css("left",i+"px")},handleSwipe:function(e){var t,i,n,s,a=this,o={},r=2e3;e.gesture.preventDefault(),this.stopSwipeAnimation(),t=1+e.gesture.distance/a.$el.width(),i=e.gesture.deltaX*t,s=r/e.gesture.velocityX,n=this.checkLeftValue(parseInt(a.$menu.css("left"),10)+i),o={duration:s,easing:"easeOutCirc"},this.animateSwipe(n,o)},animateSwipe:function(e,t){this.$menu.animate({left:e},t)},stopSwipeAnimation:function(){this.$menu.stop()},checkLeftValue:function(e){var t=-1*(this.totalWidth-this.settings.visibleItems*this.itemWidth);return e>0&&(e=0),t>e&&(e=t),e},assignCustomEasing:function(){return t.easing.easeOutCirc=function(e,t,i,n,s){return n*Math.sqrt(1-(t=t/s-1)*t)+i},this}});return n}),define("homepage/instances/inside-nyt",["homepage/views/inside-nyt/inside-nyt"],function(e){"use strict";new e}),define("shared/slideshow/templates",["underscore/nyt"],function(_){var templates={};return templates.embeddedSlideshow=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",isLede===!1&&(__p+='\n<h4 class="headline">'+(null==(__t=headline)?"":__t)+"</h4>\n"),__p+='<div class="container">\n<div class="content-container">\n<div class="image"></div>\n<div class="caption-container">\n<figcaption class="caption" itemprop="description"></figcaption>\n</div>\n</div>\n</div><nav class="arrow-navigation">\n<span class="counter"></span>\n<button class="arrow-navigation-previous">\n<span class="visually-hidden">Go to previous slide</span>\n<div class="arrow arrow-left">\n<div class="arrow-conceal"></div>\n</div>\n</button>\n<button class="arrow-navigation-next">\n<span class="visually-hidden">Go to next slide</span>\n<div class="arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n</button>\n</nav>';return __p},templates.embeddedSlideshowHP=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="content-container">\n<div class="image"></div>\n<nav class="arrow-navigation">\n<button class="arrow-navigation-previous">\n<span class="visually-hidden">Go to previous slide</span>\n<div class="arrow arrow-left">\n<div class="arrow-conceal"></div>\n</div>\n</button>\n<button class="arrow-navigation-next">\n<span class="visually-hidden">Go to next slide</span>\n<div class="arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n</button>\n<span class="counter"></span>\n</nav>\n<figcaption class="caption" itemprop="description"></figcaption>\n</div>';return __p},templates.image=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",__p+="homepage"===applicationName?'\n<a href="'+(null==(__t=url)?"":__t)+'" style="display:none;"><img src="'+(null==(__t=src)?"":__t)+'" data-caption="" /></a>\n':'\n<img src="'+(null==(__t=src)?"":__t)+'" data-caption="" style="display:none;" />\n<nav class="image-navigation previous">\n<span class="visually-hidden">Go to previous slide</span>\n</nav>\n<nav class="image-navigation next">\n<span class="visually-hidden">Go to next slide</span>\n</nav>\n',__p+="";return __p},templates.imageInfo=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<span class="caption-control" style="display:none;">\n<span class="caption-text">\n'+(null==(__t=caption)?"":__t)+'\n</span>\n<span class="credit" itemprop="copyrightHolder">\n<span class="visually-hidden">Credit</span>\n'+(null==(__t=credit)?"":__t)+"\n</span>\n</span>";return __p},templates}),define("shared/slideshow/views/embedded-slideshow",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/base-view","shared/slideshow/templates"],function(e,t,i,n,s,a){"use strict";var o=s.extend({speed:1e3,defaultSlideshowCaptionHeight:50,ledeSlideshowCaptionHeight:67,ledeSquareSlideshowSideCaptionHeight:245,firstSlide:!0,hammerSettings:{tap_max_touchtime:400,swipe_velocity:.1,drag_min_distance:3},imageShapes:{PANORAMIC:"ratio-panoramic",LANDSCAPE:"ratio-landscape",SQUARE:"ratio-square",PORTRAIT:"ratio-portrait"},slideshowTypes:{MIXED:"mixed",ALLPORTRAIT:"allPortrait",ALLSQUARE:"allSquare"},$prevArrow:e(),$nextArrow:e(),$captionText:e(),events:{"click .arrow-navigation-previous":"prevAsset","click .arrow-navigation-next":"nextAsset","click .image-navigation.previous":"prevAsset","click .image-navigation.next":"nextAsset","mouseenter .image-navigation.previous":"lightPrevArrow","mouseleave .image-navigation.previous":"unLightPrevArrow","mouseenter .image-navigation.next":"lightNextArrow","mouseleave .image-navigation.next":"unLightNextArrow",drag:"handleDrag",swipeleft:"nextAsset",swiperight:"prevAsset"},initialize:function(e){this.assetIndex=0,t.bindAll(this,"prevAsset","nextAsset","lightPrevArrow","unLightPrevArrow","lightNextArrow","unLightNextArrow"),e.showOnInit||this.$el.hide(),this.$body.off("click",".slideshow"),this.isMobile=this.pageManager.isMobile(),this.isLede=this.isSlideshowLede(),this.trackingBaseData={module:"Slideshow",action:"click",contentCollection:this.pageManager.getMeta("article:section"),version:"Embedded",region:"Body"},this.captionList=e.captionList,this.cropList=e.cropList,this.template=e.template||"embeddedSlideshow",this.truncateCaptions="boolean"==typeof e.truncateCaption?e.truncateCaption:!0},handleDomReady:function(){var e=a[this.template];this.getAssetsFromJSON(this.$el,this.captionList,this.cropList),this.setSlideshowClass(),this.$el.append(e({headline:this.headline,collection:this.collection,isMobile:this.isMobile,isLede:this.isLede})),this.$prevArrow=this.$el.find(".arrow-navigation-previous"),this.$nextArrow=this.$el.find(".arrow-navigation-next"),this.render(),this.setCounter(),this.$el.fadeIn(this.speed),this.trackingBaseData.contentID=this.assetID,this.debouncedHandleWindowResize=t.debounce(this.handleWindowResize,250),this.isSlideshowLede()&&this.subscribe(this.pageManager,"nyt:page-resize",this.debouncedHandleWindowResize)},findBasedOnList:function(e,t){var i;for(i=0;i<=t.length;i+=1)if(e.hasOwnProperty(t[i]))return e[t[i]];return{}},getImageShape:function(e,t){var i=1.7,n=1.1,s=.9,a=e/t;return a>i?this.imageShapes.PANORAMIC:a>n?this.imageShapes.LANDSCAPE:a>s?this.imageShapes.SQUARE:this.imageShapes.PORTRAIT},getAssetsFromJSON:function(i,s,a){var o,r,l,d=this,c=i.find("script").get(0).innerHTML,h=e.parseJSON(c),u=!0,m=!0,p=0;this.slideshowType=this.slideshowTypes.MIXED,this.headline=h.headline||"",this.assetID=h.id;try{h=t.map(h.imageslideshow.slides,function(e){return o=d.findBasedOnList(e.image_crops,a),r=d.findBasedOnList(e.caption,s),l=d.getImageShape(o.width,o.height),p=p>o.height?p:o.height,l!==d.imageShapes.PORTRAIT&&(u=!1),l!==d.imageShapes.SQUARE&&(m=!1),
o?{src:o.url,caption:r,credit:e.credit,imageShape:l}:null})}catch(g){h=[]}h=t.filter(h,function(e){return!!e}),u?this.slideshowType=this.slideshowTypes.ALLPORTRAIT:m&&(this.slideshowType=this.slideshowTypes.ALLSQUARE),this.tallestImageHeight=p,this.collection=new n,this.collection.reset(h)},render:function(){var i,n,s,o,r=new Image,l=this.$el.find("figure").get("context").getAttribute("data-url"),d=this.pageManager.getApplicationName(),c=this.$el.find(".image"),h=this.$el.find(".caption"),u=this.$el.find(".loader-container"),m=this;return i=this.collection.at(this.assetIndex),n=e(a.image({src:i.get("src"),url:l,applicationName:d})),s=e(a.imageInfo({caption:i.get("caption"),credit:i.get("credit")})),c.html(n),this.isMobile||"homepage"!==d||c.css("height",this.tallestImageHeight),u.css("margin-bottom",0),h.html(s),this.$captionText=this.$el.find(".caption-text"),s.fadeIn(this.speed),o=i.get("imageShape"),this.$el.find(".container").removeClass(t.values(this.imageShapes).join(" ")).addClass(o),r.onload=function(){var e;n.fadeIn(m.speed,function(){m.toggleLoader(!1)}),m.truncateCaptions&&(e=m.getTruncationHeight(o),m.truncateText(m.$captionText,e,!0))},r.src=i.get("src"),this},nextAsset:function(e){var t;e.stopPropagation(),this.moveIndex(1),this.render(),this.setCounter(),t=this.assetIndex+1,this.trackingTrigger("embedded-slideshow-next-image",{eventName:"NextAsset-"+t+(t===this.collection.length?"-Finish":""),mdata:{currentSlide:t,totalSlides:this.collection.length}})},prevAsset:function(e){var t;e.stopPropagation(),this.moveIndex(-1),this.render(),this.setCounter(),t=this.assetIndex+1,this.trackingTrigger("embedded-slideshow-prev-image",{eventName:"PrevAsset-"+t+(t===this.collection.length?"-Finish":""),mdata:{currentSlide:t,totalSlides:this.collection.length}})},setCounter:function(){var e;this.$counter=this.$el.find(".counter"),e=this.assetIndex,this.$counter.html(e+1+" of "+this.collection.length)},moveIndex:function(e){var t=this.assetIndex,i=this.collection.length;t+=e,t===i?t=0:-1===t&&(t=i-1),this.assetIndex=t},handleDrag:function(e){var t=e.gesture;("right"===t.direction||"left"===t.direction)&&t.preventDefault()},getTruncationHeight:function(e){return this.isWideLedeSquareNoAdSlideshow()?this.ledeSquareSlideshowSideCaptionHeight:this.isLedeMixedNoAdSlideshow()?this.defaultSlideshowCaptionHeight:this.isSlideshowLede()?this.ledeSlideshowCaptionHeight:this.slideshowType===this.slideshowTypes.ALLPORTRAIT?300:this.slideshowType===this.slideshowTypes.ALLSQUARE?184:e===this.imageShapes.PORTRAIT?290:e===this.imageShapes.SQUARE?224:this.defaultSlideshowCaptionHeight},isSlideshowLede:function(){return this.$el.hasClass("lede")},setSlideshowClass:function(){var e,t=this.slideshowType;(t===this.slideshowTypes.ALLPORTRAIT||t===this.slideshowTypes.ALLSQUARE)&&(e=t.replace(/^all/,"format-all-").toLowerCase(),this.$el.addClass(e))},hasLedeAd:function(){var e=this.pageManager.$html;return e.hasClass("has-xxl")||e.hasClass("has-big-ad")||e.hasClass("has-half-page")},toggleLoader:function(e){var t=this.$el.find(".loader-container");e?t.show():t.hide()},lightPrevArrow:function(){this.unLightNextArrow(),this.$prevArrow.addClass("hover")},unLightPrevArrow:function(){this.$prevArrow.removeClass("hover")},lightNextArrow:function(){this.unLightPrevArrow(),this.$nextArrow.addClass("hover")},unLightNextArrow:function(){this.$nextArrow.removeClass("hover")},isWideLedeSquareNoAdSlideshow:function(){var e=this.pageManager.getCurrentBreakpoint();return!this.hasLedeAd()&&this.isSlideshowLede()&&this.slideshowType===this.slideshowTypes.ALLSQUARE&&e>=1030?!0:!1},isLedeMixedNoAdSlideshow:function(){return!this.hasLedeAd()&&this.isSlideshowLede()&&this.slideshowType===this.slideshowTypes.MIXED?!0:!1},handleWindowResize:function(){var e;this.truncateCaptions&&(e=this.ledeSlideshowCaptionHeight,this.isWideLedeSquareNoAdSlideshow()&&(e=this.ledeSquareSlideshowSideCaptionHeight),this.truncateText(this.$captionText,e,!0))}});return o}),define("homepage/instances/embedded-slideshow",["jquery/nyt","shared/slideshow/views/embedded-slideshow"],function(e,t){"use strict";var i,n;e("body").find(".slideshow").each(function(s,a){"inline"===e(this).data("media-action")&&(n=["largeWidescreen573","largeHorizontal375"],e(this).data("crop")&&(n=[e(this).data("crop")]),i={el:a,captionList:["short"],cropList:n,showOnInit:!0,template:"embeddedSlideshowHP"},new t(i))})}),define("shared/page/helpers/page-mixin",["jquery/nyt"],function(e){"use strict";var t={handleSwipe:function(e){this.broadcast("nyt:app-swipe",e,e.gesture.direction)},handleSwipeStartEnd:function(e){var t="swipestart"===e.type?"start":"end";this.broadcast("nyt:app-swipe",e,t)},handleDrag:function(t){!t||e(t.srcElement).closest(".slideshow").length>0||this.broadcast("nyt:app-drag",t,t.gesture.direction)},handleDragStartEnd:function(t){var i="dragstart"===t.type?"start":"end";!t||e(t.srcElement).closest(".slideshow").length>0||this.broadcast("nyt:app-drag",t,i)},truncateCaptionText:function(){var t=this;this.$el.find("figure").each(function(){var i,n,s=88,a=e(this);a.hasClass("layout-small-vertical")||a.hasClass("layout-small-horizontal")||a.hasClass("has-adjacency layout-large-horizontal")?(n=a.find(".caption-text"),n>=1&&n.html().indexOf("<")<0&&t.truncateText(n,s,!0)):a.hasClass("layout-large-horizontal")?(i=a.find("img").height()-s,n=a.find(".caption-text"),n>=1&&n.html().indexOf("<")<0&&t.truncateText(n,i,!0)):a.hasClass("photo")&&a.hasClass("inline")&&(n=a.find(".caption-text"),n>=1&&n.html().indexOf("<")<0&&t.truncateText(n,s,!0))})}};return t}),define("shared/page/helpers/inactivity-timer-mixin",["underscore/nyt","jquery/nyt"],function(e,t){"use strict";var i={inactivityTimerTimeout:null,inactivityTimerDuration:6e5,inactivityTimerEnabled:!1,inactivityTimerLocked:!1,preInactivityTimerEnabled:!0,bindInactivityTimerEvents:function(){e.bindAll(this,"startInactivityTimer","enableInactivityTimer","disableInactivityTimer","reenableInactivityTimer","completeInactivityTimer"),this.subscribe("nyt:inactivity-timer-enable",this.handleTimerEnable),this.subscribe("nyt:inactivity-timer-disable",this.handleTimerDisable),this.subscribe("nyt:user-activity",this.reenableInactivityTimer)},handleTimerEnable:function(){this.unlockInactivityTimer(),this.preInactivityTimerEnableDuration?setTimeout(this.enableInactivityTimer,this.preInactivityTimerEnableDuration):this.enableInactivityTimer()},handleTimerDisable:function(){this.disableInactivityTimer(),this.lockInactivityTimer()},startInactivityTimer:function(){var e=this;this.inactivityTimerTimeout&&this.stopInactivityTimer(),this.inactivityTimerTimeout=window.setTimeout(function(){e.disableInactivityTimer(),e.lockInactivityTimer(),e.completeInactivityTimer()},this.inactivityTimerDuration)},enableInactivityTimer:function(e){var t=e&&e.data?e.data:this;t.inactivityTimerEnabled||t.inactivityTimerLocked||(t.preInactivityTimerEnabled=!1,t.inactivityTimerEnabled=!0,t.startInactivityTimer())},disableInactivityTimer:function(){this.inactivityTimerEnabled&&!this.inactivityTimerLocked&&(this.inactivityTimerEnabled=!1,this.stopInactivityTimer())},reenableInactivityTimer:function(){this.inactivityTimerEnabled&&!this.inactivityTimerLocked&&(this.disableInactivityTimer(),this.enableInactivityTimer())},stopInactivityTimer:function(){window.clearTimeout(this.inactivityTimerTimeout),this.inactivityTimerTimeout=null},lockInactivityTimer:function(){this.inactivityTimerLocked=!0},unlockInactivityTimer:function(){this.inactivityTimerLocked=!1},completeInactivityTimer:t.noop};return i}),define("shared/community/models/static-comment-service",["foundation/models/base-model"],function(e){"use strict";var t=e.extend({defaults:{assetID:0,assetURL:"",createDate:0,commentCount:0,canSubmit:0},canSubmit:function(){return parseInt(this.get("canSubmit"),10)>0}});return t}),define("shared/community/collections/static-comment-service",["foundation/collections/base-collection","shared/community/models/static-comment-service","foundation/hosts"],function(e,t,i){"use strict";var n=e.extend({url:i.s1Host+"/ugc/comments/commentData.json",model:t,parse:function(e){return e&&e.results?e.results.assets:[]},getCommentCountByURL:function(e){return this.findWhere({assetURL:e})?this.findWhere({assetURL:e}).get("commentCount"):-1}});return n}),define("homepage/instances/comment-counts",["shared/community/collections/static-comment-service"],function(e){"use strict";return new e}),define("homepage/views/homepage",["underscore/nyt","jquery/nyt","foundation/models/user-data","foundation/helpers/utils","foundation/views/base-view","shared/page/helpers/page-mixin","shared/page/helpers/inactivity-timer-mixin","homepage/instances/comment-counts","foundation/cookies"],function(e,t,i,n,s,a,o,r,l){"use strict";var d=s.extend(a).extend(o).extend({el:"body",events:{"click #markets-search-label":"handleMarketsSearchClick","click .top-news a, .pocket-region a, .region .opinion a":"handleTopNewsClick","click .region .day-part a, .region .markets .story":"handleDayPartClick","click .classifieds .real-estate .story, .classifieds .job-market .story":"handleTopNewsClick","click .well a":"handleWellClick","click #recommendations .most-emailed a":"handleMostEmailedClick","click #recommendations .most-viewed a":"handleMostViewedClick","click #recommendations .recommended a":"handleRecommendedClick","click #mobile-banner a":"removeMobileCookie"},nytEvents:{"nyt:video-play":"handleVideoPlay","nyt:video-ad-start":"handleVideoPlay","nyt:video-video-paused":"handleVideoStop","nyt:video-complete":"handleVideoStop","nyt:page-scroll":"handlePageScrolled","nyt:on-focus":"handleOnFocus"},sectionMapping:{World:"world",BusinessDay:"business",Opinion:"opinion","U.S.":"us",Technology:"technology",Arts:"arts",Politics:"politics",Sports:"sports",Movies:"movies",NewYork:"nyregion",Obituaries:"obituaries",Theater:"theater",Science:"science",Travel:"travel",Television:"television",Health:"health",Food:"food",Books:"books",Education:"education",TimesInsider:"times-insider",SundayReview:"sunday-review",RealEstate:"realestate","Fashion&Style":"fashion",Magazine:"magazine",Automobiles:"automobiles",TMagazine:"t-magazine",TheUpshot:"upshot",InternationalOpinion:"opinion",InternationalArts:"arts",InternationalBusiness:"business",InternationalStyle:"fashion",InternationalSports:"sports","GreatHomes&Destinations":"realestate","U.S.Politics":"politics"},inactivityTimerDuration:6e4,preInactivityTimerEnableDuration:3e5,timestampCounter:0,adUnitMetrics:[],initialize:function(){var e=this.pageManager.getUrlParam("activity-rate"),t=this.pageManager.getUrlParam("inactivity-rate");e&&(this.preInactivityTimerEnableDuration=e),t&&(this.inactivityTimerDuration=t)},handleDomReady:function(){var e,i,n,s,a;if(this.bindInactivityTimerEvents(),this.updateCommentCounts(),this.updateTimestamps(),this.determineMobileVersionVisibility(),this.setDaypartItemHeight(),setTimeout(this.enableInactivityTimer,this.preInactivityTimerEnableDuration),this.pageManager.flag("hpVisibilityTracking")){for(e=[],"undefined"!=typeof window.NYTADX&&(e=window.NYTADX.positions),a=0;a<e.length;a++)i=t("#"+e[a]),n=0,1===i.length&&(n=i.offset().top-50),s=i.height(),n>0&&this.adUnitMetrics.push({ad:e[a],loadPoint:n,height:s,seen:!1});this.handlePageScrolled(!0)}},handlePageScrolled:function(i){var n,s,a,o,r;if(this.pageManager.flag("hpVisibilityTracking")){for(n=t(window).scrollTop(),s=t(window).height(),a={},o=0;o<this.adUnitMetrics.length;o++)r=this.adUnitMetrics[o],r.seen===!1&&r.loadPoint<n+s&&(r.seen=!0,a[r.ad]=!0);i&&e.extend(a,{onDomReady:!0}),e.isEmpty(a)||this.trackingTrigger("hp-ad-visibility-scroll",a)}},updateTimestamps:function(){var e=this,i=t("section:not(.times-wire) .timestamp"),n=6e4;e.timestampCounter+=1,e.timestampCounter<=20&&(n=1e3),this.renderTimestamps(i,!1),setTimeout(function(){e.updateTimestamps()},n)},renderTimestamps:function(e,i){var n,s=this,a=function(e){return e>=3600?!0:void 0};e.each(function(){var e=t(this).data("utc-timestamp"),o=Math.ceil(Math.log(e+1)/Math.LN10),r=13;e=r>o?e*Math.pow(10,r-o):e,n=s.prettyDate(e,i,a),n&&t(this).text(n)})},updateCommentCounts:function(){r.length>0?this.renderCommentCounts():(r.fetch(),this.subscribeOnce(r,"sync",this.renderCommentCounts))},renderCommentCounts:function(){var e,i,n;this.$linkList=this.$el.find(".comments-link"),this.$linkList.each(function(){e=t(this).attr("href").match(/[^?#]+/)[0],i=r.getCommentCountByURL(e),i>0&&(n=1===i?" Comment":" Comments",t(this).find(".comment-count").html(i+n))})},handleMarketsSearchClick:function(){t(".markets-search").addClass("active")},completeInactivityTimer:function(){var t,i,s,a=window.location.href,o={"WT.z_jog":"1"},r=!0;if(this.pageManager.flag("hpVisibilityTracking"))try{i=document.visibilityState.substr(0,3)}catch(l){i="e"}if(this.pageManager.flag("hpVisibilityTracking")||this.pageManager.flag("hpViewability")){try{t=(document.hasFocus()+"").charAt(0)}catch(l){t="e"}r="e"===i||"vis"===i?!0:!1,e.extend(o,{hF:t,vS:i})}s=n.appendQueryParams(a,o),(!this.pageManager.flag("hpViewability")||this.pageManager.currentlyHasFocus||r)&&(window.location.href=s)},handleOnFocus:function(){this.pageManager.flag("hpViewability")&&!this.preInactivityTimerEnabled&&this.completeInactivityTimer()},handleAnchorClick:function(e,i){var s,a=t(e.target);i=i||{},a.is("a")||(a=a.parents("a")),s=a.attr("href"),s&&(s=n.appendQueryParams(s,i),a.attr("href",s))},handleTopNewsClick:function(e){this.handleAnchorClick(e,{hp:""})},handleDayPartClick:function(e){this.handleAnchorClick(e,{src:"dayp"})},handleWellClick:function(e){var i=t(e.target),n=i.closest("ul").prev().children("a").text().replace(/\u00bb|\s+/g,""),s=this.sectionMapping[n]||"";this.handleAnchorClick(e,{hpw:"",rref:s})},handleMostEmailedClick:function(e){this.handleAnchorClick(e,{src:"me"})},handleMostViewedClick:function(e){this.handleAnchorClick(e,{src:"mv"})},handleRecommendedClick:function(e){this.handleAnchorClick(e,{src:"rechp"})},handleVideoPlay:function(e){t(e.container).closest(".video").find(".caption").fadeTo(200,0),this.broadcast("nyt:inactivity-timer-disable")},handleVideoStop:function(){this.broadcast("nyt:inactivity-timer-enable")},determineMobileVersionVisibility:function(){var e=l.readCookie("nyt-mobile");"0"===e&&t("#mobile-banner").removeClass("hidden")},removeMobileCookie:function(){l.deleteCookie("nyt-mobile")},handleUserReady:function(){var e=i.isCrosswordsSubscriber(),n=i.isPremierSubscriber();e&&!n?t("#crossword-subscription").removeClass("hidden"):n&&!e?t("#times-insider-subscription").removeClass("hidden"):t("#times-premier-crossword-subscription").removeClass("hidden")},setDaypartItemHeight:function(){var e=this.$el.find(".span-ab-bottom-region .split-3-layout"),t=e.find(".section-heading"),i=e.find(".column"),n=10,s=e.height()-t.height()-n;e.height(s),i.height(s)}});return d}),define("homepage/instances/homepage",["homepage/views/homepage"],function(e){"use strict";new e}),define("homepage/views/tracking/tracking",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({el:"body",events:{"click .region a":"handleStoryClick","click .site-index a":"handleSiteIndexClick","click .mini-navigation a":"handleMiniNavClick","click .most-emailed a":"handleMostEmailedClick","click .most-viewed a":"handleMostViewedClick","click .trending a":"handleTrendingClick","click .recommended a":"handleRecommendedClick","click .markets-modal a":"handleMarketsClick","click .video-playlist":"handleVideoScrollClick","click .modal-container.weather-modal-container .user-action a":"handleWeatherModalClick","click .user-subscriptions a":"handleUserSubscriptionClick","click .feedback a":"handleFeedbackClick"},nytEvents:{"nyt:page-scroll":"handleScroll","nyt:page-scroll-after":"handleScrollAfter","nyt:pinned-masthead":"handlePinnedMasthead","nyt:recommended-click-switch":"handleRecommendedClickSwitch","nyt:masthead-search-toggle":"handleSearchToggle","nyt:recommended-tab-click":"handleRecommendedTabClick","nyt:video-playlist-scroll":"handleVideoPlaylistScroll","nyt:navigation-opened":"handleNavigationOpen","nyt:navigation-level-one-open":"handleNavigationLevelOneOpen","nyt:navigation-level-one-closed":"handleNavigationLevelOneClosed"},impressionTrackingData:[{selector:".modal.weather-modal",data:{module:"WeatherModal",region:"TopBar",action:"hover",eventName:"weather-hover"}},{selector:".modal.markets-modal",data:{module:"MarketsModal",region:"TopBar",action:"hover",eventName:"markets-hover"}},{selector:"#times-insider-subscription",data:{module:"timesinsider",region:"c-column-bottom-span-region",action:"impression"}},{selector:"#times-premier-crossword-subscription",data:{module:"timesinsidercrossword",region:"c-column-bottom-span-region",action:"impression"}},{selector:"#crossword-subscription",data:{module:"crosswords",region:"c-column-bottom-span-region",action:"impression"}},{selector:"#recommendations .tabs-container li.selected",data:{region:"CColumn",action:"impression"},handler:"handleRecommendationImpression"},{selector:"#recommendations .tabs-container li.trending-tab",data:{module:"TrendingTab",region:"CColumn",action:"impression",pgtype:"Homepage"}},{selector:"#feedback",data:{module:"feedback-form",region:"feedback-form",action:"impression"}}],initialize:function(){var e=this;this.lastScrollTop=0,this.maxScrollDepth=0,this.maxScrollTop=this.$body.height()-this.$window.height(),this.trackingBaseData={action:"click",pgtype:"Homepage"},this.impressionTimer=setInterval(function(){e.handleImpressionTracking()},1e3)},handleDomReady:function(){var t=this;e("#masthead").on("click",".branding a",function(e){t.handleBrandingClick(e)}),this.handleSlideshowImpression()},handleStoryClick:function(t){var i,n,s,a={},o=e(t.currentTarget),r=o.closest(".region").attr("class").match(/[A-z-]+region/)[0],l=this.getTrackingVersion(o);l&&(a.version=l),"inside-nyt-region"===r&&(a.moduleDetail=this.getInsideNytDetail(o)),i=this.getModRef(o),i&&(a.modref=i),"inside-nyt-region"!==r&&"well-region"!==r&&(s=this.getClickSrc(o),s&&(a.clickSource=s)),a.module=this.getTrackingModule(o)||r,a.region=this.getGeographicalRegionMappingBasedOnScoopRegion(r),a["WT.nav"]=this.getGeographicalRegionMappingBasedOnScoopRegion(r),"span-ab-bottom-region"===r&&(a.module="mini-moth"),n=this.trackingAppendParams(o.attr("href"),a),o.attr("href",n)},getGeographicalRegionMappingBasedOnScoopRegion:function(e){var t=e;switch(e){case"well-region":t="bottom-well";break;case"span-ab-bottom-region":t="top-stories-below";break;case"first-column-region":case"second-column-region":case"third-column-region":case"span-ab-top-region":case"photo-spot-region":case"span-ab-lede-package-region":case"a-lede-package-region":case"b-lede-package-region":case"bottom-span-promo-region":t="top-news"}return t},getTrackingModule:function(e){var t=e.attr("class")||"";return t.indexOf("times-video-link")>=0?"times-video":t.indexOf("explore-all-videos-link")>=0?"more-video":t.indexOf("watch-link")>=0?"watch-in-times-video":void 0},getTrackingVersion:function(e){var t,i=e.attr("class")||"",n=e.closest("article").data("collection-renderstyle");return"Moth"===n?t=e.closest("li").index()<=5?"Moth-Visible":"Moth-Hidden":i.indexOf("times-video-link")>=0||i.indexOf("watch-link")>=0?t="timesvideo-heading":i.indexOf("explore-all-videos-link")>=0&&(t="morevideo-link"),t||""},getModRef:function(e){var t=this.getReferType(e);return 0!==e.closest(".theme-comments").length?"HPCommentsRefer":0!==e.closest(".refer").length?t:""},getClickSrc:function(e){var t,i=e.find("img");return t=0!==i.length?i.parents("[class]:eq(0)").attr("class")?i.parents("[class]:eq(0)").attr("class"):i.closest("a").attr("class"):"story-heading"},getReferType:function(e){var t=e.find(".icon");return t.hasClass("video")?"HPVideoRefer":t.hasClass("audio")?"HPAudioRefer":t.hasClass("interactive")?"HPInteractiveRefer":t.hasClass("slideshow")?"HPSlideshowRefer":t.hasClass("graphic")?"HPGraphicRefer":t.hasClass("map")?"HPMapRefer":""},getInsideNytDetail:function(e){var t=e.parents("li:eq(0)");return"inside-nyt-region-"+t.index()},handleMiniNavClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{region:"TopBar",module:"HPMiniNav",contentCollection:i.html(),"WT.nav":"page"});i.attr("href",n)},handleMarketsClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{region:"TopBar",module:"HPMiniNav",contentCollection:"Markets","WT.nav":"page"});i.attr("href",n)},handleVideoScrollClick:function(t){var i=e(t.target),n=i.closest("li"),s=n.index(),a=n.find(".headline").text(),o={pgtype:"Homepage",action:"click",region:"video-player-region",module:"video-side-scroll",contentPlacement:s,contentId:a};this.trackingTriggerRaw("video-player-side-scroll",o,"interaction")},handleSiteIndexClick:function(t){var i,n=e(t.currentTarget),s={region:"SiteIndex",module:"SiteIndex",contentCollection:n.html(),"WT.nav":"footer-nav"};n.find(".nyt-logo").length>0&&(s.contentCollection="NYTlogoHome"),n.parents(".user-action").length>0&&(s.contentCollection="GoToHPCTA"),i=this.trackingAppendParams(n.attr("href"),s),n.attr("href",i)},handleMostEmailedClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{region:"CColumn",module:"MostEmailed",version:"Full",src:"me","WT.nav":"MostEmailed"});i.attr("href",n)},handleTrendingClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"Trending",region:"CColumn"});i.attr("href",n)},handleMostViewedClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{region:"CColumn",module:"MostViewed",version:"Full",src:"mv","WT.nav":"MostViewed"});i.attr("href",n)},handleRecommendedClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{region:"CColumn",module:"Recommendation",src:"rechp","WT.nav":"RecEngine"});i.attr("href",n)},updateScrollDepth:function(){var e=this.lastScrollTop/this.maxScrollTop*100,t=25*Math.floor(e/25);t>this.maxScrollDepth&&(this.maxScrollDepth=t,window.NYTD&&"function"==typeof window.NYTD.EventTracker&&(this.eventTracker||(this.eventTracker=new window.NYTD.EventTracker),this.eventTracker.track({name:"scroll-depth",module:"homepage",depth:t,subject:"interaction"})))},handleScrollAfter:function(){var e=this.$window.scrollTop(),t=e-this.lastScrollTop;100>t||(this.lastScrollTop=e,this.updateScrollDepth())},handlePinnedMasthead:function(e){this.trackingTrigger("pinned-masthead",{action:"scroll",module:"topNav",region:"TopBar",pgtype:"Homepage",eventName:e?"masthead-pin":"masthead-unpin"})},handleScroll:t.throttle(function(){this.impressionTrackingData.length>0&&this.handleImpressionTracking()},400),handleImpressionTracking:function(){var e,t=this.impressionTrackingData,i=t.length;for(e=0;i>e;e++)if(this.isElementInViewport(t[e])){t.splice(e,1),0===t.length&&clearInterval(this.impressionTimer);break}},isElementInViewport:function(t){var i=e(t.selector),n=t.data,s=t.handler;return this.pageManager.isComponentVisible(i)?(n.pgtype="Homepage",s?this[s](i,n):this.trackingTriggerImpression("hp-impression",n),!0):!1},handleRecommendedClickSwitch:function(e){this.trackingTrigger("rec-switch",{module:"Recommendation",region:"CColumn",action:"click",pgtype:"Homepage",eventName:e?"recommended-show-click":"recommended-dont-show-click"})},handleRecommendedTabClick:function(t,i){var n=e("#recommendations").find(".tab-content:visible").attr("class");i||(n&&(n=n.replace("tab-content ","")),this.trackingTrigger("rec-tabs",{module:n,region:"CColumn",action:"click",pgtype:"Homepage",eventName:t+"-tab-click"}))},handleSearchToggle:function(e){this.trackingTrigger("search-close",{module:"SearchClose",region:"TopBar",action:"click",pgtype:"Homepage",eventName:e?"OpenSearchBar":"CloseSearchBar"})},handleBrandingClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"MastheadLogo",region:"TopBar",action:"click"});i.attr("href",n)},handleWeatherModalClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"HPMiniNav",region:"TopBar",action:"click",pgtype:"Homepage",contentCollection:"Weather"});i.attr("href",n)},handleUserSubscriptionClick:function(t){var i,n=e(t.currentTarget),s=n.closest(".collection");s.hasClass("insider-collection")?i=this.trackingAppendParams(n.attr("href"),{module:"timesinsider",region:"c-column-bottom-span-region",action:"click",pgtype:"Homepage"}):s.hasClass("crosswords-collection")&&(i=this.trackingAppendParams(n.attr("href"),{module:"crosswords",region:"c-column-bottom-span-region",action:"click",pgtype:"Homepage"})),n.attr("href",i)},handleVideoPlaylistScroll:function(e){this.trackingTrigger("video-playlist-scroll",{module:"video-player",region:"TopBar",action:"scroll",pgtype:"Homepage",eventName:"video-strip-scroll-"+e})},handleNavigationOpen:function(){this.trackingTrigger("navigation-open",{module:"SectionsNav",region:"TopBar",action:"click",pgtype:"Homepage"})},handleNavigationLevelOneOpen:function(e){var t=this,i=e?e.find(".secondary-container .section-heading").text():"";clearTimeout(this.secondaryNavTrackingTimeout),this.secondaryNavTrackingTimeout=setTimeout(function(){t.trackingTrigger("navigation-secondary-open",{module:"SubSectionsNav",region:"TopBar",action:"hover",pgtype:"Homepage",content_collection:i.replace(/\n/g,"")})},1e3)},handleNavigationLevelOneClosed:function(){clearTimeout(this.secondaryNavTrackingTimeout)},handleRecommendationImpression:function(e,t){t.module=e.data("type"),this.trackingTriggerImpression("hp-impression",t)},handleFeedbackClick:function(){this.trackingTrigger("feedback-click",{action:"click",pgtype:"Homepage",region:"feedback-form",module:"feedback-form"})},handleSlideshowImpression:function(){var t=this,i=this.$el.find(".theme-news-headlines .icon.slideshow");i.each(function(){t.trackingTriggerImpression("slideshow-promo-impression",{module:"Slide",action:"impression",slideshowTitle:e(this).parent("a").text().replace("Slide Show: ","")})})}});return n}),define("homepage/instances/tracking",["homepage/views/tracking/tracking"],function(e){"use strict";new e}),define("shared/video/models/playlist-videos",["backbone/nyt","foundation/models/base-model","foundation/hosts"],function(e,t,i){"use strict";var n=t.extend({url:i.videoApiHost+"/svc/video/api/v2/playlist/",fetchData:function(e,t,i,n){var s=this,a=[],o=e.playlistId||"1194811622188";this.success=t,this.error=i,this.passThroughCallback=n,e.count&&a.push("count="+e.count),e.skip&&a.push("skip="+e.skip),this.url+=o,a.length>0&&(this.url+="?"+a.join("&")),this.fetch({success:function(e){s.success&&(s.passThroughCallback&&"function"==typeof s.passThroughCallback?s.success(e,s.passThroughCallback):s.success(e))},error:function(e){s.error&&s.error(e)}})},sync:function(t,i,n){return n.dataType="jsonp",n.timeout=1e4,n.cache=!0,n.jsonp="callback",n.jsonpCallback="hpPlaylistCallback",e.sync(t,i,n)}});return n}),define("homepage/helpers/image-utils",[],function(){"use strict";var e={getCropUrl:function(e,t){var i,n;if(!e||0===e.length||!t||0===t.length)return!1;for(i=0;i<t.length;i++)for(n=0;n<e.length;n++)if(e[n].type===t[i]&&""!==e[n].url)return e[n].url;return!1}};return e}),define("homepage/views/video/playlist-item",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/hosts","homepage/templates","foundation/views/base-view","homepage/helpers/image-utils"],function(e,t,i,n,s,a,o){"use strict";var r=a.extend({template:s.playlistItem,cropPreferences:["videoSixteenByNine150","wide"],initialize:function(e){this.video=e.video,this.video.playlist.parent_channel&&this.video.playlist.parent_channel.headline?this.kicker=this.video.playlist.parent_channel.headline:this.kicker=this.video.playlist.headline,this.thumbnailSrc=this.getThumbnailUrl(),this.duration=this.durationFromMilliseconds(this.video.duration),this.headline=this.video.headline},render:function(){return this.template({kicker:this.kicker,thumbnailSrc:this.thumbnailSrc,duration:this.duration,headline:this.headline})},getThumbnailUrl:function(){var e;return e=o.getCropUrl(this.video.images,this.cropPreferences),e||(e="video/static-timesvideo/img/video-default-16by9-225x126.png"),[n.image,e].join("/")}});return r}),define("homepage/views/video/playlist",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/video/models/playlist-videos","homepage/views/video/playlist-item"],function(e,t,i,n,s){"use strict";var a=i.extend({nytEvents:{"nyt:video-player-finished":"selectNextThumb"},initialize:function(i){t.bindAll(this,"processPlaylistVideos","processPlaylistVideosError"),this.options=e.extend({perPage:10},i),this.videos=[],this.currentPage=0,this.requestData=!0,this.element=this.options.container,this.$videoPlaylist=this.element.find(".video-playlist"),this.fetchPlaylistVideos(),this.registerEvents()},registerEvents:function(){var t=this,i=".video-playlist li";this.element.on("click",i,function(){var i=e(this);t.selectThumb(i,{click:!0})})},tuckFirstThumbUnder:function(){var e=124,t=this.element.find(".video-playlist-container"),i=this;t.animate({scrollTop:e},{complete:function(){i.$videoPlaylist.find("li").first().addClass("selected")}})},selectNextThumb:function(){var e,t=this.$videoPlaylist.find("li.selected");t.length>0&&(e=t.next(),e.length>0&&this.selectThumb(e.first(),{click:!1}))},selectThumb:function(e,t){var i=e.index(),n=this.videos[i];this.$videoPlaylist.find("li").removeClass("selected"),e.addClass("selected"),this.scrollTo(e),t.click?this.broadcast("nyt:video-playlist-selected",n):this.broadcast("nyt:video-playlist-autoplay-next",n)},scrollTo:function(e){var t=e.position().top,i=this.element.find(".video-playlist-container");i.animate({scrollTop:t})},fetchPlaylistVideos:function(e){this.playlist=new n,this.playlist.fetchData({playlistId:this.options.playlistId,count:this.options.perPage,skip:this.currentPage*this.options.perPage},this.processPlaylistVideos,this.processPlaylistVideosError,e),this.currentPage>0&&this.broadcast("nyt:video-playlist-scroll",this.currentPage*this.options.perPage)},processPlaylistVideos:function(e,t){this.videos=this.videos.concat(e.get("videos")),0===this.currentPage&&this.broadcast("nyt:video-playlist-loaded",this.videos[0]),this.renderThumbnails(),0===this.currentPage&&this.tuckFirstThumbUnder(),this.currentPage+=1,"function"==typeof t&&t()},processPlaylistVideosError:function(e,t){"function"==typeof t&&t()},renderThumbnails:function(){var t,i,n,a,o=this.playlist.get("videos"),r=this,l=this.element.find(".loader-container");for(l&&this.handleLoader("remove"),t=this.options.thumbsMax||o.length,e(".video-playlist-container").scroll(function(){r.scrollPercentage=100*this.scrollTop/(this.scrollHeight-this.clientHeight)}),this.updateScroll(),i=0;t>i;i++)n=new s({video:o[i]}),a=e(n.render()),this.$videoPlaylist.append(a);this.handleLoader("append")},handleLoader:function(t){"append"===t?e('<li class="loader-container"><div class="loader"><span class="visually-hidden">Loading...</span></div></li>').appendTo(this.$videoPlaylist):this.$videoPlaylist.find(".loader-container").remove()},renderMoreButton:function(){var t=e('<li class ="button-container"><a href="http://www.nytimes.com/video?src=vidm" class="user-action button">More videos &raquo;</a></li>');this.$videoPlaylist.append(t),this.handleLoader("remove")},updateScroll:function(){var e=this;window.requestAnimationFrame(t.bind(this.updateScroll,this)),e.scrollPercentage>=99&&e.requestData&&(e.requestData=!1,e.fetchPlaylistVideos(function(){e.requestData=!0,e.$videoPlaylist.find("li").length>=100&&(e.requestData=!1,e.renderMoreButton())}))}});return a}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("shared/video/libs/inactivity-timer-manager",[],t):e.InactvityTimerManager=t()}(this,function(){"use strict";function e(e,t){if(this.disableIntervalId=null,this.pageManager=e,this.disableInterval=t||3e4,!e)throw new Error("InactvityTimerManager:: pageManger must be provided");
}return e.prototype.disable=function(e){e=e||this,e.disableIntervalId||(e.disableIntervalId=setInterval(e.disable,e.disableInterval,e)),e.pageManager.trigger("nyt:inactivity-timer-disable")},e.prototype.enable=function(){clearInterval(this.disableIntervalId),this.disableIntervalId=null,this.pageManager.trigger("nyt:inactivity-timer-enable")},e}),define("homepage/views/video/metadata",["jquery/nyt","underscore/nyt","backbone/nyt","homepage/templates","foundation/views/base-view"],function(e,t,i,n,s){"use strict";var a=s.extend({template:n.videoMetadata,initialize:function(e){this.video=e.video},render:function(){return this.$el.html(this.template({byline:this.getByline(),permalink:this.getPermalink()})),this},getByline:function(){return[this.getVideoCredit(),this.getPosterCredit()].join(" ").trim()},getPermalink:function(){return[this.video.domain,this.video.publish_url].join("")},getVideoCredit:function(){var e="";return this.video.byline&&""!==this.video.byline&&(e=0===this.video.byline.toLowerCase().indexOf("by ")?this.video.byline+".":"By "+this.video.byline+"."),e},getPosterCredit:function(){var e="";return this.video.images[0]&&this.video.images[0].credit&&""!==this.video.images[0].credit&&(e="Image by "+this.video.images[0].credit+"."),e}});return a}),define("homepage/views/video/poster",["jquery/nyt","underscore/nyt","backbone/nyt","homepage/templates","foundation/views/base-view"],function(e,t,i,n,s){"use strict";var a=s.extend({template:n.videoPoster,initialize:function(e){this.video=e.video},render:function(){var t=e(this.template({duration:this.getDuration(),headline:this.video.headline,summary:this.video.summary}));return t=this.insertKickerLabel(t),t=this.insertChannel(t),this.$el.html(t),this},insertKickerLabel:function(t){return this.video.playlist.parent_channel&&void 0!==this.video.playlist.parent_channel.headline&&e("<span/>",{"class":"kicker-label",text:this.video.playlist.parent_channel.headline}).insertBefore(t.find(".duration")),t},insertChannel:function(t){var i="";return this.video.playlist.parent_channel&&this.video.playlist.parent_channel.headline!==this.video.playlist.headline&&(void 0===this.video.playlist.parent_channel.headline&&(i="margin-left:0"),e("<span/>",{"class":"channel",style:i,text:this.video.playlist.headline}).insertBefore(t.find(".duration"))),t},getDuration:function(){return this.durationFromMilliseconds(this.video.duration)}});return a}),define("shared/sharetools/models/share-data",["foundation/models/base-model"],function(e){"use strict";var t=e.extend({dataAttributes:{URL:"data-url",TITLE:"data-title",MEDIA:"data-media",DESCRIPTION:"data-description",PUBLICATION_DATE:"data-publish-date",CONTENT_TYPE:"data-content-type",AUTHOR:"data-author",VIA:"data-via"},initialize:function(e){this.$container=e},getUrl:function(){var e=this.$container.attr(this.dataAttributes.URL);return e?e:this.pageManager.getCanonical()},setUrl:function(e){this.$container.attr(this.dataAttributes.URL,e)},getTitle:function(){var e=this.$container.attr(this.dataAttributes.TITLE);return e?e:this.pageManager.getMeta("og:title")},setTitle:function(e){this.$container.attr(this.dataAttributes.TITLE,e)},getAuthor:function(){var e=this.$container.attr(this.dataAttributes.AUTHOR);return e?e:this.pageManager.getMeta("byl")},setAuthor:function(e){this.$container.attr(this.dataAttributes.AUTHOR,e)},getMedia:function(){var e=this.$container.attr(this.dataAttributes.MEDIA);return e?e:this.pageManager.getMeta("og:image")},setMedia:function(e){this.$container.attr(this.dataAttributes.MEDIA,e)},getDescription:function(){var e=this.$container.attr(this.dataAttributes.DESCRIPTION);return e?e:this.pageManager.getMeta("description")},setDescription:function(e){this.$container.attr(this.dataAttributes.DESCRIPTION,e)},getPublicationDate:function(){var e=this.$container.attr(this.dataAttributes.PUBLICATION_DATE);return e?e:this.pageManager.getMeta("DISPLAYDATE")},setPublicationDate:function(e){this.$container.attr(this.dataAttributes.PUBLICATION_DATE,e)},getVia:function(){var e=this.$container.attr(this.dataAttributes.VIA),t=this.pageManager.getMeta("twitter:site");return e?e:"upshot"===this.pageManager.getMeta("CG")?"UpshotNYT":t&&"@nytimes"!==t?t.replace("@",""):""},setVia:function(e){this.$container.attr(this.dataAttributes.VIA,e)},getContentType:function(){var e=this.$container.attr(this.dataAttributes.CONTENT_TYPE);return e?e:"Content"},setContentType:function(e){this.$container.attr(this.dataAttributes.CONTENT_TYPE,e)}});return t}),define("shared/sharetools/templates",["underscore/nyt"],function(_){var templates={};return templates.emailModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<iframe src="'+(null==(__t=emailThisUrl)?"":__t)+(null==(__t=dataUrl)?"":__t)+'" title="Email This" id="emailthis" scrolling="'+(null==(__t=scrolling)?"":__t)+'" marginheight="0" marginwidth="0" frameborder="0"></iframe>';return __p},templates.savemodal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<ul class="instructions">\n<li>This item has been saved to read later from any device. </li>\n<li>Access saved items through your user name at the top of the page.</li>\n</ul>\n<p><a href="'+(null==(__t=link)?"":__t)+'">View Saved Items</a><p>\n<button class="button dismiss-button">OK</button>';return __p},templates.shareTool=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<a href="javascript:;" data-share="'+(null==(__t=id)?"":__t)+'" data-modal-title="'+(null==(__t=loginModalTitle)?"":__t)+'"><i class="icon sprite-icon"></i><span class="sharetool-text '+(null==(__t=isLabelHidden===!0?"visually-hidden":"")?"":__t)+'">'+(null==(__t=label)?"":__t)+"</span></a>";return __p},templates.shareTools=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="<ul>\n",_.each(shares,function(e){__p+='\n<li class="sharetool '+(null==(__t=e.type)?"":__t)+"-sharetool "+(null==(__t=config[e.type].loginRequired?"login-modal-trigger":"")?"":__t)+'" data-modal-title="'+(null==(__t=config[e.type].loginModalText||"")?"":__t)+'">\n<a href="javascript:;" data-share="'+(null==(__t=e.type)?"":__t)+'"><i class="icon sprite-icon"></i><span class="sharetool-text">'+(null==(__t=e.label)?"":__t)+"</span></a>\n</li>\n"}),__p+="\n</ul>";return __p},templates.shareToolsModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="section share ',isCompact&&(__p+="compact-share-tools"),__p+='">\n<ul class="sharetools-menu">\n'+(null==(__t=standardToolsList)?"":__t)+'\n</ul>\n<form class="short-url-form">\n<div class="control">\n<div class="label-container"><label for="short-url-input">Permalink</label></div>\n<div class="field-container">\n<input id="short-url-input" class="short-url-input text" type="text" name="short-url-input" value="'+(null==(__t=shortUrl)?"":__t)+'" readonly="readonly" />\n</div>\n</div>\n</form>\n',isCompact&&showTools&&(__p+='\n<form class="embed-url-form">\n<div class="control">\n<div class="label-container"><label for="embed-input">Embed</label></div>\n<div class="field-container">\n<input id="embed-input" class="embed-input text" type="text" name="embed-input" readonly="readonly" />\n</div>\n</div>\n</form>\n'),__p+="\n</div><!--close section -->\n",!isCompact&&showTools&&(__p+='\n<div class="section tools">\n<h4 class="modal-heading">Tools</h4>\n<ul class="sharetools-menu">\n'+(null==(__t=articleToolsList)?"":__t)+"\n</ul>\n</div><!--close section -->\n"),__p+="";return __p},templates.shareToolsModalFooter=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="ad show-all-sharetool-modal-ad hidden">\n<small class="ad-sponsor">'+(null==(__t=toolTypeSponsor)?"":__t)+" Tools Sponsored By</small>\n</div>";return __p},templates.showAllSharetoolCompactModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="section share">\n<ul class="sharetools-menu">\n'+(null==(__t=showAllLinkList)?"":__t)+'\n</ul>\n</div> <!--close section -->\n<div class="section tools">\n<ul class="sharetools-menu">\n'+(null==(__t=showAllToolList)?"":__t)+'\n</ul>\n<div class="control permalink-control">\n<div class="label-container">\n<label for="permalink-input" class="sharetools-label">Permalink</label>\n</div>\n<div class="field-container">\n<input id="permalink-input" type="text" class="text short-url-input" placeholder="" readonly="readonly" />\n<span class="textbox-fade"></span>\n</div>\n</div><!-- close control -->\n<div class="control embed-control">\n<div class="label-container">\n<label for="embed-input" class="sharetools-label">Embed</label>\n</div>\n<div class="field-container">\n<input id="embed-input" type="text" class="text embed-input" placeholder="" readonly="readonly" />\n<span class="textbox-fade"></span>\n</div>\n</div><!-- close control -->\n</div><!--close section -->';return __p},templates.showAllSharetoolModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="section share">\n<ul class="sharetools-menu">\n'+(null==(__t=showAllLinkList)?"":__t)+'\n</ul>\n<form class="short-url-form">\n<div class="control">\n<div class="label-container"><label for="short-url-input">Permalink</label></div>\n<div class="field-container">\n<input id="short-url-input" class="short-url-input text" type="text" name="short-url-input" value="'+(null==(__t=shortUrl)?"":__t)+'" readonly="readonly" />\n</div>\n</div>\n</form>\n</div> <!--close section -->\n<div class="section tools">\n<h5 class="modal-heading">Tools</h5>\n<ul class="sharetools-menu">\n'+(null==(__t=showAllToolList)?"":__t)+"\n</ul>\n</div><!--close section -->";return __p},templates.showallLinks=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li class="sharetool '+(null==(__t=shareObj.type)?"":__t)+"-sharetool "+(null==(__t=config.loginRequired?"login-modal-trigger":"")?"":__t)+'" data-modal-title="'+(null==(__t=config.loginModalText||"")?"":__t)+'">\n<a href="javascript:;" data-share="'+(null==(__t=shareObj.type)?"":__t)+'"><i class="icon sprite-icon"></i>'+(null==(__t=shareObj.label)?"":__t)+"</a>\n</li>";return __p},templates}),define("shared/sharetools/views/email",["jquery/nyt","underscore/nyt","foundation/hosts","foundation/views/base-view","shared/modal/views/modal","shared/sharetools/templates"],function(e,t,i,n,s,a){"use strict";var o=n.extend({template:a.emailModal,className:"email-view-container",frameSize:{small:507,full:867,ad:285},defaultSettings:{emailThisUrl:"https:"+i.www+"/mem/email-this.html?url=",scrolling:window.Modernizr.postmessage?"no":"yes"},defaultModalSettings:{id:"email-share-modal",modalTitle:"Email This Article",binding:".email-sharetool",tailDirection:"centered",hasOverlay:!0,hasCloseButton:!0,modalContent:""},initialize:function(e){var i=this;t.bindAll(this,"handlePostMessage","responsive"),this.settings=t.extend({},this.defaultSettings,e),this.frameState="full",this.modalSettings=t.extend({},this.defaultModalSettings,{openCallback:function(){window.Modernizr.postmessage&&(window.addEventListener?window.addEventListener("message",i.handlePostMessage,!1):window.attachEvent("onmessage",i.handlePostMessage)),i.listenTo(i.pageManager,"nyt:page-breakpoint",i.responsive)},closeCallback:function(){this.removeFromPage(),window.addEventListener?window.removeEventListener("message",i.handlePostMessage,!1):window.detachEvent("onmessage",i.handlePostMessage),i.stopListening(i.pageManager,"nyt:page-breakpoint",i.responsive)}}),this.prepareUrls(),this.render()},render:function(){this.modalSettings.modalContent=this.template(this.settings),this.emailModal=new s(this.modalSettings),this.emailModal.addToPage(),t.defer(this.responsive,this.pageManager.getCurrentBreakpoint())},responsive:function(e){var t=this.emailModal.$modal.find("iframe");1010>=e&&"full"===this.frameState&&(t.css("height",t.height()+this.frameSize.ad+"px").width(this.frameSize.small),this.frameSize.state="small",this.emailModal.positionDialog()),e>1010&&"small"===this.frameState&&(t.css("height",t.height()-this.frameSize.ad+"px").width(this.frameSize.full),this.frameState="full",this.emailModal.positionDialog())},handlePostMessage:function(e){var t;/\.nytimes\.com$/.test(e.origin)&&(t=e.data.match(/(.+)\:(.+)/),t&&"frameheight"===t[1]?this.$el.css("height",t[2]):t&&"closewindow"===t[1]?this.emailModal.close():t&&"loginredirect"===t[1]&&(window.location=i.myaccount+"/auth/login?URI="+encodeURIComponent(window.location.href)))},prepareUrls:function(){"string"==typeof this.settings.dataUrl&&-1===this.settings.dataUrl.indexOf("http")&&(this.settings.dataUrl="http:"+i.www+this.settings.dataUrl)}});return o}),define("shared/sharetools/helpers/share-tools-config",["underscore/nyt","foundation/views/page-manager"],function(e,t){"use strict";var i={width:600,height:450,adPosition:"Frame4A",overlayAdPosition:"Frame6A",isModalMember:!0,isArticleTool:!1,isInDefaultSet:!1,isPopup:!0,usesShortUrl:!1,shareDataParameters:{},shareServiceParameters:{}},n=function(t){var n=e.extend({},i,t);return Object.freeze?Object.freeze(n):n},s={EMAIL:n({label:"Email",isInDefaultSet:!0,requiresLogin:!0,loginModalTitle:"Log in to email",modalDisplayOrder:1,mobileModalDisplayOrder:1}),FACEBOOK:n({label:"Share",isInDefaultSet:!0,url:"http://www.facebook.com/sharer.php",smid:"fb-share",modalDisplayOrder:3,mobileModalDisplayOrder:2,shareDataParameters:{url:"u"}}),GOOGLE:n({label:"Google+",url:"https://plus.google.com/share",smid:"go-share",height:600,modalDisplayOrder:4,mobileModalDisplayOrder:6,shareDataParameters:{url:"url"},shareServiceParameters:{hl:"en-US"}}),REDDIT:n({label:"Reddit",url:"http://www.reddit.com/submit",smid:"re-share",width:854,height:550,modalDisplayOrder:6,mobileModalDisplayOrder:7,shareDataParameters:{url:"url",title:"title"}}),PINTEREST:n({label:"Pin",url:"https://www.pinterest.com/pin/create/button/",smid:"pin-share",width:750,height:330,modalDisplayOrder:7,mobileModalDisplayOrder:4,shareDataParameters:{url:"url",media:"media",description:"description"}}),TWITTER:n({label:"Tweet",isInDefaultSet:!0,url:"https://twitter.com/share",smid:"tw-share",usesShortUrl:!0,modalDisplayOrder:5,mobileModalDisplayOrder:3,shareDataParameters:{url:"url",title:"text"}}),LINKEDIN:n({label:"Linkedin",url:"http://www.linkedin.com/shareArticle",smid:"li-share",width:750,modalDisplayOrder:2,mobileModalDisplayOrder:5,shareDataParameters:{url:"url",title:"title",description:"summary"},shareServiceParameters:{mini:"true",source:"The New York Times"}}),SAVE:n({label:"Save",isInDefaultSet:!0,isArticleTool:!0,loginModalTitle:"Log in to save",modalDisplayOrder:1}),PRINT:n({label:"Print",isModalMember:"interactive"!==t.getApplicationName(),isArticleTool:"interactive"!==t.getApplicationName(),modalDisplayOrder:3,shareServiceParameters:{pagewanted:"print"}}),REPRINTS:n({label:"Reprints",width:930,height:850,isArticleTool:!0,isModalMember:!0,url:"http://www.nytreprints.com",modalDisplayOrder:2}),EMBED:n({label:"Embed",isArticleTool:!1,isInDefaultSet:!1,isModalMember:!1}),"SHOW-ALL":n({label:"More",isInDefaultSet:!0,isModalMember:!1,isModalTrigger:!0}),AD:n({label:"Advertisement",isInDefaultSet:!0,isModalMember:!1})};return Object.freeze?Object.freeze(s):s}),define("shared/sharetools/models/saved-article",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/models/base-model"],function(e,t,i,n){"use strict";var s=n.extend({getSummary:function(){return this.get("Data")?this.get("Data").Summary:""},getByline:function(){return this.get("Data")?this.get("Data").Byline:""},getTitle:function(){return this.get("Data")?this.get("Data").Headline:this.get("URL")},getUrl:function(){return this.get("URL")},getDate:function(){return this.get("CreatedDate")},getFormattedDate:function(){var e=new Date(this.getDate());return this.dateHelper.getMonthShortName(e.getMonth())+" "+e.getDate()+", "+e.getFullYear()},getThumbUrl:function(){return this.get("Data")?this.get("Data").ImageCrops.MediumThreeByTwo210:""},getCaption:function(){var e="";return this.get("Data")&&(e=this.get("Data").ImageCaption),e},getCaptionStripTags:function(){return this.getCaption().replace(/<\/?[^>]+>/gi,"")},hasThumb:function(){return!!this.getThumbUrl()}});return s}),define("shared/sharetools/collections/cross-platform-save",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/hosts","foundation/lib/auth/userauth","shared/sharetools/models/saved-article"],function(e,t,i,n,s,a,o){"use strict";var r=n.extend({model:o,offset:0,limit:20,apiCommand:{save:"POST",list:"GET",remove:"DELETE"},url:s.readingListApiHost+"/reading-list/v2",currentArticleSaved:!1,save:function(e){var t=this,i={data:JSON.stringify({URL:e})};this.sync(this.apiCommand.save,i).done(function(i){t.articleIsSaved(!0),t.add(i.Assets),t.trigger("nyt:xps-saved",e,i.Assets)}).fail(function(){t.trigger("nyt:xps-failed",e)})},removeSavedArticle:function(e){var t=this,i={data:JSON.stringify({URL:e})};this.sync(this.apiCommand.remove,i).done(function(i){t.articleIsSaved(!1),t.remove(i),t.trigger("nyt:xps-article-removed",e,i)}).fail(function(){t.trigger("nyt:xps-failed",e)})},getSavedArticles:function(){var e=this,t={data:{offset:this.offset,limit:this.limit},url:this.url+"/data"};e.reset(),this.sync(this.apiCommand.list,t).done(function(t){e.add(t.Assets),e.totalCount=t.OverallSummary.Count,e.trigger("nyt:xps-articles-loaded",t.Assets)}).fail(function(){e.trigger("nyt:xps-load-failed")})},getNextSavedArticles:function(){return this.offset+=this.limit,this.limit=10,this.totalCount>this.offset?(this.getSavedArticles(),this.totalCount<=this.offset+this.limit&&this.trigger("nyt:xps-finished"),!0):!1},getArticlesStatus:function(e){var t=this,i={data:{url:e},url:this.url+"/active"};this.sync(this.apiCommand.list,i).done(function(e){t.articleIsSaved(e.length)}).fail(function(){t.broadcast("nyt:xps-load-failed")})},articleIsSaved:function(e){this.currentArticleSaved=e,this.broadcast("nyt:xps-article-status",e)},sync:function(i,n){var s=new e.Deferred,o=setTimeout(function(){s.reject()},5e3),r={type:i,dataType:"json",contentType:"application/json",url:this.url,headers:{},xhrFields:{withCredentials:!0},success:function(e){clearTimeout(o),e?s.resolve(e):s.reject()}};return a.getToken().done(function(i,s,a){i&&s&&"undefined"!=typeof a&&(r.headers["X-Requested-By"]=i),e.ajax(t.extend(r,n))}),s.promise()}});return r}),define("shared/sharetools/instances/cross-platform-save",["shared/sharetools/collections/cross-platform-save"],function(e){"use strict";return new e}),define("shared/sharetools/collections/short-url",["jquery/nyt","backbone/nyt","foundation/collections/base-collection","foundation/hosts"],function(e,t,i,n){"use strict";var s=i.extend({url:n.shortenHost+"/svc/bitly/shorten.jsonp",initialize:function(){this.currentUrlRequest="",this.addCurrentPage()},sync:function(e,i,n){return n.dataType="jsonp",n.jsonpCallback="shortUrlCallback",n.jsonp="callback",n.cache=!0,n.data={url:this.currentUrlRequest},t.sync(e,i,n)},parse:function(e){return{url:this.currentUrlRequest,shortUrl:e.payload?e.payload.short_url:""}},addCurrentPage:function(){var t,i=this.pageManager.getCanonical();t="1"===this.pageManager.getUrlParam("rico")&&"undefined"!=typeof this.pageManager.getUrlParam("share_url")?this.pageManager.getUrlParam("share_url"):e("#masthead").find(".story-short-url").text(),i&&t&&this.add({url:i,shortUrl:t})},getRicoUrl:function(e){var t=this.pageManager.getUrlParam("share_url"),i=document.createElement("a");return i.href=e,i.pathname===location.pathname&&t&&7===t.indexOf("r-i.co/")?t:void 0},requestUrl:function(e){var t,i=this.findWhere({url:e});return i?i.get("shortUrl"):(t=this.getRicoUrl(e))?t:(this.currentUrlRequest=e,void this.fetch())}});return s}),define("shared/sharetools/instances/short-url",["shared/sharetools/collections/short-url"],function(e){"use strict";return new e}),define("shared/sharetools/views/common-mixin",["jquery/nyt","underscore/nyt","foundation/hosts","foundation/models/user-data","foundation/models/page-storage","foundation/tracking/tracking-mixin","shared/modal/views/modal","shared/sharetools/templates","shared/sharetools/views/email","shared/sharetools/helpers/share-tools-config","shared/sharetools/instances/cross-platform-save","shared/sharetools/instances/short-url"],function(e,t,i,n,s,a,o,r,l,d,c,h){"use strict";var u={handleShareAction:function(t,i){var s=e(t.target),a=s.attr("data-share")||s.parent().attr("data-share"),o=a&&d[a.toUpperCase()];return o?(i&&this.modal&&this.modal.close(),"imageslideshow"!==this.pageManager.getMeta("PT")&&this.trackShareData(a,o,i),o===d.EMBED?void this.triggerEmbedLoginModal(t):void(o.isModalTrigger?this.broadcast("nyt:open-share-modal",{instanceContainer:this.$instanceContainer}):o===d.EMAIL?this.isMobileShareTools()?this.openMailToLink():n.isLoggedIn()?new l({dataUrl:this.shareData.getUrl()}):this.triggerLoginModal(t,"Log in to email","Email"):o===d.PRINT?window.print():o===d.SAVE?n.isLoggedIn()?c.currentArticleSaved?this.removeItem():this.saveItem():(this.trackingTrigger("loginmodal-open",{module:"LogIn",action:"Click",region:i?"ToolsMenu":this.trackingRegion,eventName:"ArticleTool-save"}),this.triggerLoginModal(t,"Log in to save","Save")):o.isPopup&&this.popupShareWindow(o))):void 0},handleModalShareAction:function(e){this.handleShareAction(e,!0)},triggerLoginModal:function(e,t,i){e.preventDefault(),e.stopPropagation(),this.broadcast("nyt:loginmodal-open",{modalTitle:t,moduleName:i})},triggerEmbedLoginModal:function(t){t.stopPropagation(),e(".show-all-sharetool a").trigger("click"),this.$body.find(".show-all-sharetool-modal #embed-input").select()},popupShareWindow:function(e){e.usesShortUrl?this.handleShortUrlShareAction(e):window.open(this.buildShareServiceUrl(e),"_blank",this.getPopupWindowFeatures(e))},getPopupWindowFeatures:function(e){return"toolbar=0,status=0,height="+e.height+",width="+e.width+",scrollbars=yes,resizable=yes"},buildShareServiceUrl:function(e){var t,i=[],n=e.smid,s=e.shareDataParameters,a=e.shareServiceParameters,o={url:this.shareData.getUrl(),title:this.shareData.getTitle(),description:this.shareData.getDescription(),media:this.shareData.getMedia()};if(n&&(o.url+=this.getQuerystringDelimiter(o.url),o.url+="smid="+n),s)for(t in s)s.hasOwnProperty(t)&&o.hasOwnProperty(t)&&i.push(s[t]+"="+encodeURIComponent(o[t]));if(a){a.hasOwnProperty("publicationDate")&&(a.publicationDate=this.shareData.getPublicationDate()),a.hasOwnProperty("author")&&(a.author=this.shareData.getAuthor());for(t in a)a.hasOwnProperty(t)&&i.push(t+"="+encodeURIComponent(a[t]))}return e.url+"?"+i.join("&")},handleShortUrlShareAction:function(t){var i,n,s,a,o=this,r=this.shareData.getUrl(),l=t.smid;/(?:iPad|iPhone)/.test(navigator.userAgent)?(a=e("#masthead").find(".story-short-url").text()||this.pageManager.getCanonical()||r,i=t.url+"?url="+encodeURIComponent(a)+"&text="+encodeURIComponent(o.shareData.getTitle()),window.open(i,"_blank",this.getPopupWindowFeatures(t))):(n=window.open("","_blank",this.getPopupWindowFeatures(t)),s=function(e){var i=o.shareData.getVia();e=t.url+"?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(o.shareData.getTitle()),i&&(e+="&via="+encodeURIComponent(i)),n.location.href=e},l&&!this.pageManager.isMobile()&&(r+=this.getQuerystringDelimiter(r),r+="smid="+l),i=h.requestUrl(r)||"",i?s(i):this.listenToOnce(h,"add",function(){var e=h.findWhere({url:r});e&&s(e.get("shortUrl"))}))},getQuerystringDelimiter:function(e){return-1===e.indexOf("?")?"?":"&"},saveItem:function(){var e,t,n,a,o=this,l=this.shareData.getUrl();t=function(){var e="sharetools_hasSaves";s.get(e)!==!0?(a(),s.set(e,!0)):n()},n=function(){o.showModal({id:"save-item-growl-modal",modalTitle:'<i class="icon"></i>Saved',tailDirection:"centered",openCallback:function(){window.setTimeout(this.removeFromPage,2e3)}})},a=function(){o.showModal({id:"save-item-modal",modalTitle:'<i class="icon"></i>Saved',modalContent:r.savemodal({link:i.www+"/saved"}),hasOverlay:!0,hasCloseButton:!0,tailDirection:"centered",closeCallback:function(){this.removeFromPage()}})},e=c.where({url:l}),e.length?n():(this.subscribeOnce(c,"nyt:xps-saved",t),c.save(l))},removeItem:function(){var e=this,t=this.shareData.getUrl(),i=function(){e.showModal({id:"save-item-growl-modal",modalTitle:'<i class="icon"></i>Removed',tailDirection:"centered",openCallback:function(){window.setTimeout(this.removeFromPage,2e3)}})};this.subscribeOnce(c,"nyt:xps-article-removed",i),c.removeSavedArticle(t)},trackShareData:function(e,t,i){var n={};c.currentArticleSaved&&(e="unsave"),this.trackingBaseData={module:"ShareTools",action:"click",version:this.shareData.getContentType(),contentCollection:this.pageManager.getMeta("article:section")},i?(n.region="ToolsMenu",n.version="Content"):n.region=this.trackingRegion,t.isArticleTool?(n.module="ArticleTools",n.eventName="ArticleTool-"+e):"show-all"===e?n.eventName="Share-ShowAll":n.eventName="Share-"+e,this.trackingTrigger("share-tools-click",n)},showModal:function(e){var i=new o(e);i.addToPage(),t.defer(i.open)},isMobileShareTools:function(){return this.pageManager.getCurrentBreakpoint()<1e3},openMailToLink:function(){var e="%0A%0A",t=encodeURIComponent(this.shareData.getTitle()),i=encodeURIComponent(this.shareData.getDescription()),n=encodeURIComponent(this.shareData.getUrl()),s="NYTimes.com: "+t,a="From The New York Times:"+e+t+e+i+e+n;window.location="mailto:?subject="+s+"&body="+a}};return u}),define("shared/sharetools/views/share-tool",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/sharetools/views/common-mixin","shared/sharetools/templates"],function(e,t,i,n,s){"use strict";var a=i.extend(t.extend({},n,{tagName:"li",events:{click:"handleShareAction"},initialize:function(e){this.toolId=e.toolId,this.toolConfig=e.toolConfig,this.label=e.customLabel||this.toolConfig.label,this.loginModalTitle=this.toolConfig.loginModalTitle||"",this.$instanceContainer=e.instanceContainer,this.shareData=e.shareData,this.trackingRegion=e.trackingRegion,""===e.customLabel&&(this.isLabelHidden=!0)},render:function(){var e,t,i=this.toolId.toLowerCase();return this.isAdView()?(e=this.pageManager.getCurrentBreakpoint()<=1020?"Position1":"Frame4A",this.$instanceContainer.find(".sharetools-inline-article-ad").attr("id",e),this.broadcast("nyt:ad-library:dfp:queue-placement",e),this.$instanceContainer.find("#"+e).removeClass("hidden")):(t=s.shareTool({id:i,label:this.label,loginModalTitle:this.loginModalTitle,isLabelHidden:this.isLabelHidden}),this.$el.addClass("sharetool "+i+"-sharetool"),this.$el.append(t)),this},isAdView:function(){return"AD"===this.toolId}}));return a}),define("shared/sharetools/views/containers-mixin",["jquery/nyt","underscore/nyt","shared/sharetools/models/share-data","shared/sharetools/views/share-tool","shared/sharetools/helpers/share-tools-config"],function(e,t,i,n,s){"use strict";var a={getToolIdsAndCustomLabels:function(e){var t,i,n,a;if(this.toolIds=[],this.customLabels={},e)for(e=e.split(","),t=0,n=e.length;n>t;t++)i=e[t].toUpperCase(),a=i.indexOf("|"),-1!==a&&(i=i.substring(0,a),this.customLabels[i]=e[t].substr(a+1)),this.toolIds.push(i);else for(i in s)s.hasOwnProperty(i)&&s[i].isInDefaultSet===!0&&this.toolIds.push(i)},instantiateViews:function(e){var i,a,o,r,l,d=[];for(i=0,a=e.length;a>i;i++)o=e[i],r=this.customLabels&&this.customLabels[o],s.hasOwnProperty(o)&&(l={toolId:o,toolConfig:s[o],instanceContainer:this.$instanceContainer,shareData:this.shareData,trackingRegion:this.trackingRegion},t.isString(r)&&(l.customLabel=r),d.push(new n(l)));return d},renderToolViews:function(){var e,t,i;for(t=this.instantiateViews(this.toolIds),e=0,i=t.length;i>e;e++)t[e].isAdView()?t[e].render():this.$el.append(t[e].render().el)},getToolViewsMarkup:function(t){var i,n=document.createElement("div"),s=this.instantiateViews(t),a=s.length;for(i=0;a>i;i++)n.appendChild(s[i].render().el);return e(n).html()}};return a}),define("shared/ad/collections/ads",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","foundation/hosts","shared/ad/models/ad"],function(e,t,i,n,s){"use strict";var a=i.extend({deliveryProofParams:["adxforce","debug"],adForceLookup:{leaderboard:"728x90testnyt5",billboard:"970x90horiztest",pushdown:"testnyt5pushdown",halfpage:"mediamindhalfexptest",xxl:"nyt5xxltestpickletag",bigad:"middlerighttest"},initialize:function(e,i){return i?(this.options=i,t.isUndefined(this.pageManager.getMeta("adxPage"))?this.host=this.pageManager.getUrlParam("adx_campaign")||i.adx_campaign||"www.nytimes.com":(this.host="",this.options.page=this.pageManager.getMeta("adxPage")),this.interstitial=i.interstitial?1:0,void this.setPageParameter()):!1},setPageParameter:function(){var e;this.options.page||(e=location.pathname,e=e.replace(/\d{4}/,"yr").replace(/\d{2}/,"mo").replace(/\d{2}/,"day"),this.options.page=this.host+e)},model:s,url:n.ADXHost+"/adx/bin/adxrun.html",sync:function(i,n,s){var a=this,o=["nyt5"];return s.dataType="jsonp",s.jsonp="jsonp",s.data={page:a.options.page,positions:a.options.positions.join(","),autoconfirm:a.options.autoconfirm||0,v:3,cpp:1,attributes:"nyt5",interstitials:this.interstitial,secureClientside:1},this.options.cpp===!1&&(delete s.data.interstitials,delete s.data.cpp),s.data=a.assignDeliveryProofParams(s.data),"undefined"!=typeof this.pageManager.getUrlParam("hp")&&o.push("hp"),"undefined"!=typeof this.pageManager.getUrlParam("src")&&o.push("src-"+this.pageManager.getUrlParam("src")),"undefined"!=typeof a.options.keywords&&(o=t.union(o,a.chainKeywords(a.options.keywords))),s.data.keywords=t.filter(o,function(e){return!("undefined"==typeof e||""===e)}).join(","),e.sync(i,n,s)},assignDeliveryProofParams:function(e){var i,n,s={};for(i=this.deliveryProofParams.length-1;i>=0;i-=1)n=this.pageManager.getUrlParam(this.deliveryProofParams[i]),"undefined"!=typeof n&&(s[this.deliveryProofParams[i]]=n||"1");return t.extend(e,s)},chainKeywords:function(e){var t,i,n=e.length,s=[],a=this;for(t=0;n>t;t+=1)i=a.adForceLookup[e[t]],s.push(i||e[t]);return"1"===this.pageManager.getUrlParam("rico")&&s.push(this.pageManager.getUrlParam("keywords")),s},parse:function(e){var i=e.ads;return i=t.map(i,function(e,t){var i=e.isInlineSafe;return e.name=t,e.isInlineSafe="Y"===i||"true"===i,e}),"undefined"!=typeof this.pageManager.getUrlParam("debug")&&(window.adx_debug_output=e,console.log("adx debug page: ",this.options.page),console.log("adx debug positions: ",this.options.positions.join(",")),console.log("adx debug output: ",e),console.log("adx debug keywords: ",this.chainKeywords(this.options.keywords).join(","))),i},getConfirmPixel:function(){return this.confirmPixel?this.confirmPixel.creative:void 0}});return a}),define("shared/ad/templates",["underscore/nyt"],function(_){var templates={};return templates.iFrameStyleSheet=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<!--\nDEPRECATED - DO NOT USE/MODIFY - USE SHARED/ADLIBRARY INSTEAD\n-->\n<style type="text/css">\nbody {\nmargin: 0;\noverflow: hidden;\n}a img {\nborder: none;\n}\n</style>';return __p},templates.interstitialModal=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<!--\nDEPRECATED - DO NOT USE/MODIFY - USE SHARED/ADLIBRARY INSTEAD\n-->\n<div id="Interstitial" class="ad interstitial-ad"></div><p class="user-action dismiss-button">Continue &raquo;</p>';return __p},templates.ribbonInterstitial=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<!--\nDEPRECATED - DO NOT USE/MODIFY - USE SHARED/ADLIBRARY INSTEAD\n-->\n<div class="ribbon-interstitial-ad-overlay">\n<h4 class="ad-heading"> Advertisement </h4>\n<div id="RibbonInterstitial" class="ad ribbon-interstitial-ad"> </div>\n</div>';return __p},templates}),define("shared/ad/views/ads",["underscore/nyt","jquery/nyt","foundation/views/base-view","foundation/views/ad-view-manager","shared/ad/collections/ads","shared/ad/templates","shared/modal/views/modal"],function(e,t,i,n,s,a,o){"use strict";var r=i.registerView("ads").extend({el:".ad",template:a,pushdownWidth:"970",
billboardHeight:"90",navBreakPoint:10040,positions:null,blocking:!1,adShown:{},initialize:function(t){e.bindAll(this,"completeInterstitial","renderAd"),this.options=t||this.options||{},this.positions=[],this.preInitialize(),this.local(this,"nyt:ads-pre-initialize"),this.detectTragedy(),this.setAdParametersOnOptions(),this.scope=this.options.scope||this.scope,this.confirm=!0,this.ads=new s([],this.options),this.subscribe(this.ads,"sync",this.receiveAds),this.secondaryIframeClass="frame-for-"+this.scope,this.listenTo(this.pageManager,"nyt:page-breakpoint",this.responsive),this.postInitialize(),this.local(this,"nyt:ads-post-initialize"),this.subscribe("nyt:ads-new-placement",this.handleRemoteAdRequest),this.subscribe("nyt:ads-fire-ribbon-interstitial",this.fireRibbonInterstitial),this.subscribe("nyt:slideshow-ad",this.fireSlideShowAd),this.addAmazonKeywords?this.getAmazonAds():this.requestAds()},getAmazonAds:function(){window.amznads={updateAds:function(t){window.amazonAdData=t.ads,window.amazonAdSlots=e.keys(window.amazonAdData)},renderAd:function(e,t){var i,n;window.amazonAdData&&window.amazonAdData[t]?(e.write(window.amazonAdData[t]),e.close()):(i={c:"dtb",src:"3030",kvmismatch:1,pubReturnedKey:t,aaxReturnedKeys:window.amazonAdSlots,cb:Math.round(1e7*Math.random()),u:window.encodeURIComponent(window.location.host+window.location.pathname),ua:encodeURIComponent(window.navigator.userAgent)},n=window.encodeURIComponent(JSON.stringify(i)),e.write('<img src="//aax.amazon-adsystem.com/x/px/p/0/'+n+'"/>'),e.close())}},this.getAmazonKeywordsAndRequestAds()},getAmazonKeywordsAndRequestAds:function(){var e=this,i="3030",n=encodeURIComponent(document.location);try{n=encodeURIComponent(""+window.top.location)}catch(s){t.noop()}t.ajax({url:"//aax.amazon-adsystem.com/e/dtb/bid?src="+i+"&u="+n+"&cb="+Math.round(1e7*Math.random()),dataType:"script"}).done(function(){e.addAmazonKeywords()}).always(function(){e.requestAds()})},preInitialize:t.noop,postInitialize:t.noop,responsive:t.noop,setHtmlClasses:t.noop,requestAds:function(){this.options.response?(this.ads.reset(this.ads.parse(this.options.response)),this.ads.trigger("sync")):this.ads.fetch()},receiveAds:function(){this.hasInterstitial()||this.checkAds()},resizeTopAd:e.debounce(function(){var e,i=this.ads.findWhere({name:"TopAd"});i&&(e=i.get("height"),e&&90>e&&t("#TopAd").css("min-height",parseInt(e,10)))},1e3),checkAds:function(){var i,n,s,a,o,r=this;for(this.removeAds(),i=this.getReturnedAdNames(this.pageManager.isDomReady()),this.pageManager.isDomReady()||this.subscribe("nyt:page-ready",function(){r.getReturnedAdNames(!0)}),i&&i.length>0&&(this.pageManager.getMeta("ads_adNames")||this.pageManager.setMeta("ads_adNames",this.returnAdNames())),e.indexOf(i,"TopAd")<0?(o=t("#TopAd"),0===o.length&&o.addClass("hidden")):r.resizeTopAd(),a=this.getPositions(),n=0,s=a.length;s>n;n+=1)t("#"+a[n]).toggleClass("hidden",r.isAdUnavailable(i,a[n]));e.indexOf(this.options.positions,"Middle1C")>=0&&!this.ads.findWhere({name:"Middle1C"})&&t("#TopNavAd, .search-flyout-panel .ad").addClass("hidden"),e.defer(function(){r.broadcast("nyt:ads-rendered",r)}),r.setHtmlClasses(),e.delay(function(){r.loadGoogleAdScript()},1200)},loadGoogleAdScript:function(){var e,i,n;0===t("#SponLink, #SponLinkA, #HPSponLink, #TopAd1, #MiddleRightN").length||this.pageManager.getMeta("googleAdScriptInjected")||(e="script",i=document.createElement(e),n=document.getElementsByTagName(e)[0],i.src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",n.parentNode.insertBefore(i,n),this.pageManager.setMeta("googleAdScriptInjected","true"))},renderAd:function(e){e.page=e.page||this.ads.options.page,e.frameStyle=e.frameStyle||this.template.iFrameStyleSheet(),e.secondaryIframeClass=e.secondaryIframeClass||this.secondaryIframeClass,n.render(e)},renderAdByPositionName:function(i,n){var s=t("#"+i);return n||(n=this.ads.where({name:i})[0]),s.length&&n||"ADX_CLIENTSIDE"===i?(this.isCreativeBlank(n)||s.removeClass("hidden"),e.defer(this.renderAd,{model:n,el:s}),!0):!1},handleRemoteAdRequest:function(e){this.ads.length>0&&this.renderAdByPositionName(e)},getPositions:function(){return this.options.positions},detectTragedy:function(){var e=this.pageManager.getMeta("ad_sensitivity");e&&(this.options.page="www.nytimes.com/"+e)},returnAdNames:function(){return this.ads.pluck("name")},cleanHtmlClasses:function(){this.htmlClasses&&this.$html.removeClass(e.values(this.htmlClasses).join(" "))},isDirectlySold:function(e){var t=this.ads.where({name:e})[0].attributes.isDirectlySold;return"true"===t},returnAdParametersObject:function(){var t=this.pageManager.getUrlParam("ad-keywords"),i=this.pageManager.getUrlParam("ad-positions");return{keywords:e.isString(t)?[t]:t,positions:e.isString(i)?[i]:i}},setAdParametersOnOptions:function(){var t=this.returnAdParametersObject();this.options.keywords=e.union(this.options.keywords,t.keywords),t.positions&&(this.options.positions=t.positions)},isPlaceholderInViewport:function(e){var i;return!e||e&&0===e.length?!1:(i=e.get(0).getBoundingClientRect(),i.top+e.height()>=0&&i.left+e.width()>=0&&i.bottom-e.height()<=t(window).height()&&i.right-e.width()<=t(window).width())},isCreativeBlank:function(e){var t=e.get("classification");return"blank"===t||"blank-but-count-imps"===t},handleApplicationAd:function(e){var t,i;return t=e.get("name"),i=this.renderAdByPositionName(t,e)},getReturnedAdNames:function(e){var t=this,i=[];return e="undefined"!=typeof e?e:!1,this.ads.length>0&&this.ads.each(function(n){e?t.handleApplicationAd(n)?i.push(n.get("name")):t.confirm=!1:i.push(n.get("name"))}),i},isAdUnavailable:function(t,i){return e.indexOf(t,i)<0||this.isCreativeBlank(this.ads.where({name:i})[0])},removeAds:function(){t("."+this.secondaryIframeClass).remove()},isHalfPage:function(e,t){return 300===parseInt(e,10)&&600===parseInt(t,10)},isPushdown:function(e,t){return e===this.pushdownWidth&&t!==this.billboardHeight},handleTopNav:function(i){var n,s,a,o,r=t("#SponsorAd"),l=r.find("iframe"),d=t("#TopNavAd"),c=d.find("iframe");return n=this.ads.findWhere({name:"Middle1C"}),a=i<this.navBreakPoint&&0===l.length,o=i>=this.navBreakPoint&&0===c.length,n&&(a||o)?(a?(s=r,c.remove()):(s=d,l.remove()),e.defer(this.renderAd,{el:s,model:n}),!0):!1},fireSlideShowAd:function(e){var i=this.ads.findWhere({name:e.position}),n=t('<div class="ad-wrapper"></div>');this.adShown[e.position]||"object"!=typeof i||(this.adShown[e.position]=!0,e.el.html(n),this.renderAd({el:n,model:i}),this.broadcast("nyt:slideshow-ad-render",i))},hasInterstitial:function(){var e,t=this.ads.findWhere({name:"Interstitial"});return t?(e=t.get("timeout")?1e3*parseInt(t.get("timeout"),10):15e3,this.createInterstitial(t,this.completeInterstitial,e),!0):!1},fireRibbonInterstitial:function(){var e=this.pageManager.getViewport();this.$shell.prepend(a.ribbonInterstitial()),this.renderAdByPositionName("RibbonInterstitial"),this.$shell.find("#main").addClass("visually-hidden").end().find(".ribbon-interstitial-ad-overlay").css("height",e.height-150).find("iframe").css("width","")},createInterstitial:function(e,t,i){var n=this;this.interstitialModal=new o({id:"interstitial-ad-modal",modalTitle:"advertisement",tailDirection:"fixed",hasOverlay:!0,hasCloseButton:!0,width:e.get("width"),height:e.get("height"),modalContent:a.interstitialModal(),closeCallback:t,openCallback:function(){n.renderAdByPositionName(e.get("name"))}}).addToPage().open(),i&&(n.closeTimeout=window.setTimeout(this.interstitialModal.close,i))},completeInterstitial:function(e){window.clearTimeout(this.closeTimeout),this.interstitialModal.removeFromPage(),this.ads.remove(e),this.checkAds()}});return r}),define("shared/sharetools/views/share-tools-modal-container",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/ad/views/ads","shared/sharetools/helpers/share-tools-config","shared/sharetools/views/share-tool","shared/sharetools/views/common-mixin","shared/sharetools/views/containers-mixin","shared/sharetools/instances/short-url","shared/sharetools/templates"],function(e,t,i,n,s,a,o,r,l,d,c){"use strict";var h=i.extend(t.extend({},r,l,{events:{click:"handleModalShareAction"},defaultModalSettings:{id:"show-all-sharetool-modal",modalTitle:"share",binding:".show-all-sharetool",tailDirection:"up",hasOverlay:!1,hasCloseButton:!1,positionTailSide:!1,autoPosition:!1,modalContent:"",toolTypeSponsor:"Share",tailLeftOffset:0,tailTopOffset:0,openCallback:function(){this.$target.addClass("active")},closeCallback:function(){this.$target.removeClass("active"),this.removeFromPage()}},initialize:function(i){this.$instanceContainer=i.instanceContainer,this.trackingRegion=i.trackingRegion,this.shareData=i.shareData,this.configIds=i.modalSettings.shares,this.showTools=i.modalSettings.hasOwnProperty("showTools")?i.modalSettings.showTools:!0,this.modalSettings=t.extend({},this.defaultModalSettings,i.modalSettings),this.modalSettings.modalFooter=c.shareToolsModalFooter({toolTypeSponsor:this.modalSettings.toolTypeSponsor}),this.isMobileShareTools()&&(this.modalSettings=t.extend({},this.modalSettings,{tailDirection:"centered",hasCloseButton:!0,hasOverlay:!0,positionTailSide:!1,autoPosition:!1})),this.el=document.createElement("ul"),this.el.className="sharetools-menu",this.$el=e(this.el),this.urlWithSmid=this.shareData.getUrl(),this.urlWithSmid+=-1===this.urlWithSmid.indexOf("?")?"?":"&",this.urlWithSmid+="smid=pl-share",this.permalink=d.requestUrl(this.urlWithSmid)||"",this.permalink||this.listenToOnce(d,"add",this.handleShortUrl),this.render()},render:function(){var e="Frame6A",t=this;this.modalSettings.modalContent=c.shareToolsModal(this.buildMarkup()),this.modal=new n(this.modalSettings),this.setElement(this.modal.$modal),this.modalSettings.embedCode&&this.modal.$modal.find(".embed-input").val(this.modalSettings.embedCode),this.modal.$modal.find(".show-all-sharetool-modal-ad").attr("id",e),this.modalSettings.articleSaved&&this.modal.$modal.find(".save-sharetool").addClass("article-saved"),this.modal.addToPage(),this.isMobileShareTools()||this.broadcast("nyt:ad-library:dfp:request-placement",e),this.subscribe("nyt:page-resize",function(){t.modal.close()})},buildMarkup:function(){var i,n,s,o=this,r=[],l=[],d=function(e){var i;a.hasOwnProperty(e)&&(i=t.extend({},a[e],{id:e}),a[e].isArticleTool?"REPRINTS"===e?"article"!==o.pageManager.getMeta("PT")||/\/(?:aponline|reuters|opinion|t-magazine|magazine)\//.test(o.shareData.getUrl())||"books"===o.pageManager.getMeta("CG")&&"Review"===o.pageManager.getMeta("tom")||l.push(i):a[e].isArticleTool&&l.push(i):r.push(i))};if(this.configIds)for(this.getToolIdsAndCustomLabels(this.configIds),i=0,s=this.toolIds.length;s>i;i++)d(this.toolIds[i]);else{for(n in a)a[n].isModalMember&&d(n);r=t.sortBy(r,function(t){return e("html").hasClass("viewport-medium")?t.modalDisplayOrder:t.mobileModalDisplayOrder}),l=t.sortBy(l,function(t){return e("html").hasClass("viewport-medium")?t.modalDisplayOrder:t.mobileModalDisplayOrder})}return{shortUrl:this.permalink,showTools:this.showTools,isCompact:"homepage"===o.pageManager.getApplicationName(),standardToolsList:this.getToolViewsMarkup(t.pluck(r,"id")),articleToolsList:this.getToolViewsMarkup(t.pluck(l,"id"))}},handleShortUrl:function(){var e=d.findWhere({url:this.urlWithSmid});e&&this.modal.$modal.find(".short-url-input").val(e.get("shortUrl"))}}));return h}),define("shared/sharetools/views/share-tools-container",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/sharetools/models/share-data","shared/sharetools/views/containers-mixin","shared/sharetools/views/share-tools-modal-container","shared/sharetools/instances/cross-platform-save"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend(t.extend({},s,{initializedAttribute:"data-share-tools-initialized",initialize:function(t){this.$instanceContainer=t.el,this.trackingRegion=t.trackingRegion||"",this.$instanceContainer&&!this.$instanceContainer.attr(this.initializedAttribute)&&(this.getToolIdsAndCustomLabels(this.$instanceContainer.data("shares")),this.shareData=new n(this.$instanceContainer),this.el=document.createElement("ul"),this.$el=e(this.el),this.$el.addClass("sharetools-menu"),t.modalSettings&&(this.subscribe("nyt:xps-article-status",function(e){t.modalSettings.articleSaved=e}),o.getArticlesStatus(this.pageManager.getCanonical()),this.subscribe("nyt:open-share-modal",function(e){e.instanceContainer&&this.$instanceContainer.get(0)===e.instanceContainer.get(0)&&new a({instanceContainer:e.instanceContainer,modalSettings:t.modalSettings,trackingRegion:this.trackingRegion,shareData:this.shareData})})),this.render())},render:function(){var i,n=void 0!==t.find(this.toolIds,function(e){return"AD"===e}),s=this.$instanceContainer.find(".sharetools-inline-article-ad");this.renderToolViews(),this.$instanceContainer.attr(this.initializedAttribute,"1"),n&&s.length?this.$el.insertBefore(s):this.$instanceContainer.append(this.el),i=this.$el.closest(".sharetools").attr("id"),"sharetools-masthead"===i&&(this.isTemplateMinimal()||this.hasCoverMedia())&&e("#sharetools-masthead .show-all-sharetool .sharetool-text").text("Share")},isTemplateMinimal:function(){return this.$html.hasClass("template-minimal")?!0:void 0},hasCoverMedia:function(){return this.$html.hasClass("has-cover-media")?!0:void 0}}));return r}),define("homepage/views/video/player",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/views/page-manager","shared/video/libs/inactivity-timer-manager","foundation/hosts","homepage/helpers/image-utils","homepage/views/video/metadata","homepage/views/video/poster","shared/sharetools/views/share-tools-container","shared/sharetools/models/share-data"],function(e,t,i,n,s,a,o,r,l,d,c){"use strict";var h,u=i.extend({nytEvents:{"nyt:video-playlist-selected":"loadSelectedVideo","nyt:video-playlist-autoplay-next":"loadAutoplayedVideo"},initialize:function(i){t.bindAll(this,"subscribeToEvents","onVideoComplete","onVideoPlay","onVideoPaused","onAdStart","onAdComplete","onVideoRendered"),this.options=e.extend({name:"",videoWidth:768,videoHeight:432,playerType:"homepage",debug:!1,loadVhs:function(e){require(["vhs"],e)}},i),this.element=this.options.container,this.$videoPlayer=this.element.find(".video-player"),this.$poster=this.element.find(".poster"),this.video=this.options.video,this.$shareTools=this.$videoPlayer.find(".sharetools"),this.shareData=new c(this.$shareTools),this.metadataView=new r({el:this.element.find("figcaption.credit"),video:this.video}).render(),n.flag("videoVHSHomepageCover")?this.renderPlayer():this.setupPoster(),this.initializeShareTools(),this.element.removeClass("invisible"),this.inactivityTimerManager=new s(n),this.broadcast("nyt:video-playlist-ready")},setupPoster:function(){this.$poster.attr("src",this.getPosterUrl()),this.posterOverlay=new l({el:this.$videoPlayer.find(".media-action-overlay"),video:this.video}).render(),this.registerPosterEvents()},registerPosterEvents:function(){var e=this,t=".video-player .media-action-overlay";this.element.on("click",t,function(){e.renderPlayer()})},loadSelectedVideo:function(e){this.video=e,this.userInitiatedNext=!0,this.refreshVideo()},loadAutoplayedVideo:function(e){this.video=e,this.userInitiatedNext=!1,this.refreshVideo()},refreshVideo:function(){this.metadataView.video=this.video,this.metadataView.render(),this.renderPlayer(),this.setVideoPlayerShareData()},renderPlayer:function(){var e=this,t=window.location.host,i=this.element.find(".video-player-container");return this.videoPlayer&&this.videoPlayer.video?(this.videoPlayer.options.userInitiatedNext=this.userInitiatedNext,void this.videoPlayer.load(this.video.id,!0)):n.flag("videoVHSHomepageCover")&&this.videoPlayer&&!this.videoPlayer.video?(this.videoPlayer.on(h.api.events.RENDERED,this.onVideoRendered),this.videoPlayer.modules.poster.hide(),void this.videoPlayer.render()):(i.css({width:this.options.videoWidth+"px",height:this.options.videoHeight+"px"}),this.$poster.addClass("hidden"),this.$videoPlayer.find(".media-action-overlay").addClass("hidden"),i.attr("id","video_"+this.video.id),i.empty(),this.vhsConfig={container:"video_"+this.video.id,id:this.video.id,width:e.options.videoWidth,height:e.options.videoHeight,autoplay:!0,type:e.options.playerType,userInitiatedPlay:!0,siteSection:"homepage_large_homepage",controlsOverlay:{mode:"article"},cover:!1},n.flag("videoVHSHomepageCover")&&(this.vhsConfig.autoplay=!1,this.vhsConfig.cover=n.isDesktop()?{mode:"article"}:{mode:"mobile"}),n.flag("videoVHSHomepageNewControls")&&(this.vhsConfig.newControls=!0),(t.indexOf("dev.")>-1||t.indexOf("stg.")>-1||t.indexOf("sbx.")>-1)&&(this.vhsConfig.env="staging"),void this.options.loadVhs(function(t){h=t,e.videoPlayer=h.player(e.vhsConfig),e.videoPlayer.on(h.api.events.READY,e.subscribeToEvents)}))},subscribeToEvents:function(){this.videoPlayer&&(this.videoPlayer.on(h.api.events.ENDED,this.onVideoComplete),this.videoPlayer.on(h.api.events.PLAY,this.onVideoPlay),this.videoPlayer.on(h.api.events.PAUSE,this.onVideoPaused),this.videoPlayer.on(h.api.events.AD_STARTED,this.onAdStart),this.videoPlayer.on(h.api.events.AD_COMPLETED,this.onAdComplete))},onVideoRendered:function(){this.videoPlayer.off(h.api.events.RENDERED,this.onVideoRendered),this.videoPlayer.options.userInitiatedNext=this.userInitiatedNext,this.videoPlayer.load(this.video.id,!0)},onVideoComplete:function(){var e=this;setTimeout(function(){e.broadcast("nyt:video-player-finished"),e.inactivityTimerManager.enable()},100)},onVideoPlay:function(){this.inactivityTimerManager.disable()},onVideoPaused:function(){this.inactivityTimerManager.enable()},onAdStart:function(){this.inactivityTimerManager.disable()},onAdComplete:function(){this.inactivityTimerManager.enable()},initializeShareTools:function(){var e='<iframe width="480" height="373" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" id="nyt_video_player" title="New York Times Video - Embed Player" src="http://static01.nyt.com/video/players/offsite/index.html?videoId='+this.video.id+'"></iframe>';this.setVideoPlayerShareData(),new d({trackingRegion:"video-player-region",el:this.$shareTools,modalSettings:{modalTitle:"share this video",tailDirection:"down-right",positionTailSide:!1,autoPosition:!1,toggleSpeed:1,embedCode:e}})},setVideoPlayerShareData:function(){var e=this.video,t="http:"+a.www+(e.publish_url||"/video");this.shareData.setUrl(t),this.shareData.setDescription(e.summary),this.shareData.setTitle(e.headline)},getPosterUrl:function(){var e;return e=o.getCropUrl(this.video.images,["videoSixteenByNine768","videoSmall"]),e||(e="video/static-timesvideo/img/video-default-16by9-1050x591.png"),[a.image,e].join("/")}});return u}),define("homepage/views/video/video-section",["jquery/nyt","underscore/nyt","foundation/views/base-view","homepage/views/video/playlist","homepage/views/video/player"],function(e,t,i,n,s){"use strict";var a=i.extend({nytEvents:{"nyt:video-playlist-loaded":"configurePlayer","nyt:video-playlist-ready":"setup"},initialize:function(i){var s=this;t.bindAll(this,"handleMediaHover"),this.options=e.extend({},i),this.vhsConfig={container:this.options.el,referenceId:this.options.playlistID,thumbWidth:90,videoWidth:"100%",videoHeight:"100%"},this.playlistView=new n({container:this.options.el,playlistId:this.options.playlistID}),this.visibleTimer=setTimeout(function(){s.unHideVideoRegion()},3e3)},configurePlayer:function(e){this.playerView=new s(t.extend({},this.options.playerOptions,{container:this.vhsConfig.container,video:e})),this.unHideVideoRegion()},unHideVideoRegion:function(){e(".video-player-region").removeClass("invisible"),e(".video-section").removeClass("invisible")},setup:function(){this.$carousel=e("#extVidPlayerThumbsWrapper"),this.$menu=e("#extVidPlayerThumbs"),this.$el=e(".video-section"),this.$scroller=e(".video-playlist-container"),this.$items=this.$menu.find("li"),this.totalItems=this.$items.length,this.itemWidth=this.$items.eq(1).width()+parseInt(this.$items.eq(1).css("margin-right"),10),this.totalWidth=this.$items.length*this.itemWidth+20,this.isAnimating=!1,this.pointer=1,this.$menu.css("width",this.totalWidth+"px"),this.preventOverScroll(),this.summaryHeight=this.$el.find(".video-player .media-action-overlay .summary").height(),this.pageManager.isDesktop()&&(this.$el.on("mouseenter",".video-player .media-action-overlay",this.handleMediaHover),this.$el.on("mouseleave",".video-player .media-action-overlay",this.handleMediaHover))},preventOverScroll:function(){var t=this.$scroller.height(),i="DOMMouseScroll mousewheel",n=function(i){var n=e(this),s=this.scrollTop,a=this.scrollHeight,o="DOMMouseScroll"===i.type?-40*i.originalEvent.detail:i.originalEvent.wheelDelta,r=o>0,l=function(){return i.stopPropagation(),i.preventDefault(),i.returnValue=!1,!1};return!r&&-o>a-t-s?(n.scrollTop(a),l()):r&&o>s?(n.scrollTop(0),l()):void 0};this.$scroller.off(i,n).on(i,n)},handleMediaHover:function(e){var t=this,i=this.$el.find(".video-player .media-action-overlay"),n=i.find(".summary");"mouseenter"===e.type?(n.show(),n.css({height:0,opacity:0}),n.stop().animate({height:t.summaryHeight,opacity:1},200)):n.stop().animate({height:0,opacity:0},200,function(){n.hide()})}});return a}),define("homepage/instances/video-band",["jquery/nyt","underscore/nyt","foundation/views/page-manager","homepage/views/video/video-section"],function(e,t,i,n){"use strict";var s,a;s=function(){var t,n,s;return t=e("#video-player-region"),n=t.length>0&&window.pageYOffset+window.innerHeight>t.position().top-200,s=i.isComponentVisible(t),s||n?(a(),t.find("#video-module-loader").hide(),!0):!1},a=function(){i.stopListening(i,"nyt:page-scroll",s),e(".video-section").each(function(){var t=e(this);new n({el:t,playlistID:t.data("playlist-id")})})},s()||i.listenTo(i,"nyt:page-scroll",s)}),define("shared/video/models/video",["backbone/nyt","foundation/models/base-model"],function(e,t){"use strict";var i=t.extend({playerPositions:{POSITION_LEDE:"position_lede",POSITION_INLINE:"position_inline",POSITION_EMBEDDED:"position_embedded",POSITION_PHOTOSPOT:"position_photospot"},playerTypes:{ARTICLE_MODAL:"article-modal",ARTICLE_LEDE:"article-lede",ARTICLE_EMBEDDED:"article-embedded",BLOG:"blog",PHOTOSPOT:"photospot"},videoEvents:{VIDEO_COMPLETE:"nyt:video-complete",PLAY_CLICKED:"nyt:video-play-clicked",VIDEO_PLAY:"nyt:video-play",VIDEO_PAUSED:"nyt:video-video-paused",AD_START:"nyt:video-ad-start",AD_COMPLETE:"nyt:video-ad-complete",VIDEO_FULLSCREEN:"nyt:video-fullscreen",VIDEO_EXIT_FULLSCREEN:"nyt:video-exit-fullscreen",KILL_VIDEO:"nyt:video-kill",HIDE_VIDEO_END_CARD:"nyt:video-end-card-hide",MEDIA_CHANGE:"nyt:video-media-change"},clickableElements:[".video-share span",".video-share i.icon",".video-share a"],initialize:function(){this.videoObject=null,this.isVideoFullscreen=!1,this.isAdPlaying=!1},pause:function(){var e=this.get("videoObject");e&&e.pause()},kill:function(){this.local(this,this.videoEvents.KILL_VIDEO,this.videoObject)},hideVideoEndCard:function(){this.local(this,this.videoEvents.HIDE_VIDEO_END_CARD,this)}});return i}),define("shared/video/models/video-end-card",["backbone/nyt","foundation/models/base-model","foundation/hosts"],function(e,t,i){"use strict";var n=t.extend({PAUSE_STATE:"pause",COMPLETE_STATE:"complete",maxThumbs:4,autoplayTimeout:5,currentPlaylistIndex:0,cachedPlaylist:null,defaults:{permalink:"http://www.nytimes.com/video",videoTitle:"NYTimes Video",videoDescription:"",videoStillImgUrl:i.staticHost+"/images/section/video/library/default-video-posterframe.png",playlistDisplayName:"Latest Video",playlistId:1194811622182,playlistUrl:"http://www.nytimes.com/video/landing/latest-video/1194811622182/index.html",tags:[]},initialize:function(e){this.videoModel=e.videoModel,this.videoId=this.videoModel.get("videoId"),this.videoObject=this.videoModel.get("videoObject"),this.videoInnerContainer=this.videoModel.get("videoInnerContainer"),this.playlistVideosDataModel=null,this.playlistMetaDataModel=null,this.staticBaseUrl=i.staticHost+"/"}});return n}),define("shared/video/templates",["underscore/nyt"],function(_){var templates={};return templates.embedCode=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="embed-input-wrapper">\n<input\ntype="text"\nreadonly="true"\nid="'+(null==(__t=embedId)?"":__t)+'"\nvalue="'+(null==(__t=embedCode)?"":__t)+'"\nonclick="this.setSelectionRange(0, this.value.length)">\n</input>\n</div>';return __p},templates.video=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div id="'+(null==(__t=outerId)?"":__t)+'" class="video-bind">\n<div id="'+(null==(__t=innerId)?"":__t)+'" class="video-container"></div>\n</div>';return __p},templates.videoEndCard=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="video-end-card layout-small"><button class="video-end-card-play-button"><i class=\'icon sprite-icon\'></i><span>Replay Video</span></button><div class="video-share sharetools theme-classic" data-shares="show-all|Share" data-url="'+(null==(__t=permalink)?"":__t)+'" data-title="'+(null==(__t=videoTitle)?"":__t)+'" data-description="'+(null==(__t=videoDescription)?"":__t)+'">\n</div><div class="video-end-card-videos">\n<h5 class="video-end-card-section-heading video-end-card-section-heading-loading">\n<a href="'+(null==(__t=playlistUrl)?"":__t)+'" style="opacity: 1;">More in '+(null==(__t=playlistDisplayName)?"":__t)+' &raquo;</a>\n</h5>\n<div class="video-end-card-thumbs">\n<span class="video-end-card-loader"></span>\n</div>\n</div>\n</div>';return __p},templates.videoEndCardIcon=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<i class="icon sprite-icon"></i><span>'+(null==(__t=iconText)?"":__t)+"</span>";return __p},templates.videoEndCardThumb=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="video-end-card-thumb item-'+(null==(__t=itemIndex)?"":__t)+" "+(null==(__t=itemOrdinal)?"":__t)+'">\n<a href="'+(null==(__t=thumbLink)?"":__t)+'" alt="'+(null==(__t=thumbDesc)?"":__t)+'" title="'+(null==(__t=thumbDesc)?"":__t)+'" data-videoid="'+(null==(__t=thumbVideoId)?"":__t)+'" data-index="'+(null==(__t=thumbIndex)?"":__t)+'">\n',"first"==itemOrdinal&&(__p+='\n<p class="autoplayMeta off '+(null==(__t=thumbAutoPlayPaused)?"":__t)+'">\n<span class="countdownControl"></span>\n<span class="countdown">Playing in <span>'+(null==(__t=thumbAutoPlayRemainingTime)?"":__t)+"</span>...</span>\n</p>\n"),__p+='\n<span class="video-end-card-thumb-image">\n<img src="'+(null==(__t=thumbImg)?"":__t)+'">\n</span>\n<h4 class="video-headline">'+(null==(__t=thumbDesc)?"":__t)+"</h4>\n</a>\n</div>";return __p},templates}),define("shared/video/models/playlist-metadata",["backbone/nyt","foundation/models/base-model","foundation/hosts"],function(e,t,i){"use strict";var n=t.extend({url:i.videoApiHost+"/svc/video/api/v2/playlists",initialize:function(e){this.allPlaylistData=null,this.apiEnv=e.apiEnv||"production"},sync:function(t,i,n){return n.dataType="json",n.timeout=1e4,n.cache=!0,e.sync(t,i,n)},getPlaylistMetaData:function(e,t,i){var n=this;this.playlistId=e,this.success=t,this.error=i,this.allPlaylistData?this.findPlaylistById(this.allPlaylistData,this.playlistId,this.success,this.error):this.fetch({success:function(e){n.allPlaylistData=e,n.findPlaylistById(e,n.playlistId,n.success,n.error)},error:function(e){n.error&&n.error(e)}})},getPlaylistNode:function(e,t){var i,n;if(e)for(n in e)if(i=e[n],parseInt(i.knews_id,10)===t)return i;return{}},findPlaylistById:function(e,t,i,n){var s,a,o;if(this.playlistId=t,this.success=i,this.error=n,s=e.toJSON(),a=s.plst_all,o=this.getPlaylistNode(a,this.playlistId)){if(!this.success)return o;this.success(o)}else this.error&&this.error({message:"Could not find playlist in all playlists data."})}});return n}),define("shared/video/models/video-thumb",["backbone/nyt","foundation/models/base-model"],function(e,t){"use strict";var i=t.extend({defaults:{itemIndex:"",itemOrdinal:"",thumbLink:"",thumbImg:"",thumbDesc:"",thumbAutoPlayPaused:"",thumbAutoPlayRemainingTime:"5"}});return i}),define("shared/video/collections/video-thumbs",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","shared/video/models/video-thumb"],function(e,t,i,n){"use strict";var s=i.extend({model:n});return s}),define("shared/video/views/video-thumb",["jquery/nyt","underscore/nyt","backbone/nyt","shared/video/templates","foundation/views/base-view"],function(e,t,i,n,s){"use strict";var a=s.extend({thumbTemplate:n.videoEndCardThumb,render:function(){return this.thumbTemplate(this.model.toJSON())}});return a}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("shared/video/libs/countdown-timer",["jquery/nyt"],t):e.amdWeb=t(e.$)}(this,function(e){"use strict";function t(t,i){this.timeout=1e3*t,this.interval=1e3*i||1e3,this.running=!1,this.startTime=0,this.ticks=0,this.pauseTime=0,this.runTime=0,this.intervalId=null,this.resumeId=null,this.active=!0,this.$emitter=e({}),this.tick=e.proxy(this.tick,this)}return t.prototype.start=function(){var e=this,t=0;this.active&&(this.pauseTime?(t=this.interval-this.runTime%this.interval,this.pauseTime=0,this.emit("resume")):this.emit("start"),this.running=!0,this.startTime=(new Date).getTime(),this.resumeId=setTimeout(function(){t>0&&e.tick(),e.running&&(e.intervalId=setInterval(e.tick,e.interval))},t))},t.prototype.tick=function(){var e;this.ticks++,e=this.timeout-this.ticks*this.interval,0>=e?this.complete():this.emit({type:"tick",timeLeft:e/1e3})},t.prototype.on=function(e,t){this.$emitter.on(e,t)},t.prototype.emit=function(e,t){this.$emitter.trigger(e,t)},t.prototype.complete=function(){this.emit("complete"),this.stop()},t.prototype.stop=function(){clearInterval(this.intervalId),clearInterval(this.resumeId),this.emit("stop"),this.$emitter.off(),this.running=!1,this.startTime=0,this.pauseTime=0,this.runTime=0,this.ticks=0},t.prototype.pause=function(){this.running&&(clearInterval(this.intervalId),clearInterval(this.resumeId),this.emit("pause"),this.running=!1,this.pauseTime=(new Date).getTime(),this.runTime+=this.pauseTime-this.startTime)},t}),define("shared/video/views/video-end-card",["jquery/nyt","underscore/nyt","shared/video/templates","foundation/views/base-view","shared/video/models/playlist-videos","shared/video/models/playlist-metadata","shared/video/collections/video-thumbs","shared/video/views/video-thumb","shared/sharetools/views/share-tools-container","foundation/views/page-manager","shared/video/libs/countdown-timer"],function(e,t,i,n,s,a,o,r,l,d,c){"use strict";var h=n.extend({initialize:function(e){var n=window.location.host;t.bindAll(this,"processPlaylistVideos","processPlaylistVideosError","processPlaylistMetaData","processPlaylistMetaDataError","replayVideo","resumeVideo","onClickVideoOverlayHandler","onMouseEnterVideoOverlayHandler","onMouseLeaveVideoOverlayHandler","onThumbClicked","changeVideo","initializeAutoPlayCountdown","hideVideoEndCard","stopAutoPlayCountdown"),this.videoModel=this.model.videoModel,this.videoObject=this.model.videoObject,this.currentPlaylistIndex=this.model.currentPlaylistIndex,this.enableAutoPlayCountdown=e.enableAutoPlayCountdown,this.cachedPlaylist=this.model.cachedPlaylist,this.autoplayTimeout=this.model.autoplayTimeout,this.enableAutoPlayCountdown&&(this.countdown=new c(this.autoplayTimeout)),this.excludedAutoplayPlaylists=[1194812888716,0x5af310a56ca7],this.apiEnv="production",("www.dev.nytimes.com"===n||"www.stg.nytimes.com"===n||"www.sbx.nytimes.com"===n)&&(this.excludedAutoplayPlaylists=[1194812888716,0x5af310a5dfd7],this.apiEnv="staging"),this.videoEndCardTemplate=i.videoEndCard,this.iconTextTemplate=i.videoEndCardIcon,this.iconTextReplayHTML=this.iconTextTemplate({iconText:"Replay Video"}),this.iconTextResumeHTML=this.iconTextTemplate({iconText:"Resume Video"}),this.$videoInnerContainer=this.model.videoInnerContainer,this.$videoEndCard=null,this.$videoEndCardThumbsContainer=null,this.$videoEndCardVideosSectionHeading=null,this.$videoEndCardVideosSectionHeadingLink=null,
this.$videoEndCardVideosReplayButton=null,this.registerListeners(),this.getVideoData(),this.listenTo(this.videoModel,this.videoModel.videoEvents.KILL_VIDEO,this.onKill),this.listenTo(this.videoModel,this.videoModel.videoEvents.HIDE_VIDEO_END_CARD,this.hideVideoEndCard),this.listenTo(this.pageManager,"nyt:page-breakpoint",this.onBreakpoint)},registerListeners:function(){var e=this.videoModel.videoEvents;this.listenTo(this.pageManager,e.VIDEO_COMPLETE,this.onVideoComplete),this.listenTo(this.pageManager,e.PLAY_CLICKED,this.onVideoPlayClicked),this.listenTo(this.pageManager,e.VIDEO_PLAY,this.onVideoPlay),this.listenTo(this.pageManager,e.VIDEO_PAUSED,this.onVideoPaused),this.listenTo(this.pageManager,e.AD_START,this.onAdStart)},unregisterListeners:function(){var e=this.videoModel.videoEvents;this.stopListening(this.pageManager,e.VIDEO_COMPLETE,this.onVideoComplete),this.stopListening(this.pageManager,e.PLAY_CLICKED,this.onVideoPlayClicked),this.stopListening(this.pageManager,e.VIDEO_PLAY,this.onVideoPlay),this.stopListening(this.pageManager,e.VIDEO_PAUSED,this.onVideoPaused),this.stopListening(this.pageManager,e.AD_START,this.onAdStart)},onVideoComplete:function(e){e===this.videoModel.get("videoObject")&&this.showVideoEndCard(this.model.COMPLETE_STATE)},onVideoPlayClicked:function(e){e===this.videoModel.get("videoObject")&&"playing"!==this.videoObject.status&&"adplaying"!==this.videoObject.status&&this.showVideoEndCard(this.model.PAUSE_STATE)},onVideoPaused:function(){},onVideoPlay:function(e){e===this.videoModel.get("videoObject")&&this.hideVideoEndCard()},onAdStart:function(e){e===this.videoModel.get("videoObject")&&this.hideVideoEndCard()},getVideoData:function(){var t,i,n="";if(this.videoObject&&(t=this.videoObject._data)){this.videoModel.get("orphanVideo")?this.model.set("permalink",e('link[rel="canonical"]').attr("href")):this.model.set("permalink",t.domain+t.publish_url),this.model.set("videoTitle",t.headline),this.model.set("videoDescription",t.summary);for(i in t.images)if("videoSmall"===t.images[i].type){n=this.model.staticBaseUrl+t.images[i].url;break}this.model.set("videoStillImgUrl",n),t.playlist&&this.model.set("playlistId",t.playlist.id||1194811622182)}},getPlaylistId:function(e){var t=/nytp_([^,]+)/.exec(e.join(","))[1];return parseInt(t,10)||1194811622182},showVideoEndCard:function(e){var t,i=this;if(t=e,!this.videoModel.isVideoFullscreen){if(!this.$videoEndCard){this.render(),this.$videoEndCard=this.$videoInnerContainer.find(".video-end-card"),this.$videoEndCardThumbsContainer=this.$videoEndCard.find(".video-end-card-thumbs"),this.$videoEndCardVideosSectionHeading=this.$videoEndCard.find(".video-end-card-section-heading"),this.$videoEndCardVideosSectionHeadingLink=this.$videoEndCardVideosSectionHeading.find("a");try{new l({el:this.$videoEndCard.find(".video-share"),modalSettings:{hasOverlay:!0,tailDirection:"fixed",hasCloseButton:!0,shares:"facebook,email,twitter,pinterest,linkedin,reddit,google,save,permalink"}})}catch(n){this.$videoEndCard.find(".video-share").hide()}}this.$videoEndCard&&(this.onSetEndCardTemplateClass(this.videoModel.get("videoOuterContainer")),this.$videoEndCardVideosReplayButton=this.$videoEndCard.find(".video-end-card-play-button"),t===this.model.COMPLETE_STATE?this.$videoEndCardVideosReplayButton.removeClass("video-end-card-resume-button").html(this.iconTextReplayHTML).on("click",this.replayVideo):t===this.model.PAUSE_STATE&&this.$videoEndCardVideosReplayButton.addClass("video-end-card-resume-button").html(this.iconTextResumeHTML).on("click",this.resumeVideo),this.videoObject.modules.controls.hide(),this.$videoEndCard.fadeIn(500),null===this.cachedPlaylist?(this.getVideoData(),this.fetchPlaylistVideos(function(){i.initializeAutoPlayCountdown(t)}),this.fetchPlaylistMetaData()):i.initializeAutoPlayCountdown(t),this.$videoEndCard.on("click",this.onClickVideoOverlayHandler),this.$videoEndCard.on("mouseenter",this.onMouseEnterVideoOverlayHandler),this.$videoEndCard.on("mouseleave",this.onMouseLeaveVideoOverlayHandler))}},onBreakpoint:function(){this.onSetEndCardTemplateClass(this.videoModel.get("videoOuterContainer"))},initializeAutoPlayCountdown:function(e){function t(e){o.text(e.timeLeft)}function i(){a.remove(),r.changeVideo(l.data("videoid"),l.data("index"),!1)}function n(){l.off("click",r.onThumbClicked),l.on("click",function(e){a.toggleClass("paused"),a.hasClass("paused")?r.countdown.pause():r.countdown.start(),e.stopPropagation(),e.preventDefault()})}function s(){l.off("click"),l.on("click",r.onThumbClicked),o.text(r.autoplayTimeout),a.addClass("off"),a.removeClass("paused")}var a,o,r=this,l=this.$videoEndCard.find(".video-end-card-thumb.first a");!this.enableAutoPlayCountdown||e===this.model.PAUSE_STATE||-1!==this.excludedAutoplayPlaylists.indexOf(this.model.get("playlistId"))||this.videoModel.get("orphanVideo")||this.videoModel.get("live")||(a=this.$videoEndCard.find(".video-end-card-thumb.first .autoplayMeta"),o=a.find(".countdown span"),a.removeClass("off"),this.countdown.on("tick",t),this.countdown.on("complete",i),this.countdown.on("start",n),this.countdown.on("stop",s),this.countdown.start())},stopAutoPlayCountdown:function(){this.enableAutoPlayCountdown&&this.countdown.stop()},onSetEndCardTemplateClass:function(e){var t,i=e,n="layout-large",s="layout-medium",a="layout-small";i&&this.$videoEndCard&&(t=i.width(),t>=720?this.$videoEndCard.removeClass("hidden").addClass(a).addClass(s).addClass(n):t>=600?this.$videoEndCard.removeClass("hidden").addClass(a).addClass(s).removeClass(n):t>=450?this.$videoEndCard.removeClass("hidden").addClass(a).removeClass(s).removeClass(n):this.$videoEndCard.addClass("hidden"),!this.videoObject||"playing"!==this.videoObject.status&&"adplaying"!==this.videoObject.status||this.hideVideoEndCard())},onClickVideoOverlayHandler:function(t){var i=this.videoModel.clickableElements,n=i.join(", "),s=e(t.target).is(n);s||t.stopPropagation()},onMouseEnterVideoOverlayHandler:function(e){e.stopPropagation(),this.$videoEndCardVideosReplayButton&&this.$videoEndCardVideosReplayButton.addClass("expand")},onMouseLeaveVideoOverlayHandler:function(){this.$videoEndCardVideosReplayButton&&this.$videoEndCardVideosReplayButton.removeClass("expand")},hideVideoEndCard:function(t,i){var n;t=t||500,this.stopAutoPlayCountdown(),this.$videoEndCard&&this.$videoEndCard.is(":visible")&&(n=this,this.$videoEndCard.fadeOut(t,function(){e(this).hide(),n.$videoEndCardVideosReplayButton.off("click"),n.$videoEndCard.off("click"),i&&i()}))},fetchPlaylistVideos:function(e){this.model.playlistVideosDataModel||(this.model.playlistVideosDataModel=new s,this.model.playlistVideosDataModel.fetchData({playlistId:this.model.get("playlistId")},this.processPlaylistVideos,this.processPlaylistVideosError,e))},processPlaylistVideos:function(t,i){var n,s,a,l,d,c,h,u,m;if(s=t.toJSON(),n=this,s)if(null===this.cachedPlaylist&&(this.cachedPlaylist=t),this.$videoEndCardThumbsContainer.empty(),s.videos){if(a=s.videos.length,this.currentPlaylistIndex>=a)return;for(l=0,this.videoThumbs=new o,c=this.currentPlaylistIndex;a>c;c++)if(d=s.videos[c],m=this.model.get("videoStillImgUrl"),parseInt(d.id,10)!==this.videoModel.get("videoId")){if(!(l<this.model.maxThumbs))break;for(h in d.images)if("videoSmall"===d.images[h].type){m=this.model.staticBaseUrl+d.images[h].url;break}u={itemIndex:l,itemOrdinal:0===l?"first":l===this.model.maxThumbs-1?"last":"",thumbLink:d.domain+d.publish_url,thumbImg:m,thumbDesc:d.headline,thumbVideoId:d.id,thumbIndex:c,thumbAutoPlayRemainingTime:this.autoplayTimeout},this.videoThumbs.add(u),l+=1}this.currentPlaylistIndex=c,this.videoThumbs.each(function(t){var i=new r({model:t}),s=e(i.render()),a=parseInt(t.get("itemIndex"),10),o=250*a;n.$videoEndCardThumbsContainer.append(s),s.find("a").on("click",n.onThumbClicked),setTimeout(function(){s.addClass("fade-in")},o)}),i&&"function"==typeof i&&i()}else this.processPlaylistError()},onThumbClicked:function(){var e=this.$videoEndCard.find(".video-end-card-thumb.first .autoplayMeta");e.hasClass("paused")||(this.countdown.pause(),e.addClass("paused"))},changeVideo:function(e,t,i){var n=this;this.hideVideoEndCard(200,function(){n.currentPlaylistIndex=t+1,n.videoObject.options.userInitiatedNext=i,n.videoObject.load(e,!0),n.processPlaylistVideos(n.cachedPlaylist)})},processPlaylistVideosError:function(){this.$videoEndCardThumbsContainer.empty(),this.$videoEndCardThumbsContainer.append('<p class="error">There was an error retrieving more videos.</p>')},fetchPlaylistMetaData:function(){this.model.playlistMetaDataModel||(this.model.playlistMetaDataModel=new a({apiEnv:this.apiEnv}),this.model.playlistMetaDataModel.getPlaylistMetaData(this.model.get("playlistId"),this.processPlaylistMetaData,this.processPlaylistMetaDataError))},processPlaylistMetaData:function(e){var t=e;t&&t.publish_url&&t.display_name&&(this.model.set("playlistUrl",["http://www.nytimes.com",t.publish_url].join("")),this.model.set("playlistDisplayName",t.display_name),this.$videoEndCardVideosSectionHeadingLink.attr("href",this.model.get("playlistUrl")).html("More in "+this.model.get("playlistDisplayName"))),this.$videoEndCardVideosSectionHeading.css({opacity:0}).removeClass("video-end-card-section-heading-loading").fadeTo(200,1)},processPlaylistMetaDataError:function(){this.$videoEndCardVideosSectionHeading.css({opacity:0}).removeClass("video-end-card-section-heading-loading").fadeTo(200,1)},replayVideo:function(){this.videoObject.play(),this.hideVideoEndCard()},resumeVideo:function(){this.videoObject.play(),this.hideVideoEndCard()},render:function(){var e;return this.$videoEndCard||(this.$videoInnerContainer.find(".video-end-card").remove(),e=this.videoEndCardTemplate(this.model.toJSON()),this.$videoInnerContainer.append(e)),this},onKill:function(){this.stopListening(this.videoModel,this.videoModel.videoEvents.KILL_VIDEO,this.onKill),this.unregisterListeners(),this.$videoEndCard&&this.$videoEndCard.remove(),this.model.clear(),this.remove()}});return h}),define("shared/video/views/video",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/base-view","foundation/hosts","shared/video/models/video-end-card","shared/video/views/video-end-card","foundation/views/page-manager","shared/video/libs/inactivity-timer-manager","shared/video/templates","shared/video/models/video","shared/sharetools/views/share-tools-container","shared/sharetools/models/share-data"],function(e,t,i,n,s,a,o,r,l,d,c,h,u,m){"use strict";var p,g=s.extend({defaultSettings:{loadVhs:function(e){require(["vhs"],e)}},initialize:function(e){var i=this,n=window.location.host,s=new h,a=this.model.get("videoId"),o=this.model.get("width"),r=this.model.get("height"),u=this.model.get("videoFigure"),g=this.model.get("pagePosition")||s.playerPositions.POSITION_EMBEDDED,f=this.model.get("autoStart")===!1?!1:!0,v=this.model.get("playerType")||"article",y="video_inner_"+g+"_",b="video_outer_"+g+"_",w=this.model.get("userInitiatedPlay")||!1,_=this.model.get("orphanVideo")||!1,C=c.video,T=C({outerId:b+a,innerId:y+a});this.settings=t.extend({},this.defaultSettings,e),t.bindAll(this,"handleVHSLoad","onPlayerReady","onKillVideo","onVideoComplete","onVideoPlay","onPlayClicked","onVideoPaused","onAdStart","onAdComplete","onFullscreen","onExitFullscreen","onClickVideoHandler","onMediaChange","initializeShareTools","toggleEmbedField"),this.genericVideoModel=s,this.shareOptions=this.setShareOptions(v,_),u.prepend(T),this.vhsConfig={container:y+a,width:o,height:r,id:a,autoplay:f,type:v,userInitiatedPlay:w,controlsOverlay:{mode:"article"},cover:{mode:"article"},endSlate:!1,shareOptions:this.shareOptions},l.flag("videoVHSNewControls")&&(this.vhsConfig.newControls=!0),this.pageManager.isDesktop()||(this.vhsConfig.cover.mode="mobile"),v===s.playerTypes.PHOTOSPOT&&(this.inactivityTimerManager=new d(l),this.vhsConfig.cover.mode="duration",this.vhsConfig.endSlate=!0,"Homepage"===this.pageManager.getMeta("PT")&&"1"===this.isUserVariant("photospotVHSCover")&&(this.vhsConfig.cover.mode="clean")),(n.indexOf("dev.")>-1||n.indexOf("stg.")>-1||n.indexOf("sbx.")>-1)&&(this.vhsConfig.env="staging"),this.$shareToolsInline=u.find(".sharetools-video-inline"),this.shareData=new m(this.$shareToolsInline),l.flag("videoVHSEmbeddedOnly")&&_||(this.$shareToolsVideo=u.find(".sharetools-video-tools"),this.$shareToolsVideoEmbedBtn=this.$shareToolsVideo.find(".embed-sharetool"),this.$shareToolsVideo.show()),this.settings.loadVhs(function(e){p=e,i.handleVHSLoad()})},setShareOptions:function(t,i){var n={},s=e('meta[name="articleid"]').attr("content"),a=e('link[rel="canonical"]').attr("href");return l.flag("videoVHSEmbeddedOnly")?i&&a&&(n.url=a):"blog"===t&&a?n.blogPostUrl=a:s?(n.articleId=s,n.articleCanonical=a):a&&(n.url=a),n},handleVHSLoad:function(){var e=this.model.get("videoId"),t=this.model.get("videoFigure"),i=t.find(".video-bind"),n=t.find(".video-container");this.video=p.player(this.vhsConfig),this.video&&(this.model.set("videoObject",this.video),this.model.set("videoId",e),this.model.set("videoInnerContainer",n),this.model.set("videoOuterContainer",i),this.video.on(p.api.events.LOADED,this.onPlayerReady)),t.on("click",this.onClickVideoHandler)},initializeShareTools:function(){this.setVideoPlayerShareData(),new u({trackingRegion:"video-player-region",el:this.$shareToolsInline}),this.$shareToolsVideoEmbedBtn&&this.$shareToolsVideoEmbedBtn.length>0&&this.$shareToolsVideoEmbedBtn.on("click",this.toggleEmbedField)},toggleEmbedField:function(){var e="share-embed-open",t={module:"ShareTools",action:"click",version:"video",region:"video-player-region",pgtype:this.pageManager.getMeta("PT"),contentCollection:this.pageManager.getMeta("CG"),eventTimestamp:(new Date).getTime()};this.$shareToolsVideoEmbedField&&this.$shareToolsVideoEmbedField.length>0?this.$shareToolsVideoEmbedField.is(":visible")?(this.$shareToolsVideoEmbedField.hide(),this.$shareToolsVideo.removeClass("with-embed"),e="share-embed-close"):(this.$shareToolsVideoEmbedField.show(),this.$shareToolsVideo.addClass("with-embed"),this.focusEmbedCodeInput()):this.addEmbedField(),t.eventName=e,this.trackingTrigger(e,t)},addEmbedField:function(){var t=this.model.get("videoId"),i=c.embedCode({embedId:"nyt-video-embed-"+t,embedCode:this.video.getEmbedCode()});this.$shareToolsVideoEmbedField=e(i),this.$shareToolsVideo.prepend(this.$shareToolsVideoEmbedField),this.$shareToolsVideo.addClass("with-embed"),this.focusEmbedCodeInput()},removeEmbedField:function(){this.$shareToolsVideoEmbedField&&this.$shareToolsVideoEmbedField.length>0&&(this.$shareToolsVideoEmbedField.remove(),this.$shareToolsVideoEmbedField=null),this.$shareToolsVideo&&this.$shareToolsVideo.length>0&&this.$shareToolsVideo.removeClass("with-embed")},focusEmbedCodeInput:function(){this.$shareToolsVideoEmbedField.find("input").select().focus()},setVideoPlayerShareData:function(){var e=this.video,t=e.getVideoCanonical()||"http:"+a.www+"/video";this.shareOptions&&(t=l.flag("videoVHSEmbeddedOnly")&&this.shareOptions.url?this.shareOptions.url:this.shareOptions.blogPostUrl||this.shareOptions.articleCanonical||this.shareOptions.url||t),this.shareData.setVia("nytvideo"),this.shareData.setUrl(t),this.shareData.setDescription(e.getSummary()),this.shareData.setTitle(e.getTitle()),this.removeEmbedField()},onClickVideoHandler:function(t){var i=this.model.clickableElements,n=i.join(", "),s=e(t.target).is(n);s||t.stopPropagation()},createVideoEndCard:function(){this.vhsConfig.endSlate||(this.videoEndCardModel=new o({videoModel:this.model}),this.videoEndCardView=new r({model:this.videoEndCardModel,enableAutoPlayCountdown:this.model.get("pagePosition")===this.model.playerPositions.POSITION_LEDE}))},onPlayerReady:function(){l.flag("videoVHSShareTools")&&this.initializeShareTools(),this.bindVideoEvents(),this.createVideoEndCard(),this.listenTo(this.model,this.model.videoEvents.KILL_VIDEO,this.onKillVideo)},onKillVideo:function(){var e=this.model.get("videoObject"),t=this.model.get("videoFigure"),i=this.model.get("videoOuterContainer");this.stopListening(this.model,this.model.videoEvents.KILL_VIDEO,this.onKillVideo),this.bindVideoEvents(!0),this.model.set("videoObject",null),this.model.set("videoInnerContainer",null),this.model.set("videoOuterContainer",null),e&&e.destroy(),t.off("click"),i.remove(),t.remove(),this.remove()},bindVideoEvents:function(e){var t,i={},n={};if(e=e||!1,this.video){if(i[p.api.events.ENDED]=this.onVideoComplete,i[p.api.events.PLAY]=this.onVideoPlay,i[p.api.events.PAUSE]=this.onVideoPaused,i[p.api.events.AD_STARTED]=this.onAdStart,i[p.api.events.AD_COMPLETED]=this.onAdComplete,i[p.api.events.GO_FULLSCREEN]=this.onFullscreen,i[p.api.events.EXIT_FULLSCREEN]=this.onExitFullscreen,i[p.api.events.LOAD_START]=this.onMediaChange,n[p.api.events.READY]=this.onPlayerReady,e)for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);for(t in i)i.hasOwnProperty(t)&&(e?this.video.off(t,i[t]):this.video.on(t,i[t]))}},onVideoComplete:function(){this.broadcast(this.model.videoEvents.VIDEO_COMPLETE,this.video),this.inactivityTimerManager&&this.inactivityTimerManager.enable()},onVideoPlay:function(){this.model.isAdPlaying=!1,this.broadcast(this.model.videoEvents.VIDEO_PLAY,this.video),this.inactivityTimerManager&&this.inactivityTimerManager.disable()},onPlayClicked:function(){this.broadcast(this.model.videoEvents.PLAY_CLICKED,this.video)},onVideoPaused:function(){this.broadcast(this.model.videoEvents.VIDEO_PAUSED,this.video),this.inactivityTimerManager&&this.inactivityTimerManager.enable()},onAdStart:function(){this.model.isAdPlaying=!0,this.broadcast(this.model.videoEvents.AD_START,this.video),this.inactivityTimerManager&&this.inactivityTimerManager.disable()},onAdComplete:function(){this.model.isAdPlaying=!1,this.broadcast(this.model.videoEvents.AD_COMPLETE,this.video),this.inactivityTimerManager&&this.inactivityTimerManager.enable()},onFullscreen:function(){this.model.isVideoFullscreen=!0,this.broadcast(this.model.videoEvents.VIDEO_FULLSCREEN,this.video)},onExitFullscreen:function(){this.model.isVideoFullscreen=!1,this.broadcast(this.model.videoEvents.VIDEO_EXIT_FULLSCREEN,this.video)},onMediaChange:function(){this.broadcast(this.model.videoEvents.MEDIA_CHANGE,this.video),l.flag("videoVHSShareTools")&&this.setVideoPlayerShareData()}});return g}),define("shared/mediaviewer/templates",["underscore/nyt"],function(_){var templates={};return templates.bigAd3=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div id="BigAd3" class="ad big-ad3" style="display:none;"></div>';return __p},templates.continueButton=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="media-viewer-continue" style="display:none;">\n<span class="continue-text"> '+(null==(__t=message)?"":__t)+' </span>\n<div class="continue-arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n</div>';return __p},templates.image=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<figure class="media-viewer-asset" style="visibility:hidden;">\n<img src="'+(null==(__t=src)?"":__t)+'" data-caption="" style="opacity:0;" />\n<nav class="image-navigation previous">\n<span class="visually-hidden">Go to previous slide</span>\n</nav>\n<nav class="image-navigation next">\n<span class="visually-hidden">Go to next slide</span>\n</nav>\n<figcaption class="caption" style="display:none;">\n<span class="caption-text">\n'+(null==(__t=caption)?"":__t)+'\n</span>\n<span class="credit">\n'+(null==(__t=credit)?"":__t)+"\n</span>\n</figcaption>\n</figure>";return __p},templates.mediaViewer=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<aside id="media-viewer" class="media-viewer" style="display:none;">\n<button class="button close-button"><i class="icon"></i><span class="visually-hidden">Close this overlay</span></button>\n<h2 class="media-viewer-headline"></h2>\n<div class="media-viewer-wrapper"></div>\n<nav class="media-viewer-nav">\n<div class="media-viewer-counter"></div>\n<div class="media-viewer-previous">\n<span class="visually-hidden">Go to previous</span>\n<div class="arrow arrow-left">\n<div class="arrow-conceal"></div>\n</div>\n</div>\n<div class="media-viewer-next">\n<span class="visually-hidden">Go to next</span>\n<div class="arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n</div></nav>\n<div class="loader-container" style="display:none;">\n<div class="loader loader-t-logo-32x32-ecedeb-ffffff"><span class="visually-hidden">Loading...</span></div>\n</div>\n</aside>';return __p},templates.mediaViewerIcon=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="'+(null==(__t=classes)?"":__t)+'">\n<i class="icon sprite-icon"></i>\n</div>';return __p},templates.video=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<figure class="media-viewer-asset media-viewer-video media video" data-videoId="'+(null==(__t=videoId)?"":__t)+'" style="visibility:hidden;">\n<figcaption class="caption">\n<span class="credit">\n'+(null==(__t=credit)?"":__t)+"\n</span>\n</figcaption>\n</figure>";return __p},templates}),define("shared/mediaviewer/views/media-viewer",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/base-view","shared/mediaviewer/templates"],function(e,t,i,n,s,a){"use strict";var o=s.registerView("media-viewer").extend({templates:a,collection:new n,speed:400,assetIndex:0,stepsTaken:0,marginForImage:160,clickableElements:["img","nav div",".caption",".credit",".media-viewer-video",".video-share span",".video-share i.icon",".video-share a",".image-navigation"],candidateClass:"media-viewer-candidate",overlayClass:"media-action-overlay",slideshowClass:"slideshow.promo.launch-media-viewer",isVideo:!1,videoId:0,contentType:"",$prevArrow:e(),$nextArrow:e(),settings:{minWidth:700,minHeight:550,topMargin:60,basicMargin:30,captionGutter:15,navGutter:45,captionRatio:.8,imageAspectRatio:1.3,mobileBreakpoint:765},events:{"click .media-viewer-previous":"prevAsset","click .media-viewer-next":"nextAsset","click .image-navigation.previous":"prevAsset","click .image-navigation.next":"nextAsset",click:"decideClose","mouseenter .image-navigation.previous":"lightPrevArrow","mouseleave .image-navigation.previous":"unLightPrevArrow","mouseenter .image-navigation.next":"lightNextArrow","mouseleave .image-navigation.next":"unLightNextArrow"},nytEvents:{"nyt:page-key-esc":"forceClose","nyt:page-resize-after":"renderFromResize","nyt:mediaviewer-left":"prevAsset","nyt:mediaviewer-right":"nextAsset","nyt:open-media-viewer":"renderForEmbeddedSlideshow","nyt:route:slideshow":"initFromDeepLink"},initialize:function(){t.bindAll(this,"renderForSlideshow","renderFromSymbol","renderFromClick","writeVideoTemplateToViewer","nextAsset","prevAsset","pinchClose"),this.pageManager.addRoute("slideshow/:slideshowId(/:imageId)","slideshow"),this.setElement(this.templates.mediaViewer()),this.subscribe("nyt:slideshow-ad-render",this.renderSlideshowAd)},handleDomReady:function(){this.$body.on("click","."+this.slideshowClass,this.renderForSlideshow).on("click","."+this.overlayClass,this.renderFromSymbol).on("click","."+this.candidateClass,this.renderFromClick),this.hammer&&(this.hammer(this.el).on("swiperight",this.prevAsset),this.hammer(this.el).on("swipeleft",this.nextAsset),this.hammer(this.el).on("pinch",this.pinchClose)),this.$candidates=e("."+this.candidateClass),this.$headline=this.$(".media-viewer-headline"),this.$wrapper=this.$(".media-viewer-wrapper"),this.$counter=this.$(".media-viewer-counter"),this.$nav=this.$(".media-viewer-nav"),this.$body.find("#main").append(this.$el),this.$prevArrow=this.$el.find(".media-viewer-previous"),this.$nextArrow=this.$el.find(".media-viewer-next"),this.addViewerIcon(),this.trackingBaseData={action:"click",contentCollection:this.pageManager.getMeta("article:section"),region:"Body"},this.pageManager.checkRoute()},initFromDeepLink:function(t){var i,n=t[0],s=t.length>1?parseInt(t[1],10):null,a=e("#slideshow-"+n);return a.size()>0?(this.getAssetsFromJSON(a),s&&(i=this.collection.findWhere({id:s})),"undefined"==typeof i&&(i=this.collection.at(0)),this.$el.addClass("theme-dark"),this.changeLoader("dark"),this.contentType="slideshow",this.assetIndex=this.collection.indexOf(i),void this.render(i)):void 0},addViewerIcon:function(){var t=this.templates.mediaViewerIcon({classes:this.overlayClass});this.$candidates.each(function(){e(this).after(t)})},changeLoader:function(e){var t=this.$el.find(".loader"),i="loader-t-logo-32x32-ecedeb-ffffff",n="loader-t-logo-32x32-333333-121212";"dark"===e?t.removeClass(i).addClass(n):"light"===e&&t.removeClass(n).addClass(i)},getDimension:function(e,t,i,n){var s=this.pageManager.getViewport(),a=s.width-i,o=s.height-n;return e>a&&(t*=a/e,e=a),t>o&&(e*=o/t,t=o),{width:Math.round(e),height:Math.round(t)}},getAssetsFromJSON:function(i){var n=i.find("script").get(0).innerHTML,s=e.parseJSON(n),a=s.id;this.headline=s.headline,s=t.map(s.imageslideshow.slides,function(e){var t,i="",n="";return e&&e.image_crops&&(t=e.image_crops,t.superJumbo?i=t.superJumbo.url:t.jumbo?i=t.jumbo.url:t.articleLarge?i=t.articleLarge.url:t.slide?i=t.slide.url:t.popup&&(i=t.popup.url)),e&&e.caption&&(e.caption.full?n=e.caption.full:e.caption["short"]&&(n=e.caption["short"])),{id:e.data_id,src:i,caption:n,credit:e.credit}}),this.collection.reset(s),this.collection.slideshowId=a},getAssetsFromDOM:function(){var i,n=[];this.$candidates.each(function(){i={src:e(this).data("mediaviewer-src"),caption:e(this).data("mediaviewer-caption"),credit:e(this).data("mediaviewer-credit")},n.push(i)}),this.collection.reset(t.uniq(n,function(e){return e.src}))},broadcastAd:function(){var e="",t=0===this.assetIndex,i=this.collection.length,n=this.end();if(t&&!n)e="Slideshow_int";else{if(!(i>3&&n))return!1;e="Slideshow_end"}return this.broadcast("nyt:slideshow-ad",{el:this.$wrapper,position:e}),this.adRendered},renderSlideshowAd:function(t){var i,n,s,a,o,r,l;"slideshow"===this.contentType&&(i=this,n=this.pageManager.getCurrentBreakpoint(),s=this.$wrapper.find(".ad-wrapper"),a=2*parseInt(s.css("padding-left"),10),o=parseInt(t.get("width"),10),r=parseInt(t.get("height"),10),l=e(this.templates.continueButton({message:this.end()?"RETURN TO ARTICLE":"CONTINUE SLIDE SHOW"})),this.$adBtn=l,s.append(l).css({width:o,height:r,"margin-left":-(o+a)/2,"margin-top":-(r+a)/2}),this.$nav.find(".media-viewer-previous").hide(),this.$counter.hide(),this.$headline.text(this.headline||""),this.adRendered=!0,this.toggleLoader(!1),this.start(),this.active(!0),l.show().on("click",function(e){e.stopPropagation(),e.preventDefault(),i.renderAfterAd()}),n>=1e3&&1030>n&&l.hide())},renderAfterAd:function(){this.dismissAd(),this.render()},dismissAd:function(){this.$adBtn.off("click").hide(),this.$wrapper.html(""),this.$counter.show(),this.$nav.find(".media-viewer-previous").show(),this.adRendered=!1},renderForSlideshow:function(t){var i;e(t.target).hasClass("skip-to-text-link")||(i=e(t.currentTarget),"modal"===i.data("media-action")&&(this.assetIndex=0,this.$el.addClass("theme-dark"),this.changeLoader("dark"),this.getAssetsFromJSON(i),this.contentType="slideshow",this.render()))},renderForEmbeddedSlideshow:function(e,t){this.assetIndex=t,this.$el.addClass("theme-dark"),this.changeLoader("dark"),this.getAssetsFromJSON(e),this.contentType="embedded-slideshow",this.render()},renderFromSymbol:function(t){e(t.currentTarget).siblings("."+this.candidateClass).trigger("click")},renderFromResize:function(){var t;this.adRendered||(this.isActive&&this.isVideo?(t=e("figure.media-viewer-video"),this.handleVideo(t)):this.isActive&&this.render())},renderFromClick:function(t){var i;this.getAssetsFromDOM(),i=this.collection.findWhere({src:e(t.target).data("mediaviewer-src")}),this.assetIndex=this.collection.indexOf(i),this.contentType="images",this.render(i)},renderForVideo:function(e,t){this.videoModel=e,this.videoCallback=t,this.$el.addClass("theme-dark"),this.changeLoader("dark"),this.isVideo=!0,this.render(e)},writeVideoTemplateToViewer:function(){var t=this.videoModel?this.videoModel.get("videoId"):this.videoId,i=this.$body.find("figure[data-videoid="+t+"] .video-credit"),n=e(this.templates.video({videoId:t,credit:i.html()}));this.handleVideo(n),this.$wrapper.html(n),this.pageManager.isMobile()?"function"==typeof this.videoCallback&&this.videoCallback():this.broadcast("nyt:mediaviewer-open")},render:function(e){var t=this;if(t.toggleLoader(!0),!this.broadcastAd()){if(this.isVideo)this.renderVideo();else{if(this.end())return t.toggleLoader(!1),void this.close(!0);this.renderImage(e)}this.active(!0),this.$body.css("overflow","hidden"),this.$document.on("touchmove",function(e){e.preventDefault()}),this.setCounter(),this.toggleNav()}},renderVideo:function(){var e,t=this;this.pageManager.isMobile()?(this.start(),this.writeVideoTemplateToViewer()):this.start(this.writeVideoTemplateToViewer),t.toggleLoader(!1),e={module:"Video",version:"MediaViewer",eventName:"PlayVideo"},this.trackingTrigger("media-viewer-play-video",e),this.trackingComscorePVC(e)},renderImage:function(t){var i,n,s,a,o,r=this,l=this.collection.slideshowId;t=t||this.collection.at(this.assetIndex),i=t.get("id"),this.isActive||(this.start(),this.$headline.text(this.headline||""),this.broadcast("nyt:mediaviewer-open"),a={module:this.getTrackingModule(),version:this.getTrackingVersion(),eventName:this.getTrackingOpenEventName(),mdata:{currentSlide:this.assetIndex+1,totalSlides:this.collection.length}},this.trackingTrigger("media-viewer-opened",a),this.trackingComscorePVC(a)),n=e(this.templates.image({src:t.get("src"),caption:t.get("caption"),credit:t.get("credit")})),s=e(this.templates.bigAd3()),n.find("img").load(function(){r.handleImg(n,s),r.toggleLoader(!1)}),l&&i&&(o="slideshow/"+l+"/"+i,this.pageManager.navigateRoute(o,{trigger:!1,replace:!0})),this.$wrapper.html(n),this.$wrapper.append(s)},start:function(e){e=e||function(){},this.$el.fadeIn(this.speed,e)},toggleNav:function(){var e=this.$("nav"),t=this.isMobile();1===this.collection.length||this.isVideo||t&&this.pageManager.flag("mobileMediaViewer")?e.hide():e.show()},toggleLoader:function(e){var t=this.$el.find(".loader-container");e?t.show():t.hide()},handleImg:function(i,n){var s,a,o,r,l,d,c,h,u,m,p,g,f=this.settings,v=i.closest(".media-viewer"),y=i.find("img"),b=v.find("figcaption.caption"),w=e("nav.media-viewer-nav"),_={},C=this.getElementDimensions(w),T=this.getElementDimensions(y),k=t.extend({},this.pageManager.getViewport()),S=k.width,M=this.$html.hasClass("tone-feature"),P=T.width/T.height,A=k.width/(k.height-C.height-f.topMargin-f.basicMargin),x=P>A?"below":"right",I=this.isMobile();I&&this.pageManager.flag("mobileMediaViewer")?(v.addClass("mobile"),i.after(b),this.changeLoader("dark"),k={width:window.innerWidth,height:window.innerHeight},m=k.width/k.height,u=m>P?{width:"auto",height:"100%"}:{width:"100%",height:"auto"},T=this.getElementDimensions(y),l=k.height/2-T.height/2,r=k.width/2-T.width/2,i.css({visibility:"visible",top:l+"px",left:r+"px"}).css(u),y.animate({opacity:1},this.speed),b.css({display:"block",opacity:0}).animate({opacity:1},this.speed)):(this.pageManager.flag("mobileMediaViewer")&&(v.removeClass("mobile"),i.append(b),this.changeLoader("light")),k.height=k.height<150?150:k.height,k.width=k.width<100?100:k.width,this.$headline.css({"margin-right":0}),S>=1280&&M&&"slideshow"===this.contentType&&(k.width=S-330,this.$headline.css({"margin-right":330}),this.loadBigAd(),n.show(),P>f.imageAspectRatio&&(x="below")),"right"===x?(c=this.getImageSizeAvailable(b,C,x,k),h=this.getCaptionSize(b,C,x),_=this.getScaledImage(T,c),a=c.width/c.height,a>P?(p=_.width<T.width?_.width:T.width,g=c.height<T.height?c.height:T.height,i.css({height:g,width:p}),b.css({left:p+f.captionGutter,width:h.width,height:h.height}),(k.width-2*f.basicMargin-_.width)/2>h.width?(r=Math.round((k.width-_.width)/2),i.css({left:r,top:f.topMargin}),n.css({"margin-top":f.topMargin}),o=r<2*(C.width+f.basicMargin),d=f.topMargin+c.height+f.navGutter+C.height+f.basicMargin>k.height,
s=o&&d?C.height+f.navGutter+f.basicMargin:f.basicMargin,b.css({bottom:s,width:h.width})):(r=Math.round((k.width-(_.width+h.width))/2),i.css({left:r,top:f.topMargin}),n.css({"margin-top":f.topMargin}),b.css({bottom:f.basicMargin,width:h.width,height:h.height}))):(l=Math.round((k.height-_.height-f.topMargin)/2),l=Math.max(l,f.topMargin),r=Math.round((k.width-(c.width+h.width+f.captionGutter))/2),p=c.width<T.width?c.width:T.width,g=_.height<T.height?_.height:T.height,i.css({width:p,height:g,left:r,top:l}),n.css({"margin-top":l}),b.css({width:h.width,bottom:f.basicMargin,left:p+f.captionGutter}),h.height>_.height&&b.css({height:_.height}))):(h=this.getCaptionSize(b,C,x),c=this.getImageSizeAvailable(b,C,x,k),_=this.getScaledImage(T,c),a=c.width/c.height,a>P?(r=Math.round((k.width-_.width)/2),i.css({height:c.height,width:_.width,left:r,top:f.topMargin}),n.css({"margin-top":f.topMargin}),b.css({"max-width":550,width:c.width-C.width,"margin-settings.topMargin-top":f.captionGutter})):(r=Math.round((k.width-c.width)/2),l=Math.round((k.height-(_.height+h.height+f.captionGutter)-f.topMargin)/2),l=Math.max(l,f.topMargin),i.css({height:_.height,width:c.width,left:r,top:l}),n.css({"margin-top":l}),b.css({width:c.width,"margin-topmargin-top":f.captionGutter}))),i.css({visibility:"visible"}),n.css({width:300,height:250,"margin-left":30,"margin-right":30,"float":"right"}),b.css({display:"block",opacity:0}).animate({opacity:1},this.speed),y.animate({opacity:1},this.speed))},isMobile:function(){return e(window).width()<this.settings.mobileBreakpoint},loadBigAd:function(){var e=!0;this.loadedBigAd?this.broadcast("nyt:ad-library:dfp:refresh","BigAd3",e):(this.loadedBigAd=!0,this.broadcast("nyt:ad-library:dfp:queue-placement","BigAd3",[[300,250],[300,600]]))},getElementDimensions:function(e){return{width:e.width(),height:e.height()}},getScaledImage:function(e,t){return{width:Math.round(e.width/e.height*t.height),height:Math.round(e.height/e.width*t.width)}},getImageSizeAvailable:function(e,t,i,n){var s=this.getCaptionSize(e,t),a=this.settings,o=n.height-a.topMargin-a.basicMargin,r=n.width-2*a.basicMargin;return"right"===i?r-=s.width+a.captionGutter:"below"===i&&(o-=s.height+a.captionGutter),{width:r,height:o}},getCaptionSize:function(e,t,i){var n=this.getElementDimensions(e),s=this.settings;return n.width=Math.floor(Math.sqrt(n.width*n.height)),n.height=n.width,n.width=Math.max(n.width,t.width),"right"===i?(n.height=Math.round(n.height*(1/s.captionRatio)),n.width=Math.max(Math.round(n.width*s.captionRatio),t.width)):"below"===i&&(n.height=e.height(),n.width=Math.round(n.width*(1/s.captionRatio))),n},handleVideo:function(e){var t=this.pageManager.getViewport(),i=Math.round(t.width),n=Math.round(t.width*(9/16)),s=this.getDimension(i,n,0,70);e.css({visibility:"visible",width:s.width,height:s.height,"margin-left":-s.width/2,"margin-top":-(s.height/2-30),opacity:1})},lightPrevArrow:function(){this.unLightNextArrow(),this.$prevArrow.addClass("hover")},unLightPrevArrow:function(){this.$prevArrow.removeClass("hover")},lightNextArrow:function(){this.unLightPrevArrow(),this.$nextArrow.addClass("hover")},unLightNextArrow:function(){this.$nextArrow.removeClass("hover")},nextAsset:function(e){var t,i;return e&&(this.doClose="swipeleft"!==e.type),this.adRendered?void this.renderAfterAd():(this.unLightPrevArrow(),this.moveIndex(1),this.render(),t=this.assetIndex+1,i={module:this.getTrackingModule(),version:this.getTrackingVersion(),eventName:"NextAsset-"+t+(t===this.collection.length?"-Finish":""),mdata:{currentSlide:t,totalSlides:this.collection.length}},this.trackingTrigger("media-viewer-next-image",i),void this.trackingComscorePVC(i))},prevAsset:function(e){var t,i;e&&(this.doClose="swiperight"!==e.type),this.unLightNextArrow(),this.moveIndex(-1),this.render(),t=this.assetIndex+1,i={module:this.getTrackingModule(),version:this.getTrackingVersion(),eventName:"PrevAsset-"+t+(t===this.collection.length?"-Finish":""),mdata:{currentSlide:t,totalSlides:this.collection.length}},this.trackingTrigger("media-viewer-prev-image",i),this.trackingComscorePVC(i)},moveIndex:function(e){var t=this.assetIndex,i=this.collection.length;t+=e,this.stepsTaken+=e,t===i?t=0:-1===t&&(t=i-1),this.assetIndex=t},setCounter:function(e,t){e=e||this.assetIndex,t=t||this.collection.length,this.$counter.html(e+1+" of "+t)},pinchClose:function(){this.close(!0)},decideClose:function(t){var i=e(t.target),n=this.clickableElements.join(", "),s=i.is(n),a=this.isMobile();return a&&!i.hasClass("close-button")&&0===i.closest(".close-button").length?void this.toggleCaption():void(s||this.close(!0))},toggleCaption:function(){var e=this.$el.find("figcaption");e.fadeToggle(500)},forceClose:function(){this.close(!0)},close:function(e){var t=this.$el,i=this;return this.isVideo&&(this.videoId=0,this.isVideo=!1),e&&(this.doClose=!0),this.doClose?(this.adRendered&&this.dismissAd(),this.active(!1),this.stepsTaken=0,this.assetIndex=0,this.destroyHeadline(),this.$body.css("overflow",""),this.$document.off("touchmove"),this.pageManager.clearRoute(),void this.$el.fadeOut(this.speed,function(){t.removeClass("theme-dark"),i.changeLoader("light"),i.broadcast("nyt:mediaviewer-close")})):void(this.doClose=!0)},destroyHeadline:function(){this.$headline.empty(),this.headline=null},end:function(){return Math.abs(this.stepsTaken)===this.collection.length},active:function(e){this.broadcast("nyt:mediaviewer-visibility",e),this.pageManager.setMeta("mediaviewer_isVisible",e),this.isActive=e},getTrackingModule:function(){var e="";return"images"===this.contentType?e="ImageViewer":("embedded-slideshow"===this.contentType||"slideshow"===this.contentType)&&(e="Slideshow"),e},getTrackingVersion:function(){var e="";return"slideshow"===this.contentType?e="MediaViewer-Promo":"embedded-slideshow"===this.contentType?e="MediaViewer-NonPromo":"images"===this.contentType&&(e="MediaViewer"),e},getTrackingOpenEventName:function(){return"images"===this.contentType?"OpenImageViewer":"OpenSlideshow"}});return o}),define("shared/mediaviewer/instances/media-viewer",["shared/mediaviewer/views/media-viewer"],function(e){"use strict";return new e}),define("shared/video/views/embedded-videos",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/base-view","shared/video/models/video","shared/video/views/video","shared/mediaviewer/instances/media-viewer","foundation/views/page-manager"],function(e,t,i,n,s,a,o,r,l){"use strict";var d=s.extend({className:"video",el:e("figure.video"),videos:new n,events:{click:"handleVideoModalClick"},videoView:null,modalVideoModel:null,initialize:function(e){this.settings=t.extend({},e),this.subscribe("nyt:mediaviewer-open",this.onMediaViewerOpen),t.bindAll(this,"onVideoMediaViewerOpen","onMediaViewerClose"),this.genericVideoModel=new a,this.pageManager.isMobile()||this.subscribe(this.genericVideoModel.videoEvents.MEDIA_CHANGE,this.onMediaChange),this.pageManager.isDomReady()?this.handlePageReady():this.subscribeOnce("nyt:page-ready",this.handlePageReady)},handlePageReady:function(){var t=this;this.$el.each(function(){t.initVideoFigure(e(this))})},initVideoFigure:function(i){var n,s,r,l,d=!1,c=!0,h=i.data("videoid"),u=i.data("embedded")||!1,m=e("body").find("figure.video.lede").eq(0),p=this.genericVideoModel.playerTypes,g=i.data("live")||!1;return h?(s=this.getPlayerPosition(i),n=this.getPlayerType(s,i),this.pageManager.isDesktop()&&-1!==[p.ARTICLE_LEDE,p.BLOG].indexOf(n)&&(i.data("autoplay")===!0||this.checkExternalReferrerAutoPlay(m))&&(d=!0,c=!1),n===p.ARTICLE_MODAL&&(d=!0,c=!0),r={videoId:h,videoFigure:i,autoStart:d,width:"100%",height:"100%",modal:n===p.ARTICLE_MODAL?!0:!1,pagePosition:s,playerType:n,userInitiatedPlay:c,orphanVideo:u,live:g},l=new a(r),this.videos.add(l),void(n!==p.ARTICLE_MODAL?this.videoView=new o(t.extend({},this.settings.videoViewOptions,{model:l})):i.find(".caption a.video-link").click(function(e){e.stopPropagation()}))):!1},checkExternalReferrerAutoPlay:function(e){var t=document.referrer,i=t&&-1===t.split(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)[4].indexOf("nytimes.com"),n=!t||i,s=e&&e.data("autoplay")===!1,a=e&&"noads"!==e.data("adsensitivity"),o="article"===this.pageManager.getMeta("PT");return o&&a&&s&&n?!0:!1},handleVideoModalClick:function(t){var i=e(t.currentTarget),n=this.videos.findWhere({videoId:i.data("videoid")});return n?"link-to"===i.data("media-action")?void t.stopPropagation():void(n.get("modal")&&(t.preventDefault(),t.stopPropagation(),this.modalVideoModel=n,this.pageManager.isMobile()||this.subscribeOnce("nyt:mediaviewer-open",this.onVideoMediaViewerOpen),r.renderForVideo(this.modalVideoModel,this.onVideoMediaViewerOpen))):void 0},getPlayerPosition:function(e){var t,i=this.genericVideoModel.playerPositions;return t=e.hasClass("lede")?i.POSITION_LEDE:e.hasClass("inline")?i.POSITION_INLINE:"photospot"===e.data("position")?i.POSITION_PHOTOSPOT:i.POSITION_EMBEDDED},getPlayerType:function(e,t){var i,n=this.genericVideoModel.playerPositions,s=this.genericVideoModel.playerTypes;return i=t.hasClass("blog-video")?s.BLOG:e===n.POSITION_INLINE?s.ARTICLE_MODAL:e===n.POSITION_LEDE?s.ARTICLE_LEDE:e===n.POSITION_PHOTOSPOT?s.PHOTOSPOT:s.ARTICLE_EMBEDDED},onVideoMediaViewerOpen:function(){var i=e("figure.media-viewer-video");i&&this.modalVideoModel&&(this.subscribeOnce("nyt:mediaviewer-close",this.onMediaViewerClose),this.modalVideoModel.set("videoFigure",i),this.videoView=new o(t.extend({},this.settings.videoViewOptions,{model:this.modalVideoModel})))},onMediaViewerClose:function(){this.modalVideoModel&&(this.modalVideoModel.kill(),this.modalVideoModel=null,this.videoView=null)},onMediaViewerOpen:function(){this.videos.each(function(e){e&&e.pause()})},onMediaChange:function(t){var i;t.firstPlay||(i=e(t.container)||e(".video"),l.flag("videoVHSShareTools")?i.closest("figure").find(".summary-credit").animate({opacity:0}):i.closest("figure").find(".caption").animate({opacity:0}))}});return d}),define("shared/video/instances/videos",["jquery/nyt","underscore/nyt","shared/video/views/embedded-videos"],function(e,t,i){"use strict";var n=function(){var t;t=e("figure.video"),t.length>0&&new i({el:t,videoContainerSelector:"figure.video"})};e(document).ready(function(){t.defer(n)})}),define("shared/messaging/instances/push-notifications",["foundation/cookies"],function(e){"use strict";var t,i=function(t){"default"===t.permission?window.safari.pushNotification.requestPermission("https://www.nytimes.com/svc/pushmobile","web.com.nytimes",null,i):"granted"===t.permission&&e.writeCookie("NYT-mavericks",t.deviceToken)};"safari"in window&&"pushNotification"in window.safari&&(t=window.safari.pushNotification.permission("web.com.nytimes"),i(t))}),require(["homepage/instances/ad-manager","shared/account/instances/account","homepage/instances/recommendations","homepage/instances/masthead","homepage/instances/messaging","homepage/instances/navigation","homepage/instances/inside-nyt","homepage/instances/embedded-slideshow","homepage/instances/homepage","homepage/instances/tracking","homepage/instances/video-band","shared/video/instances/videos","shared/messaging/instances/push-notifications"]);
//# sourceMappingURL=main.js.map